
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pycsamt.geodrill.geoDB.sql_recorder &#8212; pyCSAMT v1.0.03 documentation</title>
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pyCSAMT v1.0.03 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pycsamt.geodrill.geoDB.sql_recorder</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===============================================================================</span>
<span class="sd">    Copyright Â© 2021  Kouadio K.Laurent</span>
<span class="sd">    </span>
<span class="sd">    This file is part of pyCSAMT.</span>
<span class="sd">    </span>
<span class="sd">    pyCSAMT is free software: you can redistribute it and/or modify</span>
<span class="sd">    it under the terms of the GNU Lesser General Public License as published by</span>
<span class="sd">    the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">    (at your option) any later version.</span>
<span class="sd">    </span>
<span class="sd">    pyCSAMT is distributed in the hope that it will be useful,</span>
<span class="sd">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">    GNU Lesser General Public License for more details.</span>
<span class="sd">    </span>
<span class="sd">    You should have received a copy of the GNU Lesser General Public License</span>
<span class="sd">    along with pyCSAMT.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="sd">===============================================================================  </span>

<span class="sd">.. _module-GeoDataBase::`pycsamt.geodrill.geoDB.sql_recorder`</span>
<span class="sd"> </span>
<span class="sd">    :synopsis: Special class to manage outputs-input requests from-into </span>
<span class="sd">                SQL  database .</span>
<span class="sd">                ...</span>
<span class="sd">                </span>
<span class="sd">.. warnings:: Editing this module presume that you are aware of what you  are doing.</span>
<span class="sd">              The module is a core of Geodrill subpackages. It is sensible module.</span>
<span class="sd">              However the the way the dataBase is arranged can be enhanced  and adapted</span>
<span class="sd">              for better convenient or other suitable purposes.</span>
<span class="sd">             </span>
<span class="sd">Created on Wed Oct 14 13:38:13 2020</span>

<span class="sd">@author:kkouaoLaurent alias @Daniel03</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># =============================================================================</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>  
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">pycsamt.geodrill.geoCore.structural</span> <span class="kn">import</span> <span class="n">Geo_formation</span> 
<span class="kn">import</span>  <span class="nn">pycsamt.utils.exceptions</span> <span class="k">as</span> <span class="nn">CSex</span> 

<span class="kn">from</span> <span class="nn">pycsamt.geodrill.geoDB.dict_app</span> <span class="kn">import</span> <span class="n">Glob</span>
<span class="kn">from</span> <span class="nn">pycsamt.geodrill.geoDB.interfaceDB</span> <span class="kn">import</span> <span class="n">ManageDB</span>

<span class="kn">from</span>  <span class="nn">pycsamt.utils.decorator</span> <span class="kn">import</span> <span class="n">redirect_cls_or_func</span>
<span class="kn">from</span> <span class="nn">pycsamt.utils._csamtpylog</span> <span class="kn">import</span> <span class="n">csamtpylog</span> 

<span class="c1">#set LogInfos</span>
<span class="k">try</span> <span class="p">:</span>
    <span class="n">_logger</span><span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="c1"># _logger.setLevel(logging.DEBUG)</span>
    <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
    <span class="c1"># lineno=__file__.__code__.co_firstlineno + 1</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span> <span class="p">:</span>
    <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No basic configuration found. Try to set logging.basicConfig()&quot;</span>\
                    <span class="s2">&quot;file as .json file or .yml file&quot;</span><span class="p">,</span><span class="n">error</span> <span class="p">)</span>
    
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn_explicit</span><span class="p">(</span><span class="s1">&#39;you may configure logFile&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span>
                           <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">pass</span> 

<span class="c1"># let set the systeme path find memory dataBase</span>
 
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>  
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">))</span> 
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../..&#39;</span><span class="p">))</span>  
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;pycsamt/geodrill/geoDB/sql_utils/sql_DB&#39;</span><span class="p">))</span>  <span class="c1"># for consistency  </span>

<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="GeoDataBase"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.GeoDataBase">[docs]</a><span class="k">class</span> <span class="nc">GeoDataBase</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Geodatabase class . Currently we do not create the specific pattern </span>
<span class="sd">    for each geostructures. DataBase is built is built following the   </span>
<span class="sd">       codef `code`,   `label`,`__description`,`pattern`, `pat_size`,`pat_density`,</span>
<span class="sd">       `pat_thickness`,`RGBA`, `electrical_props`, `hatch`, `colorMPL`, `FGDC` .</span>
<span class="sd">       </span>
<span class="sd">        </span>
<span class="sd">    Arguments</span>
<span class="sd">    -----------</span>
<span class="sd">        **geo_structure_name** : str </span>
<span class="sd">                Name of geological rocks , strata or layer.</span>
<span class="sd">                </span>
<span class="sd">    .. seealso:: FGDC-Digital cartographic Standard for Geological  Map Symbolisation. </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#  FGDC is not set yet , we use the  matplotlib pattern symbol makers </span>
    <span class="n">make_pattern_symbol</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> 
                          <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;\-&#39;</span><span class="p">,</span> <span class="s1">&#39;\+&#39;</span><span class="p">,</span> <span class="s1">&#39;\o&#39;</span><span class="p">,</span> <span class="s1">&#39;\O&#39;</span><span class="p">,</span> <span class="s1">&#39;\.&#39;</span><span class="p">,</span> <span class="s1">&#39;\*&#39;</span><span class="p">]</span> <span class="c1">#use &#39;\\&#39; rather than &#39;\&#39;.</span>
    <span class="c1"># latter , i will be deprecated to FGDC geological map symbolisation . </span>
    
    <span class="n">codef</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">,</span><span class="s1">&#39;__description&#39;</span><span class="p">,</span><span class="s1">&#39;pattern&#39;</span><span class="p">,</span> <span class="s1">&#39;pat_size&#39;</span><span class="p">,</span>	<span class="s1">&#39;pat_density&#39;</span><span class="p">,</span><span class="s1">&#39;pat_thickness&#39;</span><span class="p">,</span><span class="s1">&#39;rgb&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;electrical_props&#39;</span><span class="p">,</span> <span class="s1">&#39;hatch&#39;</span><span class="p">,</span> <span class="s1">&#39;colorMPL&#39;</span><span class="p">,</span> <span class="s1">&#39;FGDC&#39;</span> <span class="p">]</span>
    <span class="c1"># geoDataBase=os.path.join(os.environ[&#39;pyCSAMT&#39;],&#39;pycsamt&#39;,</span>
    <span class="c1">#                &#39;geodrill&#39;, &#39;geoDB&#39;,&#39;sql_utils&#39;, &#39;sql_DB&#39;, &#39;memory.sq3&#39;) # locate the geodataBase</span>
    <span class="n">geoDataBase</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;pycsamt/geodrill/geoDB/sql_utils/sql_DB&#39;</span><span class="p">),</span> 
                               <span class="s1">&#39;memory.sq3&#39;</span><span class="p">)</span>
    
    <span class="c1"># :memory: is faster we chose this options :geoDataBase.sq3 in sql_DB contains drill holes and wells Tables </span>
    <span class="c1"># will develop in the future extensions </span>
 
    
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geo_structure_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span> <span class="o">=</span> <span class="n">geo_structure_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dateTime</span><span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>          <span class="c1"># Get the date time now  </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span><span class="kc">None</span>                                       <span class="c1"># initialise comment  text</span>
        
  
        <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span><span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span><span class="o">=</span><span class="kc">None</span>

        <span class="k">try</span> <span class="p">:</span> 
        <span class="c1"># to connect geodataBse </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span> <span class="o">=</span><span class="n">ManageDB</span><span class="p">(</span><span class="n">db_host</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoDataBase</span><span class="p">),</span> 
                                      <span class="n">db_name</span> <span class="o">=</span><span class="s1">&#39;memory.sq3&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span> 
            <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;Connection to geoDataBase failed! Sorry we can not give a suitable reply for your request!&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;It would  be process with &quot;geological structural class.&quot; !&#39;</span><span class="p">])</span>
            
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">success</span><span class="o">=</span> <span class="mi">0</span>
 
        <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="mi">1</span> 

<div class="viewcode-block" id="GeoDataBase._avoid_injection"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.GeoDataBase._avoid_injection">[docs]</a>    <span class="k">def</span> <span class="nf">_avoid_injection</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For secure , we do not firstly introduce directly the request. We will check </span>
<span class="sd">        whether the object `request`   exists effectively  in our</span>
<span class="sd">        GeoDatabase . if not , request will be redirect to structural and strata class </span>
<span class="sd">        issue from  module `structural`</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.manage_geoDataBase.executeReq(&quot; select __description  from AGS0&quot;)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c1"># for consistency </span>
        <span class="n">manage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot; select __description  from AGS0&quot;</span><span class="p">)</span>
        <span class="n">__description</span> <span class="o">=</span> <span class="p">[</span> <span class="n">geoform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">geoform</span> <span class="ow">in</span>  <span class="nb">list</span><span class="p">(</span><span class="n">manage</span><span class="p">)]</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span> <span class="ow">in</span> <span class="n">__description</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_exists</span> <span class="o">=</span><span class="kc">True</span> 
            
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;Structure &lt;</span><span class="si">%s</span><span class="s1">&gt; does not exist  in our GeoDataBase yet.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_exists</span> <span class="o">=</span><span class="kc">False</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">debug</span> <span class="p">(</span><span class="s1">&#39;Could not find a </span><span class="si">{0}</span><span class="s1"> in our geoDataBase.&#39;</span>\
                                 <span class="s1">&#39; It would be redirect to _strata and _structural classes for suitable processing.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">))</span></div>
            
            <span class="c1"># self.manage_geoDataBase.closeDB() # close the database</span>
            
        <span class="c1"># if self.geo_structure_exists : </span>
        <span class="c1">#     self._get_geo_structure()</span>

        
<div class="viewcode-block" id="GeoDataBase._get_geo_structure"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.GeoDataBase._get_geo_structure">[docs]</a>    <span class="k">def</span> <span class="nf">_get_geo_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        After checking wether the name of structures exists , </span>
<span class="sd">        let find the geoformation properties   from geodatabase  . </span>
<span class="sd">      </span>
<span class="sd">        :param struture_name:   name of geological rock or layer </span>
<span class="sd">        :type struture_name: str</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">structure_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span> <span class="o">=</span> <span class="n">structure_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> 
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No name is inputted as geological formation. Sorry ,&#39;</span>
                          <span class="s1">&#39; your request is aborted !&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_manager</span><span class="p">(</span><span class="s1">&#39;No name is inputted as geological formation. Sorry ,&#39;</span>\
                          <span class="s1">&#39; your request is aborted !&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1"># Then try to check whether strcuture name is write or Not</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_avoid_injection</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_exists</span> <span class="p">:</span> <span class="c1"># Then execute the request </span>
            <span class="n">__geonames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;Select * from AGS0 where __description = &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span>\
                                                 <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())))[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># keep only the tuple values </span>
     
            <span class="c1"># once value is get then set attribute  for each column of geoDataBase</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">codec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codef</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">codef</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="n">codec</span> <span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorMPL</span><span class="o">=</span> <span class="n">__geonames</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="c1"># if &#39;#&#39; in __geonames[ii] : # we assume that value colorMPL is hexadecimal value eg : #0000ff</span>
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorMPL</span><span class="p">)</span> <span class="c1"># color MPL format to  string tuple  like &#39;(1.0, 0.5, 0.23)&#39;</span>
                    <span class="c1"># else :                      # value in RGB color (0-1 --&gt; 0 to 255 bits)</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">codef</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">==</span> <span class="n">codec</span> <span class="p">:</span> <span class="c1"># set electrical properties (min,max) line (1e-5,5.2e0 )</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">electrical_props</span> <span class="o">=</span> <span class="n">__geonames</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">codec</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrical_props</span><span class="p">)</span> <span class="c1"># get color matplotlib from property attributes</span>

                <span class="k">else</span> <span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">codec</span> <span class="p">,</span> <span class="n">__geonames</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span></div>
                
<div class="viewcode-block" id="GeoDataBase._reminder_geo_recorder"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.GeoDataBase._reminder_geo_recorder">[docs]</a>    <span class="k">def</span> <span class="nf">_reminder_geo_recorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geo_structure_name</span> <span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To have reminder of geological formation into the geodatabase ,</span>
<span class="sd">        this method allow to output information </span>
<span class="sd">        if the structure doesnt not exist, An error will occurs. </span>
<span class="sd">        </span>
<span class="sd">        :param geo_structure_name: name of geological formation </span>
<span class="sd">        :type geo_structure_name: str </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;---&gt;&quot;</span><span class="si">{}</span><span class="s1">&quot; Request successfully introduced ! &#39;</span>  
        
        <span class="k">if</span> <span class="n">geo_structure_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span> <span class="o">=</span> <span class="n">geo_structure_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> 
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoDataBase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_avoid_injection</span><span class="p">()</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_exists</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span> 
        
            <span class="n">__geonames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;Select * from AGS0 where __description = &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span>\
                                                 <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># keep only the tuple values </span>
            

            <span class="nb">print</span><span class="p">(</span><span class="n">mess</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">__geonames</span><span class="p">)</span>
            
        
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">closeDB</span><span class="p">()</span> <span class="c1"># close the database </span></div>
        
                
<div class="viewcode-block" id="GeoDataBase._update_geo_structure"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.GeoDataBase._update_geo_structure">[docs]</a>    <span class="k">def</span> <span class="nf">_update_geo_structure</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geo_formation_name</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update _indormation into geoDataBase . </span>
<span class="sd">        </span>
<span class="sd">        Remember that the geodatabase is build following this table</span>
<span class="sd">        codef &#39;code&#39;,&#39;label&#39;,&#39;__description&#39;,&#39;pattern&#39;, &#39;pat_size&#39;,</span>
<span class="sd">        &#39;pat_density&#39;,&#39;pat_thickness&#39;,&#39;rgb&#39;,&#39;electrical_props&#39;,  &#39;hatch&#39;,</span>
<span class="sd">        &#39;colorMPL&#39;, &#39;FGDC&#39;. </span>
<span class="sd">        </span>
<span class="sd">        :param geo_formation_name:  name of formation be sure the formation</span>
<span class="sd">                             already exists in the geoDataBase </span>
<span class="sd">                             if not an error occurs </span>
<span class="sd">        :type geo_formation_name: str</span>
<span class="sd">        </span>
<span class="sd">        - Update the electrical property of basement rocks = [1e99, 1e6 ]</span>
<span class="sd">        </span>
<span class="sd">        :Example:</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from pycsamt.geodrill.geoDB.sql_recorder import GeoDataBase </span>
<span class="sd">            &gt;&gt;&gt; GeoDataBase()._update_geo_structure(**{&#39;__description&#39;:&#39;basement rocks&#39;, </span>
<span class="sd">                                            &#39;electrical_props&#39;:[1e99, 1e6 ]})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fmt_mess</span> <span class="o">=</span> <span class="s1">&#39;---&gt; </span><span class="si">{0}</span><span class="s1"> was successfully set to geoDataBase. Old value = </span><span class="si">{1}</span><span class="s1"> is updated to = </span><span class="si">{2}</span><span class="s1">&#39;</span>
        
        <span class="k">if</span> <span class="n">geo_formation_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1"># find geological rocks name if is in keywords dict</span>
            <span class="k">if</span> <span class="s1">&#39;__description&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kws</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span> 
                <span class="n">geo_formation_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;__description&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kws</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span> 
                <span class="n">geo_formation_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="s1">&#39; ! Unable to find a new geological structure name.&#39;</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geo_formation_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="p">:</span> 
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="s1">&#39;Unacceptable rock/layer name =</span><span class="si">{0}</span><span class="s1">.&#39;</span>\
                                                              <span class="s1">&#39; Please provide a right rock/layer name.&#39;</span><span class="p">)</span>
        <span class="n">geo_formation_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">geo_formation_name</span><span class="p">)</span> <span class="c1"># for consistency </span>
        
        <span class="k">if</span> <span class="n">geo_formation_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span> <span class="o">=</span> <span class="n">geo_formation_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> 
        
        <span class="c1"># build new_dictionnary without the keyname and key value of dictionnay </span>
        <span class="n">tem_geodict</span> <span class="o">=</span><span class="p">{</span><span class="n">geokey</span><span class="p">:</span><span class="n">geovalue</span> <span class="k">for</span> <span class="n">geokey</span> <span class="p">,</span> <span class="n">geovalue</span> <span class="ow">in</span> <span class="n">kws</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> 
                      <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">geokey</span> <span class="o">==</span><span class="s1">&#39;__description&#39;</span> <span class="ow">or</span> <span class="n">geokey</span> <span class="o">==</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="c1"># we can alse use list excep the both name</span>
                      <span class="p">}</span> <span class="c1"># because the update need absoluteld to provided a name of the rocks </span>
        

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1"># chech on databas if structural name exists </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_avoid_injection</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_exists</span> <span class="ow">is</span> <span class="kc">False</span> <span class="p">:</span> 
            <span class="n">mess</span> <span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; Actually geological formation name =  &lt;</span><span class="si">{0}</span><span class="s1">&gt; can not be updated because&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">),</span> 
                           <span class="s1">&#39; it doesnt  exist in our DataBase. To set new geological formation with their corresponding values &#39;</span><span class="p">,</span> 
                           <span class="s1">&#39; see { _add_geo_structure } method .&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="s1">&#39;Update name= </span><span class="si">{0}</span><span class="s1">  failed ! it doesnt not exist in geoDataBase&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">))</span>
                    
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_exists</span> <span class="p">:</span> <span class="c1"># even the geostructure exists , let check wether the key provided </span>
            <span class="k">for</span> <span class="n">geo_key</span> <span class="ow">in</span> <span class="nb">list</span> <span class="p">(</span><span class="n">tem_geodict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span> <span class="c1"># is among the geocodes keys</span>
                <span class="k">if</span> <span class="n">geo_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">codef</span> <span class="p">:</span> <span class="c1"># if key provided not in geodatable keys </span>
                    
                    <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;Sorry the key = </span><span class="si">{0}</span><span class="s2"> is wrong! key doesnt exist in geoDataBase.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geo_key</span><span class="p">),</span> 
                                   <span class="s2">&quot; Please provide a right keys among = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codef</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_manager</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
        
                <span class="k">elif</span> <span class="n">geo_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">codef</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">geo_key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;pat&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">:</span> 
                        <span class="k">try</span> <span class="p">:</span> 
                            <span class="n">update_geo_values</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="n">geo_key</span><span class="p">])</span> <span class="c1"># keep value to real</span>
                        <span class="k">except</span> <span class="p">:</span> 
                            <span class="n">msg</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;update failed ! Could not convert value = </span><span class="si">{0}</span><span class="s1"> to float.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="n">geo_key</span><span class="p">]),</span> 
                                          <span class="s1">&#39;Please try again later.&#39;</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                            
                    <span class="c1"># let get the formatage of all values  (properties values )  </span>
                    <span class="k">elif</span> <span class="n">geo_key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;colorMPL&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">colorMPL</span> <span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="n">geo_key</span><span class="p">]</span> 
                        <span class="n">update_geo_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorMPL</span>
                                    
                    <span class="k">elif</span> <span class="n">geo_key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;rgb&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> <span class="c1"># let fill automatically the &quot;rgb&quot; and the colorMPL </span>
                        <span class="c1"># keep the rgb value g : R125G90B29 and compute the colorMPL</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rgb</span> <span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="n">geo_key</span><span class="p">]</span>
                        <span class="n">update_geo_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rgb</span>
                    <span class="k">elif</span> <span class="n">geo_key</span> <span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;hatch&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">hatch</span> <span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="n">geo_key</span><span class="p">]</span>
                        <span class="n">update_geo_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hatch</span>
                    <span class="k">elif</span> <span class="n">geo_key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;electrical_props&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">electrical_props</span> <span class="o">=</span><span class="n">kws</span><span class="p">[</span><span class="n">geo_key</span><span class="p">]</span>
                        <span class="n">update_geo_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrical_props</span>

                    <span class="k">else</span> <span class="p">:</span> <span class="n">update_geo_values</span> <span class="o">=</span><span class="nb">str</span> <span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="n">geo_key</span><span class="p">])</span>
                    <span class="c1"># now must be put on the data base</span>
                    
                    <span class="k">if</span> <span class="n">geo_key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;rgb&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">:</span> <span class="c1"># fill automaticall colorMPL when rgb is provided </span>
                    
                        <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;update AGS0 set rgb = &#39;</span><span class="si">{0}</span><span class="s2">&#39;  where __description =&#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span>\
                                                 <span class="nb">format</span><span class="p">(</span> <span class="n">update_geo_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;update AGS0 set colorMPL= &#39;</span><span class="si">{0}</span><span class="s2">&#39;  where __description =&#39;</span><span class="si">{1}</span><span class="s2">&#39;&quot;</span><span class="o">.</span>\
                                                 <span class="nb">format</span><span class="p">(</span><span class="n">update_geo_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">))</span>
                    
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">__oldvalues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;Select * from AGS0 where __description =&#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span>\
                                                 <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;update AGS0 set </span><span class="si">{0}</span><span class="s2">= &#39;</span><span class="si">{1}</span><span class="s2">&#39;  where __description =&#39;</span><span class="si">{2}</span><span class="s2">&#39;&quot;</span><span class="o">.</span>\
                                                     <span class="nb">format</span><span class="p">(</span><span class="n">geo_key</span><span class="p">,</span> <span class="n">update_geo_values</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">))</span>
                        <span class="n">__newvalues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;Select * from AGS0 where __description =&#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span>\
                                                 <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>    <span class="c1"># inout new info to database from cursor </span>
                    
                    <span class="k">if</span> <span class="n">geo_key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;rgb&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; </span><span class="si">{0}</span><span class="s1"> colors was successfully set to rgb = </span><span class="si">{1}</span><span class="s1"> &amp; matplotlib rgba = </span><span class="si">{2}</span><span class="s1">.&#39;</span><span class="o">.</span>\
                              <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">,</span> <span class="n">update_geo_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">update_geo_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span> <span class="p">:</span> 
                        <span class="n">fmt_mess</span> <span class="o">=</span> <span class="s1">&#39;---&gt; </span><span class="si">{0}</span><span class="s1"> was successfully set to geoDataBase.</span><span class="se">\n</span><span class="s1"> ** Old value = </span><span class="si">{1}</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> is **updated to </span><span class="se">\n</span><span class="s1"> New value = </span><span class="si">{2}</span><span class="s1">&#39;</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">fmt_mess</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">,</span><span class="n">__oldvalues</span><span class="p">,</span> <span class="n">__newvalues</span> <span class="p">))</span>
                        
            <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">closeDB</span><span class="p">()</span> <span class="c1"># close the database </span></div>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">hatch</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> 
    <span class="nd">@hatch</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">hatch</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mpl_hatch</span><span class="p">):</span>
        <span class="n">mm</span><span class="o">=</span><span class="mi">0</span>  <span class="c1"># counter  of hach symbol present on the value provided </span>
        <span class="n">mpl_hatch</span> <span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">mpl_hatch</span><span class="p">)</span> <span class="c1"># for consitency put on string value </span>
        <span class="c1"># removed the tuple sign  &quot;( and )&quot; if provided </span>
        <span class="k">if</span> <span class="s1">&#39;(&#39;</span>  <span class="ow">in</span> <span class="n">mpl_hatch</span>  <span class="p">:</span> <span class="n">mpl_hatch</span> <span class="o">=</span><span class="n">mpl_hatch</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span>   <span class="s1">&#39;)&#39;</span> <span class="ow">in</span> <span class="n">mpl_hatch</span><span class="p">:</span> <span class="n">mpl_hatch</span> <span class="o">=</span><span class="n">mpl_hatch</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1"># chech whether the value provided is right </span>
        <span class="k">if</span> <span class="n">mpl_hatch</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span><span class="n">mpl_hatch</span>  <span class="c1"># keep the initialised value </span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">mpstr</span>  <span class="ow">in</span> <span class="n">mpl_hatch</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">mpstr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_pattern_symbol</span>  <span class="p">:</span> 
                    <span class="n">mm</span> <span class="o">+=</span><span class="mi">1</span> 
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpl_hatch</span><span class="p">)</span> <span class="o">==</span> <span class="n">mm</span> <span class="p">:</span>  <span class="c1">#all value are symbols  and put the  </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">mpl_hatch</span> <span class="o">+</span><span class="s1">&#39;)&#39;</span>
            <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span><span class="s1">&#39;none&#39;</span> <span class="c1"># abandon value and initialise to None </span>


<div class="viewcode-block" id="GeoDataBase._add_geo_structure"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.GeoDataBase._add_geo_structure">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_add_geo_structure</span><span class="p">(</span> <span class="n">new_geological_rock_name</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span> <span class="p">:</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add new _geological information  into geodatabase .</span>
<span class="sd">        </span>
<span class="sd">        DataBase properties:</span>
<span class="sd">        --------------------</span>
<span class="sd">            - code</span>
<span class="sd">            - label</span>
<span class="sd">            - __description</span>
<span class="sd">            - pattern </span>
<span class="sd">            - pat_size	</span>
<span class="sd">            - pat_density</span>
<span class="sd">            - pat_thickness</span>
<span class="sd">            - rgb&#39;</span>
<span class="sd">            - electrical_props</span>
<span class="sd">            - hatch</span>
<span class="sd">            - colorMPL</span>
<span class="sd">            - FGDC </span>
<span class="sd">            </span>
<span class="sd">        .. note:: `__description` could be replaced by `name`.</span>
<span class="sd">                    `code` , `label` and `FGDC` dont need to be fill. </span>
<span class="sd">                    Values are rejected if given.</span>
<span class="sd">                    </span>
<span class="sd">                </span>
<span class="sd">        :param new_geological_rock_name: new name of geological formation to add </span>
<span class="sd">        :type new_geological_rock_name: str </span>
<span class="sd">        </span>
<span class="sd">        :param informations: dict , must be on keyward keys  when keywords keys </span>
<span class="sd">                                are provided , program will check whether all keys are</span>
<span class="sd">                                effectively the right keys. if not will aborted the process.</span>
<span class="sd">        :type informations: dict</span>
<span class="sd">        </span>
<span class="sd">        :Example: </span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from pycsamt.geodrill.geoDB.sql_recorder import GeoDataBase </span>
<span class="sd">            &gt;&gt;&gt; geodatabase_obj= GeoDataBase._add_geo_structure( **{</span>
<span class="sd">            ...                                     &#39;name&#39;: &#39;massive sulfure&#39;, </span>
<span class="sd">            ...                                     &#39;pattern&#39;: 218., </span>
<span class="sd">            ...                                     &#39;pat_size&#39;: 250., </span>
<span class="sd">            ...                                     &#39;pat_density&#39;: 0.75, </span>
<span class="sd">            ...                                     &#39;pat_thickness&#39;: 2., </span>
<span class="sd">            ...                                     &#39;rgb&#39;: &#39;R128B28&#39;,</span>
<span class="sd">            ...                                     &#39;hatch&#39;: &#39;+.+.o.+&#39;, </span>
<span class="sd">            ...                                     &#39;electrical_props&#39;:[1e0 , 1e-2],</span>
<span class="sd">            ...                                     } )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="nf">__generate_structure_code</span> <span class="p">(</span><span class="n">__description</span> <span class="p">,</span> <span class="n">__geocodeList</span><span class="p">)</span> <span class="p">:</span> 
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Will geological description will create a code and label </span>

<span class="sd">            :param __description: name of geological formation </span>
<span class="sd">            :type __description: str </span>
<span class="sd">  </span>
<span class="sd">            :returns: geological formation code </span>
<span class="sd">            :rtype: str </span>
<span class="sd">            </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">def</span> <span class="nf">_rev_func_code</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">CODE</span><span class="p">):</span> 
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                generate code and check thin new code  doesnt not exist in </span>
<span class="sd">                amongs the code of geoDataBase .</span>

<span class="sd">                :param code:  new_generate code </span>
<span class="sd">                :type code: str </span>
<span class="sd">                :param CODE: codes already exists in dataBase </span>
<span class="sd">                :type CODE: str </span>
<span class="sd">                </span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="c1"># actually the lencode is &gt; than 3 </span>
                <span class="n">mm</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">while</span> <span class="n">code</span>  <span class="ow">in</span> <span class="n">CODE</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CODE</span> <span class="p">:</span> 
                        <span class="k">break</span> 
                    <span class="k">if</span> <span class="n">mm</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">):</span> 
                        <span class="n">mm</span><span class="o">=</span><span class="mi">0</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="n">code</span> <span class="o">+</span> <span class="n">code</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span>
                    <span class="n">mm</span><span class="o">=</span><span class="n">mm</span><span class="o">+</span><span class="mi">1</span>
            
                <span class="k">return</span> <span class="n">code</span>
                
            <span class="c1"># fisrtly code is marked by three ,main letters </span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">__description</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">:</span><span class="n">code</span><span class="o">=</span>  <span class="n">__description</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> 
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">__description</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">code</span> <span class="o">=</span><span class="n">__description</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> 
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">__description</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">:</span>
                <span class="n">nadd</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">code</span> <span class="o">=</span><span class="n">__description</span> <span class="c1"># loop thin you find a code =3 </span>
                <span class="k">while</span> <span class="n">nadd</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span> <span class="p">)</span><span class="o">==</span> <span class="mi">3</span> <span class="p">:</span> 
                        <span class="k">break</span> 
                    <span class="n">code</span> <span class="o">+=</span> <span class="n">code</span><span class="p">[</span><span class="n">nadd</span><span class="p">]</span>
                    <span class="n">nadd</span> <span class="o">+=</span><span class="mi">1</span> 
                <span class="n">code</span> <span class="o">=</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="c1"># then check whether the new code generate exist or not.</span>
            
            <span class="k">for</span> <span class="n">cof</span> <span class="ow">in</span> <span class="n">__geocodeList</span>  <span class="p">:</span> 
                <span class="k">if</span> <span class="n">code</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="n">__geocodeList</span> <span class="p">:</span> <span class="k">return</span> <span class="n">code</span> 
                <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">__geocodeList</span> <span class="p">:</span> 
                    <span class="n">code</span> <span class="o">=</span><span class="n">_rev_func_code</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span><span class="n">code</span> <span class="p">,</span> <span class="n">CODE</span><span class="o">=</span><span class="n">__geocodeList</span><span class="p">)</span>  

            <span class="k">return</span> <span class="n">code</span>             <span class="c1"># return new code that not exist in geocodes </span>
            
        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Starting process  new geological information into GeoDatabase&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">new_geological_rock_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1"># find geological rocks name if is in keywords dict</span>
            <span class="k">if</span> <span class="s1">&#39;__description&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kws</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span> 
                <span class="n">new_geological_rock_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;__description&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kws</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span> 
                <span class="n">new_geological_rock_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="s1">&#39; ! Unable to find a new geo_logical structure name.&#39;</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_geological_rock_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="p">:</span> 
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="s1">&#39;Unacceptable rocks names =</span><span class="si">{0}</span><span class="s1">.&#39;</span>\
                                                              <span class="s1">&#39; Please provide a right rock name.&#39;</span><span class="p">)</span>
        <span class="n">new_geological_rock_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">new_geological_rock_name</span><span class="p">)</span> <span class="c1"># </span>
        
        
        <span class="c1"># ---------------------------call Geodatabse --------------------------</span>
        
        <span class="n">geoDataBase_obj</span> <span class="o">=</span>  <span class="n">GeoDataBase</span><span class="p">(</span><span class="n">new_geological_rock_name</span><span class="p">)</span>
        
        <span class="n">mmgeo</span><span class="o">=</span><span class="p">{</span><span class="n">geokey</span> <span class="p">:</span> <span class="s1">&#39;none&#39;</span> <span class="k">for</span> <span class="n">geokey</span> <span class="ow">in</span> <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">codef</span> <span class="p">}</span> <span class="c1"># initialise to &#39;none&#39; value </span>
        
        <span class="k">if</span> <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">success</span> <span class="o">==</span><span class="mi">1</span> <span class="p">:</span>  <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">_avoid_injection</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">success</span>  <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">mess</span> <span class="o">=</span> <span class="s2">&quot;Connection to SQL geoDataBase failed ! Try again later.&quot;</span> 
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_geoDataBase</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            
        <span class="c1">#----------------------------------------------------------------------</span>
       
        <span class="k">if</span> <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">geo_structure_exists</span> <span class="p">:</span> 
            <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;! Name </span><span class="si">{0}</span><span class="s1"> already exists in our GeoDataBase. Could not add &#39;</span>\
                <span class="s1">&#39;again as new geostructure. Use &quot;_update_geo_geostructure method&quot; to update infos if you need !&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">geo_structure_name</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">geo_structure_exists</span> <span class="ow">is</span> <span class="kc">False</span> <span class="p">:</span> 
  
            <span class="c1"># make an copy of codef useful in the case where  user provided &quot;name&quot; as key instead of &quot;__description&quot; </span>
            <span class="kn">import</span> <span class="nn">copy</span> 
            <span class="n">new_codef</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">codef</span><span class="p">)</span>
            <span class="n">mmgeo</span> <span class="p">[</span><span class="s1">&#39;__description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_geological_rock_name</span><span class="p">)</span> <span class="c1">#  set the first value of keys to fill </span>
            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kws</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span> 
                 <span class="n">new_codef</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;name&#39;</span>
            
            <span class="c1"># get the list of geo_code values in DataBase </span>
            <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;Select code  from AGS0 &#39;</span><span class="p">)</span>
            
            <span class="n">__geocode</span> <span class="o">=</span><span class="p">[</span><span class="n">codegeo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">codegeo</span> <span class="ow">in</span>  
                        <span class="nb">list</span><span class="p">(</span><span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="p">)]</span>
            
            
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kws</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span> 

                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_codef</span>  <span class="p">:</span> 
                    <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span> <span class="s1">&#39;Process aborted ! wrong &lt;</span><span class="si">{0}</span><span class="s1">&gt; key!&#39;</span>\
                                                              <span class="s1">&#39; could not add new informations. Please check your key !&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                
                <span class="k">elif</span> <span class="n">key</span>  <span class="ow">in</span> <span class="n">new_codef</span><span class="p">:</span>  <span class="c1">#  set code and labels from geo_description name </span>
                
                    <span class="k">try</span> <span class="p">:</span> <span class="c1"># check if name is provided intead of  __description name (generaly code and label are the same)</span>
                        <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__generate_structure_code</span> <span class="p">(</span><span class="n">new_geological_rock_name</span><span class="p">,</span> <span class="n">__geocode</span><span class="p">)</span>
                        <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">__generate_structure_code</span> <span class="p">(</span><span class="n">new_geological_rock_name</span><span class="p">,</span>  <span class="n">__geocode</span><span class="p">)</span>
 
                    <span class="k">except</span> <span class="p">:</span> <span class="c1"># user can provide name instead of __description </span>
                        <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__generate_structure_code</span> <span class="p">(</span><span class="n">new_geological_rock_name</span><span class="p">,</span> <span class="n">__geocode</span><span class="p">)</span>
                        <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">__generate_structure_code</span> <span class="p">(</span><span class="n">new_geological_rock_name</span><span class="p">,</span> <span class="n">__geocode</span> <span class="p">)</span>
 
                    
                    <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;pat&#39;</span><span class="p">)</span><span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">:</span>
                        <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                
                        <span class="k">for</span> <span class="n">kvalue</span>  <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pattern&#39;</span><span class="p">,</span> <span class="s1">&#39;pat_size&#39;</span><span class="p">,</span>	<span class="s1">&#39;pat_density&#39;</span><span class="p">,</span><span class="s1">&#39;pat_thickness&#39;</span><span class="p">]:</span> 
                            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">kvalue</span> <span class="p">:</span> 
                                <span class="n">mmgeo</span><span class="p">[</span><span class="n">kvalue</span><span class="p">]</span><span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                                
                    <span class="c1"># set RGB value and MPL colors eg : R128G128B --.(0.50, 0.5, 1.0)</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span><span class="s1">&#39;rgb&#39;</span> <span class="p">:</span>
                        <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">rgb</span><span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        
                        <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;rgb&#39;</span><span class="p">]</span><span class="o">=</span>  <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># set at the same time rgb value and color MPL </span>
                        <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;colorMPL&#39;</span><span class="p">]</span><span class="o">=</span>  <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        
                    <span class="c1"># set Matplotlib color whether the rgb is not provided . if provided will skip </span>
                    
                    <span class="k">if</span> <span class="n">key</span><span class="o">==</span><span class="s1">&#39;colorMPL&#39;</span><span class="p">:</span> 
                        <span class="k">if</span> <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;colorMPL&#39;</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;none&#39;</span> <span class="p">:</span> 
                            <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">colorMPL</span><span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                            <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;colorMPL&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">colorMPL</span>
                    <span class="c1"># optional keys </span>
                    
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;electrical_props&#39;</span> <span class="p">:</span> 
                        <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">electrical_props</span><span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;electrical_props&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">electrical_props</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;hatch&#39;</span><span class="p">:</span> 
                        
                        <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;hatch&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;FGDC&#39;</span><span class="p">:</span> 
                        <span class="n">mmgeo</span><span class="p">[</span><span class="s1">&#39;FGDC&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        
            <span class="c1"># print(geoDataBase_obj.success)</span>
            <span class="c1"># now build insert all info </span>
            <span class="n">mm_sql</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">codk</span> <span class="ow">in</span> <span class="n">new_codef</span><span class="p">:</span>  <span class="c1"># build info in order and input to GeodataBase</span>
                <span class="k">if</span> <span class="n">codk</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="n">codk</span> <span class="o">=</span> <span class="s1">&#39;__description&#39;</span>
                <span class="n">mm_sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mmgeo</span><span class="p">[</span><span class="n">codk</span><span class="p">])</span>

        
            <span class="n">reqSQL</span> <span class="o">=</span> <span class="s1">&#39;insert into AGS0 (</span><span class="si">{0}</span><span class="s1">) values (</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">codef</span> <span class="p">]),</span>
                                                    <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">codef</span><span class="p">))]))</span>
 
            <span class="k">try</span> <span class="p">:</span> 
                <span class="c1"># geoDataBase_obj.manage_geoDataBase.curs.execute(reqSQL , mm_sql )</span>
                <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="n">reqSQL</span> <span class="p">,</span> <span class="n">mm_sql</span> <span class="p">)</span>
                
            <span class="k">except</span> <span class="p">:</span> 
                <span class="n">mess</span><span class="o">=</span><span class="s1">&#39;Process to set </span><span class="si">{0}</span><span class="s1"> infos  failed !  Try again later ! &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_geological_rock_name</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span> <span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                
            <span class="k">else</span> <span class="p">:</span>
   
                <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>     
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; new data =</span><span class="si">{}</span><span class="s1"> was successfully set into GeoataBase ! &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_geological_rock_name</span><span class="p">))</span> 
            
        <span class="n">geoDataBase_obj</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">closeDB</span><span class="p">()</span> <span class="c1"># close the database </span></div>
        
                  
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">pattern</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;return geopattern&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span> 
        
    <span class="nd">@pattern</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">pattern</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern_value</span><span class="p">):</span>
        <span class="s2">&quot;configure geopattern&quot;</span>
        <span class="k">try</span> <span class="p">:</span> 
             <span class="nb">float</span><span class="p">(</span><span class="n">pattern_value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span> 
            <span class="n">mes</span> <span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Process aborted ! Could not convert </span><span class="si">{pattern_value}</span><span class="s1"> to float number.&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">mes</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="n">mes</span><span class="p">)</span>

        <span class="k">else</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_pattern</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pattern_value</span><span class="p">)</span>
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">colorMPL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="s2">&quot;return geocolorMPL&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span> 
    
    <span class="nd">@colorMPL</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">colorMPL</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mpl_color</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        configure geocolorMPL</span>
<span class="sd">        to set matplotlib _color in rgb value </span>
<span class="sd">        value is range (0 to 1) coding to 0 to 255 bits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mpl_color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># get value from database </span>
   
            <span class="k">if</span> <span class="n">mpl_color</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">mpl_color</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span> <span class="nb">float</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="c1"># build the tuple of mpl colors </span>
                                                   <span class="n">mpl_color</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span>

            <span class="k">elif</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">mpl_color</span> <span class="p">:</span> <span class="c1"># we assume that value colorMPL is hexadecimal value eg : #0000ff</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span> <span class="o">=</span>  <span class="nb">str</span><span class="p">(</span><span class="n">mpl_color</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>    <span class="c1"># assume the colorMPL is in hexadecimal </span>
            <span class="k">elif</span> <span class="s1">&#39;none&#39;</span> <span class="ow">in</span> <span class="n">mpl_color</span> <span class="p">:</span> <span class="c1"># initilisation  value </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span> <span class="o">=</span>  <span class="s1">&#39;none&#39;</span>            <span class="c1"># keep the value on the dataBase </span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span> 
                <span class="k">try</span> <span class="p">:</span> <span class="c1"># try to convert color to rgba</span>
                
                    <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="nb">str</span> <span class="p">(</span> <span class="n">mpl_color</span><span class="p">))</span>
                <span class="k">except</span> <span class="p">:</span> 
                    <span class="k">raise</span>  <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_manager</span><span class="p">(</span><span class="s1">&#39; Unsupported </span><span class="si">{0}</span><span class="s1"> color!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mpl_color</span><span class="p">))</span>  
                <span class="k">else</span> <span class="p">:</span>  <span class="c1"># keep only R, G, B and abandon alpha . Matplotlib give tuple of 4 values </span>
                        <span class="c1"># as (R, G, B, alpha)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> 
            
        <span class="k">elif</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">mpl_color</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>  <span class="c1"># set value to database way </span>
            <span class="k">if</span> <span class="mi">3</span> <span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">mpl_color</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">:</span> 
                <span class="n">msg</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;update failed ! value = </span><span class="si">{0}</span><span class="s1"> must be a tuple of &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mpl_color</span><span class="p">),</span>
                             <span class="s1">&#39;3 values = (Red, Green, Blue) values.&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39; Please provided a right number again later.&#39;</span><span class="p">])</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpl_color</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span> <span class="p">:</span> <span class="c1"># let check whether the value provided can be converted to float </span>
                <span class="k">try</span> <span class="p">:</span> 
                     <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span><span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span> <span class="n">mpl_color</span><span class="p">)])</span>
                <span class="k">except</span> <span class="p">:</span> 
                     <span class="n">msg</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;update failed ! Could not convert value &#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;= </span><span class="si">{0}</span><span class="s1"> to float.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mpl_color</span><span class="p">),</span> 
                                   <span class="s1">&#39;Please try again later.&#39;</span><span class="p">])</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                     <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span> 
                    <span class="c1"># try to check if value is under 1. because clor is encoding to 1 to 255 bits </span>
                    <span class="k">for</span> <span class="n">ival</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span><span class="p">:</span> 
                        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">ival</span> <span class="o">&lt;</span><span class="mi">0</span>  <span class="p">:</span> 
                            <span class="k">if</span> <span class="n">ival</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">fmt</span> <span class="o">=</span><span class="s1">&#39;greater than 1&#39;</span> 
                            <span class="k">elif</span>  <span class="n">ival</span> <span class="o">&lt;</span><span class="mi">0</span> <span class="p">:</span>
                                <span class="n">fmt</span><span class="o">=</span> <span class="s1">&#39;less than 0&#39;</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;update failed ! Value provided  =&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39; </span><span class="si">{0}</span><span class="s1"> is UNacceptable value !&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ival</span><span class="p">),</span>
                                           <span class="s1">&#39; input value is </span><span class="si">{0}</span><span class="s1">. It must be encoding on 1 to 255 bits as MPL colors.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="p">)])</span>
                            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                            
                <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mplcolor</span><span class="p">)</span> <span class="c1"># put on str for consistency </span>
                
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;return georgb&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> 
    <span class="nd">@rgb</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">litteral_rgb</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        configure georgb</span>
<span class="sd">        </span>
<span class="sd">        .. note:: return the rgb value and the convert rgb palette value: </span>
<span class="sd">                keep the rgb value eg `R125G90B29` and compute the colorMPL</span>
<span class="sd">                let fill automatically the &quot;rgb&quot; and the colorMPL </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pycsamt.geodrill.geoCore.structural</span> <span class="kn">import</span> <span class="n">get_color_palette</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span><span class="o">=</span><span class="p">(</span><span class="n">litteral_rgb</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_color_palette</span><span class="p">(</span><span class="n">RGB_color_palette</span><span class="o">=</span><span class="n">litteral_rgb</span><span class="p">)))</span>
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">electrical_props</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="s2">&quot;return electrical property&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span>
    
    <span class="nd">@electrical_props</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">electrical_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">range_of_rocks_resvalues</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        configure electrical property</span>
<span class="sd">        </span>
<span class="sd">        .. note:: Electrical_property of rocks must a tuple of resisvity , max and Min</span>
<span class="sd">                bounds  eg : [2.36e-13, 2.36e-3]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_of_rocks_resvalues</span> <span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="p">:</span> <span class="c1"># electrical props were initialse by float 0. </span>
            <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">range_of_rocks_resvalues</span>  <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span> <span class="nb">float</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="c1"># build the tuple of mpl colors </span>
                                               <span class="n">range_of_rocks_resvalues</span> <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span> 
            <span class="k">elif</span> <span class="s1">&#39;none&#39;</span> <span class="ow">in</span> <span class="n">range_of_rocks_resvalues</span> <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span> <span class="o">=.</span><span class="mi">0</span>
                
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_of_rocks_resvalues</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span> 
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_of_rocks_resvalues</span><span class="p">)</span> <span class="o">==</span><span class="mi">2</span>  <span class="p">:</span> 
                <span class="k">try</span> <span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span> <span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">range_of_rocks_resvalues</span><span class="p">]</span>
                <span class="k">except</span> <span class="p">:</span> 
                    <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="s1">&#39; !Could not convert input values to float.&#39;</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span> <span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span><span class="p">)</span> <span class="c1"># range the values to min to max </span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span><span class="p">))</span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span> <span class="o">=</span> <span class="o">.</span><span class="mi">0</span>         <span class="c1"># force program to format value to 0. float </span>
                    
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_of_rocks_resvalues</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_of_rocks_resvalues</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> 
                <span class="n">range_of_rocks_resvalues</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">range_of_rocks_resvalues</span><span class="p">)</span> <span class="c1"># 0 at initialization </span>
            <span class="k">except</span>  <span class="p">:</span> 
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_of_rocks_resvalues</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">fmt</span> <span class="o">=</span><span class="s1">&#39;are&#39;</span>
                <span class="k">else</span> <span class="p">:</span><span class="n">fmt</span> <span class="o">=</span><span class="s1">&#39;is&#39;</span>
    
                <span class="n">mess</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;Unable to set electrical property of rocks.&#39;</span><span class="p">,</span> 
                                        <span class="s1">&#39; We need only minimum and maximum resistivities bounds. </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> given&#39;</span><span class="o">.</span>\
                                            <span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">range_of_rocks_resvalues</span><span class="p">),</span> <span class="n">fmt</span><span class="p">)])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_update_geoinformation</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span> 
                
                <span class="bp">self</span><span class="o">.</span><span class="n">_electrical_props</span> <span class="o">=</span> <span class="o">.</span><span class="mi">0</span>          <span class="c1">#mean value  initialised </span>
                

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_setGeoDatabase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. note:: property of  GeoDataBase -create the GeoDataBase</span>
<span class="sd">                 Setting geoDataBase table</span>
<span class="sd">                 No Need to reset the DataBase at least you dropped the table,</span>
<span class="sd">                 avoid to do that if you are not sure of what you are doing. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span>  <span class="nn">pycsamt.utils.func_utils</span> <span class="k">as</span> <span class="nn">func</span> 
        <span class="c1">#set other attributes</span>
        <span class="c1"># create connection </span>
        <span class="c1"># try : </span>
        <span class="c1">#     # call manage DB  so to connect geodataBse </span>
        <span class="c1">#     manage_geoDataBase =ManageDB(db_host=os.path.dirname(self.geoDataBase), </span>
        <span class="c1">#                                  db_name =&#39;memory.sq3&#39;)</span>
        <span class="c1"># except : pass </span>
        <span class="c1"># if success is True  : </span>
        <span class="c1"># createa tABLE IN THE DATABASE</span>
        <span class="n">req</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;create table AGS0&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39; (&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> TEXT,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{1}</span><span class="s1"> TEXT,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{2}</span><span class="s1"> TEXT,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{3}</span><span class="s1"> REAL,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{4}</span><span class="s1"> REAL,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{5}</span><span class="s1"> REAL,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{6}</span><span class="s1"> REAL,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{7}</span><span class="s1"> TEXT,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{8}</span><span class="s1"> REAL,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{9}</span><span class="s1"> TEXT,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{10}</span><span class="s1"> TEXT,&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39; </span><span class="si">{11}</span><span class="s1"> TEXT&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;)&#39;</span>
                       <span class="p">])</span> 
        
        <span class="c1"># create Request to insert value into table </span>
        <span class="n">mes</span> <span class="o">=</span><span class="s1">&#39;insert into AGS0 (&#39;</span><span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">icode</span><span class="p">)</span> <span class="k">for</span> <span class="n">icode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">codef</span><span class="p">])</span>
        <span class="n">enter_req</span> <span class="o">=</span> <span class="n">mes</span><span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        

        <span class="c1"># create  Geoformation objets </span>
        <span class="n">geo_formation_obj</span> <span class="o">=</span><span class="n">Geo_formation</span><span class="p">()</span>      <span class="c1"># set oBject of geostructures </span>
        
        <span class="n">new_codef</span> <span class="p">,</span>  <span class="n">new_codef</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_codef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">codef</span> <span class="p">[:</span><span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;codes&#39;</span>
        <span class="c1"># get attribute from geoformation and #build new geo_formations _codes </span>
        <span class="n">geo_form_codes</span> <span class="o">=</span><span class="p">[</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">geo_formation_obj</span><span class="p">,</span> <span class="n">codehead</span><span class="p">)</span> <span class="k">for</span> <span class="n">codehead</span> <span class="ow">in</span> <span class="n">new_codef</span> <span class="p">]</span>
        <span class="n">geo_form_codes</span> <span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">concat_array_from_list</span><span class="p">(</span><span class="n">geo_form_codes</span><span class="p">,</span> <span class="n">concat_axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># generate other main columns of tables to fill laters </span>
        <span class="n">geo_add_form_codes</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">concat_array_from_list</span><span class="p">(</span><span class="n">list_of_array</span> <span class="o">=</span> <span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">geo_formation_obj</span><span class="o">.</span><span class="n">codes</span><span class="p">),)),</span> 
                                                                     <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">geo_formation_obj</span><span class="o">.</span><span class="n">codes</span><span class="p">),),</span> <span class="s1">&#39;none&#39;</span><span class="p">),</span> 
                                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span> <span class="p">(</span><span class="n">clsp</span><span class="p">)</span> <span class="k">for</span> <span class="n">clsp</span> <span class="ow">in</span> <span class="n">geo_formation_obj</span><span class="o">.</span><span class="n">mpl_colorsp</span><span class="p">]),</span>
                                                                     <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">geo_formation_obj</span><span class="o">.</span><span class="n">codes</span><span class="p">),),</span><span class="s1">&#39;none&#39;</span><span class="p">),</span>
                                                                      <span class="p">],</span>
                                                         <span class="n">concat_axis</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
        <span class="c1"># create Table resquest </span>
        
        <span class="n">req</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">codef</span><span class="p">)</span>                        <span class="c1"># generate a request for table creation </span>
        <span class="n">enter_req</span> <span class="o">=</span> <span class="n">enter_req</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">codef</span><span class="p">)</span>            <span class="c1"># generate interrequest </span>

        <span class="n">GDB_DATA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">geo_form_codes</span><span class="p">,</span><span class="n">geo_add_form_codes</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># generate values Host string so to avoid injection </span>
        <span class="c1"># print(req)</span>
        <span class="n">values_str</span> <span class="o">=</span> <span class="s1">&#39;values (&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;?&#39;</span> <span class="k">for</span> <span class="n">itg</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">GDB_DATA</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span> <span class="o">+</span><span class="s1">&#39;)&#39;</span>
        <span class="n">insert_request</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">enter_req</span> <span class="p">,</span> <span class="n">values_str</span><span class="p">])</span>

        <span class="c1"># create Table</span>
        
        <span class="k">try</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">executeReq</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">req</span> <span class="p">)</span> 
            
        <span class="k">except</span> <span class="p">:</span> 
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Could not create </span><span class="si">{AGS0}</span><span class="s1"> Table !&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_SQL_geoDataBase</span><span class="p">(</span><span class="s1">&#39;Table AGS0 already exists !&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">success</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span> 
            <span class="c1"># enter the record </span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">row_geoDataBase</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GDB_DATA</span> <span class="p">):</span> 
                <span class="n">row_geoDataBase</span> <span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">row_geoDataBase</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">executeReq</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">insert_request</span> <span class="p">,</span> <span class="n">param</span> <span class="o">=</span><span class="n">row_geoDataBase</span> <span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manage_geoDataBase</span><span class="o">.</span><span class="n">closeDB</span><span class="p">()</span></div>


    
<div class="viewcode-block" id="Recorder_sql"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.Recorder_sql">[docs]</a><span class="k">class</span> <span class="nc">Recorder_sql</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to record data from file or pd.core.DataFrame and to tranfer </span>
<span class="sd">    into SQL database. </span>
<span class="sd">    </span>
<span class="sd">    Arguments </span>
<span class="sd">    -----------</span>
<span class="sd">        **database** : str , </span>
<span class="sd">                name of sql database </span>
<span class="sd">                </span>
<span class="sd">        **table** : str , </span>
<span class="sd">                name of table in dict_app</span>
<span class="sd">    </span>
<span class="sd">        **Glob.dicoT** : dict,</span>
<span class="sd">                dicoT is from dict_app module , Global class for sql variable </span>
<span class="sd">                encapsulated on particular dictionnary.</span>
<span class="sd">                </span>
<span class="sd">    =========================  ==============================================</span>
<span class="sd">    Methods                    Description </span>
<span class="sd">    =========================  ==============================================</span>
<span class="sd">    transferdata_to_sqlDB      transfer Data to SQL Database </span>
<span class="sd">    keepDataInfos              keep informations from datafile &#39;*csv&#39;</span>
<span class="sd">    arrangeData_for_dictapp    to arrange data, acording the dict_app </span>
<span class="sd">                               arangement</span>
<span class="sd">    =========================  ==============================================</span>

<span class="sd">    .. deprecated::deprecated methods </span>
<span class="sd">                - recordData --&gt; to  keepDataInfos (staticmethod)</span>
<span class="sd">                - set_on_dict_app --&gt; to tarrangeData_for_dictapp(staticmethod)</span>
<span class="sd">    </span>
<span class="sd">    :Example: </span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; from pycsamt.geodrill.geoDB.sql_recorder import Recorder_sql</span>
<span class="sd">        &gt;&gt;&gt; realpath=os.path.dirname(os.path.realpath(__file__)) </span>
<span class="sd">        &gt;&gt;&gt; #where &#39;the file&#39;sql_recorder is located&#39;</span>
<span class="sd">        &gt;&gt;&gt; print(realpath)</span>
<span class="sd">        &gt;&gt;&gt; path_to_files =os.path.normpath(os.path.join(realpath,&#39;sql_utils&#39;,&#39;sql_DB&#39;))</span>
<span class="sd">        &gt;&gt;&gt; os.chdir(path_to_files)</span>
<span class="sd">        &gt;&gt;&gt;  filename=&#39;nofacies_data_2.csv&#39;</span>
<span class="sd">        &gt;&gt;&gt; memory_DB=&#39;memory.sq3&#39;</span>
<span class="sd">        &gt;&gt;&gt; path_to_memory=os.path.dirname(os.path.realpath(memory_DB))</span>
<span class="sd">        &gt;&gt;&gt; Rec=Recorder_sql(database=memory_DB,table=None)</span>
<span class="sd">        &gt;&gt;&gt; recordList1=Recorder_sql.recordData(data=filename,new_tablename=&#39;TEST2&#39;,</span>
<span class="sd">        ...                                    sep=&#39;,&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sdico_app=Recorder_sql.set_on_dict_app( datalist=recordList0)</span>
<span class="sd">        &gt;&gt;&gt;  sdico_app=Recorder_sql.arrangeData_for_dictapp( datalist=recordList0)</span>
<span class="sd">        &gt;&gt;&gt; trand_sql= Rec.transferdata_to_sqlDB( filename=filename,record_list= None,</span>
<span class="sd">        ...                                         table_name=&#39;exam_zju_2&#39;,comments=None,</span>
<span class="sd">        ...                                         visualize_table_creating_query=True,</span>
<span class="sd">        ...                                         path_to_sqlDataBase=path_to_files,</span>
<span class="sd">        ...                                         Drop_DB_Tables=&#39;none&#39;, fetchall=True, </span>
<span class="sd">        ...                                         ready_to_transfer=&#39;n&#39;,</span>
<span class="sd">        ...                                         close_connexion =False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span> <span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlmanager</span><span class="o">=</span><span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">=</span><span class="n">table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GlobDicoT</span><span class="o">=</span><span class="n">Glob</span><span class="o">.</span><span class="n">dicoT</span>
        
        <span class="c1"># self.descriptif =Glob.dicoT[table]</span>
        
        
<div class="viewcode-block" id="Recorder_sql.transferdata_to_sqlDB"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.Recorder_sql.transferdata_to_sqlDB">[docs]</a>    <span class="k">def</span> <span class="nf">transferdata_to_sqlDB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to transfer Data from Dict_app to SQL DataBase. Users can use this function by</span>
<span class="sd">        including several arguments. The function will build the data , arrange  it and put it in </span>
<span class="sd">        the dataBase by commit the dataBase. Use only this func is benefit.</span>
<span class="sd">        It is better to revise arguments of that function.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            * record_list : dict, optional</span>
<span class="sd">                    Dictionnay build according the dict_app model. </span>
<span class="sd">                    The *default* is None.</span>
<span class="sd">                </span>
<span class="sd">            *  filename : str, optional</span>
<span class="sd">                    file must be on &quot;.csv&quot; format. The default is None.</span>
<span class="sd">            *  table_name : str, optional</span>
<span class="sd">                    Name of DataBase Table. The default is None.</span>
<span class="sd">            </span>
<span class="sd">            *  comments : str  </span>
<span class="sd">                    little comment to identify your database table. </span>
<span class="sd">                    </span>
<span class="sd">            *  path_to_sqlDataBase : str  </span>
<span class="sd">                    path where the SQL dataBase is located . </span>
<span class="sd">                </span>
<span class="sd">            *  visualize_table_creating_query : bool </span>
<span class="sd">                   If the connexion to server is unlikable  </span>
<span class="sd">                   set to True to see whether query entered is right or wrong.</span>
<span class="sd">                   </span>
<span class="sd">            *  Drop_DB_Tables : str, </span>
<span class="sd">                   way to drop table in SQL Database . set litteral arguments like </span>
<span class="sd">                  the name of database user want to drop or [ no &quot;*&quot; or all to drop all tables. </span>
<span class="sd">                                                             </span>
<span class="sd">            *  Ready_to_transfer : str </span>
<span class="sd">                   process to commit Database , the curso tranfered the dataBase to SQL connexion.</span>
<span class="sd">                   set litteral &#39;no&#39; or &#39;yes&#39; to do.</span>
<span class="sd">              </span>
<span class="sd">            *  close_connexion : bool , </span>
<span class="sd">                  set True when transfer is done . it seems connexion.close()</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            Exception occurs when Table Name is not set on dict_app.</span>

<span class="sd">        .. note:: The process of organization is full request of  PostgreSQL </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">comments</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">sql_DB_loc</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;path_to_sqlDataBase&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">visualize_req</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;visualize_table_creating_query&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">drop_table</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Drop_DB_Tables&#39;</span><span class="p">,</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">fetch_data</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fetchall&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">ready_to_transfer</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Ready_to_transfer&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
        <span class="n">close_connex</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;close_connexion&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">record_list</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">record_list</span><span class="o">=</span><span class="n">Recorder_sql</span><span class="o">.</span><span class="n">keepDataInfos</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="n">new_tablename</span><span class="o">=</span> <span class="n">table_name</span><span class="p">)</span>
            
        <span class="n">sdico_app</span><span class="o">=</span><span class="n">Recorder_sql</span><span class="o">.</span><span class="n">arrangeData_for_dictapp</span><span class="p">(</span> <span class="n">datalist</span><span class="o">=</span><span class="n">record_list</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">keys</span> <span class="p">,</span> <span class="n">values</span>  <span class="ow">in</span> <span class="n">sdico_app</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># or keys=[keys for keys in sdico_app]--&gt; keys =keys[0]</span>
            <span class="c1">#or keys = [*sdico_app]---&gt; keys=keys[0]</span>
            <span class="n">valapp</span><span class="p">,</span><span class="n">insertvalues</span><span class="o">=</span><span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GlobDicoT</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">valapp</span><span class="p">)</span>
        <span class="c1"># name_of_sql_DATABASE=self.sqlmanager</span>
        <span class="n">manDB</span><span class="o">=</span><span class="n">ManageDB</span><span class="p">(</span><span class="n">db_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sqlmanager</span><span class="p">,</span> 
                               <span class="n">db_host</span><span class="o">=</span><span class="n">sql_DB_loc</span><span class="p">)</span>
        <span class="n">table_req</span><span class="o">=</span><span class="n">manDB</span><span class="o">.</span><span class="n">dicT_sqlDB</span><span class="p">(</span><span class="n">dicTables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GlobDicoT</span><span class="p">,</span>
                         <span class="n">visualize_request</span><span class="o">=</span><span class="n">visualize_req</span><span class="p">)</span>
        
        <span class="c1">#build request for values : </span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span><span class="n">table_name</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GlobDicoT</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span>  <span class="sa">f</span><span class="s1">&#39;No such Table &lt;</span><span class="si">{self.table}</span><span class="s1">&gt; in the dataBase</span><span class="si">{self.sqlmanager}</span><span class="s1"> ! &#39;</span>\
                <span class="s1">&#39;You may enter the right Table Name.&#39;</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptif</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GlobDicoT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">]</span>
        <span class="c1">#&quot;INSERT INTO oeuvres(comp,  titre,  duree, interpr) VALUES(?,?,?,?)&quot;</span>
        <span class="n">value_req</span><span class="o">=</span><span class="n">table_req</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;CREATE TABLE&#39;</span><span class="p">,</span> <span class="s1">&#39;INSERT INTO&#39;</span><span class="p">)</span>
        
        <span class="n">beacons</span><span class="o">=</span><span class="s2">&quot;(&quot;</span>         <span class="c1"># balises= &quot;beacons&quot; in english</span>
        <span class="c1"># fieldValue=[]</span>
        <span class="c1"># for ii, rowline in enumerate(self.descriptif):</span>
        <span class="c1">#     fieldValue.append(rowline[5])   # rowline of  value in dicoT.</span>
        
        <span class="n">len_values</span> <span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">insertvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">beacons</span> <span class="o">=</span> <span class="n">beacons</span><span class="o">+</span><span class="s1">&#39;?,&#39;</span><span class="o">*</span><span class="n">len_values</span> 
        <span class="n">beacons</span><span class="o">=</span><span class="n">beacons</span> <span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot;)&quot;</span>   <span class="c1"># sustract the &#39;,&#39; and close the parenthesis </span>
        <span class="n">value_req</span><span class="o">=</span> <span class="n">value_req</span> <span class="o">+</span> <span class="s1">&#39; VALUES </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">beacons</span>
        
        <span class="c1"># for itemvalues in insertvalues: </span>
        <span class="n">manDB</span><span class="o">.</span><span class="n">executeReq</span><span class="p">(</span> <span class="n">query</span> <span class="o">=</span><span class="n">value_req</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">insertvalues</span><span class="p">)</span>
        <span class="c1"># manDB.executeReq( query =value_req, param=None)        </span>
        <span class="k">if</span> <span class="n">fetch_data</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span>
            <span class="n">manDB</span><span class="o">.</span><span class="n">print_query</span><span class="p">()</span>
        

        <span class="k">if</span> <span class="n">drop_table</span> <span class="o">==</span><span class="kc">False</span> <span class="ow">or</span> <span class="n">drop_table</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s1">&#39;not yet&#39;</span><span class="p">,</span><span class="s1">&#39;wait&#39;</span><span class="p">,</span><span class="s1">&#39;not ready&#39;</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">drop_table</span> <span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="n">drop_table</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;all tables&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">]:</span>
            
            <span class="n">manDB</span><span class="o">.</span><span class="n">drop_TableDB</span><span class="p">(</span> <span class="n">dicTables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GlobDicoT</span><span class="p">,</span><span class="n">drop_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">drop_table</span> <span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">drop_table</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GlobDicoT</span><span class="o">.</span><span class="n">keys</span><span class="p">()]:</span>
            
            <span class="n">manDB</span><span class="o">.</span><span class="n">drop_TableDB</span><span class="p">(</span> <span class="n">dicTables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GlobDicoT</span><span class="p">,</span><span class="n">drop_table_name</span><span class="o">=</span><span class="n">drop_table</span> <span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">pass</span> 
        
        <span class="k">if</span> <span class="n">ready_to_transfer</span> <span class="o">==</span><span class="kc">True</span> <span class="ow">or</span> <span class="n">ready_to_transfer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;alright,&#39;</span>
                                                                     <span class="s1">&#39;yes&#39;</span><span class="p">,</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span>
                                                                     <span class="s1">&#39;fine&#39;</span><span class="p">,</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="p">:</span>
            <span class="n">manDB</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                     
        <span class="k">if</span> <span class="n">close_connex</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span>
            <span class="n">manDB</span><span class="o">.</span><span class="n">closeDB</span><span class="p">()</span></div>
            
<div class="viewcode-block" id="Recorder_sql.keepDataInfos"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.Recorder_sql.keepDataInfos">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">keepDataInfos</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">new_tablename</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to KeepData from file infos . the function </span>
<span class="sd">        is otherwritten fo RecordData. The difference between two function </span>
<span class="sd">        is that function organise data from each row of columns </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            * data : str, np.array, list, or pd.core.DataFrame object</span>
<span class="sd">                    Data ca, be on the format above or filename of data </span>
<span class="sd">                    if the argument &quot;data&quot; is a filename, we must be convert on &quot;.csv&quot; format.</span>
<span class="sd">                </span>
<span class="sd">            * new_tablename : str, optional</span>
<span class="sd">                    Name of database. if name is not given , the </span>
<span class="sd">                    function return only list . The default is None.</span>
<span class="sd"> </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            IndexError.</span>
<span class="sd">                 if lengh of number of columns like heads of data </span>
<span class="sd">                does not match the data.shape[0], then errors will occurs.  </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            list  </span>
<span class="sd">                list of value in the case of no name is providen for tablename.</span>
<span class="sd">                else  return dict if name of datatable is providen.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">nump_columns</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;columns_of array&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">separate_colist</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;seperate_columns_list&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">seperate_csvfile</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sep&#39;</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        
        <span class="n">tempkeylenvalue</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">index_item</span> <span class="o">=</span><span class="p">[],[],[]</span>
        <span class="k">if</span> <span class="n">nump_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="p">(</span><span class="n">nump_columns</span><span class="p">)</span> <span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">:</span>
                <span class="n">nump_columns</span><span class="o">=</span><span class="n">nump_columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">type</span> <span class="p">(</span><span class="n">nump_columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="p">:</span>
                <span class="n">nump_columns</span><span class="o">=</span><span class="n">nump_columns</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">separate_colist</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">separate_colist</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nump_columns</span><span class="p">:</span>
                    <span class="n">nump_columns</span><span class="o">=</span><span class="p">[</span><span class="n">nump_columns</span><span class="p">]</span>  <span class="c1"># put on a list </span>
    
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span> <span class="c1"># read csv file .</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">seperate_csvfile</span><span class="p">,</span>
                             <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;infer&#39;</span><span class="p">,</span>
                             <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">type</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">==</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>        <span class="c1"># get the dataframe columns</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="n">columns</span><span class="p">]</span>          <span class="c1"># unpack pd.Index on list </span>
            <span class="n">datavalues</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>  <span class="c1"># recover numpy array</span>
            
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">rowlines</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">datavalues</span><span class="p">)</span> <span class="p">:</span> 
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">rowlines</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
                <span class="c1"># if ii ==0 : </span>
                <span class="c1">#     for jj, item in rowlines.tolist(): </span>
                <span class="c1">#         type_of_value.append(type(item))</span>
            <span class="n">type_of_value</span><span class="o">=</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span>  <span class="n">item</span> <span class="ow">in</span> <span class="n">datavalues</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span> 
            <span class="n">index_item</span><span class="o">=</span><span class="p">[</span><span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
            <span class="n">num_of_val</span><span class="o">=</span><span class="p">[</span><span class="n">datavalues</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">)]</span>
            <span class="n">tempkeylenvalue</span><span class="o">=</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">type_of_value</span><span class="p">,</span><span class="n">index_item</span><span class="p">,</span><span class="n">num_of_val</span><span class="p">,</span><span class="n">temp</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">new_tablename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="k">return</span> <span class="p">{</span><span class="n">new_tablename</span><span class="p">:</span><span class="n">tempkeylenvalue</span><span class="p">}</span>

            <span class="k">return</span> <span class="n">tempkeylenvalue</span>
            
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">nump_columns</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span> <span class="p">(</span><span class="s1">&#39;The primary keys is needed ! You may provide at least </span><span class="si">{0}</span><span class="s1"> fields to fill the database &#39;</span>\
                                 <span class="s1">&#39;like  dictionnary values first key.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">asize</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>         <span class="c1"># check the number of columns</span>
            <span class="n">len_nump</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nump_columns</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">asize</span> <span class="o">==</span> <span class="n">len_nump</span> <span class="p">,</span><span class="s1">&#39;The shape at index 1 must be the same like the &#39;</span>\
                <span class="s1">&#39;lenght &lt;&lt; </span><span class="si">{0}</span><span class="s1">&gt;&gt; of data you provide&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nump_columns</span><span class="p">))</span>
            <span class="c1"># if as_key_for_DB ==None : </span>
            <span class="c1">#     as_key_for_DB=[&#39;_&#39;.join([val[:-2]for val in nump_columns])] </span>
                
            <span class="k">if</span> <span class="n">asize</span> <span class="o">&gt;</span><span class="mi">1</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">rowlines</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">data</span><span class="p">)</span> <span class="p">:</span> 
                    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">rowlines</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
                    
                <span class="n">type_of_value</span><span class="o">=</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span>  <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span> 
                <span class="n">index_item</span><span class="o">=</span><span class="p">[</span><span class="n">nump_columns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nump_columns</span><span class="p">]</span>
                <span class="n">num_of_val</span><span class="o">=</span><span class="p">[</span><span class="n">datavalues</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nump_columns</span><span class="p">)]</span>
                <span class="n">tempkeylenvalue</span><span class="o">=</span><span class="p">(</span><span class="n">nump_columns</span><span class="p">,</span> <span class="n">type_of_value</span><span class="p">,</span><span class="n">index_item</span><span class="p">,</span><span class="n">num_of_val</span><span class="p">,</span><span class="n">temp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_tablename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                    <span class="k">return</span> <span class="p">{</span><span class="n">new_tablename</span><span class="p">:</span><span class="n">tempkeylenvalue</span><span class="p">}</span>
    
                <span class="k">return</span> <span class="n">tempkeylenvalue</span>
                
            <span class="k">elif</span> <span class="n">asize</span> <span class="o">==</span><span class="mi">1</span> <span class="p">:</span>
                <span class="c1"># type_of_value=type(data.tolist()[0])</span>
                <span class="n">type_of_value</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>       
                <span class="k">if</span> <span class="n">new_tablename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                    <span class="k">return</span> <span class="p">{</span><span class="n">new_tablename</span><span class="p">:(</span><span class="n">nump_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">type_of_value</span><span class="p">,</span><span class="n">asize</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">())}</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">nump_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">type_of_value</span><span class="p">,</span><span class="n">asize</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span></div>
            
            
<div class="viewcode-block" id="Recorder_sql.arrangeData_for_dictapp"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.Recorder_sql.arrangeData_for_dictapp">[docs]</a>    <span class="nd">@staticmethod</span>    
    <span class="k">def</span> <span class="nf">arrangeData_for_dictapp</span><span class="p">(</span> <span class="n">datalist</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function overwritten from &quot;set_on_dictapp func&quot;. Reorganise </span>
<span class="sd">        data to dict_app model.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            * datalist : list, dict</span>
<span class="sd">                list of value providen for fill the dict_app.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">             pyCSAMTError_SQL_manager</span>
<span class="sd">                None dataname detected</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            dict</span>
<span class="sd">                datalist, Data arranged according to  dict_app arrangement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">comments</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">dataname</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name_of_table&#39;</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        
        <span class="n">build_tup</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">dicosqlDB</span> <span class="o">=</span><span class="p">{}</span>
        <span class="c1"># we can populate later </span>
        <span class="n">field_dico_inv</span> <span class="o">=</span><span class="p">{</span><span class="nb">int</span><span class="p">:</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="nb">bool</span><span class="p">:</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="nb">list</span><span class="p">:</span><span class="s1">&#39;t&#39;</span><span class="p">,</span>
                         <span class="nb">float</span><span class="p">:</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">:</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">,</span>
                         <span class="nb">dict</span><span class="p">:</span><span class="s1">&#39;h&#39;</span><span class="p">}</span> <span class="c1"># date:&#39;date&#39;,buffer:&#39;by&#39;</span>
        <span class="k">try</span> <span class="p">:</span> 
            <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="p">,</span> <span class="n">timezone</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="s1">&#39;Importation datetime module failed ! please try again&#39;</span>
        
        <span class="k">if</span> <span class="nb">type</span> <span class="p">(</span><span class="n">datalist</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">dataname</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="s1">&#39;Please set a table name !&#39;</span>
            <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="n">datalist</span><span class="o">=</span><span class="p">{</span><span class="n">dataname</span><span class="p">:</span><span class="n">datalist</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">datalist</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="p">:</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">datalist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">main_f</span> <span class="p">,</span> <span class="n">type_f</span><span class="p">,</span> <span class="n">posi</span> <span class="p">,</span> <span class="n">num_of_val</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span> <span class="n">values</span>
                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">item</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">main_f</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">type_f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">in</span> <span class="n">field_dico_inv</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">type_f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_dico_inv</span><span class="p">[</span><span class="n">type_f</span><span class="p">[</span><span class="n">ii</span><span class="p">]])</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">type_f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">posi</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{0:&lt;3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posi</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">num_of_val</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:&lt;7}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_of_val</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                    <span class="c1"># find other param </span>
                    <span class="n">id_</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">main_f</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
                    <span class="n">dtime</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:}</span><span class="s1"> - </span><span class="si">{1:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
                    
                    <span class="n">idkey</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:&lt;}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">main_f</span><span class="p">[</span><span class="n">ii</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">id_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">num_of_val</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">main_f</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">comments</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                        <span class="n">comments</span> <span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:}{1:&lt;7}{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span>
                                               <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">datalist</span><span class="p">))[</span><span class="o">-</span><span class="mi">7</span><span class="p">:],</span><span class="n">main_f</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    
                    <span class="n">build_tup</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">item</span><span class="p">,</span> <span class="n">type_f</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">id_</span><span class="p">,</span> <span class="n">posi</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                     <span class="n">num_of_val</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">dtime</span><span class="p">,</span> <span class="n">idkey</span><span class="p">,</span> <span class="n">comments</span><span class="p">))</span>

                <span class="c1"># build_tup.append(value) # better to use append instead of extend </span>
 
                    
                <span class="n">dicosqlDB</span> <span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:(</span><span class="n">build_tup</span><span class="p">,</span><span class="n">value</span><span class="p">)}</span> 
                
        <span class="k">return</span> <span class="n">dicosqlDB</span> </div>
    
<div class="viewcode-block" id="Recorder_sql.recordData"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.Recorder_sql.recordData">[docs]</a>    <span class="nd">@redirect_cls_or_func</span><span class="p">(</span> <span class="n">keepDataInfos</span><span class="p">,</span><span class="s1">&#39;func&quot;recordData&quot; was redirected to func &quot;keepDataInfos&quot; on called it.&#39;</span><span class="p">)</span>
    <span class="nd">@staticmethod</span>    
    <span class="k">def</span> <span class="nf">recordData</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">new_tablename</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Func created to record data for easily set on dictionnary for sql arrangement. </span>
<span class="sd">        Indeed the func displays values along each colummns and determine the type of </span>
<span class="sd">        each column. This sort of arrangement may not be use for PostgreSQL.Reason why </span>
<span class="sd">        the func is deprecated . Once call , it redirected to onother function above. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            * data : str, np.array, list,  pd.core.DataFrame object</span>
<span class="sd">                    Data ca, be on the format above or filename of data </span>
<span class="sd">                    if the argument &quot;data&quot; is a filename, we must be convert on &quot;.csv&quot; format.</span>
<span class="sd">                </span>
<span class="sd">            * new_tablename : str, optional</span>
<span class="sd">                    Name of database. if name is not given , the </span>
<span class="sd">                function return only list . The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            IndexError</span>
<span class="sd">                 if lengh of number of columns like heads of data </span>
<span class="sd">                 does not match the data.shape[0], then errors will occurs.  </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            list , dict</span>
<span class="sd">                list of value in the case of no name is providen for tablename.</span>
<span class="sd">                else return dict if name of datatable is providen.</span>

<span class="sd">        :Example:</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from pycsamt.geodrill.geoDB.sql_recorder import recordData</span>
<span class="sd">            &gt;&gt;&gt; filename=&#39;nofacies_data.csv&#39;</span>
<span class="sd">            &gt;&gt;&gt; recordList0=recordData(data=filename,</span>
<span class="sd">                                    new_tablename=&#39;example&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nump_columns</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;columns_of array&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">separate_colist</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;seperate_columns_list&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">seperate_csvfile</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sep&#39;</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="c1"># table_id =kwargs.pop(&#39;id_&#39;,None)</span>
        <span class="c1"># comment=&#39;&#39;</span>
        

        <span class="n">tempkeylenvalue</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">nump_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="p">(</span><span class="n">nump_columns</span><span class="p">)</span> <span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">:</span>
                <span class="n">nump_columns</span><span class="o">=</span><span class="n">nump_columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">type</span> <span class="p">(</span><span class="n">nump_columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="p">:</span>
                <span class="n">nump_columns</span><span class="o">=</span><span class="n">nump_columns</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">separate_colist</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">separate_colist</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nump_columns</span><span class="p">:</span>
                    <span class="n">nump_columns</span><span class="o">=</span><span class="p">[</span><span class="n">nump_columns</span><span class="p">]</span>  <span class="c1"># put on a list </span>
    
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span> <span class="c1"># read csv file .</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">seperate_csvfile</span><span class="p">,</span>
                             <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;infer&#39;</span><span class="p">,</span>
                             <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">type</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">==</span><span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>        <span class="c1"># get the dataframe columns </span>
            <span class="n">datavalues</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>  <span class="c1"># recover numpy array</span>
            
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">kkey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">columns</span><span class="p">)</span> <span class="p">:</span> 
                <span class="c1"># type_of_value=type(datavalues[:,ii].tolist()[0])</span>
                <span class="n">type_of_value</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">datavalues</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>                
                <span class="n">tempkeylenvalue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">kkey</span><span class="p">,</span><span class="n">type_of_value</span><span class="p">,</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">datavalues</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="n">datavalues</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">new_tablename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="k">return</span> <span class="p">{</span><span class="n">new_tablename</span><span class="p">:</span><span class="n">tempkeylenvalue</span><span class="p">}</span>

            <span class="k">return</span> <span class="n">tempkeylenvalue</span>
            
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">nump_columns</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span> <span class="p">(</span><span class="s1">&#39;Th primary keys is needed ! You may provide at least </span><span class="si">{0}</span><span class="s1"> fields to fill the database &#39;</span>\
                                 <span class="s1">&#39;like  dictionnary values first key.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">asize</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>         <span class="c1"># check the number of columns</span>
            <span class="n">len_nump</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nump_columns</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">asize</span> <span class="o">==</span> <span class="n">len_nump</span> <span class="p">,</span><span class="s1">&#39;The shape at index 1 must be the same like the &#39;</span>\
                <span class="s1">&#39;lenght &lt;&lt; </span><span class="si">{0}</span><span class="s1">&gt;&gt; of data you provide&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nump_columns</span><span class="p">))</span>
            <span class="c1"># if as_key_for_DB ==None : </span>
            <span class="c1">#     as_key_for_DB=[&#39;_&#39;.join([val[:-2]for val in nump_columns])] </span>
                
            <span class="k">if</span> <span class="n">asize</span> <span class="o">&gt;</span><span class="mi">1</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">kkeys</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nump_columns</span><span class="p">):</span>
                    <span class="n">datatolist</span><span class="o">=</span><span class="n">datavalues</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="c1"># type_of_value=type(datatolist[0])</span>
                    <span class="n">type_of_value</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">datatolist</span><span class="p">)</span>                    
                    <span class="n">tempkeylenvalue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">kkeys</span><span class="p">,</span><span class="n">type_of_value</span><span class="p">,</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">datavalues</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="n">datatolist</span><span class="p">))</span>
                
                <span class="k">if</span> <span class="n">new_tablename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                    <span class="k">return</span> <span class="p">{</span><span class="n">new_tablename</span><span class="p">:</span><span class="n">tempkeylenvalue</span><span class="p">}</span>
                
                <span class="k">return</span> <span class="n">tempkeylenvalue</span>
                
            <span class="k">elif</span> <span class="n">asize</span> <span class="o">==</span><span class="mi">1</span> <span class="p">:</span>
                <span class="c1"># type_of_value=type(data.tolist()[0])</span>
                <span class="n">type_of_value</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>       
                <span class="k">if</span> <span class="n">new_tablename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                    <span class="k">return</span> <span class="p">{</span><span class="n">new_tablename</span><span class="p">:(</span><span class="n">nump_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">type_of_value</span><span class="p">,</span><span class="n">asize</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">())}</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">nump_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">type_of_value</span><span class="p">,</span><span class="n">asize</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span></div>
    
<div class="viewcode-block" id="Recorder_sql.set_on_dict_app"><a class="viewcode-back" href="../../../../geodb.html#pycsamt.geodrill.geoDB.sql_recorder.Recorder_sql.set_on_dict_app">[docs]</a>    <span class="nd">@redirect_cls_or_func</span><span class="p">(</span><span class="n">arrangeData_for_dictapp</span><span class="p">,</span><span class="s1">&#39;set_on_dict will redirect to &quot;arrangeData_for_dictapp once called.&quot; &#39;</span><span class="p">)</span>
    <span class="nd">@staticmethod</span>    
    <span class="k">def</span> <span class="nf">set_on_dict_app</span><span class="p">(</span> <span class="n">datalist</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        function to arrange value according to dict_app  arangement </span>
<span class="sd">        The func can call python datatype to SQLdatatype . function include </span>
<span class="sd">        the datetime , and the id of each data to fullfill dictionnary.</span>
<span class="sd">        NB : func is redirected because it&#39;s corollary of RecordData whom it also</span>
<span class="sd">        redirected . if you use this function , it will redirect you to </span>
<span class="sd">        &quot;arrangeData_for_dict_app&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            * datalist : list, dict</span>
<span class="sd">                list of value providen for fill the dict_app.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            pyCSAMTError_SQL_manager </span>
<span class="sd">                DataBase no found</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            dict</span>
<span class="sd">                datalist , Data arranged according to  dict_app arrangement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">comments</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">dataname</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name_of_table&#39;</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>

        <span class="c1"># we can populate later </span>
        <span class="n">field_dico_inv</span> <span class="o">=</span><span class="p">{</span><span class="nb">int</span><span class="p">:</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="nb">bool</span><span class="p">:</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="nb">list</span><span class="p">:</span><span class="s1">&#39;t&#39;</span><span class="p">,</span>
                         <span class="nb">float</span><span class="p">:</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">:</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">,</span>
                         <span class="nb">dict</span><span class="p">:</span><span class="s1">&#39;h&#39;</span><span class="p">}</span> <span class="c1"># date:&#39;date&#39;,buffer:&#39;by&#39;</span>
        <span class="k">try</span> <span class="p">:</span> 
            <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="p">,</span> <span class="n">timezone</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="s1">&#39;Importation datetime module failed ! please try again&#39;</span>
        
        <span class="k">if</span> <span class="nb">type</span> <span class="p">(</span><span class="n">datalist</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">dataname</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="s1">&#39;Please set a table name !&#39;</span>
            <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="n">datalist</span><span class="o">=</span><span class="p">{</span><span class="n">dataname</span><span class="p">:</span><span class="n">datalist</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">datalist</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="p">:</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">datalist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">rowval</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">main_f</span><span class="p">,</span> <span class="n">type_f</span><span class="p">,</span> <span class="n">posi</span><span class="p">,</span> <span class="n">num_of_val</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">rowval</span>
                    <span class="n">main_f</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">main_f</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">type_f</span> <span class="ow">in</span> <span class="n">field_dico_inv</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">type_f</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_dico_inv</span><span class="p">[</span><span class="n">type_f</span><span class="p">])</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">type_f</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">posi</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{0:&lt;3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">posi</span><span class="p">)</span>
                    <span class="n">num_of_val</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:&lt;7}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_of_val</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span> <span class="p">:</span>
                        <span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elm</span><span class="p">)</span> <span class="k">for</span> <span class="n">elm</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
                    <span class="c1"># find other param </span>
                    <span class="n">id_</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">main_f</span><span class="p">))</span>
                    <span class="n">dtime</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:}</span><span class="s1"> - </span><span class="si">{1:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
                    
                    <span class="n">idkey</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:&lt;}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">main_f</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">id_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">num_of_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">main_f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">comments</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                        <span class="n">comments</span> <span class="o">=</span><span class="s1">&#39;</span><span class="si">{0:}{1:&lt;7}{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span>
                                               <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">datalist</span><span class="p">))[</span><span class="o">-</span><span class="mi">7</span><span class="p">:],</span><span class="n">main_f</span><span class="p">)</span>
                    <span class="n">valueT</span><span class="o">=</span><span class="p">(</span><span class="n">main_f</span><span class="p">,</span> <span class="n">type_f</span><span class="p">,</span> <span class="n">id_</span><span class="p">,</span> <span class="n">posi</span><span class="p">,</span>
                               <span class="n">num_of_val</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">dtime</span><span class="p">,</span><span class="n">idkey</span><span class="p">,</span><span class="n">comments</span><span class="p">)</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">valueT</span>
                    
                <span class="n">datalist</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">values</span>
                
        <span class="k">return</span> <span class="n">datalist</span>     </div></div>

        


            
                

                
            
            
            
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pyCSAMT v1.0.03 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Kouadio K. Laurent.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.0.
    </div>
  </body>
</html>