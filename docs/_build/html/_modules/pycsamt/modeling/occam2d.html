
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pycsamt.modeling.occam2d &#8212; pyCSAMT v1.0.03 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pyCSAMT v1.0.03 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pycsamt.modeling.occam2d</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===============================================================================</span>
<span class="sd">    Copyright Â© 2021  Kouadio K.Laurent</span>
<span class="sd">    </span>
<span class="sd">    This file is part of pyCSAMT.</span>
<span class="sd">    </span>
<span class="sd">    pyCSAMT is free software: you can redistribute it and/or modify</span>
<span class="sd">    it under the terms of the GNU Lesser General Public License as published by</span>
<span class="sd">    the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">    (at your option) any later version.</span>
<span class="sd">    </span>
<span class="sd">    pyCSAMT is distributed in the hope that it will be useful,</span>
<span class="sd">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">    GNU Lesser General Public License for more details.</span>
<span class="sd">    </span>
<span class="sd">    You should have received a copy of the GNU Lesser General Public License</span>
<span class="sd">    along with pyCSAMT.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>

<span class="sd">=============================================================================== </span>
<span class="sd"> </span>
<span class="sd">.. _module-Occam2D :: `pycsamt.modeling.occam2d`</span>
<span class="sd">    :synopsis:: The Occam 2D MT inversion code (v3.0) presented here is an</span>
<span class="sd">                implementation of the general Occam procedure of  Constable, et al. (1987)</span>
<span class="sd">                extended to  2D by deGroot-Hedlin and Constable (1990).</span>
<span class="sd">                The 2D MT forward  calculations are carried out with codeprovided</span>
<span class="sd">                 by Wannamaker, et al (1987)  using reciprocity to calculate the</span>
<span class="sd">                Jacobian (de Lugao and Wannamaker, 1996).</span>
<span class="sd">                ...</span>
<span class="sd">                </span>
<span class="sd">.. seealso::</span>
<span class="sd">        - http://marineemlab.ucsd.edu/Projects/Occam/sharp/index.html </span>
<span class="sd">        - https://marineemlab.ucsd.edu/~kkey/Software.php</span>
<span class="sd">        - and  .. _MTpy:: `MTpy&lt;https://github.com/MTgeophysics/mtpy.git&gt;`</span>
<span class="sd">            ...</span>
<span class="sd">            </span>
<span class="sd">.. note:: Actually this module is not able to write Occam2D meshes file or build </span>
<span class="sd">        OccamInputfiles. However , you can import ocam module of :ref: `MTpy` toolbox     </span>
<span class="sd">       </span>
<span class="sd">        </span>
<span class="sd">@author: KouaoLaurent alias @Daniel03</span>
<span class="sd">Created on Fri Jan 22 20:31:14 2021</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pycsamt.modeling.__init__</span> <span class="kn">import</span>  <span class="n">SUCCESS_IMPORT_MTPY</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 


<span class="kn">import</span> <span class="nn">pycsamt.utils.exceptions</span> <span class="k">as</span> <span class="nn">CSex</span>
<span class="kn">from</span> <span class="nn">pycsamt.utils</span> <span class="kn">import</span> <span class="n">func_utils</span> <span class="k">as</span> <span class="n">func</span>

<span class="kn">from</span> <span class="nn">pycsamt.etc.infos</span> <span class="kn">import</span> <span class="n">_sensitive</span> <span class="k">as</span> <span class="n">SB</span> 
<span class="kn">from</span> <span class="nn">pycsamt.utils._csamtpylog</span> <span class="kn">import</span> <span class="n">csamtpylog</span> 

<span class="n">_logger</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">if</span>  <span class="n">SUCCESS_IMPORT_MTPY</span> <span class="p">:</span>

    <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;successfull imported :ref:`MTpy`&#39;</span><span class="p">)</span>
    <span class="k">try</span> <span class="p">:</span> 
        <span class="kn">from</span> <span class="nn">mtpy.modeling</span> <span class="kn">import</span> <span class="n">occam2d</span> <span class="k">as</span> <span class="n">MToccam2d</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;`occam2d` module sucessfully imported  from `MTpy`.&#39;</span><span class="p">)</span>
        
        <span class="n">SUCCESS_IMPORT_MTPY</span> <span class="o">=</span><span class="kc">True</span> 
    <span class="k">except</span> <span class="p">:</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;loading  `occam2d` module from `MTpy`packages  failed&#39;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Loading occam2d module from &quot;MTpy&quot; package failed ! Please try again&#39;</span><span class="p">)</span>
        
        <span class="n">SUCCESS_IMPORT_MTPY</span>  <span class="o">=</span><span class="kc">False</span> 
    
<span class="k">else</span><span class="p">:</span> 
    <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Unable to import `MTpy`packages. Loading failed !&#39;</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Tries to import :ref:`MTpy` failed !&#39;</span>
                  <span class="s1">&#39; you can get &quot;MTPY&quot; from :ref:`MTpy`.&#39;</span><span class="p">)</span>
     
    <span class="n">SUCCESS_IMPORT_MTPY</span> <span class="o">=</span><span class="kc">False</span> 
    


<div class="viewcode-block" id="occamLog"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.occamLog">[docs]</a><span class="k">class</span> <span class="nc">occamLog</span> <span class="p">(</span><span class="nb">object</span><span class="p">)</span> <span class="p">:</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to deal with occcam 2d logfile . File output after inverted data.</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        **fn** : str </span>
<span class="sd">            full path to occam logfile </span>
<span class="sd">            </span>
<span class="sd">    ==================  ==============  =====================================</span>
<span class="sd">    Attributes          Type            Description </span>
<span class="sd">    ==================  ==============  =====================================</span>
<span class="sd">    rms                 float           RootMeansquared computation Error </span>
<span class="sd">    iteration           float           number of iteration </span>
<span class="sd">    fminocc             float           minimum tolerance </span>
<span class="sd">    stepsize            float           cutoff evaluation function </span>
<span class="sd">    roughness           float           deGrootHeldin roughness parameters.</span>
<span class="sd">    ==================  ==============  =====================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">occam_params</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;rms&#39;</span><span class="p">,</span> <span class="s1">&#39;iteration&#39;</span><span class="p">,</span> <span class="s1">&#39;fminocc&#39;</span><span class="p">,</span> <span class="s1">&#39;stepsize&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;roughness&#39;</span><span class="p">,</span> <span class="s1">&#39;and_is&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="o">=</span><span class="n">fn</span> 
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_params</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            
            <span class="bp">self</span><span class="o">.</span><span class="n">read_occam2d_logfile</span><span class="p">()</span>
            
            
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">fn</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> 
    
    <span class="nd">@fn</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">fn</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        assert  the occam logfile. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Asserting &lt;</span><span class="si">%s</span><span class="s1">&gt; occam2d logfile.&#39;</span><span class="o">%</span> <span class="n">logpath</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">logpath</span><span class="p">)</span> <span class="o">==</span><span class="s1">&#39;logfile&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="o">=</span> <span class="n">logpath</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No occam 2d logfile detected. Please check your path.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d</span><span class="p">(</span><span class="s1">&#39;Doesnt not recognize the Logfile &lt;</span><span class="si">{0}</span><span class="s1">&gt;&#39;</span>\
                                            <span class="s1">&#39; provided.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">logpath</span><span class="p">)))</span>
            
<div class="viewcode-block" id="occamLog.read_occam2d_logfile"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.occamLog.read_occam2d_logfile">[docs]</a>    <span class="k">def</span> <span class="nf">read_occam2d_logfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read occam file and populate attributes. </span>
<span class="sd">        </span>
<span class="sd">        :param fn:  full path to occam2d log file </span>
<span class="sd">        :type fn: str</span>

<span class="sd">        :Example: </span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from pycsamt.modeling import occam2d </span>
<span class="sd">            &gt;&gt;&gt; path =os.path.join(os.environ [&#39;pyCSAMT&#39;], &#39;pycsamt&#39;, &#39;data&#39;,</span>
<span class="sd">            ...                       &#39;occam2D&#39;, &#39;logFile.logfile&#39;)</span>
<span class="sd">            &gt;&gt;&gt; occamlog_obj =occam2d.Log(fn = path)</span>
<span class="sd">            &gt;&gt;&gt; print(occamlog_obj.rms.shape)</span>
<span class="sd">            &gt;&gt;&gt; print(occamlog_obj.roughness.shape)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Reading and setting OccamLog  atributes from logfiles &lt;</span><span class="si">%s</span><span class="s1">&gt;.&#39;</span><span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d</span><span class="p">(</span><span class="s1">&#39;None occam2dlog file detected. Please check your right path .&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">focc</span><span class="p">:</span> 
            <span class="n">occamlog_lines</span> <span class="o">=</span><span class="n">focc</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">oc</span> <span class="p">,</span>  <span class="n">occam</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">occamlog_lines</span><span class="p">)</span> <span class="p">:</span> 
            
            <span class="k">if</span> <span class="n">occam</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;r.m.s&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">occam</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;starting&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">rms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">occam</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
       
            <span class="k">if</span> <span class="n">occam</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;iteration&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span><span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">:</span> <span class="c1"># for safety , we collect the iteration number from logile.</span>
                 <span class="k">for</span> <span class="n">iocc</span> <span class="ow">in</span> <span class="n">occam</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">():</span> 
                     <span class="k">try</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">iocc</span><span class="p">)</span>
                     <span class="k">except</span><span class="p">:</span>  <span class="k">pass</span> 
                     <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">iocc</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">occam</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;fminocc&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">occam</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;minimum tol from&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">fminocc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">occam</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">occam</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;and is&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">and_is</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">occam</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">occam</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;stepsize is&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">occam</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">occam</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;roughness is&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">roughness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">occam</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
                
        <span class="c1">#---&lt; resetting attributes </span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_params</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div></div>
                
<div class="viewcode-block" id="Data"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Data">[docs]</a><span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read and write Occam data</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        **fn** : str </span>
<span class="sd">            full path to occam Data file </span>
<span class="sd">        </span>
<span class="sd">     .. note:: Replace the marker &quot;**&quot; in followig attributes  by &quot;occam_data&quot; </span>
<span class="sd">     </span>
<span class="sd">    ===================  ================  ====================================</span>
<span class="sd">    Attributes            Type              Description</span>
<span class="sd">    ===================  ================  ====================================</span>
<span class="sd">    **format              str               occam sofware version name </span>
<span class="sd">    **title               str               title given the building files </span>
<span class="sd">    **sites               array_like        array of stations names </span>
<span class="sd">    **offsets             array_like        array of site locations along</span>
<span class="sd">                                            the 2D line in meters  </span>
<span class="sd">    **frequencies         array_like        array of frequencies in decreasing </span>
<span class="sd">    **data_nblocks        int               order number of data blocks for  </span>
<span class="sd">                                            building models </span>
<span class="sd">    **data                (ndarray,4)       array of {site, freq, type, datum,</span>
<span class="sd">                                            error} . datacollected                  </span>
<span class="sd">    ===================  ================  ====================================</span>
<span class="sd">    </span>
<span class="sd">    Reads data files and find list of explanations of model model mode .  </span>

<span class="sd">    ===================== =====================================================</span>
<span class="sd">    Model Modes           Description                     </span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    1 or log_all          Log resistivity of TE and TM plus Tipper</span>
<span class="sd">    2 or log_te_tip       Log resistivity of TE plus Tipper</span>
<span class="sd">    3 or log_tm_tip       Log resistivity of TM plus Tipper</span>
<span class="sd">    4 or log_te_tm        Log resistivity of TE and TM</span>
<span class="sd">    5 or log_te           Log resistivity of TE</span>
<span class="sd">    6 or log_tm           Log resistivity of TM</span>
<span class="sd">    7 or all              TE, TM and Tipper</span>
<span class="sd">    8 or te_tip           TE plus Tipper</span>
<span class="sd">    9 or tm_tip           TM plus Tipper</span>
<span class="sd">    10 or te_tm           TE and TM mode</span>
<span class="sd">    11 or te              TE mode</span>
<span class="sd">    12 or tm              TM mode</span>
<span class="sd">    13 or tip             Only Tipper</span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">occam_data_type</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;te_log10&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> 
                 <span class="s1">&#39;te_phase&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> 
                 <span class="s1">&#39;real_tip&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> 
                 <span class="s1">&#39;imag_tip&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> 
                 <span class="s1">&#39;tm_log10&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                 <span class="s1">&#39;tm_phase&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
                 <span class="s1">&#39;tm_tip&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span>
                 <span class="s1">&#39;tm_tip&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                 <span class="s1">&#39;te&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span>
                 <span class="s1">&#39;tm&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                 <span class="s1">&#39;real_zxx&#39;</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span>
                 <span class="s1">&#39;imag_zxx&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                 <span class="s1">&#39;real_zxy&#39;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span> 
                 <span class="s1">&#39;imag_zyx&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span>
                 <span class="s1">&#39;real_zyx&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span>
                 <span class="s1">&#39;imag_zyx&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span>
                 <span class="s1">&#39;real_zyy&#39;</span><span class="p">:</span><span class="mi">17</span><span class="p">,</span>
                 <span class="s1">&#39;imag_zyy&#39;</span><span class="p">:</span><span class="mi">18</span> <span class="p">}</span>
    <span class="n">occam_dataType</span> <span class="p">,</span> <span class="n">occam_modes</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="mi">1</span> <span class="p">:</span><span class="s1">&#39;TE apparent resistivity (log10)&#39;</span><span class="p">,</span>
                    <span class="mi">2</span> <span class="p">:</span> <span class="s1">&#39;TE phase&#39;</span><span class="p">,</span>
                    <span class="mi">3</span> <span class="p">:</span> <span class="s1">&#39;real(tipper) Hz/Hy&#39;</span><span class="p">,</span>
                    <span class="mi">4</span> <span class="p">:</span> <span class="s1">&#39;imag(tipper) Hz/Hy&#39;</span><span class="p">,</span>
                    <span class="mi">5</span> <span class="p">:</span> <span class="s1">&#39;TM apparent resistivity (log10)&#39;</span><span class="p">,</span>
                    <span class="mi">6</span> <span class="p">:</span> <span class="s1">&#39;TM phase&#39;</span><span class="p">,</span>
                    <span class="mi">7</span> <span class="p">:</span> <span class="s1">&#39;reserved for TM Ez/Ey tipper&#39;</span><span class="p">,</span>
                    <span class="mi">8</span> <span class="p">:</span> <span class="s1">&#39;reserved for TM Ez/Ey tipper&#39;</span><span class="p">,</span>
                    <span class="mi">9</span> <span class="p">:</span> <span class="s1">&#39;TE apparent resistivity (linear)&#39;</span><span class="p">,</span>
                    <span class="mi">10</span> <span class="p">:</span> <span class="s1">&#39;TM apparent resistivity (linear)&#39;</span><span class="p">,</span>
                    <span class="mi">12</span> <span class="p">:</span> <span class="s1">&#39;imag(Zxx) ! not used until we incorporate site-rotation angle&#39;</span><span class="p">,</span>
                    <span class="mi">11</span> <span class="p">:</span> <span class="s1">&#39;real(Zxx) ! not used until we incorporate site-rotation angle&#39;</span><span class="p">,</span>
                    <span class="mi">13</span> <span class="p">:</span> <span class="s1">&#39;real(Zxy) ! TE&#39;</span><span class="p">,</span>
                    <span class="mi">14</span> <span class="p">:</span> <span class="s1">&#39;imag(Zxy) ! TE&#39;</span><span class="p">,</span>
                    <span class="mi">15</span> <span class="p">:</span> <span class="s1">&#39;real(Zyx) ! TM&#39;</span><span class="p">,</span>
                    <span class="mi">16</span> <span class="p">:</span> <span class="s1">&#39;imag(Zyx) ! TM&#39;</span><span class="p">,</span>
                    <span class="mi">17</span> <span class="p">:</span> <span class="s1">&#39;imag(Zyy) ! not used until we incorporate site-rotation angle&#39;</span><span class="p">,</span>
                    <span class="mi">18</span> <span class="p">:</span> <span class="s1">&#39;imag(Zyy) ! not used until we incorporate site-rotation angle&#39;</span><span class="p">},{</span>
                                        <span class="s1">&#39;log_all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;log_te_tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                        <span class="s1">&#39;log_tm_tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                        <span class="s1">&#39;log_te_tm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;log_te&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                        <span class="s1">&#39;log_tm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;te_tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                        <span class="s1">&#39;tm_tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                        <span class="s1">&#39;te_tm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;te&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                        <span class="s1">&#39;tm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;tip&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                        <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                        <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                        <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                        <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;7&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;8&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                        <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                        <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;11&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                        <span class="s1">&#39;12&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                                        <span class="s1">&#39;13&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]}</span>


    <span class="n">data_blocks_header</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;datum&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;OCCAM2MTDATA_1.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_title</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward model response from Occam2D&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sites&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;offsets&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;frequencies&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_nblocks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;data_blocks&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">occam_data</span> <span class="o">=</span><span class="kc">None</span>
 
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_occam2d_datafile</span> <span class="p">()</span>
            
<div class="viewcode-block" id="Data.read_occam2d_datafile"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Data.read_occam2d_datafile">[docs]</a>    <span class="k">def</span> <span class="nf">read_occam2d_datafile</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read_occam_data file. and populates attributes </span>

<span class="sd">        :param fn: full path to occam data file .</span>
<span class="sd">        :type fn: str</span>
<span class="sd">            </span>
<span class="sd">        :Example:</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; path =os.path.join(os.environ [&#39;pyCSAMT&#39;], </span>
<span class="sd">            ...                       &#39;pycsamt&#39;, &#39;data&#39;, &#39;occam2D&#39;, </span>
<span class="sd">            ...                       &#39;OccamDataFile.dat&#39;)</span>
<span class="sd">            &gt;&gt;&gt; occamdata_obj =Data(fn = path)</span>
<span class="sd">            &gt;&gt;&gt; print(occamdata_obj.occam_data_format)</span>
<span class="sd">            &gt;&gt;&gt; print(occamdata_obj.occam_data_blocks)</span>
<span class="sd">            &gt;&gt;&gt; print(occamdata_obj.occam_data_title)</span>
<span class="sd">            &gt;&gt;&gt; print(occamdata_obj.occam_data_sites)</span>
<span class="sd">            &gt;&gt;&gt; print(occamdata_obj.occam_data_frequencies)</span>
<span class="sd">            &gt;&gt;&gt; print(occamdata_obj.occam_data_offsets)</span>
<span class="sd">            &gt;&gt;&gt; occamDATA = occamdata_obj.occam_data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span><span class="n">data_fn</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Read Occam2D data file :&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;occamdat&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">focd</span> <span class="p">:</span> 
                <span class="n">occam_data_lines</span> <span class="o">=</span><span class="n">focd</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="c1"># get data from occam files </span>
        <span class="n">indextemp</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">dataparams</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">occam_data_lines</span><span class="p">)</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="n">dataparams</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">)</span><span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_format</span><span class="o">=</span> <span class="n">dataparams</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dataparams</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_title</span> <span class="o">=</span><span class="n">dataparams</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dataparams</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span><span class="n">indextemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataparams</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> <span class="n">indextemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataparams</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;frequencies&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> <span class="n">indextemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataparams</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_nblocks</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dataparams</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dataparams</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">dataparams</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                <span class="n">indextemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
                
                <span class="k">break</span>
        <span class="c1">#--&gt; now get each specials arrays and eliminate (the firsst tiles )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="o">=</span><span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">occam_data_lines</span><span class="p">[</span><span class="n">indextemp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">indextemp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">off</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">off</span> <span class="ow">in</span> <span class="n">occam_data_lines</span><span class="p">[</span><span class="n">indextemp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span> <span class="p">:</span> <span class="n">indextemp</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span> <span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">freq</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">occam_data_lines</span><span class="p">[</span><span class="n">indextemp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">indextemp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        
        <span class="c1">#cchek if frequencies are sorted in decrease order : highest to lower frequencies </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_flip_freq</span><span class="o">=</span><span class="kc">False</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_flip_freq</span> <span class="o">=</span><span class="kc">True</span> 
            
        <span class="n">temp</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">occam_data_lines</span><span class="p">[</span><span class="n">indextemp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">concat_array_from_list</span><span class="p">(</span><span class="n">list_of_array</span><span class="o">=</span><span class="n">temp</span><span class="p">)</span>

        <span class="c1"># set attributes tO DATAblocks class </span>

        <span class="c1"># for ikey, key in enumerate(self.data_titles ) : </span>
        <span class="n">occam_data_dict</span> <span class="o">=</span><span class="p">{</span><span class="n">key</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">ikey</span><span class="p">]</span>  <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_blocks_header</span><span class="p">)}</span>

        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;occam_data_blocks&#39;</span><span class="p">,</span> <span class="n">DataBlock</span><span class="p">(</span><span class="o">**</span><span class="n">occam_data_dict</span><span class="p">))</span>
        <span class="c1">#straighten out offset  and get the step </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="c1"># graduate to min to max for consistency </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
        <span class="n">step</span><span class="o">=</span>  <span class="n">func</span><span class="o">.</span><span class="n">round_dipole_length</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1">#regraduate offset </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="p">),</span> <span class="n">step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span> <span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:-^77}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Occam 2D Data infos&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Sites num.&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Frequencies num.&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Highest frequency (Hz)&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Lowest frequency (Hz)&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Minimum offset (m)&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Maximum offset (m)&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_offsets</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">77</span><span class="p">)</span></div>
        
        
        
<div class="viewcode-block" id="Data.write_occam2d_data"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Data.write_occam2d_data">[docs]</a>    <span class="k">def</span> <span class="nf">write_occam2d_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. Future plan:: We will call MTpy here for</span>
<span class="sd">                    writing Occam2D data file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span> </div></div>
    
<div class="viewcode-block" id="DataBlock"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.DataBlock">[docs]</a><span class="k">class</span> <span class="nc">DataBlock</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read OccamDataBlock aand set corresponding attributes </span>
<span class="sd">     </span>
<span class="sd">    ======================  ===================================================</span>
<span class="sd">    Attributes              Description (Restriction)</span>
<span class="sd">    ======================  ===================================================</span>
<span class="sd">    site                    number of the site from the site list that this data </span>
<span class="sd">                            belongs to.</span>
<span class="sd">    freq                    number of the frequency from the frequency list.</span>
<span class="sd">    type                    type of data</span>
<span class="sd">    datum                   data value</span>
<span class="sd">    error                   size of the error for this measurement  </span>
<span class="sd">                            For log10 resistivity this value can look a little </span>
<span class="sd">                            strange. It is derived from the calculation</span>
<span class="sd">                            d(log_10(x))/dx = 1/[x ln(10)]. So for 10% error, </span>
<span class="sd">                            dx = 0.10x thus d(log_10(x)) = 0.10x / x ln(10) </span>
<span class="sd">                            =.1/ln(10) = 0.0434</span>
<span class="sd">    ======================  ===================================================</span>
<span class="sd">    </span>
<span class="sd">    :Example:</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; form pycsamt.modeling import DataBlock </span>
<span class="sd">        &gt;&gt;&gt; np.random.seed(1983)</span>
<span class="sd">        &gt;&gt;&gt; dblocks_dict = {&#39;site&#39; : [&#39;S{0:02}&#39;.format(ii)  for ii in range (10)], </span>
<span class="sd">        ...                &#39;freq&#39;: np.linspace(1, 8912, 10), </span>
<span class="sd">        ...                &#39;type&#39; :(5,6), </span>
<span class="sd">        ...                &#39;data&#39; : np.power(10, np.random.randn(20*2)), </span>
<span class="sd">        ...                &#39;error&#39; : np.random.randn(20)</span>
<span class="sd">        ...                }</span>
<span class="sd">        &gt;&gt;&gt; dblock_obj = DataBlock(**dblocks_dict)</span>
<span class="sd">        &gt;&gt;&gt; print(dblock_obj.freq )</span>
<span class="sd">        &gt;&gt;&gt; print(dblock_obj.error)</span>
<span class="sd">        &gt;&gt;&gt; print(dblock_obj.site)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># blocks_params = [&#39;site&#39;, &#39;feq&#39;, &#39;type&#39;, &#39;datum&#39;, &#39;error&#39;]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">keyb</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyb</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">keyb</span><span class="p">])</span>
        
        <span class="c1">#cehck main attributes []</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">):</span> <span class="c1"># find the occam2d mode provided </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="n">type_value</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">Data</span><span class="o">.</span><span class="n">occam_modes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
                    <span class="k">if</span> <span class="n">items</span> <span class="o">==</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">type_value</span><span class="p">)]:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;data_mode&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">ikey</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">]:</span> <span class="c1"># </span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ikey</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ikey</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                    <span class="k">if</span> <span class="n">ikey</span> <span class="o">==</span><span class="s1">&#39;error&#39;</span> <span class="p">:</span> 
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ikey</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ikey</span><span class="p">)]))</span>
                    <span class="k">else</span> <span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ikey</span><span class="p">,</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span> <span class="k">for</span> <span class="n">sf</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ikey</span><span class="p">)])</span>
  
        <span class="c1"># check if all attribute are set from data  </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Ckeck dataBlocks and share corresponding data params have been giveen properly.&#39;</span><span class="p">)</span>
        
        <span class="n">_dbk</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">Data</span><span class="o">.</span><span class="n">data_blocks_header</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">])</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">_dbk</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_dbk</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span><span class="mi">5</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_dbk_properly</span><span class="p">()</span> 

                
    <span class="k">def</span> <span class="nf">_set_dbk_properly</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        method to set property data </span>
<span class="sd">        Ckeck dataBlocks and share corresponding data params separately.</span>
<span class="sd">        </span>
<span class="sd">        for instance:</span>
<span class="sd">             site (1=site number 1=S00), freq(1: freq numb1),</span>
<span class="sd">                   dataType(5: logTM, 6:phaseTM) </span>
<span class="sd">        like:</span>
<span class="sd">            dict_mode ={ &#39;6&#39;: }</span>
<span class="sd">        &quot;&quot;&quot;</span>
   
        <span class="c1">#create data mode dict and put all value inside </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="c1"># self.dict_mode ={str(key): [] for key in Data.occam_modes[self.data_mode]}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_mode</span> <span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_mode</span><span class="p">:[]}</span>
            
        <span class="k">for</span> <span class="n">kmode</span><span class="p">,</span> <span class="n">vmode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_mode</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span> 
            <span class="k">for</span> <span class="n">itype</span> <span class="p">,</span> <span class="n">occamtype</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>  <span class="p">:</span> 
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">occamtype</span><span class="p">)</span> <span class="o">==</span> <span class="n">kmode</span> <span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_mode</span><span class="p">[</span><span class="n">kmode</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="p">[</span><span class="n">itype</span><span class="p">],</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">itype</span><span class="p">],</span> 
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">datum</span><span class="p">[</span><span class="n">itype</span><span class="p">],</span> 
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="n">itype</span><span class="p">]]))</span>
                    
        <span class="c1"># put all value on array of [site, freq , datum , error] </span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_mode</span><span class="o">.</span><span class="n">items</span> <span class="p">():</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_mode</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">concat_array_from_list</span><span class="p">(</span><span class="n">list_of_array</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
     
<div class="viewcode-block" id="DataBlock.decode_each_site_data"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.DataBlock.decode_each_site_data">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">decode_each_site_data</span> <span class="p">(</span><span class="n">data_blocks</span><span class="p">,</span> <span class="n">data_type_index</span><span class="p">)</span>  <span class="p">:</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decode each site data and get differents values array </span>
<span class="sd">        :param datablocks:  datafrom differents blocks</span>
<span class="sd">        :type datablocks: ndarray </span>
<span class="sd">        </span>
<span class="sd">        :param data_type_index: specify the data type index </span>
<span class="sd">        :type data_type_index: int </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">block_type</span> <span class="o">=</span> <span class="n">data_blocks</span><span class="p">[</span> <span class="p">:,</span>  <span class="n">data_type_index</span><span class="p">]</span>
        <span class="n">get_occam_mode</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">block_type</span><span class="p">)])</span>
        

        <span class="k">for</span> <span class="n">keymode</span><span class="p">,</span> <span class="n">valuemode</span> <span class="ow">in</span> <span class="n">Data</span><span class="o">.</span><span class="n">occam_modes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">get_occam_mode</span><span class="p">)</span> <span class="o">==</span><span class="n">valuemode</span> <span class="p">:</span> 
                <span class="n">occam_data_mode</span> <span class="o">=</span> <span class="n">keymode</span>
                <span class="n">occam_value_mode</span> <span class="o">=</span> <span class="n">valuemode</span> 
  
        <span class="k">if</span> <span class="n">occam_data_mode</span> <span class="o">==</span><span class="s1">&#39;log_tm&#39;</span> <span class="ow">or</span> <span class="n">occam_data_mode</span> <span class="o">==</span><span class="s1">&#39;6&#39;</span><span class="p">:</span> 
            <span class="n">temp</span><span class="p">,</span> <span class="n">decode_dict</span> <span class="o">=</span><span class="p">[],</span> <span class="p">{}</span>
            <span class="n">value_to_keep</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">occam_modes</span><span class="p">[</span><span class="s1">&#39;log_tm&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># get the first value for occma mmode </span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">respitems</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_blocks</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">respitems</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">data_type_index</span><span class="p">)])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_to_keep</span><span class="p">)</span> <span class="p">:</span> 
                    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">respitems</span><span class="p">)</span>
        <span class="n">decode_dict</span> <span class="p">[</span><span class="n">occam_data_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">concat_array_from_list</span><span class="p">(</span><span class="n">list_of_array</span><span class="o">=</span><span class="n">temp</span><span class="p">)</span> 
        
        <span class="k">if</span> <span class="n">occam_data_mode</span> <span class="o">==</span><span class="s1">&#39;log_te&#39;</span> <span class="ow">or</span> <span class="n">occam_data_mode</span> <span class="o">==</span><span class="s1">&#39;5&#39;</span><span class="p">:</span> 
            <span class="n">temp</span><span class="p">,</span><span class="n">decode_dict</span> <span class="o">=</span><span class="p">[],</span> <span class="p">{}</span>
            <span class="n">value_to_keep</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">occam_modes</span><span class="p">[</span><span class="s1">&#39;log_te&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># get the first value for occma mmode </span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">respitems</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_blocks</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">respitems</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">data_type_index</span><span class="p">)])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_to_keep</span><span class="p">)</span> <span class="p">:</span> 
                    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">respitems</span><span class="p">)</span>
            
            <span class="n">decode_dict</span> <span class="p">[</span><span class="n">occam_data_mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">concat_array_from_list</span><span class="p">(</span><span class="n">list_of_array</span><span class="o">=</span><span class="n">temp</span><span class="p">)</span> 
    
            
        <span class="k">return</span> <span class="n">decode_dict</span><span class="p">,</span> <span class="n">occam_data_mode</span><span class="p">,</span>  <span class="n">occam_value_mode</span></div></div>
                   

<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Occam Model , Actually read model file</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">        **model_fn** : str </span>
<span class="sd">                full path to occam model file </span>
<span class="sd">        </span>
<span class="sd">    ..note:: Replace the marker &quot;**&quot; in followig attributes  by &quot;model_&quot;</span>
<span class="sd">    </span>
<span class="sd">    ==================  =================  ====================================</span>
<span class="sd">    Attributes          Type                Description </span>
<span class="sd">    ==================  =================  ====================================</span>
<span class="sd">    **format              str               occam sofware version name </span>
<span class="sd">    **description         str               describe the model </span>
<span class="sd">    **name                str               name of the models </span>
<span class="sd">    **meshfile            str               The name of the mesh file.</span>
<span class="sd">    **mesh_type           str               the type of the mesh ,default is PW2D</span>
<span class="sd">    **static_file         str               name of static file if given . </span>
<span class="sd">                                            Default  is &#39;none&#39;.</span>
<span class="sd">    **prejudice_file      str               name of the prejudice file if given.</span>
<span class="sd">                                            default is &#39;none&#39;.models </span>
<span class="sd">    **binding_offset      float             param value for a model block can be </span>
<span class="sd">                                            aggregation into  many mesh blocks</span>
<span class="sd">    **num_layers          float             number of layers of model blocks          </span>
<span class="sd">    ==================  =================  ====================================</span>
<span class="sd">    </span>
<span class="sd">    :Example:   </span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; from pycsamt.modeling.occam2d import Model</span>
<span class="sd">        &gt;&gt;&gt; data=&#39;OccamDataFile.dat&#39;</span>
<span class="sd">        &gt;&gt;&gt; mesh = &#39;Occam2DMesh&#39;</span>
<span class="sd">        &gt;&gt;&gt; model = &#39;Occam2DModel&#39;</span>
<span class="sd">        &gt;&gt;&gt; iter_=&#39;ITER17.iter&#39;</span>
<span class="sd">        &gt;&gt;&gt; path =os.path.join(os.environ [&#39;pyCSAMT&#39;], &#39;pycsamt&#39;, &#39;data&#39;, &#39;occam2D&#39;, mesh)</span>
<span class="sd">        ...                   #,&#39;OccamDataFile.dat&#39;)</span>
<span class="sd">        &gt;&gt;&gt; occam_model_obj =Model(mesh_fn=path, </span>
<span class="sd">        ...                    iter_fn = os.path.join(os.path.dirname(path), iter_), </span>
<span class="sd">        ...                    model_fn =os.path.join(os.path.dirname(path), model) )</span>
<span class="sd">        ... print(occam_model_obj.model_binding_offset)</span>
<span class="sd">        ... print(occam_model_obj.model_resistivity)</span>
<span class="sd">        ... print(occam_model_obj.model_values)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span><span class="n">iter_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">mesh_fn</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span> <span class="n">model_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="o">=</span><span class="n">iter_fn</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="o">=</span><span class="n">mesh_fn</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model_format</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;OCCAM2MTMOD_1.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_name&#39;</span><span class="p">,</span><span class="s1">&#39;Descriptive text here&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_description</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;SIMPLE INVERSION|More descriptive text&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_mesh_file</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mesh_file&#39;</span><span class="p">,</span> <span class="s1">&#39;Occam.mesh&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_mesh_type</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mesh_type&#39;</span><span class="p">,</span> <span class="s1">&#39;PW2D&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model_statics_file</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prejudice_file&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">model_prejudice_file</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prejudice_file&#39;</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_binding_offset</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;binding_offset&#39;</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_num_layers</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;num_layers&#39;</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_exceptions</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;numbers_exceptions&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        

        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_occam2d_modelfile</span> <span class="p">()</span>
            
<div class="viewcode-block" id="Model.read_occam2d_modelfile"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Model.read_occam2d_modelfile">[docs]</a>    <span class="k">def</span> <span class="nf">read_occam2d_modelfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">iter_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read   and ascertain modelfile.</span>
<span class="sd">        </span>
<span class="sd">        :param model_fn: full path to OCCAM2D model file </span>
<span class="sd">        :type model_fn: str </span>
<span class="sd">        </span>
<span class="sd">        :param mesh_fn: full path to MESH model file </span>
<span class="sd">        :type mesh_fn: str </span>
<span class="sd">        </span>
<span class="sd">        :param iter_fn: full path to ITER model file </span>
<span class="sd">        :type iter_fn: str </span>
<span class="sd">        </span>
<span class="sd">        :Example:</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; path =os.path.join(os.environ [&#39;pyCSAMT&#39;], &#39;pycsamt&#39;, </span>
<span class="sd">            ...                       &#39;data&#39;, &#39;occam2D&#39;, &#39;Occam2DModel&#39;)</span>
<span class="sd">            &gt;&gt;&gt; occammodel_obj =Model(model_fn = path)</span>
<span class="sd">            ... print(occammodel_obj.model_name)</span>
<span class="sd">            ... print(occammodel_obj.model_mesh_file)</span>
<span class="sd">            ... print(occammodel_obj.model_num_layers)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="o">=</span> <span class="n">model_fn</span> 
        <span class="k">if</span> <span class="n">iter_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="o">=</span> <span class="n">iter_fn</span> 
        <span class="k">if</span> <span class="n">mesh_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="o">=</span><span class="n">mesh_fn</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Read Occam2D MODEL file :&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="p">)</span>
        
        <span class="c1">#initialise attrinute as empty list for row and colums appended </span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;model_columns&#39;</span><span class="p">,</span> <span class="s1">&#39;model_rows&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span>
            
        <span class="c1"># make ascertainement for all files provided </span>
        <span class="k">for</span>  <span class="n">ifile</span> <span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">],</span> 
                                   <span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;iteration&#39;</span><span class="p">,</span> <span class="s1">&#39;mesh&#39;</span><span class="p">]):</span> 
            
            <span class="n">mess</span><span class="o">=</span><span class="s1">&#39;Error Input file ! No </span><span class="si">{0}</span><span class="s1"> file found. Please input </span><span class="si">{0}</span><span class="s1"> file.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
             
            <span class="k">if</span> <span class="n">ifile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">py</span>
        
        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="p">)</span><span class="o">==</span><span class="s1">&#39;model&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="k">as</span> <span class="n">fmod</span> <span class="p">:</span> 
                <span class="n">occam_model_datalines</span> <span class="o">=</span><span class="n">fmod</span><span class="o">.</span><span class="n">readlines</span> <span class="p">()</span>
    
        <span class="c1">#initialise empty list for model columns and rows and populates attributes</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">modelitem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">occam_model_datalines</span><span class="p">):</span> 
            <span class="k">if</span> <span class="n">modelitem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="n">modelitem</span> <span class="o">=</span><span class="n">modelitem</span> <span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">modelitem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span>
                    <span class="n">modelitem</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;exception&#39;</span> 
                <span class="c1"># keep the index of num_layer so to loop for fill model values </span>
                <span class="k">try</span> <span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;model_&#39;</span> <span class="o">+</span> <span class="n">modelitem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(</span><span class="n">modelitem</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">except</span> <span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;model_&#39;</span> <span class="o">+</span> <span class="n">modelitem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">modelitem</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">pass</span> 
            <span class="k">else</span> <span class="p">:</span> 
                <span class="n">modelitem</span> <span class="o">=</span><span class="n">modelitem</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelitem</span><span class="p">)</span> <span class="o">==</span><span class="mi">2</span> <span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">(</span><span class="n">modelitem</span><span class="p">)])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelitem</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">2</span> <span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">modelitem</span><span class="p">])</span>
        
        
        <span class="c1"># get model value from iteration object </span>
        <span class="n">occam_iter_obj</span> <span class="o">=</span><span class="n">Iter</span><span class="p">(</span><span class="n">iter_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span> <span class="o">=</span> <span class="n">occam_iter_obj</span><span class="o">.</span><span class="n">iter_data</span>  <span class="c1"># flatterned array</span>
        <span class="c1"># get iteration info </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_rms</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">occam_iter_obj</span><span class="o">.</span><span class="n">iter_misfit_value</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_roughness</span><span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">occam_iter_obj</span><span class="o">.</span><span class="n">iter_roughness_value</span><span class="p">)</span>

        <span class="c1"># get xnodes and znodes from mesh object  # dont need to get grid because </span>
        <span class="n">occam_mesh_obj</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">mesh_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="p">)</span>
        <span class="n">occam_mesh_x_nodes</span> <span class="o">=</span> <span class="n">occam_mesh_obj</span><span class="o">.</span><span class="n">mesh_x_nodes</span> 
        <span class="n">occam_mesh_z_nodes</span> <span class="o">=</span><span class="n">occam_mesh_obj</span><span class="o">.</span><span class="n">mesh_z_nodes</span> 

        <span class="c1"># initilise model array to put resistivity into agragated mesh </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_resistivity</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">occam_mesh_z_nodes</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">occam_mesh_x_nodes</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
      
        <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">)</span> 
    
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Read Model Blocks and put model resistivity inot aggregated mesh blocks &#39;</span><span class="p">)</span>
        <span class="c1">#---&gt; make sure the size of model column = modelsize </span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">):</span>
            <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;Model rows and Models columns should be  the same length.&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;However lengths model rows = </span><span class="si">{0}</span><span class="s1"> and model colums = </span><span class="si">{1}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">)),</span> 
                           <span class="s1">&#39;Please check your &lt;</span><span class="si">{0}</span><span class="s1">&gt; modelfile.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span><span class="p">)</span> <span class="p">)</span>
                           <span class="p">])</span>
                                                                          
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span> <span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
        
        <span class="c1">#---&gt; loop the model rows suppose the number of models layer </span>
        <span class="n">occm</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">mindex</span>  <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">)):</span> 
            <span class="c1">#get the first inthe first in the pair of lines that describes a layer of model blocks.</span>
            <span class="n">fp_sta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">[:</span><span class="n">mindex</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c1"># sum to get the number of model layer at the end </span>
            <span class="c1">#find next value for slicing </span>
            <span class="n">fp_end</span> <span class="o">=</span> <span class="n">fp_sta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">[</span><span class="n">mindex</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
            <span class="c1"># find the second pair of lines that describes a layer of model blocks.</span>
            <span class="c1"># is the columns </span>
            <span class="n">sp_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="p">[</span><span class="n">mindex</span><span class="p">])</span>
            <span class="c1"># then loop the collum and put the the number of mesh blocks that are aggregated into each model block</span>
            <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sp_columns</span><span class="p">)):</span> 
                <span class="n">cp_sta</span> <span class="o">=</span> <span class="n">sp_columns</span> <span class="p">[:</span><span class="n">im</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">cp_end</span> <span class="o">=</span> <span class="n">cp_sta</span> <span class="o">+</span> <span class="n">sp_columns</span><span class="p">[</span><span class="n">im</span><span class="p">]</span>    <span class="c1"># stop add when </span>
                <span class="c1">#Put model resistivities into aggregated mesh </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_resistivity</span><span class="p">[</span><span class="n">fp_sta</span><span class="p">:</span><span class="n">fp_end</span><span class="p">,</span> <span class="n">cp_sta</span><span class="p">:</span><span class="n">cp_end</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_values</span><span class="p">[</span><span class="n">occm</span><span class="p">]</span>
                <span class="n">occm</span> <span class="o">+=</span><span class="mi">1</span> 
      
        <span class="c1">#-------MAKE A PLOT PURPOSE ----------------------</span>
        <span class="c1"># making model z_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_grid</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_grid</span> <span class="o">=</span><span class="n">occam_mesh_z_nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">occam_mesh_x_nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="c1"># for dep, offs in zip( [self.z_grid, self.x_grid],[occam_mesh_z_nodes, occam_mesh_x_nodes])  : </span>
        <span class="c1">#     dep = np.array([dep[:ii].sum() for ii in range(len(offs))])</span>
        
        <span class="c1"># self.z_grid = np.array([self.z_grid[:ii].sum() for ii in range(len(occam_mesh_z_nodes))])</span>
        <span class="c1"># self.x_grid =np.array([self.x_grid[:ii].sum() for ii in range (len(occam_mesh_x_nodes))])</span>
        
        <span class="c1"># make some arrays for plotting the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_station_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">occam_mesh_x_nodes</span><span class="p">[:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">occam_mesh_x_nodes</span><span class="p">))])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_depth_offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">occam_mesh_z_nodes</span><span class="p">[:</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">occam_mesh_z_nodes</span><span class="p">))])</span>
                                

        <span class="c1"># center the grid onto the station coordinates</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_binding_offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_station_offsets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_station_offsets</span> <span class="o">+=</span> <span class="n">x0</span>
        
        <span class="c1"># rescalle the model offset to to have the top elevation to zero  </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_depth_offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_depth_offsets</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">model_depth_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># self.model_plot_z = self.model_plot_z[::-1]  #--&gt; flipping depth </span>


        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:-^37}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Boundaries X (Horizontal nodes)&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Minimum offset (m)&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_station_offsets</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Maximum offset (m)&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_station_offsets</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:-^37}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Boundaries Z (Vertical nodes)&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;20}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Minimum depth (m)&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_depth_offsets</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;20}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Maximum depth (m)&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_depth_offsets</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:-^77}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Occam 2D Models params&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model layer num.&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_rows</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Model param count&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">occam_iter_obj</span><span class="o">.</span><span class="n">iter_param_count</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Iteration num.&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">occam_iter_obj</span><span class="o">.</span><span class="n">iter_iteration</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Occam Misfit value&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">occam_iter_obj</span><span class="o">.</span><span class="n">iter_misfit_value</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Occam Misfit reached&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">occam_iter_obj</span><span class="o">.</span><span class="n">iter_misfit_reached</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Occam Misfit target&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">occam_iter_obj</span><span class="o">.</span><span class="n">iter_target_misfit</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Occam Roughness params&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_roughness</span><span class="p">))</span></div></div>

        


<div class="viewcode-block" id="Startup"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Startup">[docs]</a><span class="k">class</span> <span class="nc">Startup</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Occam startup file  Actually read startup file.</span>
<span class="sd">    for more detail:</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: http://marineemlab.ucsd.edu/Projects/Occam/sharp/index.html</span>
<span class="sd">        </span>
<span class="sd">    Arguments </span>
<span class="sd">    ----------</span>
<span class="sd">        **startup_fn** : str </span>
<span class="sd">                full path to occam startup file </span>
<span class="sd">                </span>
<span class="sd">    .. note: to get &quot;startup&quot; attributes , replace the marker&quot;**&quot; by &quot;startup_&quot;</span>

<span class="sd">    ======================  ==========  =======================================</span>
<span class="sd">    Attributes              Type        Description </span>
<span class="sd">           </span>
<span class="sd">    ======================  ==========  =======================================</span>
<span class="sd">    **format                str          occam sofware version name </span>
<span class="sd">    **description           str         describe the startup file</span>
<span class="sd">    **model_file            str         name of the model file . </span>
<span class="sd">    **data_file             str         The name of the data file.</span>
<span class="sd">    **iteration_to_run      float       number of iteration to run </span>
<span class="sd">    **target_misfit         float       misfit target. default is 1.0 </span>
<span class="sd">    **roughness_type        int         type of roughness params:</span>
<span class="sd">    **diagonal_penalties    int         penalties horizontally &amp; vertically</span>
<span class="sd">                                        [0|1].default is 0</span>
<span class="sd">    **stepsize_cut_count    int        The parameter limits the number of times</span>
<span class="sd">                                        Occam cuts the step size in a</span>
<span class="sd">                                        search for a better fitting model.</span>
<span class="sd">    **model_limits          tuple       (min, max):params imposes limits</span>
<span class="sd">                                        on the values that the model parameters </span>
<span class="sd">                                        may take.min &amp; max are also log10 res.</span>
<span class="sd">    **model_value_steps     flaot      stepsize : discretizes model parameter</span>
<span class="sd">                                        space into steps âstepsizeâ large.</span>
<span class="sd">                                        the model space is in log10 resistivity, </span>
<span class="sd">                                        so thesesteps arein the exponent (e.g. </span>
<span class="sd">                                        for stepsize=0.1, values allowed will be </span>
<span class="sd">                                        100.1, 100.2,100.3, 100.4, etcâ¦</span>
<span class="sd">    **debug_level           int         may be [0, 1, 2] : </span>
<span class="sd">                                        0 minimizes the amount of âchatterâ that </span>
<span class="sd">                                        Occam2D displays while running.</span>
<span class="sd">                                        1 (the default), displays progress on a </span>
<span class="sd">                                        frequency-by-frequency basis.</span>
<span class="sd">                                        2 displays more diagnostic info and </span>
<span class="sd">                                        changes the way Occam2D searches model </span>
<span class="sd">                                        space.</span>
<span class="sd">    **iteration             int         Occam2D iteration number represented </span>
<span class="sd">                                        on the file.</span>
<span class="sd">    **param_count           int         assumes that the model parameter</span>
<span class="sd">    ======================  ==========  =======================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startup_fn</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span><span class="n">startup_fn</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_format</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span><span class="s1">&#39;OCCAMITER_FLEX&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_description</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;Some description&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_model_file</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_file&#39;</span><span class="p">,</span> <span class="s1">&#39;occam.model&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_data_file</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;data_file&#39;</span><span class="p">,</span> <span class="s1">&#39;datafilename.dat&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_iterations_to_run</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;iterations_to_run&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_target_misfit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;target_misfit&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_roughness_type</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;roughness_type&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_diagonal_penalties</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;diagonal_penalties&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_stepsize_cut_count</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stepsize_cut_count&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_model_limits</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;model_limits&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_value_steps</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stepsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_debug_level</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;debug_level&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_iteration</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;iteration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_lagrange_value</span> <span class="o">=</span> <span class="mf">5.</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_roughness_value</span> <span class="o">=</span><span class="mf">0.1E+11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_misfit_value</span> <span class="o">=</span> <span class="mf">1000.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_misfit_reached</span> <span class="o">=</span> <span class="mf">0.</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_param_count</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;param_count&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_date_time</span> <span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y %H:%M:%S&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_occam2d_startupfile</span><span class="p">()</span>
            
<div class="viewcode-block" id="Startup.read_occam2d_startupfile"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Startup.read_occam2d_startupfile">[docs]</a>    <span class="k">def</span> <span class="nf">read_occam2d_startupfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startup_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read occam2d_startupfile</span>
<span class="sd">        </span>
<span class="sd">        :param startup_fn: full path to startup_file </span>
<span class="sd">        :type startup_fn: str </span>
<span class="sd">        </span>
<span class="sd">        :Example:</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from pycsamt.modeling.occam2d import Startup</span>
<span class="sd">            &gt;&gt;&gt; path =os.path.join(os.environ [&#39;pyCSAMT&#39;],</span>
<span class="sd">            ...                       &#39;pycsamt&#39;, &#39;data&#39;, &#39;occam2D&#39;, &#39;Startup&#39;)</span>
<span class="sd">            &gt;&gt;&gt; startup_obj=Startup(startup_fn = path)</span>
<span class="sd">            ... print(startup_obj.occam_startup_data_file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">startup_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span> <span class="o">=</span> <span class="n">startup_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Read Occam2D STARTUP file :&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;startup&#39;</span><span class="p">:</span> 
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fsup</span> <span class="p">:</span> 
                <span class="n">occam_startup_datalines</span> <span class="o">=</span><span class="n">fsup</span><span class="o">.</span><span class="n">readlines</span> <span class="p">()</span>
                
        <span class="c1"># buid list of all attributs then collapse to find the name in the data file and loop it </span>
        <span class="n">attr_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span>  <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="s1">&#39;startup_&#39;</span> <span class="ow">in</span> <span class="n">attr</span> <span class="p">]</span>
        <span class="c1"># maybe usefull when writing startup files </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twin_attr</span> <span class="o">=</span> <span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;startup_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attr_list</span><span class="p">]</span> 

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">startupitems</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">occam_startup_datalines</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">twin_attr</span><span class="p">)</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">startupitems</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span>
                    <span class="k">try</span> <span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">attr_list</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">startupitems</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
                    <span class="k">except</span> <span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">attr_list</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">startupitems</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> 
                        <span class="k">pass</span> </div></div>

<div class="viewcode-block" id="Iter"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Iter">[docs]</a><span class="k">class</span> <span class="nc">Iter</span> <span class="p">(</span><span class="n">Startup</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Occam iteration file, inherets from startup obj , </span>
<span class="sd">    in fact two object a similar the same </span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">        **iter_fn** : str </span>
<span class="sd">            full path to occam iteration file </span>
<span class="sd">    </span>
<span class="sd">    .. note:: Most attributes are describe in Startup.__doc__</span>
<span class="sd">            Iter is a copy of the startup file with the model parameters </span>
<span class="sd">            set to the values from the endof  iteration â??â (?? means =</span>
<span class="sd">            number of iteration output file.) In addition </span>
<span class="sd">            to get &quot;iter&quot; attributes , replace the marker&quot;**&quot; by &quot;ccam_iter_&quot;</span>
<span class="sd">            </span>
<span class="sd">    ==================  ==========  ==========================================</span>
<span class="sd">    Attributes          Type        Description     </span>
<span class="sd">    ==================  ==========  ==========================================</span>
<span class="sd">    **iteration         int         Occam2D iteration number represented on</span>
<span class="sd">                                    the file.</span>
<span class="sd">    **param_count       int         assumes that the model parameter</span>
<span class="sd">    **iteraion_data     array       iteration data output after inversion</span>
<span class="sd">    ==================  ==========  ==========================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter_fn</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        <span class="n">Startup</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="o">=</span><span class="n">iter_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_data</span> <span class="o">=</span><span class="kc">None</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_date_time</span> <span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y %H:%M:%S&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_occam2d_iterfile</span><span class="p">()</span>
        
<div class="viewcode-block" id="Iter.read_occam2d_iterfile"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Iter.read_occam2d_iterfile">[docs]</a>    <span class="k">def</span> <span class="nf">read_occam2d_iterfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read_occam iteration file  and populate attributes </span>
<span class="sd">        </span>
<span class="sd">        :param iter_fn: full path to iteration file </span>
<span class="sd">        :type iter_fn: str </span>
<span class="sd">        </span>
<span class="sd">        :Example:</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from pycsamt.modeling.occam2d import Iter </span>
<span class="sd">            &gt;&gt;&gt; path =os.path.join(os.environ [&#39;pyCSAMT&#39;], &#39;pycsamt&#39;, </span>
<span class="sd">            ...                       &#39;data&#39;, &#39;occam2D&#39;, &#39;ITER17.iter&#39;)</span>
<span class="sd">            &gt;&gt;&gt; iter_obj=Iter(iter_fn= path)</span>
<span class="sd">            ... print(iter_obj.occam_iter_param_count)</span>
<span class="sd">            ... iterDATA= iter_obj.occam_iter_data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">iter_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="o">=</span> <span class="n">iter_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Read Occam2D iteration file and set convenient attributes :&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;iter&#39;</span><span class="p">:</span> 
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fsup</span> <span class="p">:</span> 
                <span class="n">occam_iter_datalines</span> <span class="o">=</span><span class="n">fsup</span><span class="o">.</span><span class="n">readlines</span> <span class="p">()</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">iteritems</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">occam_iter_datalines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iteritems</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;param count&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                <span class="n">iterdata</span> <span class="o">=</span><span class="n">occam_iter_datalines</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">iteritems</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                <span class="n">iteritems</span> <span class="o">=</span> <span class="n">iteritems</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">iter_attr</span> <span class="o">=</span> <span class="n">iteritems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">try</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;iter_&#39;</span> <span class="o">+</span> <span class="n">iter_attr</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">iteritems</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
                <span class="k">except</span> <span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;iter&#39;</span> <span class="o">+</span> <span class="n">iter_attr</span><span class="p">,</span> <span class="n">iteritems</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> 
                    <span class="k">pass</span> 

        <span class="c1"># temp =[] # get the data from iterfile  and collect model resistivities .</span>
        <span class="n">temp</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">iteritems</span> <span class="ow">in</span> <span class="n">iterdata</span> <span class="p">:</span> 
            <span class="n">sfitems</span> <span class="o">=</span> <span class="n">iteritems</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sfitems</span><span class="p">)</span>
        <span class="c1"># temp=[np.array([float(item) for item in iteritems.strip().split()])  for iteritems in iterdata ]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iter_data</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">])</span></div></div>

      
<div class="viewcode-block" id="Response"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Response">[docs]</a><span class="k">class</span> <span class="nc">Response</span> <span class="p">(</span><span class="n">Data</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Occam response file . Response is paired with the iteration file above.</span>
<span class="sd">    One is output at the end of each successful iteration.</span>
<span class="sd">    Inherets from Occam 2D data file .</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        **response_fn** : str </span>
<span class="sd">                full path to Occam 2D  response_file </span>
<span class="sd">        **data_fn** : str </span>
<span class="sd">                full path to Occam 2D data file </span>
<span class="sd">            </span>
<span class="sd">    .. note:: To get &quot;response attributes&quot; replace &quot;**&quot; by &quot;resp_&quot; and &#39;***&#39;</span>
<span class="sd">                means &#39;reso_+occam_dtype&#39;.An example below to help </span>
<span class="sd">                understanding how to get attributes from this class.</span>
<span class="sd">                </span>
<span class="sd">    ====================  ===============  ====================================</span>
<span class="sd">    Attributes              Type            Description </span>
<span class="sd">    ====================  ===============  ====================================</span>
<span class="sd">    occam_mode              str             occam  mode of survey area </span>
<span class="sd">    occam_dtye              str             Type of data provided </span>
<span class="sd">    **receiver_number       int             number of sites names </span>
<span class="sd">    **frequencies           array_like      frequency array </span>
<span class="sd">    **datatype              array_like      datatype from OccamData file (TE, </span>
<span class="sd">                                            TM etc..) </span>
<span class="sd">    ** data_value           array_like      occam2d data value in OccamDatafile .</span>
<span class="sd">    ** forward_data         array_like      data value produced by the forward </span>
<span class="sd">                                            code using</span>
<span class="sd">                                            the model from ITER??.iter  </span>
<span class="sd">    ***residual              array_like     normalized difference i.e</span>
<span class="sd">                                            (input data â forward data) / error.</span>
<span class="sd">                                            The âerrorâ value is from the input</span>
<span class="sd">                                            data file.</span>
<span class="sd">    ***forward              ndarray         array of forward mode resistivities </span>
<span class="sd">    ***forward_phase        ndarray         array of computed phase forward mode </span>
<span class="sd">    ***strike_angle         ndarray         array of strike angle , it rotation </span>
<span class="sd">                                            is applied </span>
<span class="sd">    ====================  ===============  ====================================</span>
<span class="sd">    </span>
<span class="sd">    .. note:: easy way to get all attributes for other purposes  </span>
<span class="sd">            &quot;occam_mode&quot; means the data type provided </span>
<span class="sd">            If &quot;occam_dtype&quot;= tm_log10 then </span>
<span class="sd">            resp_obj.resp_{occam_dtype}_residual = resp_obj.resp_tm_log10_residual</span>
<span class="sd">            </span>
<span class="sd">    .. seealso:: `Data.occam_mode` and ` Data.data_type `</span>
<span class="sd">        </span>
<span class="sd">    :Example :</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; from pycsamt.modeling.occam2d import Response</span>
<span class="sd">        &gt;&gt;&gt; resp_obj =Response (data_fn =os.path.join(os.environ[pyCSAMT], </span>
<span class="sd">        ...                                              &#39;pycsamt&#39;, data, occam2D,</span>
<span class="sd">        ...                                              &#39;OccamDataFile.dat&#39;), </span>
<span class="sd">        ...                        response_fn =os.path.join(os.environ[pyCSAMT], </span>
<span class="sd">        ...                                              &#39;pycsamt&#39;, data, occam2D,</span>
<span class="sd">        ...                                              &#39;RESP17.resp&#39;)</span>
<span class="sd">        &gt;&gt;&gt; occam_mode =resp_obj.resp_occam_mode </span>
<span class="sd">        &gt;&gt;&gt; occam_data_type =resp_obj.occam_dtype </span>
<span class="sd">        &gt;&gt;&gt; occam_mode_forward =resp_obj.resp_{occam_dtype}_forward</span>
<span class="sd">        &gt;&gt;&gt; occam_mode_residual =resp_obj.resp_{occam_dtype}_residual </span>
<span class="sd">        &gt;&gt;&gt; occam_mode_phase_error = resp_obj.resp_{occam_dtype}_residual_phase_error</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response_params</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;sites&#39;</span><span class="p">,</span> <span class="s1">&#39;frequencies&#39;</span><span class="p">,</span> <span class="s1">&#39;data_type&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;strike_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="s1">&#39;residual&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">data_fn</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Data</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span><span class="n">response_fn</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span><span class="n">data_fn</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
 
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_params</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;resp_&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_data</span> <span class="o">=</span><span class="kc">None</span> 
        
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">keys</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_occam2d_responsefile</span><span class="p">()</span>
            
<div class="viewcode-block" id="Response.read_occam2d_responsefile"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Response.read_occam2d_responsefile">[docs]</a>    <span class="k">def</span> <span class="nf">read_occam2d_responsefile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read Occam2D response file.</span>
<span class="sd">        </span>
<span class="sd">        :param response_fn: full path to response file </span>
<span class="sd">        :type response_fn:str</span>
<span class="sd">        </span>
<span class="sd">        :Example:</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from pycsamt.modeling.occam2d import Response </span>
<span class="sd">            &gt;&gt;&gt; pathresp =os.path.join(os.environ [&#39;pyCSAMT&#39;], &#39;pycsamt&#39;,</span>
<span class="sd">            ...                           &#39;data&#39;, &#39;occam2D&#39;,RESP17.resp )</span>
<span class="sd">            &gt;&gt;&gt; path_data =os.path.join(os.environ [&#39;pyCSAMT&#39;], &#39;pycsamt&#39;,</span>
<span class="sd">            ...                            &#39;data&#39;, &#39;occam2D&#39;,OccamDataFile.dat )</span>
<span class="sd">            &gt;&gt;&gt; resp_obj = Response(response_fn=pathresp, data_fn = path_data )</span>
<span class="sd">            &gt;&gt;&gt; respDATA= resp_obj.resp_data_value </span>
<span class="sd">            &gt;&gt;&gt; resp_obj.occam_mode </span>
<span class="sd">            &gt;&gt;&gt; resp_obj.occam_dtype</span>
<span class="sd">            &gt;&gt;&gt; forward_data = resp_obj.resp_forward_value</span>
<span class="sd">            &gt;&gt;&gt; residual_data = resp_obj.resp_residual_value</span>
<span class="sd">            &gt;&gt;&gt; tm_log10= resp_obj.resp_tm_log10</span>
<span class="sd">            &gt;&gt;&gt; tm_phase=resp_obj.resp_tm_phase</span>
<span class="sd">            &gt;&gt;&gt; tm_forward = resp_obj.resp_tm_log10_forward</span>
<span class="sd">            &gt;&gt;&gt; tm_residual = resp_obj.resp_tm_log10_forward</span>
<span class="sd">            &gt;&gt;&gt; tm_forward = resp_obj.resp_tm_log10_residual</span>
<span class="sd">            &gt;&gt;&gt; tm_phase_error = resp_obj.resp_tm_phase_err</span>
<span class="sd">            &gt;&gt;&gt; tm_phase_err = occam_resp_obj.resp_tm_log10_forward_phase</span>
<span class="sd">            &gt;&gt;&gt; tm_residual_phase_err = occam_resp_obj.resp_tm_log10_residual_phase_err</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">response_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="o">=</span><span class="n">response_fn</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Read Occam 2D response file &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span><span class="p">)</span> <span class="o">==</span><span class="s1">&#39;resp&#39;</span><span class="p">:</span> 
            <span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_fn</span> <span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span><span class="s1">&#39;utf8&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fresp</span> <span class="p">:</span> 
                <span class="n">occam_response_lines</span> <span class="o">=</span> <span class="n">fresp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        
        <span class="c1"># for respitems in occam_response_lines : </span>
        <span class="n">temp</span><span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">newitem</span><span class="p">)</span> <span class="k">for</span> <span class="n">newitem</span>  <span class="ow">in</span> <span class="n">respitems</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span> <span class="k">for</span> <span class="n">respitems</span> <span class="ow">in</span> <span class="n">occam_response_lines</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_data</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">concat_array_from_list</span><span class="p">(</span><span class="n">list_of_array</span><span class="o">=</span><span class="n">temp</span><span class="p">)</span>  
        
        <span class="c1"># container of original data </span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">keyattr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;receiver_number&#39;</span><span class="p">,</span> <span class="s1">&#39;frequencies&#39;</span><span class="p">,</span> <span class="s1">&#39;data_type&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;strike_angle_value&#39;</span><span class="p">,</span> <span class="s1">&#39;data_value&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;forward_value&#39;</span><span class="p">,</span> <span class="s1">&#39;residual_value&#39;</span><span class="p">])</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;resp_&#39;</span><span class="p">,</span><span class="n">keyattr</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_data</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">])</span>
        
        <span class="c1">#---&gt;  populate specific  attributes </span>
        
        <span class="k">def</span> <span class="nf">truncate_response</span> <span class="p">(</span><span class="n">data</span> <span class="p">,</span> <span class="n">station_data</span><span class="p">,</span> <span class="n">station_names</span> <span class="p">):</span>  
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            function to truncate data and put on dictionnay for all stations  and </span>
<span class="sd">            their coresponding values </span>
<span class="sd">            </span>
<span class="sd">            :param data: data ndarray(depth , station_location)</span>
<span class="sd">            :type data: ndarray </span>
<span class="sd">            </span>
<span class="sd">            :param station_data: from response data </span>
<span class="sd">            :type station_data: array_like  </span>
<span class="sd">            </span>
<span class="sd">            :param station_names: list of sites names </span>
<span class="sd">            :param station_names: list</span>
<span class="sd">            </span>
<span class="sd">  </span>
<span class="sd">            :returns dico: dictionnary of station value </span>
<span class="sd">            :rtype dico: dict </span>
<span class="sd">            &quot;&quot;&quot;</span> 
            <span class="n">dico</span><span class="p">,</span> <span class="n">sta</span><span class="o">=</span><span class="p">{},</span><span class="mi">0</span>
   
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">station_data</span><span class="p">):</span> 
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">station_data</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">station_names</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span>
                        <span class="n">dico</span><span class="p">[</span><span class="n">station_names</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span> <span class="n">data</span> <span class="p">[</span><span class="n">sta</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># tale before last array and </span>
                        <span class="c1"># add the last array</span>
                        <span class="n">dico</span><span class="p">[</span><span class="n">station_names</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)]]</span> <span class="o">=</span><span class="n">data</span> <span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="k">break</span>
                    <span class="k">else</span> <span class="p">:</span> 
                        <span class="n">dico</span><span class="p">[</span><span class="n">station_names</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span> <span class="n">data</span> <span class="p">[</span><span class="n">sta</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">sta</span><span class="o">=</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span> 
            <span class="k">return</span> <span class="n">dico</span> 
  
        <span class="c1">#----------&gt; build matrix iter2data [resp_{occam mode} ,resp_{occam mode}_forward,</span>
        <span class="c1"># -------&gt; resp_{occam mode}_residual ]</span>
        <span class="c1">#Note to access attribute , use &quot;resp_+occam_mode _{response data{forward, strike_angle or residual }}</span>
        <span class="c1"># set frequencies into corresponding value </span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_frequencies</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_frequencies</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resp_data_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resp_data_type</span><span class="p">])</span>
        
        <span class="c1"># get occam mode from resp_data_type </span>
        <span class="n">occam_mode</span> <span class="p">,</span> <span class="o">*</span><span class="n">ignore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_data_type</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Once occam mode is get then create attribute with occam datatype</span>

        <span class="n">keymode</span> <span class="o">=</span><span class="p">[]</span> <span class="c1"># container of new datatype  eg [tm_log10, tm_phase]</span>
        <span class="n">occam_mode</span> <span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">oo</span><span class="p">)</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">occam_mode</span><span class="p">]</span>  <span class="c1"># PUT occam mode on list </span>
        
        <span class="k">for</span> <span class="n">imode</span>  <span class="ow">in</span>  <span class="n">occam_mode</span> <span class="p">:</span> 
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">Data</span><span class="o">.</span><span class="n">occam_data_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
                <span class="k">if</span> <span class="n">imode</span> <span class="o">==</span> <span class="n">mode</span> <span class="p">:</span> 
                    <span class="n">keymode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="c1">#set attrinut as numb freq -1 * num sites </span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">),))</span> <span class="c1">#np.zeros((self.resp_data.shape[0],))) </span>
                    
                    <span class="c1"># for each mode , try to figure out each forward , residual value </span>
                    <span class="c1">#--- &gt; initialise attributes eg : resp_+{occam_mode}_{forward|residual}</span>
                    <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="s1">&#39;residual&#39;</span><span class="p">,</span> <span class="s1">&#39;strike_angle&#39;</span><span class="p">]:</span> <span class="c1"># add forward attribut for all datatype </span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">))))</span> 
                        
                    <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;forward_phase&#39;</span><span class="p">,</span> <span class="s1">&#39;residual_phase_err&#39;</span><span class="p">,</span> <span class="s1">&#39;strike_angle_err&#39;</span><span class="p">]:</span> 
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">))))</span> 
                    
        <span class="c1">#set attribute occam mode and occam _data type get from response file  </span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;occam_mode&#39;</span><span class="p">,</span> <span class="n">occam_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;occam_dtype&#39;</span><span class="p">,</span> <span class="n">keymode</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:-^77}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Occam 2D Response  infos&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Occam data type&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occam_dtype</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Occam data mode&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occam_mode</span><span class="p">)))</span>
        
       
        <span class="c1"># </span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occam_mode</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">2</span> <span class="p">:</span>
            <span class="n">mess</span> <span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;Your data seems a Magnetotelluric (MT) data.&quot;</span><span class="p">,</span>
                           <span class="s2">&quot; pyCSAMT works only with Controlled Source Audio-frequency Magnetotelluric (CSAMT).&quot;</span><span class="p">,</span> 
                           <span class="s2">&quot;Althrough the both methods are close , we are not able to process these data properly beyond &quot;</span><span class="p">,</span> 
                           <span class="s2">&quot;4 modes simultaneously and more.To avoid misleading and miscomputation on your data, &quot;</span>
                           <span class="s2">&quot;, we strongly recommend you to use  MTpy software; an efficiently python toolbox solve  magnetotelluric problem.&quot;</span>
                           <span class="s2">&quot; You can easy download and install via the following link :&quot;</span><span class="p">,</span> 
                           <span class="s2">&quot; https://github.com/MTgeophysics/mtpy/wiki .&quot;</span><span class="p">])</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                           
        <span class="c1"># resp_tm_log10&#39; for mode = 5, and resp_tm_phase for mode =6 ,</span>
        <span class="c1">#initialise values  to get their corresponding value </span>
        <span class="c1"># raw value are not truncated , get directly from response file                  </span>
        <span class="n">raw_forward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">),)</span>
        <span class="n">raw_forward_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">),)</span>
        
        <span class="n">raw_residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">),)</span>
        <span class="n">raw_residual_phase_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">),)</span>
        
        <span class="n">raw_stike_angle</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">),)</span>
        <span class="n">raw_stike_angle_err</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">),)</span>
        
        <span class="c1"># get an corresponding value for each attributes (looping response file )</span>
        <span class="n">step</span><span class="o">=</span><span class="mi">0</span>          <span class="c1"># gap to find the phase value , if not find at the next reading then add one as step</span>
        <span class="n">mm</span><span class="o">=</span><span class="mi">0</span>            <span class="c1"># indice for value (data, forward , residual )</span>
        <span class="n">nn</span><span class="o">=</span><span class="mi">0</span>            <span class="c1"># indice for phase </span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">rowline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_data</span><span class="p">)</span> <span class="p">:</span>  <span class="c1"># loop the response file and get the different data -Type value</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="p">,</span> <span class="p">(</span><span class="n">imode</span> <span class="p">,</span> <span class="n">ikey</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occam_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_dtype</span><span class="p">)):</span> <span class="c1">#[5,6][tm_log10, tm_phase]</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resp_data</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="n">imode</span><span class="p">:</span> 
                    
                    <span class="k">if</span> <span class="n">jj</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span><span class="mi">0</span> <span class="p">:</span> <span class="c1"># mean is rho value len of data type =2 then repeat if find the same value for next reading</span>
                        <span class="c1">#to_fill=  getattr(self, &#39;resp_&#39; + keymode[jj]) # self.resp_tm_log10 |self.resp_tm_phase</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_&#39;</span> <span class="o">+</span> <span class="n">ikey</span><span class="p">)[</span><span class="n">mm</span><span class="p">]</span><span class="o">=</span><span class="n">rowline</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                        <span class="n">raw_forward</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">raw_residual</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span> <span class="p">,</span> <span class="n">raw_stike_angle</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span>  <span class="o">=</span><span class="n">rowline</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">rowline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rowline</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">mm</span> <span class="o">+=</span><span class="mi">1</span>  <span class="c1"># incremente to get new index to fill data </span>
                        <span class="n">step</span> <span class="o">+=</span><span class="mi">1</span> <span class="c1"># step to get the new</span>
                        
                    <span class="k">if</span> <span class="n">jj</span> <span class="o">%</span><span class="mi">2</span>  <span class="o">!=</span> <span class="mi">0</span> <span class="p">:</span> <span class="c1"># if phase for mm # when is odd --&gt; mean a phase, need to add step </span>
                        <span class="n">nn</span> <span class="o">=</span> <span class="n">nn</span> <span class="o">+</span> <span class="n">step</span> 
                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_&#39;</span> <span class="o">+</span> <span class="n">ikey</span><span class="p">)[</span><span class="n">nn</span><span class="p">]</span><span class="o">=</span><span class="n">rowline</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="c1"># self.resp_tm_phase</span>

                        <span class="n">raw_forward_phase</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">raw_residual_phase_err</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="p">,</span> <span class="n">raw_stike_angle_err</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>  <span class="o">=</span> \
                            <span class="n">rowline</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">rowline</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rowline</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">step</span> <span class="o">=</span><span class="mi">0</span> <span class="c1"># initialise  for next reading </span>
        
        <span class="c1"># build a block data of forward residual with shape = number frequency , num_sites </span>
        <span class="c1"># set response value</span>

        <span class="n">rr</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">dd</span> <span class="p">,</span> <span class="n">dval</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="s1">&#39;residual&#39;</span><span class="p">,</span> <span class="s1">&#39;strike_angle&#39;</span><span class="p">],</span>
                             <span class="p">[</span><span class="n">raw_forward</span><span class="p">,</span> <span class="n">raw_residual</span><span class="p">,</span> <span class="n">raw_stike_angle</span><span class="p">])</span> <span class="p">:</span>
            
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">)):</span> 
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_dtype</span><span class="p">:</span> 
                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">dd</span><span class="p">))[</span><span class="n">kk</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">dval</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span> 
                        <span class="c1"># self.__setattr__(&#39;resp_{0}_{1}&#39;.format(mode, dd), vv[])</span>
                    <span class="n">rr</span> <span class="o">+=</span><span class="mi">1</span>
           
            <span class="n">rr</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># </span>
       
        <span class="c1"># set phase and phase error # do the dame for errors </span>
        <span class="n">rr</span><span class="o">=</span><span class="mi">0</span>   
        <span class="k">for</span> <span class="n">dd</span> <span class="p">,</span> <span class="n">dval</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;forward_phase&#39;</span><span class="p">,</span> <span class="s1">&#39;residual_phase_err&#39;</span><span class="p">,</span> <span class="s1">&#39;strike_angle_err&#39;</span><span class="p">],</span>
                             <span class="p">[</span><span class="n">raw_forward_phase</span><span class="p">,</span> <span class="n">raw_residual_phase_err</span><span class="p">,</span> <span class="n">raw_stike_angle_err</span><span class="p">])</span> <span class="p">:</span> 
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">)):</span> 
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_dtype</span><span class="p">:</span> 
                        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">dd</span><span class="p">))[</span><span class="n">kk</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">dval</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span> 
                        <span class="c1"># self.__setattr__(&#39;resp_{0}_{1}&#39;.format(mode, dd), vv[])</span>
                    <span class="n">rr</span> <span class="o">+=</span><span class="mi">1</span>
            <span class="n">rr</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># </span>

        <span class="c1"># resetting mode value  like [self.resp_tm_log10 | self.resp_tm_phase]</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_dtype</span> <span class="p">:</span> 
            <span class="n">vv</span><span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span> <span class="c1"># let get the value of resp_tm_log10 as example </span>
            <span class="c1"># let reinitialize our  resp_tm_log10 attribute so to get the matrix length as nfreq-1 , nsites</span>
            <span class="n">ll</span><span class="o">=</span><span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;resp_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">))))</span> 
            <span class="c1"># let loop to repopulative value &#39;in shape len(data frequency, len(sitenames) )</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_sites</span><span class="p">)):</span> 
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_frequencies</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))[</span><span class="n">kk</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> 
                    <span class="n">ll</span> <span class="o">+=</span><span class="mi">1</span>
        <span class="c1"># sometimes some processing softwares doent respect th Occam2D criteria to range frequency from Highest to lower . </span>
        <span class="c1"># to be sure that this criteria is respected , let flip all data to highest to lowest frequency</span>
        <span class="c1"># especially avoid miscomputation when the frequencies are not sorted according this principle.</span>
        <span class="c1"># if freq is range to increase order , let flip the data so to get the frequency as occam 2D range </span>
        <span class="c1">#  Higest frequency to lowest frequency </span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_flip_freq</span> <span class="p">:</span> <span class="c1"># get attribute from inheret Data object </span>
            <span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_dtype</span> <span class="p">:</span>
                <span class="c1"># flip the mode attribute e.g : tm_log10</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;resp_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">occ</span><span class="p">),</span> 
                                     <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">occ</span><span class="p">))))</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="s1">&#39;residual&#39;</span><span class="p">,</span> <span class="s1">&#39;strike_angle&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="c1"># flip other attribute eg : tm_log10_forward</span>
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;resp_</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">occ</span><span class="p">,</span> <span class="n">attr</span><span class="p">),</span> 
                                     <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">occ</span><span class="p">,</span> <span class="n">attr</span><span class="p">))))</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;forward_phase&#39;</span><span class="p">,</span> <span class="s1">&#39;residual_phase_err&#39;</span><span class="p">,</span> <span class="s1">&#39;strike_angle_err&#39;</span><span class="p">]:</span> <span class="c1">#flip other attribute eg : tm_log10_forward_phase</span>
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;resp_</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">occ</span><span class="p">,</span> <span class="n">attr</span><span class="p">),</span> 
                                     <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">occ</span><span class="p">,</span> <span class="n">attr</span><span class="p">))))</span>
                
        <span class="c1"># display infos </span>
        <span class="k">for</span> <span class="n">occ</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">occam_dtype</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fwo</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Residual&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** </span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fwo</span><span class="o">+</span> <span class="s1">&#39; shape:&#39;</span> <span class="o">+</span> <span class="n">occ</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">+</span> <span class="n">occ</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                                                  <span class="s1">&#39;=&#39;</span><span class="p">,</span> 
                                                  <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;resp_</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">occ</span><span class="p">,</span> <span class="n">fwo</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span></div></div>

            
            
<div class="viewcode-block" id="Mesh"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Mesh">[docs]</a><span class="k">class</span> <span class="nc">Mesh</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read Occam read mesh file </span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    -----------</span>
<span class="sd">        **mesh_fn** : str </span>
<span class="sd">            full path to occam_2D mesh file </span>
<span class="sd">            </span>
<span class="sd">    .. note: to get &quot;mesh&quot; attributes , replace the marker&quot;**&quot; by &quot;mesh_&quot;</span>
<span class="sd">    </span>
<span class="sd">    ====================  ===============  ====================================</span>
<span class="sd">    Attributes(**=mesh_)  Type              Description </span>
<span class="sd">    ====================  ===============  ====================================</span>
<span class="sd">    **x_nodes              array_like       horizontal ânodesâ (i.e. blocks + 1)</span>
<span class="sd">    **z_nodes              array_like       vertical ânodesâ (i.e. layers + 1)</span>
<span class="sd">    **mesh_values          ndarray          array of mesh files parameters </span>
<span class="sd">                                            xnodes,z_nodes</span>
<span class="sd">    ====================  ===============  ====================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span>  <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="o">=</span><span class="n">mesh_fn</span> 
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x_nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;z_nodes&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;mesh_&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
            <span class="nb">setattr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_occam2d_mesh</span><span class="p">()</span>
    
<div class="viewcode-block" id="Mesh.read_occam2d_mesh"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Mesh.read_occam2d_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">read_occam2d_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh_fn</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read mesh and get mesh values data and populates attributes </span>
<span class="sd">        </span>
<span class="sd">        :param mesh_fn:   full path to mesh file </span>
<span class="sd">        :type mesh_fn: str </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mesh_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="o">=</span> <span class="n">mesh_fn</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;read Occam2d meshfiles &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span><span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="p">)</span><span class="o">==</span><span class="s1">&#39;mesh&#39;</span><span class="p">:</span> 
                 <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fmesh</span> <span class="p">:</span> 
                    <span class="n">occam_mesh_lines</span> <span class="o">=</span> <span class="n">fmesh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;No Mesh file detected. Please provide the right occam2d mesh files.&#39;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
        
        <span class="n">mesh_char</span> <span class="o">=</span> <span class="n">occam_mesh_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>         <span class="c1"># characteristic of the mesh (nblocks +1)</span>
        <span class="n">num_h_nodes</span> <span class="p">,</span><span class="n">num_v_nodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mesh_char</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">mesh_char</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># horizontal nodes , verticales nodes (nlayers+1)</span>

        <span class="c1">#initialise attribute x nodes and z nodes </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_nodes</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_h_nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_nodes</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">(</span><span class="n">num_v_nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_h_nodes</span><span class="p">,</span> <span class="n">num_v_nodes</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        
        
        <span class="n">starting_lines_counter</span> <span class="o">=</span> <span class="mi">2</span>          <span class="c1"># take off the both descriptive lines </span>
        <span class="n">count_xnodes</span> <span class="p">,</span> <span class="n">count_z_nodes</span><span class="p">,</span> <span class="n">mesh_index</span><span class="o">=</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">mii</span><span class="p">,</span> <span class="n">mitems</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">occam_mesh_lines</span><span class="p">[</span><span class="n">starting_lines_counter</span><span class="p">:]):</span> 
            <span class="n">mitems</span> <span class="o">=</span> <span class="n">mitems</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">mval</span> <span class="ow">in</span> <span class="n">mitems</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_nodes</span><span class="p">[</span><span class="n">count_xnodes</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">mval</span><span class="p">)</span>
                <span class="n">count_xnodes</span> <span class="o">+=</span> <span class="mi">1</span> 
            <span class="k">if</span> <span class="n">count_xnodes</span> <span class="o">&gt;=</span> <span class="n">num_h_nodes</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span>  <span class="c1"># asssume to get (number of blocks =x_nodes -1 -1 of Python readlines )</span>
                <span class="n">starting_lines_counter</span> <span class="o">+=</span> <span class="n">mii</span>
                <span class="k">break</span> 
        <span class="c1"># print(self.mesh_x_nodes)</span>
        <span class="c1"># print(starting_lines_counter)</span>
        <span class="c1">#sometimes there is between xnodes and verticales nodes a lines of spaces , skip it if exists </span>
        <span class="c1"># and go to the line to count the vertical nodes </span>
        <span class="k">if</span> <span class="n">occam_mesh_lines</span><span class="p">[</span><span class="n">starting_lines_counter</span> <span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="ow">or</span>\
            <span class="n">occam_mesh_lines</span><span class="p">[</span><span class="n">starting_lines_counter</span> <span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span> 
            <span class="n">starting_lines_counter</span> <span class="o">+=</span><span class="mi">1</span>
 
        <span class="c1">#--&gt; read vertical nodes part </span>
        <span class="k">for</span> <span class="n">mii</span><span class="p">,</span> <span class="n">mitems</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">occam_mesh_lines</span><span class="p">[</span><span class="n">starting_lines_counter</span> <span class="o">+</span><span class="mi">1</span><span class="p">:]):</span> 
            <span class="n">mitems</span> <span class="o">=</span><span class="n">mitems</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> 
            <span class="k">for</span> <span class="n">mj</span><span class="p">,</span> <span class="n">mvalues</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mitems</span><span class="p">):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_nodes</span> <span class="p">[</span><span class="n">count_z_nodes</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mvalues</span><span class="p">)</span>
                <span class="n">count_z_nodes</span> <span class="o">+=</span><span class="mi">1</span> 
            <span class="k">if</span> <span class="n">count_z_nodes</span> <span class="o">&gt;=</span> <span class="n">num_v_nodes</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="c1"># substract the number of blocks =1 with the Python index </span>
                <span class="n">starting_lines_counter</span> <span class="o">+=</span> <span class="n">mii</span> 
                <span class="k">break</span> 
        <span class="c1"># be sure line counter match the </span>
        
        <span class="c1"># Check whether we are at the end of nodes  for consistency , it </span>
        <span class="c1">#There should always be a zero before the next section  # so add +1 to index line </span>
        <span class="k">try</span> <span class="p">:</span>      
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">occam_mesh_lines</span><span class="p">[</span><span class="n">starting_lines_counter</span> <span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>                               
                <span class="n">starting_lines_counter</span> <span class="o">+=</span><span class="mi">1</span>
        <span class="k">except</span> <span class="p">:</span><span class="k">pass</span>

        <span class="c1"># --&gt; fill model values with parameter specs {???}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reading of parameters&quot;</span>
                           <span class="s2">&quot; specification of mesh and fill model values&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">specs</span><span class="p">,</span> <span class="n">paramline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">occam_mesh_lines</span><span class="p">[</span><span class="n">starting_lines_counter</span><span class="o">+</span> <span class="mi">1</span><span class="p">:],</span> 
                                   <span class="n">starting_lines_counter</span><span class="p">):</span>
            <span class="n">paramline</span> <span class="o">=</span> <span class="n">paramline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mesh_index</span> <span class="o">==</span> <span class="n">num_v_nodes</span> <span class="ow">or</span> <span class="n">paramline</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">list_paramspecs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">paramline</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_paramspecs</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_h_nodes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">77</span><span class="p">)</span>
                    <span class="n">mess</span><span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span><span class="s2">&quot;---&gt; Params specification for line = </span><span class="si">{0}</span><span class="s2">&quot;</span>
                                    <span class="s2">&quot; from &lt;</span><span class="si">{1}</span><span class="s2">&gt; have too many columns.&quot;</span><span class="p">,</span> 
                                    <span class="s2">&quot;Should be </span><span class="si">{2}</span><span class="s2"> instead of </span><span class="si">{3}</span><span class="s2">. &quot;</span>
                                    <span class="s2">&quot;Please check your mesh file.&quot;</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">mess</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">specs</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span><span class="p">),</span>
                                      <span class="n">num_h_nodes</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">list_paramspecs</span><span class="p">)</span>  <span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">77</span><span class="p">)</span>
   
                    <span class="n">list_paramspecs</span> <span class="o">=</span>  <span class="n">list_paramspecs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">num_h_nodes</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">mvalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span> <span class="n">list_paramspecs</span> <span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span> <span class="n">mesh_index</span><span class="p">,</span> <span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">paramline</span> <span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                <span class="n">mesh_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1">#Note : from coocam 2D,  number of hozotonal nodes = nblocks +1 </span>
        <span class="c1">#                       number of vertical nodes = nlayer +1 </span>
        <span class="c1"># remove me zero stay on array if number of horizontal node deosnt match the array x_nodes x_shape </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_nodes</span><span class="p">)]</span>
        <span class="c1"># do the same for z_nodes </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_nodes</span><span class="p">)]</span> 
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">num_h_nodes</span><span class="p">:</span> 
            <span class="n">new_h_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># reshape the mesh vales </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_h_nodes</span> <span class="p">,</span> <span class="n">num_v_nodes</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">new_h_nodes</span><span class="o">=</span> <span class="n">num_h_nodes</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">num_v_nodes</span><span class="p">:</span>
            <span class="n">new_v_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_values</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_h_nodes</span><span class="p">,</span> <span class="n">num_v_nodes</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:-^77}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Occam 2D Mesh params &#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">im</span> <span class="p">,</span> <span class="n">nodes</span>  <span class="ow">in</span> <span class="nb">zip</span> <span class="p">([</span><span class="s1">&#39;Horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;Vertical&#39;</span><span class="p">],</span>
                                <span class="p">[[</span><span class="n">new_h_nodes</span><span class="p">,</span><span class="n">num_h_nodes</span> <span class="p">],</span> 
                                 <span class="p">[</span><span class="n">new_v_nodes</span><span class="p">,</span><span class="n">num_v_nodes</span><span class="p">]])</span> <span class="p">:</span> 
            <span class="n">mess</span><span class="o">=</span><span class="s1">&#39;*** </span><span class="si">{0}</span><span class="s1"> nodes read = </span><span class="si">{1}</span><span class="s1"> instead of </span><span class="si">{2}</span><span class="s1"> in &#39;</span>\
                <span class="s1">&#39;mesh files.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">mess</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
      
        <span class="c1"># generate mesh x_grid and z_grid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_grid</span><span class="p">[:</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_grid</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_grid</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_nodes</span><span class="p">[:</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; </span><span class="si">{0:&lt;20}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Horizontal nodes&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; </span><span class="si">{0:&lt;20}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Vertical nodes&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div></div>
        
  
<div class="viewcode-block" id="Iter2Dat"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Iter2Dat">[docs]</a><span class="k">class</span> <span class="nc">Iter2Dat</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iter2Dat is a format converter which convert *.iter file and related mesh</span>
<span class="sd">    files to so called &#39;x,y,z&#39; *.data file for post-processing.</span>
<span class="sd">    The class was inpired from the Bo Yang matlab script . reading functions come</span>
<span class="sd">    from &#39;plotOccam2DMT.m&#39; routine</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: `Occam routine &lt;http://marineemlab.ucsd.edu/Projects/Occam/sharp/index.html &gt;`</span>
<span class="sd">                of SIO, UCSD.</span>
<span class="sd">            </span>
<span class="sd">    Bo Yang matlab-script is on `add.info` sub-packages of pyCSAMT.</span>
<span class="sd">    If your are familiar with matlab and you want to rewrite  the script</span>
<span class="sd">    please contact author at: </span>
<span class="sd">        </span>
<span class="sd">    Bo Yang, 2011.</span>
<span class="sd">    ------------------</span>
<span class="sd">        China Univ. of Geosciences, Wuhan, China.</span>
<span class="sd">        yangbo.cug@163.com.</span>
<span class="sd">        Copyright 2011-2016 Bo Yang.</span>
<span class="sd">        $Revision: 1.0 $ $Date: 2012/04/05 21:50:20 $</span>
<span class="sd">        Revision log:</span>
<span class="sd">        2012/04/04 : Version 1.0 released.</span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    ----------</span>
<span class="sd">        **path_to_occamfiles** : str </span>
<span class="sd">                path to occamfiles : put on one directory </span>
<span class="sd">        </span>
<span class="sd">    ==================  ==============  =======================================</span>
<span class="sd">    Attributes              Type         Description</span>
<span class="sd">    ==================  ==============  =======================================</span>
<span class="sd">    ** Data             obj             Occam Data object </span>
<span class="sd">    **Iter              obj             occam Iteration object</span>
<span class="sd">    **Response          obj             OccamResponse object </span>
<span class="sd">    model_fn            str             full path to occam model file </span>
<span class="sd">    iter_fn             str             full path to iteration file </span>
<span class="sd">    mesh_fn             str             full path to occam mesh file </span>
<span class="sd">    data_fn             str             full path to occam data file </span>
<span class="sd">    doi                 str of float    depth of investigation. default is 1km</span>
<span class="sd">                                        if your povide  value on float,</span>
<span class="sd">    model_x_nodes       array_like      rescalled station offsets according </span>
<span class="sd">                                        to doi.</span>
<span class="sd">    model_z_nodes       array_like      rescalled depth offsets accordng to doi</span>
<span class="sd">    model_res           ndarray         rescalled model resistivity according</span>
<span class="sd">                                        to doi.shape len(model_z_nodes,</span>
<span class="sd">                                        model_x_nodes)</span>
<span class="sd">    station_names       list            list of sites names </span>
<span class="sd">    station_location    array_like      station offsets  </span>
<span class="sd">    elevation           array_like      elevation value  , to rewrite a file </span>
<span class="sd">                                        if elevation is given ,</span>
<span class="sd">                                        will take elevation              </span>
<span class="sd">    ==================  ==============  =======================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">iter2d_params</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;model_x_nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;model_z_nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;model_res&#39;</span><span class="p">,</span> <span class="s1">&#39;station_names&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;station_location&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter2dat_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">model_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> 
                 <span class="n">iter_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">mesh_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
                 
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter2dat_fn</span>   <span class="o">=</span><span class="n">iter2dat_fn</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span><span class="n">model_fn</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="o">=</span><span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="o">=</span> <span class="n">iter_fn</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="o">=</span><span class="n">mesh_fn</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bln_fn</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;bln_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">OccamModel</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;occam_model_obj&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="c1"># initialise the main attributes</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter2d_params</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>  
       

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter2dat_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_iter2dat</span><span class="p">()</span>
        

<div class="viewcode-block" id="Iter2Dat.read_occamfiles"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Iter2Dat.read_occamfiles">[docs]</a>    <span class="k">def</span> <span class="nf">read_occamfiles</span><span class="p">(</span><span class="bp">self</span> <span class="p">,</span> <span class="n">path_to_occamfiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="o">**</span><span class="n">kws</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        getffiles and readfiles to populates speciales attributes </span>

<span class="sd">        :param path_to_occamfiles: full path to occamfiles [ITER|DATA|RESP] files. </span>
<span class="sd">        :type path_to_occamfiles: str</span>
<span class="sd">                </span>
<span class="sd">        :Example:</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; path =os.path.join(os.environ [&#39;pyCSAMT&#39;], &#39;pycsamt&#39;, &#39;data&#39;, &#39;occam2D&#39;)</span>
<span class="sd">            &gt;&gt;&gt; iter2_obj=Iter2Dat(path_to_occamfiles= path)</span>
<span class="sd">            &gt;&gt;&gt; sites= iter2_obj.OccamData.occam_data_sites</span>
<span class="sd">            &gt;&gt;&gt; freq =iter2_obj.OccamData.occam_data_frequencies</span>
<span class="sd">            &gt;&gt;&gt; iter_roughn =iter2_obj.OccamIter.occam_iter_roughness_value</span>
<span class="sd">            &gt;&gt;&gt; iter_misfit=iter2_obj.OccamIter.occam_iter_misfit_reached</span>
<span class="sd">            &gt;&gt;&gt; forward_data = iter2_obj.OccamResponse.forward_data</span>
<span class="sd">            &gt;&gt;&gt; residual_data = iter2_obj.OccamResponse.residual</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">truncate_response</span> <span class="p">(</span><span class="n">data</span> <span class="p">,</span> <span class="n">station_data</span><span class="p">,</span> <span class="n">station_names</span> <span class="p">):</span>  
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            function to truncate data and put on dictionnay for all stations  and </span>
<span class="sd">            their coresponding values </span>
<span class="sd">  </span>
<span class="sd">            :param data: arrray of data ndarray(depth , station_location)</span>
<span class="sd">            :type data: array_like </span>
<span class="sd">            </span>
<span class="sd">            :param station_data: from response data </span>
<span class="sd">            :type station_data: array_like , dtype &#39;&lt;U12&#39;</span>
<span class="sd">                </span>
<span class="sd">            :param station_names: list , list of sites names</span>
<span class="sd">            :type station_names: list </span>
<span class="sd">                </span>
<span class="sd">            :returns:  dictionnary  of station value </span>
<span class="sd">            :rtype: dict </span>
<span class="sd">            &quot;&quot;&quot;</span> 
            <span class="n">dico</span><span class="p">,</span> <span class="n">sta</span><span class="o">=</span><span class="p">{},</span><span class="mi">0</span>
   
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">station_data</span><span class="p">):</span> 
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">station_data</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">station_names</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span>
                        <span class="n">dico</span><span class="p">[</span><span class="n">station_names</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span> <span class="n">data</span> <span class="p">[</span><span class="n">sta</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># tale before last array and </span>
                        <span class="c1"># add the last array</span>
                        <span class="n">dico</span><span class="p">[</span><span class="n">station_names</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)]]</span> <span class="o">=</span><span class="n">data</span> <span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="k">break</span>
                    <span class="k">else</span> <span class="p">:</span> 
                        <span class="n">dico</span><span class="p">[</span><span class="n">station_names</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span> <span class="n">data</span> <span class="p">[</span><span class="n">sta</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">sta</span><span class="o">=</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span> 
            <span class="k">return</span> <span class="n">dico</span> </div>

       

<div class="viewcode-block" id="Iter2Dat.write_iter2dat_file"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Iter2Dat.write_iter2dat_file">[docs]</a>    <span class="k">def</span>  <span class="nf">write_iter2dat_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">filename</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span><span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iter_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span>
                             <span class="n">mesh_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> 
                              <span class="n">doi</span> <span class="o">=</span><span class="s2">&quot;1km&quot;</span><span class="p">,</span>  <span class="n">savepath</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span><span class="n">occam_model_obj</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> 
                              <span class="n">negative_depth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write  &#39;x,y,z&#39; *.data file for post-processing</span>
<span class="sd">        can read and rewrite iter2dat file </span>
<span class="sd">        </span>
<span class="sd">        :param x: offset</span>
<span class="sd">        :type x: array_like </span>
<span class="sd">        </span>
<span class="sd">        :param y: depth </span>
<span class="sd">        :type y: array_like </span>
<span class="sd">        </span>
<span class="sd">        :param z: log10 resistivities</span>
<span class="sd">        :type z: array_like </span>
<span class="sd">        </span>
<span class="sd">        ==============  ==============  =======================================</span>
<span class="sd">        params          Type            Description </span>
<span class="sd">        ==============  ==============  =======================================</span>
<span class="sd">        model_fn        str             full path to occam model file </span>
<span class="sd">        iter_fn         str             full path to iteration file </span>
<span class="sd">        mesh_fn         str             full path to occam mesh file </span>
<span class="sd">        data_fn         str             fll path to occam data file </span>
<span class="sd">        filename        str             output of iter2dat file </span>
<span class="sd">        doi             str of float    depth of investigation. default is 1km</span>
<span class="sd">                                        if your povide  value on float,  </span>
<span class="sd">                                        default unit is &quot;meter&quot; eg : 2000=2000m </span>
<span class="sd">        negative_depth  bool            if True , will provide file with </span>
<span class="sd">                                        negative depth value </span>
<span class="sd">        scale           str             scaled the offset value and elevation . </span>
<span class="sd">                                        might be [m|km]</span>
<span class="sd">        elevation       ndarray|list    can be provided if usefull </span>
<span class="sd">        ==============  ==============  =======================================</span>
<span class="sd">        </span>
<span class="sd">        1. Write with Occam 2D files  </span>
<span class="sd">        </span>
<span class="sd">        :Examples:</span>
<span class="sd"> </span>
<span class="sd">            &gt;&gt;&gt; from pycsamt.modeling.occam2d import Iter2Dat as i2d</span>
<span class="sd">            &gt;&gt;&gt; data=&#39;OccamDataFile.dat&#39;</span>
<span class="sd">            &gt;&gt;&gt; mesh = &#39;Occam2DMesh&#39;</span>
<span class="sd">            &gt;&gt;&gt; model = &#39;Occam2DModel&#39;</span>
<span class="sd">            &gt;&gt;&gt; path =os.path.join(os.environ [&#39;pyCSAMT&#39;], &#39;pycsamt&#39;, </span>
<span class="sd">            ...                       &#39;data&#39;, &#39;occam2D&#39;)</span>
<span class="sd">            ...                   #,&#39;OccamDataFile.dat&#39;)</span>
<span class="sd">            &gt;&gt;&gt; pathi2d =os.path.join(os.environ [&#39;pyCSAMT&#39;], &#39;pycsamt&#39;, &#39;data&#39;, &#39;_iter2dat_&#39;)</span>
<span class="sd">            &gt;&gt;&gt; occam_iter2dat_obj =i2d(mesh_fn=os.path.join(path, mesh), </span>
<span class="sd">            ...                    iter_fn = os.path.join(path, iter_), </span>
<span class="sd">            ...                    model_fn =os.path.join(path, model), </span>
<span class="sd">            ...                    data_fn =os.path.join(path, data))</span>
<span class="sd">            &gt;&gt;&gt; occam_iter2dat_obj.write_iter2dat_file()</span>
<span class="sd">                </span>
<span class="sd">        2. Rewrite the  with iter2dat file </span>
<span class="sd">        </span>
<span class="sd">        :Example:</span>
<span class="sd">             </span>
<span class="sd">            &gt;&gt;&gt; from pycsamt.modeling.occam2d import Iter2Dat as i2d</span>
<span class="sd">            &gt;&gt;&gt; iter_=&#39;ITER17.iter&#39;</span>
<span class="sd">            &gt;&gt;&gt; idat = K1.iter.20142.dat</span>
<span class="sd">            &gt;&gt;&gt; bln = K1.iter.20142.bln</span>
<span class="sd">            &gt;&gt;&gt; occam_iter2dat_obj =i2d(iter2dat_fn=os.path.join(pathi2d, idat),</span>
<span class="sd">                                        bln_fn = os.path.join(pathi2d, bln)</span>
<span class="sd">            &gt;&gt;&gt; occam_iter2dat_obj.write_iter2dat_file()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">iter2dat_fn</span> <span class="o">=</span><span class="n">kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;iter2dat_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">bln_fn</span> <span class="o">=</span><span class="n">kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;bln_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">elev</span><span class="o">=</span><span class="n">kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">elev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="n">elev</span> 
        <span class="k">if</span> <span class="n">bln_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bln_fn</span> <span class="o">=</span> <span class="n">bln_fn</span> 
        <span class="k">if</span> <span class="n">doi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">doi</span> <span class="o">=</span><span class="n">doi</span>
        
        <span class="c1"># statement to do so to </span>
        <span class="k">if</span> <span class="n">iter2dat_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">iter2dat_fn</span><span class="o">=</span> <span class="n">iter2dat_fn</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter2dat_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span><span class="n">model_fn</span> 
            <span class="k">if</span> <span class="n">occam_model_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">OccamModel</span> <span class="o">=</span> <span class="n">occam_model_obj</span>
            
            <span class="c1"># resseting other main attributes </span>
            <span class="k">if</span> <span class="n">iter_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;iter_fn&#39;</span><span class="p">,</span> <span class="n">iter_fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mesh_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mesh_fn&#39;</span><span class="p">,</span> <span class="n">mesh_fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;data_fn&#39;</span><span class="p">,</span> <span class="n">data_fn</span><span class="p">)</span>
      
        <span class="c1"># then read file </span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">read_iter2dat</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Get ready to write iter2dat_file with model file or model_obj.&#39;</span><span class="p">)</span>
        
        
        <span class="c1">#--------WRITE station location bln file ---------------------</span>
        <span class="c1">#--specs the name of the file is not given </span>
      
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter2dat_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter2dat_fn</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="n">filename</span> <span class="o">=</span><span class="s1">&#39;iter</span><span class="si">{0}</span><span class="s1">.</span><span class="si">{1}{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_num</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_roughness</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
            
        <span class="c1">#-</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">mess</span><span class="o">=</span><span class="s1">&#39;!Elevation is not provided. We gonna set to 0.&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--&gt;&#39;</span><span class="o">+</span><span class="n">mess</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>  <span class="c1"># assume station location exist</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_location</span><span class="p">))</span>
            
        <span class="k">else</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_location</span><span class="p">)</span> <span class="p">,</span>\
                <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d</span><span class="p">(</span><span class="s1">&#39;Elevation provided must be the same with offsets :&#39;</span>\
                                          <span class="s1">&#39; length|size =</span><span class="si">{0}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_location</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Now write an associate file call *bln include :offset+elev+station name: </span><span class="se">\</span>
<span class="s1">                           Can be used straiforwardly for Golden software plot.&#39;</span><span class="p">)</span>
           
        <span class="n">write_bln_lines</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span><span class="n">scale</span> <span class="o">=</span><span class="s1">&#39;km&#39;</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span><span class="s1">&#39;km&#39;</span> <span class="p">:</span>  <span class="c1"># convert to  kilometer elev ,  offset  and  depth.</span>
            <span class="n">dz</span> <span class="o">=</span> <span class="mf">1e3</span>
        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span><span class="s1">&#39;m&#39;</span> <span class="p">:</span>
            <span class="n">dz</span><span class="o">=</span> <span class="mf">1.</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">model_z_nodes</span> <span class="o">/=</span> <span class="n">dz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_x_nodes</span> <span class="o">/=</span><span class="n">dz</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">station_location</span> <span class="o">/=</span> <span class="n">dz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span>  <span class="o">/=</span><span class="n">dz</span>
            <span class="c1"># then can write bln file </span>
            <span class="k">for</span>  <span class="n">ikey</span><span class="p">,</span> <span class="n">stn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_names</span><span class="p">)</span> <span class="p">:</span> 
                <span class="n">write_bln_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{0:&lt;7.6f}</span><span class="s1">,&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_location</span><span class="p">[</span><span class="n">ikey</span><span class="p">]),</span> 
                                                <span class="s1">&#39;</span><span class="si">{0:&lt;7.6f}</span><span class="s1">,&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation</span><span class="p">[</span><span class="n">ikey</span><span class="p">]),</span>
                                                <span class="s1">&#39;</span><span class="si">{0:&lt;4}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stn</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
        <span class="c1">#---- end of writing bln file ---- </span>
        
        <span class="c1">#---WRITE iteration to DATA ----</span>
        <span class="c1"># loop all the grid makes :flatern all array s (expensive way)</span>
        <span class="c1"># x , y , z  = mesh_x_grid.flattern(), mesh_z_grid.flattern(),new_model_res_matrix.flattern() </span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Writing a iter2dat file from specifics objects.&#39;</span>\
                            <span class="s1">&#39; Can be visualized  by Golden software &quot;Surfer&quot;.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">negative_depth</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_z_nodes</span> <span class="o">*=-</span><span class="mi">1</span>
        <span class="n">write_iter2data_lines</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_z_nodes</span><span class="p">))</span> <span class="p">:</span> 
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_x_nodes</span><span class="p">)):</span> 
                <span class="n">write_iter2data_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="s1">&#39;</span><span class="si">{0:&gt;15.7f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_x_nodes</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span>
                    <span class="s1">&#39;</span><span class="si">{0:&gt;15.7f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_z_nodes</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span> 
                    <span class="s1">&#39;</span><span class="si">{0:&gt;15.7f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_res</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span>
                    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="p">]))</span>
        
        <span class="k">if</span> <span class="n">savepath</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1"># create a folder in your current work directory</span>
            <span class="k">try</span> <span class="p">:</span>
                <span class="n">savepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;_iter2dat_&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span><span class="c1">#  mode =0o666)</span>
            <span class="k">except</span> <span class="p">:</span> 
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;It seems the path already exists !&quot;</span><span class="p">)</span>
        <span class="c1">#writes files </span>
        <span class="k">for</span> <span class="n">ii</span> <span class="p">,</span> <span class="n">wfiles</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">write_iter2data_lines</span><span class="p">,</span> <span class="n">write_bln_lines</span> <span class="p">]):</span> 
            <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">mm</span><span class="o">=</span><span class="s1">&#39;.dat&#39;</span>
            <span class="k">else</span> <span class="p">:</span><span class="n">mm</span><span class="o">=</span><span class="s1">&#39;.bln&#39;</span>
            <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span><span class="mi">1</span> <span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_location</span> <span class="ow">is</span>  <span class="kc">None</span> <span class="p">:</span> <span class="k">break</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mm</span><span class="p">)]),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fw</span> <span class="p">:</span> 
                <span class="n">fw</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">wfiles</span><span class="p">)</span>
                
        <span class="c1">#savefile</span>
        <span class="k">if</span> <span class="n">savepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="kn">import</span> <span class="nn">shutil</span> 
            <span class="k">try</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">file</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">filename</span> <span class="o">+</span><span class="s1">&#39;.dat&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.bln&#39;</span><span class="p">]):</span> 
                    <span class="k">if</span>  <span class="n">jj</span><span class="o">==</span><span class="mi">1</span> <span class="p">:</span> 
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_location</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">break</span> 
         
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">file</span><span class="p">)</span> <span class="p">,</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span> <span class="p">,</span> <span class="n">file</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">:</span> 
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;It seems the files already exists !&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_location</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; Only file </span><span class="si">{0}</span><span class="s1">.dat have been&#39;</span>
                  <span class="s1">&#39; successfully written to  &lt;</span><span class="si">{1}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">savepath</span><span class="p">))</span>
            
            <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;! Error writing &quot;</span><span class="si">{0}</span><span class="s1">.bln&quot; file . Could not &#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;write Golden software (*.bln) file without &#39;</span><span class="p">,</span>
                           <span class="s1">&#39;station names and station location.&#39;</span><span class="p">])</span>
            
            <span class="n">mess</span><span class="o">=</span><span class="n">mess</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;---&gt; !&#39;</span><span class="o">+</span><span class="n">mess</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
 
        <span class="k">else</span> <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; files </span><span class="si">{0}</span><span class="s1">.dat &amp; </span><span class="si">{0}</span><span class="s1">.bln have been &#39;</span>
                     <span class="s1">&#39;successfully written to  &lt;</span><span class="si">{1}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">savepath</span><span class="p">))</span></div>
    
    
<div class="viewcode-block" id="Iter2Dat.read_iter2dat"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.Iter2Dat.read_iter2dat">[docs]</a>    <span class="k">def</span> <span class="nf">read_iter2dat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iter2dat_fn</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bln_fn</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span>
                      <span class="n">model_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iter_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">mesh_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">doi</span><span class="o">=</span><span class="s1">&#39;1km&#39;</span><span class="p">,</span>
                      <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">occam_model_obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read YangBo iter2data file or provided  Occam 2D specific files .</span>

<span class="sd">        :param iter2dat_fn: full path to iter2dat file </span>
<span class="sd">        :type iter2dat_fn: str  </span>
<span class="sd">        </span>
<span class="sd">        :param bln_file: full path to bln file </span>
<span class="sd">        :type  bln_file: str  </span>
<span class="sd">        </span>
<span class="sd">        :param scale: str ,  scale of output data . Most of time ,</span>
<span class="sd">                    Bo yang iter2Dat file is converted in kilometer . If not turn </span>
<span class="sd">                        the scale to `m`.</span>
<span class="sd">        :type param scale: str </span>
<span class="sd">            </span>
<span class="sd">        :Example:</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; from pycsamt.modeling.occam2d import Iter2Dat </span>
<span class="sd">            &gt;&gt;&gt; i2d=&#39;iter17.2412.dat&#39;</span>
<span class="sd">            &gt;&gt;&gt; i2d_2=&#39;K1.iter.dat&#39;</span>
<span class="sd">            &gt;&gt;&gt; bln=&#39;iter17.2412.bln&#39;</span>
<span class="sd">            &gt;&gt;&gt; bln_2 = &#39;K1.bln&#39;</span>
<span class="sd">            &gt;&gt;&gt; pathiter = os.path.join(os.path.dirname(os.environ [&#39;pyCSAMT&#39;]),</span>
<span class="sd">            ...                            &#39;_iter2dat_&#39;, i2d_2)</span>
<span class="sd">            &gt;&gt;&gt; pathbln = os.path.join(os.path.dirname(os.environ [&#39;pyCSAMT&#39;]),</span>
<span class="sd">            ...                           &#39;_iter2dat_&#39;, bln_2)</span>
<span class="sd">            &gt;&gt;&gt; occam_iter2dat_obj =Iter2Dat(iter2dat_fn=pathiter, </span>
<span class="sd">            ...                                 bln_fn =pathbln ) </span>
<span class="sd">            &gt;&gt;&gt; i2d_data = occam_iter2dat_obj.read_iter2datfile()</span>
<span class="sd">            &gt;&gt;&gt; i2d_sta, i2d_depth = occam_iter2dat_obj.model_x_nodes,</span>
<span class="sd">            &gt;&gt;&gt; occam_iter2dat_obj.model_z_nodes</span>
<span class="sd">            &gt;&gt;&gt; i2d_model_res = occam_iter2dat_obj.model_res</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># flag to read data from file or attributes populating </span>
        
        <span class="k">if</span> <span class="n">scale</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;km&#39;</span><span class="p">,</span> <span class="s1">&#39;kilometer&#39;</span><span class="p">]:</span>
            <span class="n">dz</span><span class="o">=</span> <span class="mf">1000.</span>
        <span class="k">elif</span> <span class="n">scale</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;meter&#39;</span><span class="p">]</span> <span class="p">:</span> 
            <span class="n">dz</span><span class="o">=</span><span class="mf">1.</span>
        <span class="k">else</span> <span class="p">:</span> 
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;---&gt; Iter2Dat file is generally converted into km.&#39;</span>\
                  <span class="s1">&#39; so provided the specify unit of yourf file.&#39;</span><span class="p">)</span>
                
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d_iter2dat</span><span class="p">(</span><span class="s1">&#39;Wrong scale ! . Might be &quot;m&quot; or &quot;km&quot;.&#39;</span><span class="p">)</span>
            
        <span class="n">elev</span> <span class="o">=</span><span class="n">kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation</span>  <span class="o">=</span><span class="n">elev</span> 

        <span class="k">def</span> <span class="nf">validate_iter2dat_file</span> <span class="p">(</span><span class="n">iter2dat_fn</span><span class="p">)</span> <span class="p">:</span> 
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            validate iter2dat fn and return array of data </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">newf</span> <span class="o">=</span><span class="p">[]</span>
            <span class="k">if</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">iter2dat_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">&gt; is not a file. Please check your right path.&#39;</span> <span class="o">%</span> <span class="n">iter2dat_fn</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d_iter2dat</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">iter2dat_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi2d</span><span class="p">:</span> 
                    <span class="n">iter2dat_readlines</span> <span class="o">=</span><span class="n">fi2d</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iter2dat_readlines</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">try</span> <span class="p">:</span> 
                        <span class="n">item</span> <span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i2d</span><span class="p">)</span> <span class="k">for</span> <span class="n">i2d</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span> 
                    <span class="k">except</span> <span class="p">:</span> 
                        <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1">&gt; is not Bo Yang data file.&#39;</span>\
                            <span class="s1">&#39; Please provide the right iterartion file.&#39;</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d_iter2dat</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                    <span class="k">else</span> <span class="p">:</span>    
                        <span class="n">newf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">concat_array_from_list</span><span class="p">(</span><span class="n">list_of_array</span><span class="o">=</span><span class="n">newf</span><span class="p">)</span>
        
         <span class="c1"># statement , which file |data should be read </span>
        <span class="k">if</span> <span class="n">iter2dat_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">iter2dat_fn</span> <span class="o">=</span><span class="n">iter2dat_fn</span> 
    
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter2dat_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>  <span class="n">f</span><span class="o">=</span><span class="mi">2</span>
        <span class="k">else</span> <span class="p">:</span><span class="n">f</span><span class="o">=</span> <span class="mi">1</span>      <span class="c1"># read module and fill attributes </span>

        <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="n">model_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="o">=</span><span class="n">model_fn</span> 
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Get ready to write iter2dat_file with model file or model_obj.&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">occam_model_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">OccamModel</span> <span class="o">=</span> <span class="n">occam_model_obj</span> 
       
    
            <span class="c1">#--&gt;  get exception if files are poperly given </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">iter_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;iter_fn&#39;</span><span class="p">,</span> <span class="n">iter_fn</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mesh_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mesh_fn&#39;</span><span class="p">,</span> <span class="n">mesh_fn</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;data_fn&#39;</span><span class="p">,</span> <span class="n">data_fn</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                     <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="s1">&#39;Can not read iter2data files !None object is detected.&#39;</span><span class="p">,</span> 
                                    <span class="s1">&#39;,  Must supply at least mesh_file, iteration file and data file &#39;</span><span class="p">,</span>
                                    <span class="s1">&#39; or provided model obj.&#39;</span><span class="p">])</span>
                     <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                     <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d_iter2dat</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                    
                <span class="bp">self</span><span class="o">.</span><span class="n">OccamModel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">model_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="p">,</span> <span class="n">iter_fn</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span> <span class="p">,</span> 
                                        <span class="n">mesh_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_fn</span> <span class="p">)</span>
                
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">OccamModel</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;Can not read iter2data files !None object is detected.&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;Please provide modelfile, mesh file, data file or occam model obj .&#39;</span><span class="p">])</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d_iter2dat</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">OccamModel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="c1"># try to get an spacific attribute from Model </span>
                <span class="k">try</span> <span class="p">:</span> 
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;model_station_offsets&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">:</span> 
                    <span class="n">mess</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;Object provided is not an Python Model class object.&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39; Please provide a model object from occam2d module. e.g&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;--&gt; from pycsamt.modeling.occam2d import Model .&#39;</span><span class="p">])</span>
                    
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d_iter2dat</span><span class="p">(</span><span class="s1">&#39;Object provided is not a Model class object.&#39;</span>\
                                                             <span class="s1">&#39; Please provide a right model obj. &#39;</span><span class="p">)</span>
            <span class="c1"># thin now everything is fine then :    </span>
            <span class="c1">#----Get model_attribute from model_obj ------- </span>

            <span class="c1"># get data offset _obj </span>
            <span class="n">occam_data_obj</span> <span class="o">=</span><span class="n">Data</span><span class="p">(</span><span class="n">data_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_fn</span><span class="p">)</span>
            <span class="n">offs</span> <span class="o">=</span> <span class="n">occam_data_obj</span><span class="o">.</span><span class="n">data_offsets</span>
            
             <span class="c1"># # get the last iteration number and roughness value from Iter obj </span>
            <span class="n">occam_iter_obj</span> <span class="o">=</span><span class="n">Iter</span><span class="p">(</span><span class="n">iter_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_fn</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;iter_num&#39;</span><span class="p">,</span> <span class="n">occam_iter_obj</span><span class="o">.</span><span class="n">iter_iteration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;iter_roughness&#39;</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="n">occam_iter_obj</span><span class="o">.</span><span class="n">iter_roughness_value</span><span class="p">)</span> <span class="p">)</span>
            
            <span class="c1"># get largest model attributes (nodes x , nodes z  and model resistivity )</span>
            <span class="n">model_plot_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OccamModel</span><span class="o">.</span><span class="n">model_station_offsets</span>
            <span class="n">model_plot_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OccamModel</span><span class="o">.</span><span class="n">model_depth_offsets</span>
            <span class="n">model_res</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OccamModel</span><span class="o">.</span><span class="n">model_resistivity</span>
            
            <span class="c1"># Matrix is large enough , let get the part we need from investigation depth </span>
            <span class="c1">#Note : from CSAMT : 1km is enough them we set 1km as a ddefault value .</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Get a corresponding range of matrix we need , offsets, depth and rho and populate attributes.&#39;</span><span class="p">)</span>
            
            <span class="kn">from</span> <span class="nn">pycsamt.utils.plot_utils</span> <span class="kn">import</span> <span class="n">slice_csamt_matrix</span>  <span class="p">,</span> <span class="n">depth_of_investigation</span> 
            
            <span class="bp">self</span><span class="o">.</span><span class="n">doi</span> <span class="o">=</span><span class="n">depth_of_investigation</span><span class="p">(</span><span class="n">doi</span><span class="o">=</span><span class="n">doi</span><span class="p">)</span>
            <span class="c1"># check the doi and the max z_nodes depth if user change the default doi value </span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doi</span> <span class="o">&gt;</span> <span class="n">model_plot_z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="p">:</span> 
                <span class="n">mess</span> <span class="o">=</span><span class="s1">&#39;doi provided = </span><span class="si">{0}</span><span class="s1"> m is much larger than maximum investigation depth =</span><span class="si">{1}</span><span class="s1">.&#39;</span>\
                    <span class="s1">&#39;We reset new doi = </span><span class="si">{1}</span><span class="s1"> m.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span> <span class="n">model_plot_z</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; ! Input doi =</span><span class="si">{0}</span><span class="s1"> m was resetting to maxdepth =</span><span class="si">{1}</span><span class="s1"> m.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">doi</span><span class="p">,</span><span class="n">model_plot_z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="p">))</span>
                
                <span class="n">doi</span> <span class="o">=</span> <span class="n">model_plot_z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="c1"># slice matrix and get range </span>
            <span class="n">new_station_offsets</span><span class="p">,</span>  <span class="n">new_depth_offsets</span><span class="p">,</span> <span class="n">new_model_res_matrix</span><span class="o">=</span> \
                <span class="n">slice_csamt_matrix</span><span class="p">(</span><span class="n">block_matrix</span> <span class="o">=</span><span class="n">model_res</span> <span class="p">,</span><span class="n">offset_MinMax</span><span class="o">=</span><span class="p">(</span><span class="n">offs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">offs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                                                         <span class="n">station_offsets</span><span class="o">=</span><span class="n">model_plot_x</span><span class="p">,</span> 
                                                         <span class="n">depth_offsets</span><span class="o">=</span><span class="n">model_plot_z</span> <span class="p">,</span> 
                                                         <span class="n">doi</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">doi</span><span class="p">)</span>
            
            <span class="c1"># resetting attribute : Defalut values are in  meter as default units</span>
            
            <span class="k">for</span> <span class="n">i2dkey</span><span class="p">,</span> <span class="n">i2dvalues</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter2d_params</span><span class="p">,</span>
                                          <span class="p">[</span><span class="n">new_station_offsets</span><span class="p">,</span><span class="n">new_depth_offsets</span><span class="p">,</span>
                                           <span class="n">new_model_res_matrix</span><span class="p">,</span>
                                           <span class="n">occam_data_obj</span><span class="o">.</span><span class="n">data_sites</span><span class="p">,</span> 
                                           <span class="n">occam_data_obj</span><span class="o">.</span><span class="n">data_offsets</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="p">])</span> <span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i2dkey</span><span class="p">,</span> <span class="n">i2dvalues</span><span class="p">)</span>
                
                
         <span class="c1"># ---&gt; NOW Go to the case where data iter2dat file is provided, read file and populate attributes   </span>
        <span class="k">elif</span> <span class="n">f</span><span class="o">==</span><span class="mi">2</span> <span class="p">:</span> 
            
            <span class="n">iter2dat_data</span> <span class="o">=</span> <span class="n">validate_iter2dat_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter2dat_fn</span><span class="p">)</span>
           
            <span class="c1"># Bo Yang  iteration data  are range into  negative depth , then we will resset to positive depth </span>
            <span class="n">iter2dat_data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i2d</span> <span class="p">:</span><span class="n">i2d</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iter2dat_data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
          
            <span class="c1"># get depth offset and station offset  and sorted values according to station range the min to max . </span>
            <span class="c1"># sometimes  Bo yang files  are little missy, reorganize it  </span>
            
            <span class="n">iter2dat_data</span><span class="o">=</span><span class="n">iter2dat_data</span><span class="p">[</span><span class="n">iter2dat_data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;mergesort&quot;</span><span class="p">)]</span>
            
            <span class="c1"># loop and ressetting attributes ---</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="p">,</span> <span class="n">name</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter2d_params</span><span class="p">[:</span><span class="mi">2</span><span class="p">]):</span> <span class="c1"># resetting attributes </span>
                <span class="n">value</span><span class="p">,</span><span class="o">*</span><span class="n">ign</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">iter2dat_data</span><span class="p">[:,</span><span class="n">ii</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">*</span><span class="n">dz</span><span class="p">)</span>
    
            <span class="c1"># build resistivitvity model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Building Resisistivity model from file &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter2dat_fn</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">model_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">model_z_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">model_x_nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="c1"># initialise model resistivity array </span>
            <span class="n">mm</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_z_nodes</span><span class="p">))</span> <span class="p">:</span> 
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_x_nodes</span><span class="p">)):</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_res</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">iter2dat_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> 
                    <span class="n">mm</span> <span class="o">+=</span><span class="mi">1</span> 
                    
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:-^77}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Iter2Dat *Data* info&#39;</span><span class="p">))</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;37}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Mininum Limit vertical nodes (m)&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_z_nodes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span><span class="mi">1</span> <span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;37}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Maximum limit vertical nodes (m)&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_z_nodes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span><span class="mi">1</span> <span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;37}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Minimum limit Horizontal nodes (m) &#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_x_nodes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;37}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Maximum limit Horizontal nodes(m)&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_x_nodes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;37}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Horizontal nodes get from file &#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;37}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Vertical nodes get from file &#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    
            <span class="k">if</span> <span class="n">bln_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bln_fn</span> <span class="o">=</span> <span class="n">bln_fn</span> 
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bln_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bln_fn</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span> <span class="p">:</span> 
                <span class="n">mess</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; ! Site file is not provided. Need  a Bo Yang bln file read from Golden software&#39;</span><span class="p">,</span>
                              <span class="s1">&#39; to set station location , elevation and sites names.&#39;</span><span class="p">,</span> 
                              <span class="s1">&#39;Please profile a file &lt;*.bln&gt;, if not, station location,&#39;</span><span class="p">,</span>
                              <span class="s1">&#39; elevation and sites names will set to None.&#39;</span><span class="p">])</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bln_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bln_fn</span> <span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span> 

                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bln_fn</span> <span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fbln</span> <span class="p">:</span>
                        <span class="n">bln_readlines</span> <span class="o">=</span> <span class="n">fbln</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="n">temb</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bln_readlines</span> <span class="p">])</span>
                    
                    <span class="k">for</span> <span class="n">ii</span> <span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;station_location&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span> <span class="p">,</span> <span class="s1">&#39;station_names&#39;</span><span class="p">])</span> <span class="p">:</span>
                        <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span><span class="mi">2</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span>   <span class="n">temb</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
                        <span class="k">else</span> <span class="p">:</span> 
                            <span class="k">try</span> <span class="p">:</span>
                                <span class="c1"># self.__setattr__(ss, np.apply_along_axis(lambda off : float(off) * dz, 0 , temb[:, ii] ))</span>
                                <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">off</span><span class="p">)</span> <span class="k">for</span> <span class="n">off</span> <span class="ow">in</span> <span class="n">temb</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]])</span> <span class="o">*</span> <span class="n">dz</span><span class="p">)</span>
                            <span class="k">except</span> <span class="p">:</span> 
                                <span class="n">mess</span> <span class="o">=</span><span class="s2">&quot; It seem all data from station and elevation &quot;</span>\
                                    <span class="s2">&quot;can not be convert into float value. Please check your data.&quot;</span>
                                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_occam2d_iter2dat</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:-^77}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Iter2Dat *Station* info&#39;</span><span class="p">))</span>  
            <span class="k">try</span> <span class="p">:</span> 
                <span class="k">for</span> <span class="n">ffmt</span><span class="p">,</span> <span class="n">fmtvalue</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">([</span><span class="s1">&#39; Stations num.&#39;</span><span class="p">,</span><span class="s1">&#39; Minimum offset (m)&#39;</span><span class="p">,</span><span class="s1">&#39; Maximum offset (m)&#39;</span> <span class="p">],</span> 
                                           <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station_names</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">station_location</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_location</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="p">]):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ffmt</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">fmtvalue</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">:</span> 
                <span class="k">for</span> <span class="n">ffmt</span> <span class="ow">in</span> <span class="p">([</span><span class="s1">&#39; Stations num.&#39;</span><span class="p">,</span><span class="s1">&#39; Minimum offset (m)&#39;</span><span class="p">,</span><span class="s1">&#39; Maximum offset (m)&#39;</span> <span class="p">]):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ffmt</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">pass</span> 

                
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** ! Elevation not provided.&#39;</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Minimum elevation (m)&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Maximum elevation (m)&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span></div></div>
                
                
<div class="viewcode-block" id="occam2d_write"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.occam2d_write">[docs]</a><span class="k">class</span> <span class="nc">occam2d_write</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Special class to build occam2d imput files with :ref:`MTpy` module .</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    --------</span>
<span class="sd">        **edi_fn**: str </span>
<span class="sd">            full path to edifiles locations</span>
<span class="sd">        **freq_num** :float </span>
<span class="sd">            number of frequencies to use in inversion</span>
<span class="sd">        **interpolate_freq**: bool,</span>
<span class="sd">            frequency interpolation , default is *False*</span>
<span class="sd">        **geoelectric_strike**: bool</span>
<span class="sd">             geoelectric strike angle assuming N = 0, E = 90.</span>
<span class="sd">             If True , provided , losgspace interpolation as tuple value</span>
<span class="sd">        </span>
<span class="sd">    Others important attributes can be  found in : </span>
<span class="sd">        </span>
<span class="sd">    ======================  ===================================================</span>
<span class="sd">    Key Words/Attributes    Description</span>
<span class="sd">    ======================  ===================================================</span>
<span class="sd">    edi_fn                  full path to data file</span>
<span class="sd">    n_layers                number of vertical layers in mesh</span>
<span class="sd">                            *default* is 31. </span>
<span class="sd">    num_layers              [ int ] number of regularization layers.</span>
<span class="sd">    num_z_pad_cells         number of vertical padding cells below </span>
<span class="sd">    iterations_to_run       maximum number of iterations to run</span>
<span class="sd">                            *default* is 20</span>
<span class="sd">    resistivity_start       starting resistivity value.  If model_values is</span>
<span class="sd">                            not given, then all values with in model_values</span>
<span class="sd">                            array will be set to resistivity_start</span>
<span class="sd">    save_path               directory path to save startup file to</span>
<span class="sd">                            *default* is current working directory  </span>
<span class="sd">    startup_basename        basename of startup file name. </span>
<span class="sd">                            *default* is Occam2DStartup</span>
<span class="sd">    startup_fn              full path to startup file.</span>
<span class="sd">                            *default* is save_path/startup_basename  </span>
<span class="sd">    target_misfit           target misfit value.</span>
<span class="sd">                            *default* is 1.</span>
<span class="sd">    x_pad_multiplier        horizontal padding cells will increase by this</span>
<span class="sd">                            multiple out to the edge of the grid.</span>
<span class="sd">                            *default* is 1.7</span>
<span class="sd">    z1_layer                thickness of the first layer in the model.</span>
<span class="sd">                            Should be at least 1/4 of the first skin depth</span>
<span class="sd">                            *default* is 10</span>
<span class="sd">    z_bottom                bottom depth of the model (m).  Needs to be large </span>
<span class="sd">                            enough to be 1D at the edge. </span>
<span class="sd">                            *default* is 200000.0 </span>
<span class="sd">    z_target_depth          depth to deepest target of interest.  Below this</span>
<span class="sd">                            depth cells will be padded to z_bottom</span>
<span class="sd">    cell_width              width of cells with in station area in meters</span>
<span class="sd">                            *default* is 100</span>
<span class="sd">    phase_te_err            percent error in phase for TE mode. *default* is 5</span>
<span class="sd">    phase_tm_err            percent error in phase for TM mode. *default* is 20. </span>
<span class="sd">    res_te_err              percent error in resistivity for TE mode. </span>
<span class="sd">                              *default* is 10</span>
<span class="sd">    res_tm_err              percent error in resistivity for TM mode.</span>
<span class="sd">    trigger                 [ float ] multiplier to merge model blocks at </span>
<span class="sd">                            depth.  A higher number increases the number of</span>
<span class="sd">                            model blocks at depth.  *default* is .1.12</span>
<span class="sd">    model_mode              model mode to use for inversion, see module`Data`. </span>
<span class="sd">    ======================  ===================================================</span>
<span class="sd">    </span>
<span class="sd">    .. note:: We consider occam2D buildingInputs file is focused on CSAMT data in</span>
<span class="sd">            TM mode then default configuration as  setting according this feature. </span>
<span class="sd">            If input `edi_fn` are MT data , please resetting configuration</span>
<span class="sd">            you SEG `edi-fn` data provided !.</span>
<span class="sd">            ... </span>
<span class="sd">            </span>
<span class="sd">    :Example:</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; from pycsamt.modeling.occam2d import occam2d_write </span>
<span class="sd">        &gt;&gt;&gt;  occam2d_write.buildingInputfiles(os.path.join(os.environ[&#39;pyCSAMT&#39;], </span>
<span class="sd">        ...                                              &#39;data&#39;, &#39;edi&#39;), </span>
<span class="sd">        ...                        savepath =os.path.join(os.environ[&#39;pyCSAMT&#39;],</span>
<span class="sd">        ...                                               &#39;data&#39;, &#39;tesocc2&#39; ),</span>
<span class="sd">        ...                        geolectricke_strike=34.)</span>
<span class="sd">  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">SUCCESS_IMPORT_MTPY</span> <span class="ow">is</span> <span class="kc">False</span> <span class="p">:</span>
        
            <span class="n">mess</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;Failed to import MTpy module ! Could not build inputOccam2D files.&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39; Please try to install :ref:`MTpy` manually !&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; &#39;</span><span class="o">+</span> <span class="n">mess</span><span class="p">)</span>
    
<div class="viewcode-block" id="occam2d_write.buildingInputfiles"><a class="viewcode-back" href="../../../modeling.html#pycsamt.modeling.occam2d.occam2d_write.buildingInputfiles">[docs]</a>    <span class="nd">@staticmethod</span> 
    <span class="k">def</span> <span class="nf">buildingInputfiles</span><span class="p">(</span><span class="n">edi_fn</span><span class="p">,</span> <span class="n">freq_num</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">savepath</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">interpolate_freq</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                               <span class="n">geoelectric_strike</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to build Occam2D inputfiles. Deal with :ref:`MTpy` module. </span>
<span class="sd">        Try to install :ref:`MTpy` is not installed yet.</span>
<span class="sd">        </span>
<span class="sd">        :param edi_fn: full path to edifiles </span>
<span class="sd">        :type edi_fn: str </span>
<span class="sd">        </span>
<span class="sd">        :param freq_num:  number of frequencies to use in inversion</span>
<span class="sd">        :type freq_num: float</span>
<span class="sd">        </span>
<span class="sd">        :param interpolate_freq: frequency interpolation , default is *False*</span>
<span class="sd">        :type interpolate_freq: bool </span>
<span class="sd">        </span>
<span class="sd">        :param geoelectric_strike: geoelectric strike angle assuming N = 0, E = 90.</span>
<span class="sd">                            If True , provided , losgspace interpolation as tuple value</span>
<span class="sd">        :type geoelectric_strike: float</span>
<span class="sd">        </span>
<span class="sd">        :return: outfiles building occam2d inputfiles </span>
<span class="sd">        :rtype: str , sys.stdout</span>
<span class="sd">   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">SUCCESS_IMPORT_MTPY</span> <span class="ow">is</span> <span class="kc">False</span> <span class="p">:</span> <span class="k">return</span> 
           
        <span class="n">freq_logspace</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;intp_freq_logspace&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">17</span> <span class="p">))</span>
        <span class="n">startup_basename</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;startup_basename&#39;</span><span class="p">,</span> <span class="s1">&#39;Startup&#39;</span><span class="p">)</span>
        
        <span class="n">res_tm_error_floor</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_tm_err&#39;</span><span class="p">,</span> <span class="mf">10.</span><span class="p">)</span>
        <span class="n">phase_tm_error_floor</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phase_tm_err&#39;</span><span class="p">,</span> <span class="mf">20.</span><span class="p">)</span>
        
        <span class="n">occam_model_mode</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;occam_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">)</span>
        
        <span class="n">res_te_error_floor</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;res_te_err&#39;</span><span class="p">,</span> <span class="mf">10.</span><span class="p">)</span>
        <span class="n">phase_te_error_floor</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phs_te_err&#39;</span><span class="p">,</span> <span class="mf">20.</span><span class="p">)</span>
        
        <span class="n">number_of_layers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;n_layers&#39;</span><span class="p">,</span> <span class="mf">31.</span><span class="p">))</span>
    
        <span class="n">cell_width</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cell_width&#39;</span><span class="p">,</span> <span class="mf">5.</span><span class="p">)</span>
        <span class="n">x_pad_multiplier</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;x_pad_multiplier&#39;</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">)</span>
        <span class="n">trigger</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;trigger&#39;</span><span class="p">,</span> <span class="mf">1.12</span><span class="p">)</span>
        
        <span class="n">z_bottom</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z_bottom&#39;</span><span class="p">,</span> <span class="mf">5000.</span><span class="p">)</span>
        <span class="n">z1_layer</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z1_layer&#39;</span><span class="p">,</span> <span class="mf">5.</span><span class="p">)</span>
        <span class="n">z_target_depth</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;z_target&#39;</span><span class="p">,</span> <span class="mf">1100.</span><span class="p">)</span>
        
        <span class="n">iterations_to_run</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;iteration_to_run&#39;</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)</span>
        <span class="n">resistivity_start</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;resistivity_start&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">OccamDataFile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;occamDataFile&#39;</span><span class="p">,</span><span class="s1">&#39;OccamDataFile.dat&#39;</span> <span class="p">)</span>
        
        
        <span class="k">if</span> <span class="n">savepath</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">savepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span><span class="s1">&#39;occam2dBuildInputfiles&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        
        <span class="c1"># collected the list of stations from edifile object </span>
        
        <span class="n">slst</span><span class="o">=</span><span class="p">[</span><span class="n">edi</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edi_fn</span><span class="p">)</span> <span class="k">if</span> <span class="n">edi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.edi&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
        
    
        <span class="c1"># create an occam data object</span>
        
        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Read occam2d Data, write data and build regularization mesh &#39;</span><span class="p">)</span>
        
        <span class="n">ocd</span> <span class="o">=</span> <span class="n">MToccam2d</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">edi_path</span><span class="o">=</span><span class="n">edi_fn</span><span class="p">,</span>
                           <span class="n">station_list</span><span class="o">=</span><span class="n">slst</span><span class="p">,</span>
                           <span class="n">interpolate_freq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">*</span><span class="n">freq_logspace</span><span class="p">)</span>
                           <span class="p">)</span>
        <span class="n">ocd</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">savepath</span>
        <span class="n">ocd</span><span class="o">.</span><span class="n">freq_num</span> <span class="o">=</span> <span class="n">freq_num</span><span class="c1"># number of frequencies to invert</span>
        
        <span class="c1">#### make data file</span>
        <span class="c1"># geoelectric strike for rotation</span>
        <span class="c1"># if not specified will calculate from the data</span>
        
        <span class="n">ocd</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span> <span class="n">geoelectric_strike</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; geoelectric strike added !&#39;</span><span class="p">)</span>
        
       
        <span class="k">if</span> <span class="n">occam_model_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span> 
                                    <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">occam_dataType</span><span class="o">.</span><span class="n">keys</span><span class="p">())]:</span> 
            <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Occam model mode provided is wrong ! Please select the convenient&#39;</span><span class="o">+</span>\
                <span class="s1">&#39; mode between  the following list modes: </span><span class="si">{0}</span><span class="s1">&#39;</span>
                
            <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;occam model value given is out of the model mode range . &#39;</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- &gt; &#39;</span><span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span> 
                                    <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">occam_dataType</span><span class="o">.</span><span class="n">keys</span><span class="p">())]))</span>
            <span class="k">return</span> 
        
         <span class="c1"># added error floors</span>
        <span class="k">if</span> <span class="n">occam_model_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="s1">&#39;6&#39;</span><span class="p">]:</span> 
            <span class="n">ocd</span><span class="o">.</span><span class="n">model_mode</span><span class="o">=</span> <span class="s2">&quot;6&quot;</span>
            <span class="n">ocd</span><span class="o">.</span><span class="n">res_tm_err</span> <span class="o">=</span> <span class="n">res_tm_error_floor</span>
            <span class="n">ocd</span><span class="o">.</span><span class="n">phase_tm_err</span> <span class="o">=</span> <span class="n">phase_tm_error_floor</span>
        <span class="k">elif</span> <span class="n">occam_model_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]:</span> 
            <span class="n">ocd</span><span class="o">.</span><span class="n">res_te_err</span> <span class="o">=</span> <span class="n">res_te_error_floor</span> 
            <span class="n">ocd</span><span class="o">.</span><span class="n">phase_te_err</span> <span class="o">=</span> <span class="n">phase_te_error_floor</span> 
            
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; Errors floors successfully  added !&#39;</span><span class="p">)</span>
        
        <span class="c1"># now write occam_data_file </span>
        <span class="n">ocd</span><span class="o">.</span><span class="n">write_data_file</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; Read occam2D data and write occam Data done !&#39;</span><span class="p">)</span>
        <span class="c1"># make model and mesh files</span>
        <span class="n">ocr</span> <span class="o">=</span> <span class="n">MToccam2d</span><span class="o">.</span><span class="n">Regularization</span><span class="p">(</span><span class="n">ocd</span><span class="o">.</span><span class="n">station_locations</span><span class="p">,</span> 
                                       <span class="n">n_layers</span> <span class="o">=</span><span class="n">number_of_layers</span><span class="p">,</span> 
                                       <span class="n">cell_width</span> <span class="o">=</span> <span class="n">cell_width</span><span class="p">,</span> 
                                       <span class="n">x_pad_multiplier</span> <span class="o">=</span> <span class="n">x_pad_multiplier</span><span class="p">,</span> 
                                       <span class="n">trigger</span><span class="o">=</span> <span class="n">trigger</span><span class="p">,</span> 
                                       <span class="n">z1_layer</span> <span class="o">=</span> <span class="n">z1_layer</span><span class="p">,</span>
                                       <span class="n">z_target_depth</span> <span class="o">=</span> <span class="n">z_target_depth</span> <span class="p">,</span> 
                                       <span class="n">save_path</span><span class="o">=</span><span class="n">ocd</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span>
                                       <span class="n">z_bottom</span> <span class="o">=</span><span class="n">z_bottom</span> <span class="p">,</span>
                                        <span class="p">)</span>
    
        <span class="n">ocr</span><span class="o">.</span><span class="n">build_mesh</span><span class="p">()</span>
        <span class="n">ocr</span><span class="o">.</span><span class="n">build_regularization</span><span class="p">()</span>
        <span class="n">ocr</span><span class="o">.</span><span class="n">write_mesh_file</span><span class="p">()</span>
        <span class="n">ocr</span><span class="o">.</span><span class="n">write_regularization_file</span><span class="p">()</span>
        <span class="n">ocr</span><span class="o">.</span><span class="n">plot_mesh</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; Build occam2d Regularization mesh  done !&#39;</span><span class="p">)</span>
        <span class="c1"># make startup file</span>
        <span class="n">ocs</span><span class="o">=</span><span class="n">MToccam2d</span><span class="o">.</span><span class="n">Startup</span><span class="p">(</span><span class="n">iterations_to_run</span><span class="o">=</span><span class="n">iterations_to_run</span><span class="p">,</span> 
                              <span class="n">startup_basename</span><span class="o">=</span><span class="n">startup_basename</span><span class="p">,</span> 
                              <span class="n">data_fn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocd</span><span class="o">.</span><span class="n">save_path</span><span class="p">,</span><span class="n">OccamDataFile</span><span class="p">),</span> 
                              <span class="n">resistivity_start</span><span class="o">=</span><span class="n">resistivity_start</span><span class="p">)</span>
        <span class="n">ocr</span><span class="o">.</span><span class="n">get_num_free_params</span><span class="p">()</span>
        <span class="n">ocs</span><span class="o">.</span><span class="n">param_count</span><span class="o">=</span><span class="n">ocr</span><span class="o">.</span><span class="n">num_free_param</span>
        <span class="n">ocs</span><span class="o">.</span><span class="n">save_path</span><span class="o">=</span><span class="n">ocd</span><span class="o">.</span><span class="n">save_path</span>
        <span class="n">ocs</span><span class="o">.</span><span class="n">model_fn</span><span class="o">=</span><span class="n">ocr</span><span class="o">.</span><span class="n">reg_fn</span>
        <span class="n">ocs</span><span class="o">.</span><span class="n">write_startup_file</span><span class="p">()</span>
    
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; Build write occam2D startup file done !&#39;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:-^77}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Summary *occam2d input params* infos&#39;</span><span class="p">))</span>  
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Given frequency number&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">freq_num</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Interpolate frequencies range&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">freq_logspace</span><span class="p">))</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Occam model mode&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">occam_model_mode</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">occam_model_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1"> %.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; TM rho error floors&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">res_tm_error_floor</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1"> %.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; TM phase error floors&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">phase_tm_error_floor</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">occam_model_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1"> %.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; TE rho error floors&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">res_te_error_floor</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1"> %.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; TE phase error floors&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">phase_te_error_floor</span><span class="p">))</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Model cell width&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">cell_width</span> <span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; model horizontal pad&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">x_pad_multiplier</span> <span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Model bricks trigger&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">trigger</span> <span class="p">))</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Number of model layers&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">number_of_layers</span><span class="p">)</span> <span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1"> m.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Top layer thickness&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">z1_layer</span> <span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1"> m.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Expected image depth&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">z_target_depth</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1"> m.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Model bottom&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">z_bottom</span> <span class="p">))</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Expected iteration to run&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">iterations_to_run</span> <span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1"> ohm.m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; starting model resistivity&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;=&#39;</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">resistivity_start</span><span class="p">)</span> <span class="p">))</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{0:&lt;27}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> +</span><span class="si">{2}</span><span class="s1"> degrees E of N&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; Geoelectric strike&#39;</span><span class="p">,</span>
                                                         <span class="s1">&#39;=&#39;</span> <span class="p">,</span><span class="n">geoelectric_strike</span><span class="p">))</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">77</span><span class="p">)</span>  

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; Building occamInputfiles  function successfully run. !&#39;</span><span class="p">)</span>            </div></div>
   
   
<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span> 
    
    <span class="c1"># print(list(Data.occam_dataType.keys()))</span>
    <span class="n">occam2d_write</span><span class="o">.</span><span class="n">buildingInputfiles</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;pyCSAMT&#39;</span><span class="p">],</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;edi&#39;</span><span class="p">),</span> 
                                <span class="n">savepath</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;pyCSAMT&#39;</span><span class="p">],</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;tesocc2&#39;</span> <span class="p">),</span>
                                <span class="n">geoelectric_strike</span><span class="o">=</span><span class="mf">34.</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pyCSAMT v1.0.03 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Kouadio K. Laurent.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.0.
    </div>
  </body>
</html>