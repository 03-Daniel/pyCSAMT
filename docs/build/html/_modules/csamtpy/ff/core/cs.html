
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>csamtpy.ff.core.cs &#8212; pyCSAMT v1.0.01 documentation</title>
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pyCSAMT v1.0.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for csamtpy.ff.core.cs</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ===========================================================================</span>
<span class="sd">    Copyright Â© 2021  Kouadio K.Laurent</span>
<span class="sd">    </span>
<span class="sd">    This file is part of pyCSAMT.</span>

<span class="sd">    pyCSAMT is free software: you can redistribute it and/or modify</span>
<span class="sd">    it under the terms of the GNU Lesser General Public License as published by</span>
<span class="sd">    the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">    (at your option) any later version.</span>

<span class="sd">    pyCSAMT is distributed in the hope that it will be useful,</span>
<span class="sd">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">    GNU Lesser General Public License for more details.</span>

<span class="sd">    You should have received a copy of the GNU Lesser General Public License</span>
<span class="sd">    along with pyCSAMT.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="sd">    </span>
<span class="sd">    ===========================================================================</span>
<span class="sd">    </span>
<span class="sd">    . Super class or CSAMT Far Field implementation </span>
<span class="sd">    Deal with AVG file and EDI files </span>
<span class="sd">    </span>
<span class="sd">Created on Wed Dec  2 11:29:32 2020</span>

<span class="sd">@author: KouaoLaurent alias @Daniel03</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">warnings</span><span class="o">,</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">time</span>  
 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">csamtpy.etc</span> <span class="kn">import</span> <span class="n">infos</span> <span class="k">as</span> <span class="n">inFO</span>

<span class="kn">import</span> <span class="nn">csamtpy.ff.core.avg</span> <span class="k">as</span> <span class="nn">CSAMTavg</span> 
<span class="kn">import</span> <span class="nn">csamtpy.ff.core.edi</span> <span class="k">as</span> <span class="nn">CSAMTedi</span> 
<span class="kn">import</span> <span class="nn">csamtpy.ff.core.j</span> <span class="k">as</span> <span class="nn">CSAMTj</span> 
<span class="kn">import</span> <span class="nn">csamtpy.ff.core.z</span> <span class="k">as</span> <span class="nn">CSAMTz</span> 

<span class="kn">from</span> <span class="nn">csamtpy.utils</span> <span class="kn">import</span> <span class="n">exceptions</span> <span class="k">as</span> <span class="n">CSex</span>
<span class="kn">from</span> <span class="nn">csamtpy.utils</span> <span class="kn">import</span> <span class="n">gis_tools</span> <span class="k">as</span> <span class="n">gis</span> 
<span class="kn">from</span> <span class="nn">csamtpy.utils</span> <span class="kn">import</span> <span class="n">func_utils</span>  <span class="k">as</span> <span class="n">func</span>
<span class="kn">from</span> <span class="nn">csamtpy.utils._csamtpylog</span> <span class="kn">import</span> <span class="n">csamtpylog</span>

<span class="kn">from</span> <span class="nn">csamtpy.ff.processing</span> <span class="kn">import</span> <span class="n">callffunc</span> <span class="k">as</span> <span class="n">cfunc</span> 
<span class="kn">import</span> <span class="nn">csamtpy.ff.processing.zcalculator</span> <span class="k">as</span> <span class="nn">Zcc</span>

<span class="n">_logger</span> <span class="o">=</span> <span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">try</span> <span class="p">:</span> 
    <span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span> 
    <span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">spSTATS</span>
    <span class="n">scipy_version</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">vers</span><span class="p">)</span> <span class="k">for</span> <span class="n">vers</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span> <span class="c1">#[1,4,1]</span>
    <span class="k">if</span> <span class="n">scipy_version</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> 
        <span class="k">if</span> <span class="n">scipy_version</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Note: need scipy version 1.4.0 or more . It may probably  get a trouble when import &quot;stats&quot; attribute&#39;</span>
                          <span class="s1">&#39;under such version.It may probably move from &#39;</span><span class="p">,</span> <span class="ne">ImportWarning</span><span class="p">)</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Note: need scipy version 0.14.0 or higher or for stats.linearegress. Under such version&#39;</span>
                            <span class="s1">&#39;it might not work.&#39;</span><span class="p">)</span>
    <span class="c1"># from sp import stats </span>
    <span class="n">stats_import</span> <span class="o">=</span><span class="kc">True</span> 
            
<span class="k">except</span> <span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Could not find scipy.stats, cannot use method linearregression&#39;</span>
                  <span class="s1">&#39;check installation you can get scipy from scipy.org.&#39;</span><span class="p">)</span>
    <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not find scipy.stats, cannot use method linearegress&#39;</span>
                    <span class="s1">&#39;check installation you can get scipy from scipy.org.&#39;</span><span class="p">)</span>
    
    <span class="n">stats_import</span> <span class="o">=</span><span class="kc">False</span> 


<span class="c1">########################## end import #######################################</span>


<div class="viewcode-block" id="CSAMT"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.cs.CSAMT">[docs]</a><span class="k">class</span> <span class="nc">CSAMT</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      CSAMT class is super class container of all the information of the other classes,</span>
<span class="sd">     J, Avg and Edi. In fact, the CS object collect all the information of the other classes,</span>
<span class="sd">     once questioned for specific uses. The purpose of the construction</span>
<span class="sd">     of this object to avoid the repetition of scripts throughout the project.</span>
<span class="sd">     Objet CSAMT can recognize the typycal input obj of file and set attributes for use . </span>
<span class="sd">     </span>
<span class="sd">     arguments : </span>
<span class="sd">                 data_fn : str : full path to EDI, J or AVG file or  files directory : can be : </span>
<span class="sd">                                     (1) ===&gt; edipath : str : path to edifiles directory.,</span>
<span class="sd">                                                         where edifiles are located OR</span>
<span class="sd">                                     (2) ===&gt; jpath : str : full path to AG.Jones file ;</span>
<span class="sd">                                                         directory where jfiles are located </span>
<span class="sd">                 profile_fn : str : full path to Zonge station profile file : &quot;*.stn&quot;</span>
<span class="sd">                 </span>
<span class="sd">     Note : To call multiple files ,user need only to specify the path . </span>
<span class="sd">     </span>
<span class="sd">    ================== =================================================================</span>
<span class="sd">    Attributes              Type                Description  </span>
<span class="sd">    ============================== =====================================================</span>
<span class="sd">    lat                 float/ndarray,1         sation latitude </span>
<span class="sd">    lon                 float/ndarray,1         station longitude </span>
<span class="sd">    elev                float/ndarray           station elevantion in m or ft </span>
<span class="sd">    east                float/ndarray.1         station easting coordinate (m)</span>
<span class="sd">    north               float/ndarray,1         station northing coordinate (m)</span>
<span class="sd">    azim                float/ndarray,1         station azimuth in meter </span>
<span class="sd">    station             ndarray,1               sation id from survey</span>
<span class="sd">    utm_zone            str                     UTM location zone </span>
<span class="sd">    </span>
<span class="sd">    resistivity         dict                resistivity value at each station (ohm.m)</span>
<span class="sd">    resistivity_err     dict                res.error at each station </span>
<span class="sd">    phase               dict                phase value at each station in degree </span>
<span class="sd">    phase_err           dict                phase error at each station </span>
<span class="sd">    zxy                 dict                impedanceTensor  at each station from xy</span>
<span class="sd">    zxy_error           dict                imped. Tensor error  at each station from yx</span>
<span class="sd">    zyx                 dict                impedanceTensor  at each station from xy</span>
<span class="sd">    zyx_err             dict                imped. Tensor error  at each station from yx</span>
<span class="sd">    freq                ndarray,1           frequency array from survey    </span>
<span class="sd">    </span>
<span class="sd">    =====================================================================================</span>
<span class="sd">    </span>
<span class="sd">    Followings method : </span>
<span class="sd">    =====================================================================================</span>
<span class="sd">    Methods                         Description </span>
<span class="sd">    =====================================================================================</span>
<span class="sd">    _read_csamt_objs                read in CSAMT file [EDI|AVG|J]</span>
<span class="sd">    _read_edi_obj                   read_edi_obj and set attributes </span>
<span class="sd">    _read_avg_obj                   read Zonge Eng. Avg file and set attributes</span>
<span class="sd">    _read_j_obj                     read A.G. Jones file and set attributes.</span>
<span class="sd">    =====================================================================================</span>
<span class="sd">     </span>
<span class="sd">    examples : </span>
<span class="sd">                &gt;&gt;&gt; from csamtpy.ff.core.cs import CSAMT</span>
<span class="sd">                &gt;&gt;&gt; profile_stn=&#39;K1.stn&#39;</span>
<span class="sd">                &gt;&gt;&gt; for ii in [&#39;csi000.dat&#39;, &#39;testemap3.edi&#39;, &#39;K1.AVG&#39;]:</span>
<span class="sd">                        path =  os.path.join(os.environ[&quot;pyCSAMT&quot;], </span>
<span class="sd">                                          &#39;csamtpy&#39;,&#39;data&#39;, ii)</span>
<span class="sd">                </span>
<span class="sd">                        csamt_obj = CSAMT(fn = path, profile_fn= os.path.join(os.path.dirname(path), file_stn))</span>
<span class="sd">                </span>
<span class="sd">                        ... print(csamt_obj.resistivity[&#39;S00&#39;])</span>
<span class="sd">                        ... print(csamt_obj.phase[&#39;S00&#39;])</span>
<span class="sd">                        ... print(csamt_obj.phase_err[&#39;S00&#39;])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">profile_fn</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">Site</span> <span class="o">=</span><span class="n">Site</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span> <span class="o">=</span><span class="n">Location</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Profile</span> <span class="o">=</span><span class="n">Profile</span><span class="p">()</span>
   
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_xy</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_yx</span> <span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="o">=</span><span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res_err</span><span class="o">=</span><span class="kc">None</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_phs</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_phs_err</span> <span class="o">=</span><span class="kc">None</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="kc">None</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="o">=</span> <span class="n">data_fn</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_pfn</span> <span class="o">=</span><span class="n">profile_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fpath</span> <span class="o">=</span><span class="kc">None</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;savepath&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">key</span>  <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fpath</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_csamt_objs</span><span class="p">()</span>

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">lat</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span> 
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">lon</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span> 
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">elev</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">elevation</span> 

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">east</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">easting</span> 
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">north</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">northing</span> 
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">station</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Site</span><span class="o">.</span><span class="n">stn_name</span> 
   
    
    
    <span class="c1">#----- SET ATTRIBUTES ---------</span>
    
    <span class="nd">@station</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">station</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Site</span><span class="o">.</span><span class="n">stn_name</span> <span class="o">=</span> <span class="n">stn</span> 
        
    <span class="nd">@elev</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">elev</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elev</span><span class="p">)</span> <span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="n">elev</span> 
        
    <span class="nd">@lat</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">lat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span> <span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span><span class="n">latitude</span> 
        
    <span class="nd">@lon</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">lon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="n">longitude</span> 
    <span class="nd">@north</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">north</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">northing</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">northing</span> <span class="o">=</span><span class="n">northing</span>
    <span class="nd">@east</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">east</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">easting</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">easting</span> <span class="o">=</span><span class="n">easting</span>
        
      
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">fpath</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        assert path and redirect to file either single file  ,edifiles or Jfiles. </span>
<span class="sd">        find the specific path [EDI|J] path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CSAMT</span><span class="o">.</span><span class="n">find_path</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="p">)</span>
    
 

    <span class="k">def</span> <span class="nf">_read_csamt_objs</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read cs object and set attributes . </span>
<span class="sd">        actualy can read J.Avg and Edifile</span>
<span class="sd">        fn : str : full path to csamtfile either edi , avg or jfile</span>
<span class="sd">        path : str :  can be (1) : --&gt; edipath : str : full path to edifiles : edi directory</span>
<span class="sd">                             (2)--&gt;jpath : str: full path to AG.Jones files : j directory</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reading &lt;</span><span class="si">%s</span><span class="s2">&gt; file from &lt;</span><span class="si">%s</span><span class="s2">&gt; &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_csamt_objs</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="o">=</span> <span class="n">fn</span> 
     
        <span class="c1"># if path is not None : self._path =path </span>
        
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">fpath</span> <span class="o">==</span><span class="s1">&#39;isfile&#39;</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="n">inFO</span><span class="o">.</span><span class="n">_sensitive</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span><span class="s1">&#39;avg&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_read_avg_obj</span><span class="p">(</span><span class="n">avgfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">inFO</span><span class="o">.</span><span class="n">_sensitive</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span><span class="s1">&#39;edi&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_read_edi_obj</span><span class="p">(</span><span class="n">edi_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="n">inFO</span><span class="o">.</span><span class="n">_sensitive</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span><span class="s1">&#39;j&#39;</span><span class="p">:</span>  
                    <span class="bp">self</span><span class="o">.</span><span class="n">_read_j_obj</span><span class="p">(</span><span class="n">j_fn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span>  <span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Currently  pyCSAMT work with &quot;edi&quot;, &quot;j&quot; and &quot;avg&quot; file. &#39;</span>\
                              <span class="s1">&#39;Please provided one amomg them.&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;It seems file provided &lt;</span><span class="si">%s</span><span class="s1">&gt; does not match &quot;edi&quot; nor &quot;avg&quot; nor &quot;j&quot; file.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_file_handling</span><span class="p">(</span><span class="s1">&#39;Error reading &lt;</span><span class="si">%s</span><span class="s1">&gt; file. Please check your file.&#39;</span><span class="o">%</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">)</span> <span class="p">)</span>
                
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpath</span>   <span class="o">==</span><span class="s1">&#39;edipath&#39;</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_edi_obj</span><span class="p">(</span><span class="n">edi_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span>  <span class="p">)</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpath</span> <span class="o">==</span><span class="s1">&#39;jpath&#39;</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_j_obj</span><span class="p">(</span><span class="n">j_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span>  <span class="p">)</span>
            
            
        
    <span class="k">def</span> <span class="nf">_read_edi_obj</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read edifiles and populates important attributes </span>
<span class="sd">        </span>
<span class="sd">        edi_fn: str : full path to edifile,  can be  edi directory , where edifiles are located .</span>
<span class="sd">        Note : To call multiple edifiles ,  set only the path where edifiles are located </span>
<span class="sd">        dont need to call edifile one by one </span>
<span class="sd">         eg :(1)  read only on edifile  : </span>
<span class="sd">                     &gt;&gt;&gt; from csamtpy.ff.core.cs import CSAMT </span>
<span class="sd">                     &gt;&gt;&gt; path = r&#39;C:/Users\Administrator\Desktop\test\edirewrite&#39;&#39;</span>
<span class="sd">                     &gt;&gt;&gt;csamt_obj = CSAMT(data_fn = os.path.join(path, &#39;csi000.dat&#39;))</span>
<span class="sd">                     ... print(csamt_obj.resistivity[&#39;S00&#39;])</span>
<span class="sd">                     ... print(csamt_obj.lat)</span>
<span class="sd">                     ... print(csamt_obj.freq)</span>
<span class="sd">             </span>
<span class="sd">             (2) read multiple edifiles : --&gt; set only the path where edifiles are located.</span>
<span class="sd">             </span>
<span class="sd">                     &gt;&gt;&gt; from csamtpy.ff.core.cs import CSAMT </span>
<span class="sd">                     &gt;&gt;&gt; csamt_obj = CSAMT( data_fn = edipath )</span>
<span class="sd">                     ... print(csamt_obj.resistivity[&#39;S05&#39;])</span>
<span class="sd">                     ... print(csamt_obj.resistivity_err[&#39;S00&#39;])</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reading &lt;</span><span class="si">%s</span><span class="s2">&gt; edifile from edi_obj &quot;</span><span class="o">%</span> <span class="n">edi_fn</span><span class="p">)</span>
         
        <span class="k">if</span> <span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="o">=</span><span class="n">edi_fn</span>
        
        <span class="c1"># if self._fn is not None : </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpath</span>  <span class="o">==</span><span class="s1">&#39;edipath&#39;</span><span class="p">:</span> <span class="c1">#---&gt; set the path then collect all jfiles .</span>
        
            <span class="n">edifiles</span> <span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">,</span> <span class="n">eddfile</span><span class="p">)</span> <span class="k">for</span> <span class="n">eddfile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">)</span> <span class="k">if</span> <span class="n">eddfile</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.edi&#39;</span><span class="p">)]</span>
        
        <span class="c1"># if edifile is not None : self._fn =edifile </span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpath</span>  <span class="o">==</span> <span class="s1">&#39;isfile&#39;</span> <span class="p">:</span> <span class="c1">#-- &gt; once only edifile is provided then put on list ...</span>
            <span class="n">edifiles</span> <span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">]</span>

        <span class="n">edi_obj</span> <span class="o">=</span> <span class="n">CSAMTedi</span><span class="o">.</span><span class="n">Edi_collection</span><span class="p">(</span><span class="n">list_of_edifiles</span> <span class="o">=</span><span class="n">edifiles</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Compute Z impedance Tensor  and set attributes. _ Func &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_edi_obj</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">res_xy</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_res_err</span> <span class="o">=</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">res_err_xy</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_phs_err</span> <span class="o">=</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">phs_err_xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phs</span> <span class="o">=</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">phs_xy</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_xy</span> <span class="o">=</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">z_xy</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_yx</span> <span class="o">=</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">z_yx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_err_xy</span> <span class="o">=</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">z_err_xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_err_yx</span> <span class="o">=</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">z_err_yx</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">freq_array</span>
        
    
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">latitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="o">=</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">longitude</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">convert_location_2_utm</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">easting</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">northing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">elevation</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">id</span>
        
        
        
    <span class="k">def</span> <span class="nf">_read_j_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j_fn</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">jpath</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read AG. JONES files and populate attributes </span>
<span class="sd">        j_fn : str : full path to AG Jones format or full path to all jfiles .</span>

<span class="sd">        Note : To call multiple jfiles ,  set only the path where jfiles are located </span>
<span class="sd">        dont need to call jfile one by one .</span>

<span class="sd">         eg :(1)  read single jfile : </span>
<span class="sd">                     &gt;&gt;&gt; from csamtpy.ff.core.cs import CSAMT </span>
<span class="sd">                     &gt;&gt;&gt; path = r&#39;C:/Users\Administrator\Desktop\pyCS_datasets\testj&#39;</span>
<span class="sd">                     </span>
<span class="sd">                     &gt;&gt;&gt;csamt_obj = CSAMT(fn = os.path.join(data_fn, &#39;csi000.dat&#39;))</span>
<span class="sd">                     ... print(csamt_obj.resistivity[&#39;S00&#39;])</span>
<span class="sd">                     ... print(csamt_obj.lat)</span>
<span class="sd">                     ... print(csamt_obj.freq)</span>
<span class="sd">             </span>
<span class="sd">             (2) read multiple files : --&gt; set only the path where jfiles are located.</span>
<span class="sd">             </span>
<span class="sd">                     &gt;&gt;&gt; from csamtpy.ff.core.cs import CSAMT </span>
<span class="sd">                     &gt;&gt;&gt; csamt_obj = CSAMT( data_fn = path )</span>
<span class="sd">                     ... print(csamt_obj.resistivity[&#39;S05&#39;])</span>
<span class="sd">                     ... print(csamt_obj.lat)</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reading &lt;</span><span class="si">%s</span><span class="s2">&gt; edifile from edi_obj &quot;</span><span class="o">%</span> <span class="n">j_fn</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">j_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="o">=</span><span class="n">j_fn</span> 
        
        <span class="c1"># if self._fn is not None : </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpath</span> <span class="o">==</span><span class="s1">&#39;jpath&#39;</span><span class="p">:</span>        <span class="c1">#---&gt; set the path then collect all jfiles .</span>
            <span class="n">jfiles</span> <span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">,</span> <span class="n">jjfile</span><span class="p">)</span> <span class="k">for</span> <span class="n">jjfile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">)]</span>

                <span class="c1"># if jfile is not None : self._fn = jfile </span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpath</span> <span class="o">==</span><span class="s1">&#39;isfile&#39;</span> <span class="p">:</span>  <span class="c1">#-- &gt; once only jfile is provided then put on list ...</span>
                <span class="n">jfiles</span> <span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fn</span><span class="p">]</span>
                

        <span class="n">j_obj</span> <span class="o">=</span> <span class="n">CSAMTj</span><span class="o">.</span><span class="n">J_collection</span><span class="p">(</span><span class="n">list_of_jfiles</span><span class="o">=</span> <span class="n">jfiles</span> <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">j_obj</span><span class="o">.</span><span class="n">longitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">j_obj</span><span class="o">.</span><span class="n">latitude</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">convert_location_2_utm</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span><span class="n">j_obj</span><span class="o">.</span><span class="n">id</span> 
        <span class="c1"># self.azim =np.stack ((self.east, self.north), axis= 1)</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span><span class="n">rhovalue</span> <span class="k">for</span> <span class="n">key</span> <span class="p">,</span> <span class="n">rhovalue</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="p">,</span> <span class="n">j_obj</span><span class="o">.</span><span class="n">app_rho</span><span class="p">)}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_phs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">phsvalue</span>  <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">phsvalue</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">.</span><span class="n">phase</span><span class="p">)}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_res_err</span> <span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">res_err</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="p">,</span> <span class="n">res_err</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="p">,</span>  <span class="n">j_obj</span><span class="o">.</span><span class="n">rhomax</span><span class="p">)}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_phs_err</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">phs_err</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_phs</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="p">,</span> <span class="n">phs_err</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="p">,</span> <span class="n">j_obj</span><span class="o">.</span><span class="n">phamax</span><span class="p">)</span> <span class="p">}</span>


        <span class="c1">#---&gt; get frequency through the first list of period element </span>
   
        <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">j_obj</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        
        <span class="c1"># self.z_err_xy , self._z_xy, self.z_err_yx , self._z_yx = [{} for ii in range(4)]</span>
        
        <span class="c1">#--- &gt; compute impedance Tensor and set attributes accordingly -----</span>
        
        <span class="c1">#--&gt; build Z_obj</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Compute Z impedance Tensor and set attributes. _ Func &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_j_obj</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_err_xy</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_z_xy</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">_z_yx</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="n">csamt_z_obj</span> <span class="o">=</span><span class="n">CSAMTz</span><span class="o">.</span><span class="n">Z</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
            <span class="c1"># csamt_obj =  CSAMTz.Z()</span>
            <span class="n">phs_array</span> <span class="p">,</span> <span class="n">phs_err_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="n">res_array</span> <span class="p">,</span> <span class="n">res_err_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="n">phs_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="p">,</span> <span class="n">phs_err_array</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs_err</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span>
            <span class="n">res_array</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="n">res_err_array</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="n">values</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res_err</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span>
  
            
            <span class="n">csamt_z_obj</span><span class="o">.</span><span class="n">set_res_phase</span><span class="p">(</span> <span class="n">res_array</span> <span class="o">=</span><span class="n">res_array</span> <span class="p">,</span><span class="n">phase_array</span> <span class="o">=</span> <span class="n">phs_array</span><span class="p">,</span>  
                                      <span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="p">,</span> 
                                      <span class="n">res_err_array</span><span class="o">=</span> <span class="n">res_err_array</span><span class="p">,</span>  <span class="n">phase_err_array</span><span class="o">=</span> <span class="n">phs_err_array</span><span class="p">)</span>
                                  
            <span class="bp">self</span><span class="o">.</span><span class="n">_z_err_xy</span> <span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">=</span> <span class="n">csamt_z_obj</span><span class="o">.</span><span class="n">z_err</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_z_xy</span> <span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">=</span> <span class="n">csamt_z_obj</span><span class="o">.</span><span class="n">z</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_z_yx</span> <span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">=</span> <span class="n">csamt_z_obj</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
        
      
    <span class="k">def</span> <span class="nf">_read_avg_obj</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avgfile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read Zonge Engineering AVg file and and set attributes </span>
<span class="sd">        avgfile : str : full path to avg file </span>
<span class="sd">        </span>
<span class="sd">        e.g : </span>
<span class="sd">                &gt;&gt;&gt; path =  os.path.join(os.environ[&quot;pyCSAMT&quot;], </span>
<span class="sd">                                  &#39;csamtpy&#39;,&#39;data&#39;, file_stn)</span>
<span class="sd">                &gt;&gt;&gt; from csampty.ff.core.cs import CSAMT</span>
<span class="sd">                &gt;&gt;&gt; csamt_obj = CSAMT(fn = os.path.join(os.path.dirname(path), file_1), profile_fn= path)</span>
<span class="sd">                ... print(csamt_obj.resistivity)</span>
<span class="sd">                ... print(csamt_obj.phase)</span>
<span class="sd">                ... print(csamt_obj.resistivity_err)</span>
<span class="sd">       </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">profile_fn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;profile_fn&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">profile_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_pfn</span> <span class="o">=</span> <span class="n">profile_fn</span> 
            
        
        <span class="n">northing</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;easting&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">easting</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;northing&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="n">latitude</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">longitude</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="n">elevation</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">utm_zone</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;utm_zone&#39;</span><span class="p">,</span> <span class="s1">&#39;49N&#39;</span><span class="p">)</span>
        
        <span class="c1">#---- . Build avg_obj and stn profile obj </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pfn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">Profile</span><span class="o">.</span><span class="n">read_stnprofile</span><span class="p">(</span><span class="n">profile_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pfn</span><span class="p">,</span> 
                                         <span class="n">easting</span> <span class="o">=</span><span class="n">easting</span><span class="p">,</span> 
                                         <span class="n">northing</span><span class="o">=</span> <span class="n">northing</span> <span class="p">,</span> 
                                         <span class="n">elevation</span> <span class="o">=</span><span class="n">elevation</span> <span class="p">,</span> 
                                         <span class="n">latitude</span> <span class="o">=</span><span class="n">latitude</span> <span class="p">,</span> 
                                         <span class="n">longitude</span> <span class="o">=</span><span class="n">longitude</span> <span class="p">)</span>
            
        <span class="c1"># profile_obj =Profile()</span>
        <span class="c1"># profile_obj.read_stnprofile(profile_fn =self._pfn , </span>
        <span class="c1">#                             easting =easting , </span>
        <span class="c1">#                             northing =northing ,</span>
        <span class="c1">#                             elevation  =elevation, </span>
        <span class="c1">#                             latitude =latitude , </span>
        <span class="c1">#                             longitude =longitude )</span>
        
        <span class="n">avg_obj</span> <span class="o">=</span> <span class="n">CSAMTavg</span><span class="o">.</span><span class="n">Avg</span><span class="p">(</span><span class="n">data_fn</span><span class="o">=</span><span class="n">avgfile</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Compute Z impedance Tensor,Rho and phase  and set attributes. _ Func &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_avg_obj</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="c1">#--- set attribute --- </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span><span class="n">avg_obj</span><span class="o">.</span><span class="n">Data_section</span><span class="o">.</span><span class="n">Resistivity</span><span class="o">.</span><span class="n">loc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station</span> <span class="o">=</span> <span class="n">avg_obj</span><span class="o">.</span><span class="n">Data_section</span><span class="o">.</span><span class="n">Station</span><span class="o">.</span><span class="n">names</span>
        
        <span class="n">emag_obj</span> <span class="p">,</span><span class="n">hmag_obj</span> <span class="o">=</span><span class="n">avg_obj</span><span class="o">.</span><span class="n">Data_section</span><span class="o">.</span><span class="n">Emag</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">avg_obj</span><span class="o">.</span><span class="n">Data_section</span><span class="o">.</span><span class="n">Hmag</span><span class="o">.</span><span class="n">loc</span>  
        <span class="n">c_var_emag_obj</span> <span class="p">,</span> <span class="n">c_var_hmag_obj</span> <span class="o">=</span> <span class="n">avg_obj</span><span class="o">.</span><span class="n">Data_section</span><span class="o">.</span><span class="n">pcEmag</span><span class="o">.</span><span class="n">loc</span> <span class="p">,</span> <span class="n">avg_obj</span><span class="o">.</span><span class="n">Data_section</span><span class="o">.</span><span class="n">pcHmag</span><span class="o">.</span><span class="n">loc</span>
        <span class="n">c_var_app_rho_obj</span> <span class="p">,</span> <span class="n">std_phase_obj</span> <span class="o">=</span><span class="n">avg_obj</span><span class="o">.</span><span class="n">Data_section</span><span class="o">.</span><span class="n">pcRho</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">avg_obj</span><span class="o">.</span><span class="n">Data_section</span><span class="o">.</span><span class="n">sPhz</span><span class="o">.</span><span class="n">loc</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">_res_err</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">Zcc</span><span class="o">.</span><span class="n">compute_sigmas_e_h_and_sigma_rho</span><span class="p">(</span><span class="n">pc_emag</span><span class="o">=</span> <span class="n">c_var_emag_obj</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                                                                      <span class="n">pc_hmag</span><span class="o">=</span> <span class="n">c_var_hmag_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">,</span>
                                                                      <span class="n">pc_app_rho</span><span class="o">=</span><span class="n">c_var_app_rho_obj</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                                                                      <span class="n">app_rho</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> 
                                                                      <span class="n">emag</span><span class="o">=</span> <span class="n">emag_obj</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                                                                      <span class="n">hmag</span><span class="o">=</span><span class="n">hmag_obj</span><span class="p">[</span><span class="n">key</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="c1"># phase value in Zonge AVG is on milirad , may convert into rad before to degree. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phs</span> <span class="o">=</span> <span class="p">{</span> <span class="n">stn</span><span class="p">:</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">phase_value</span> <span class="o">*</span><span class="mf">1e-3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">phase_value</span> <span class="ow">in</span> <span class="n">avg_obj</span><span class="o">.</span><span class="n">Data_section</span><span class="o">.</span><span class="n">Phase</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        
        <span class="c1"># self._freq = avg_obj.Data_section.Frequency.loc </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">=</span><span class="n">avg_obj</span><span class="o">.</span><span class="n">Data_section</span><span class="o">.</span><span class="n">Frequency</span><span class="o">.</span><span class="n">value</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_phs_err</span> <span class="o">=</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">sphz_value</span> <span class="o">/</span><span class="mi">100</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="k">for</span> <span class="n">stn</span> <span class="p">,</span> <span class="n">sphz_value</span>  <span class="ow">in</span>  <span class="n">std_phase_obj</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        
        <span class="c1">#--&gt; build Z_obj </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_err_xy</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_z_xy</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">_z_yx</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="n">csamt_z_obj</span> <span class="o">=</span><span class="n">CSAMTz</span><span class="o">.</span><span class="n">Z</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
            <span class="c1"># csamt_obj =  CSAMTz.Z()</span>
            <span class="n">phs_array</span> <span class="p">,</span> <span class="n">phs_err_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="n">res_array</span> <span class="p">,</span> <span class="n">res_err_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="n">phs_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="p">,</span> <span class="n">phs_err_array</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs_err</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span>
            <span class="n">res_array</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="n">res_err_array</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="n">values</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res_err</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span>
  
            
            <span class="n">csamt_z_obj</span><span class="o">.</span><span class="n">set_res_phase</span><span class="p">(</span> <span class="n">res_array</span> <span class="o">=</span><span class="n">res_array</span> <span class="p">,</span><span class="n">phase_array</span> <span class="o">=</span> <span class="n">phs_array</span><span class="p">,</span>  
                                      <span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_freq</span><span class="p">,</span> 
                                      <span class="n">res_err_array</span><span class="o">=</span> <span class="n">res_err_array</span><span class="p">,</span>  <span class="n">phase_err_array</span><span class="o">=</span> <span class="n">phs_err_array</span><span class="p">)</span>
                                  
            <span class="bp">self</span><span class="o">.</span><span class="n">_z_err_xy</span> <span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">=</span> <span class="n">csamt_z_obj</span><span class="o">.</span><span class="n">z_err</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_z_xy</span> <span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">=</span> <span class="n">csamt_z_obj</span><span class="o">.</span><span class="n">z</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_z_yx</span> <span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">=</span> <span class="n">csamt_z_obj</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        
        <span class="c1">#---&gt; set coordinates attributes </span>
        
        <span class="c1"># self.north= profile_obj.north</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Profile</span><span class="o">.</span><span class="n">north</span>
        <span class="c1"># self.east =profile_obj.east </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Profile</span><span class="o">.</span><span class="n">east</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">azim</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            
            <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">convert_location_2_latlon</span><span class="p">(</span><span class="n">utm_zone</span><span class="o">=</span><span class="n">utm_zone</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span>
        <span class="c1"># self.azim =profile_obj.azimuth</span>
        <span class="c1"># self.elev =profile_obj.elev</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Profile</span><span class="o">.</span><span class="n">elev</span>

    <span class="c1">#-----------------------------------------------------</span>
    <span class="c1"># reseetting specific attributes </span>
    <span class="c1">#----------------------------------------------------</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">freq</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> 
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">resistivity</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span> 
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">phase</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span><span class="p">:</span> <span class="n">value</span> <span class="o">%</span><span class="mi">90</span> <span class="k">for</span> <span class="n">stn</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> 
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">zxy</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_xy</span> 
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">zyx</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_yx</span> 
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">resistivity_err</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res_err</span> 
        
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">phase_err</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs_err</span> 
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">z_err</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_err_xy</span> 
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">dipolelength</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Profile</span><span class="o">.</span><span class="n">compute_dipolelength_from_coords</span><span class="p">(</span><span class="n">easting</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> 
                                                             <span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">skindepth</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span><span class="p">:</span> <span class="mi">503</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">resistivity</span> <span class="p">[</span><span class="n">stn</span><span class="p">]</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span> 
                <span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resistivity</span><span class="p">}</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">doi</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span>  <span class="mi">2</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">skindepth</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span>  <span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skindepth</span> <span class="p">}</span>
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">station_distance</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Profile</span><span class="o">.</span><span class="n">compute_dipolelength_from_coords</span><span class="p">(</span><span class="n">easting</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> 
                                                         <span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">station_separation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Profile</span><span class="o">.</span><span class="n">stn_separation</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> 
                                           <span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> 
                                           <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
 
    
    
    
<div class="viewcode-block" id="CSAMT.find_path"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.cs.CSAMT.find_path">[docs]</a>    <span class="nd">@staticmethod</span>    
    <span class="k">def</span> <span class="nf">find_path</span> <span class="p">(</span><span class="n">path</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ptol</span> <span class="o">=</span><span class="mf">0.7</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check path and return filepath , edipath or jpath .</span>
<span class="sd">        path : str : can be a file path or directory </span>
<span class="sd">        ptol : float : float =&lt;1 : tolerance that given by the program to judge if the number of typical file [EDI|J] </span>
<span class="sd">                                    to declare as path found is either &quot;edipath&quot; or &quot;jpath&quot; </span>
<span class="sd">                                    if none file is found return None </span>
<span class="sd">        return specific path </span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">return</span> 
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span> <span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;isfile&#39;</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                    <span class="n">ex</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;.edi&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="o">&gt;=</span> <span class="n">ptol</span> <span class="p">:</span><span class="k">return</span> <span class="s1">&#39;edipath&#39;</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">ptol</span> <span class="p">:</span> 
                        <span class="n">m</span><span class="o">=</span><span class="p">[]</span>
                        <span class="k">try</span> <span class="p">:</span> <span class="n">m</span><span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">inFO</span><span class="o">.</span><span class="n">_sensitive</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span> <span class="o">==</span><span class="s1">&#39;j&#39;</span> <span class="p">]</span>
                        <span class="k">except</span> <span class="p">:</span> <span class="k">pass</span> 
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">ptol</span> <span class="p">:</span><span class="k">return</span> <span class="s1">&#39;jpath&#39;</span>
                            
                    <span class="k">return</span> </div></div>
    
<span class="c1">#=================================================================================</span>
<span class="c1"># PROFILE CLASS </span>
<span class="c1">#=================================================================================</span>
    
<div class="viewcode-block" id="Profile"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.cs.Profile">[docs]</a><span class="k">class</span> <span class="nc">Profile</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Profile line of AVG data . </span>
<span class="sd">     Profile class deal with  AVG Zonge station file &quot;*.stn&quot; or SEG-EDI file. :</span>
<span class="sd">        argument : </span>
<span class="sd">            prifle_fn : str </span>
<span class="sd">                path to Zonge *STN file of SEG-EDI file </span>
<span class="sd">                </span>
<span class="sd">    Note : When Use SEG-EDI file ,module Edi will populate profile attribute . </span>
<span class="sd">            User dont need to call edi-file on this module . </span>
<span class="sd">            </span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    Attributes         Type        Explanation</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    Location            class      Location class for Easting Northing , azimuth </span>
<span class="sd">                                    details. </span>
<span class="sd">    profile_angle       float       If user doesnt Know the angle profile . </span>
<span class="sd">                                    He can use the method &quot;get_profile_angle&quot;  </span>
<span class="sd">                                    to get the value of  profile angle.</span>
<span class="sd">    stn_interval       (ndarray,1)  Array of station separation . </span>
<span class="sd">    dipole_length       float       Dipole length value  computed automatically.          </span>
<span class="sd">    lat/lon            (ndarray,1)  latitude/longitude of stations points . </span>
<span class="sd">    east/north         (ndarray,1)  Easting and northing of stations points.  </span>
<span class="sd">    azimuth            (ndarray,1)  Azimuth array stations .   </span>
<span class="sd">    ele                (ndarray,1)  Elevation array at each station points. </span>
<span class="sd">    stn_position       (ndarray,1)  Station position occupied ate each stations.</span>
<span class="sd">    </span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    </span>
<span class="sd">    Methods                    Description</span>
<span class="sd">    ========================= =================================================</span>
<span class="sd">    read_stnprofile             Read the profile file .</span>
<span class="sd">    get_profile_angle           Compute the profile line angle . </span>
<span class="sd">    reajust_coordinates_values  Reajustment of corrdinates values. </span>
<span class="sd">    straighten_profileline      Redress the profile line . </span>
<span class="sd">    rewrite_station_profile     Rewrite the station profile and generate </span>
<span class="sd">                                        a new stn file. </span>
<span class="sd">    stn_separation              Compute the stations separations .</span>
<span class="sd">    compute_dipolelength_from_coords       compute dipolelength</span>
<span class="sd">                          </span>
<span class="sd">    ======================= ===================================================</span>

<span class="sd">    More attributes can be added by inputing a key word dictionary</span>

<span class="sd">    e.g::       &gt;&gt;&gt; file_stn = &#39;K1.stn&#39;</span>
<span class="sd">                &gt;&gt;&gt; path =  os.path.join(os.environ[&quot;pyCSAMT&quot;], </span>
<span class="sd">                                      &#39;csamtpy&#39;,&#39;data&#39;, file_stn)</span>
<span class="sd">                &gt;&gt;&gt; profile =Profile (profile_fn=path)</span>
<span class="sd">                &gt;&gt;&gt; profile.straighten_profileline(X=profile.east, Y=profile.north,straight_type=&#39;n&#39;)</span>
<span class="sd">                &gt;&gt;&gt; profile.rewrite_station_profile(easting=profile.east, </span>
<span class="sd">                                                northing=profile.north, </span>
<span class="sd">                                                elevation =profile.elev, add_azimuth=True)</span>
<span class="sd">                ... separation = profile.stn_separation(easting = profile.east, northing =profile.north)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span> <span class="p">,</span> <span class="n">profile_fn</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span> <span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_fn</span> <span class="o">=</span><span class="n">profile_fn</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span> <span class="o">=</span><span class="n">Location</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Site</span> <span class="o">=</span><span class="n">Site</span><span class="p">()</span>
         
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stn_position</span> <span class="o">=</span><span class="kc">None</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">stn_interval</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="o">=</span><span class="kc">None</span> 
        
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">keys</span><span class="p">])</span>
        
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_stnprofile</span><span class="p">()</span>
            
    <span class="c1">#---- set profile properties -----</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">lat</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span> 
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">lon</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span> 
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">elev</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">elevation</span>  
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">north</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">northing</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">east</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">easting</span> 
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">stn_position</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">stn_pos</span>
  
    <span class="c1"># ---- set functions ----</span>
    <span class="nd">@lat</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">lat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span><span class="n">latitude</span> 

    <span class="nd">@lon</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">lon</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="n">longitude</span> 

    <span class="nd">@north</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">north</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">northing</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">northing</span> <span class="o">=</span><span class="n">northing</span>
        
    <span class="nd">@east</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">east</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">easting</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">easting</span> <span class="o">=</span> <span class="n">easting</span>
 
    <span class="nd">@elev</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">elev</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elevation</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="n">elevation</span> 
    <span class="nd">@stn_position</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">stn_position</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position_array</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">stn_pos</span> <span class="o">=</span> <span class="n">position_array</span>

        
    <span class="k">def</span> <span class="nf">read_stnprofile</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">easting</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">northing</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">elevation</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">split_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Meethod to read profile station file. user can use its special file .user can specify </span>
<span class="sd">        a head of its file. method will read and will parse easting , northing , elevation , or </span>
<span class="sd">        lon, lat, elev or station . User can also provided easting , northing and elevation value . </span>
<span class="sd">        </span>
<span class="sd">        params : </span>
<span class="sd">            profile_fn :str : path to station profile file </span>
<span class="sd">            split_type :str or NoneType : How data is separed . None == space.</span>
<span class="sd">            easting : array_like , 1 : easting coordinate (m), </span>
<span class="sd">            northing : array_like ,1 : northing coordinate value (m)</span>
<span class="sd">            </span>
<span class="sd">            lat : array_like  : latitude coordinate in degree </span>
<span class="sd">            lon : array_like  : longitude coordinate in degree</span>
<span class="sd">            azim : array_like : azimuth in degree .If not provided can computed automatically </span>
<span class="sd">            utm_zone :str :     survey utm zone : if not porvided and lat and lon is set , can compute automatically </span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">azim</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;azimuth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">utm_zone</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;utm_zone&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        

        <span class="n">_pflag</span> <span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">profile_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_fn</span> <span class="o">=</span><span class="n">profile_fn</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">_pflag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">easting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">northing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">_pflag</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">_pflag</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_fn</span>  <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">easting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">northing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span> 
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;Provided at least easting or lon or Northing or lat value or profile stn file.&#39;</span><span class="p">)</span>    
        

        <span class="k">if</span> <span class="n">_pflag</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inFO</span><span class="o">.</span><span class="n">_sensitive</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_fn</span> <span class="p">)</span> <span class="o">==</span><span class="s1">&#39;stn&#39;</span><span class="p">:</span> 
                <span class="n">ref</span><span class="o">=</span><span class="s1">&#39;none&#39;</span> 
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_fn</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;reaj&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                    <span class="n">ref</span> <span class="o">=</span><span class="s1">&#39;scalled&#39;</span>
   
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fn</span> <span class="p">:</span>
                    <span class="n">data_lines</span> <span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="n">readlines</span> <span class="p">()</span>
                    <span class="c1"># if user doesnt provide the split type : program will search automatically </span>
                    <span class="k">if</span> <span class="n">split_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                        <span class="n">split_type</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">stn_check_split_type</span><span class="p">(</span><span class="n">data_lines</span><span class="o">=</span><span class="n">data_lines</span><span class="p">)</span>
                    
                    <span class="c1"># in the case where user provide the file written by that software , ignore the  #healines start by &#39;&gt; or &#39;!</span>
                   
                    <span class="n">temp</span><span class="o">=</span><span class="p">[]</span>             <span class="c1"># rebuild a new data lines for safety</span>
                    <span class="k">for</span> <span class="n">hh</span> <span class="p">,</span> <span class="n">values</span>  <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_lines</span><span class="p">)</span> <span class="p">:</span> 
                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^&gt;&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;r^!&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="ow">is</span>  <span class="ow">not</span> <span class="kc">None</span> \
                            <span class="ow">or</span> <span class="n">values</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;++++++++&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span>  <span class="p">:</span> <span class="k">pass</span> 
                        <span class="k">else</span> <span class="p">:</span><span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;len&#39;</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;sta&#39;</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;azim&#39;</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">ref</span> <span class="o">=</span><span class="s1">&#39;pyCSAMT&#39;</span>    
                    <span class="n">data_lines</span><span class="o">=</span><span class="n">temp</span>
                    
                    <span class="n">decision</span> <span class="p">,</span> <span class="n">stn_headlines_id</span> <span class="o">=</span> <span class="n">_validate_stnprofile</span><span class="p">(</span><span class="n">profile_lines</span><span class="o">=</span> <span class="n">data_lines</span> <span class="p">,</span> <span class="n">spliting</span><span class="o">=</span><span class="n">split_type</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">decision</span> <span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;Please provide  for profile at least the Easting&#39;</span>\
                                                <span class="s1">&#39; and northing coordinates values or lat/lon values for parsing. &#39;</span><span class="p">)</span>
            
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">data_list_of_array</span><span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_type</span><span class="p">))</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span>  <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_lines</span><span class="p">)]</span>

                        <span class="n">data_array</span> <span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">concat_array_from_list</span><span class="p">(</span>
                            <span class="n">list_of_array</span><span class="o">=</span><span class="n">data_list_of_array</span><span class="p">,</span> <span class="n">concat_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1">#  catch atributes and set attributes wherever the position it takes on the *.stn files.</span>

                <span class="k">for</span> <span class="n">lab</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">stn_headlines_id</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="n">ref</span> <span class="o">==</span><span class="s1">&#39;scalled&#39;</span><span class="p">:</span> 
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;It seems the data &lt;</span><span class="si">{0}</span><span class="s2">&gt; is already scaled. We don&#39;t need to reascale. &quot;</span>\
                                      <span class="s2">&quot;To force rescalement , please use func.</span><span class="si">{Profile.reajust_coordinates_value}</span><span class="s2">. &quot;</span><span class="p">)</span>
                        <span class="n">coords_array</span> <span class="o">=</span> <span class="n">data_array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="n">index</span><span class="p">]</span>
                    <span class="k">else</span> <span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Rescalling stations positions from file &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span><span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_fn</span><span class="p">))</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Rescalling stations positions : Usually Zonge Hardware provides stations locations at each electrodes NOT in center of each dipoles. &#39;</span>\
                              <span class="s1">&#39;Station locations and EM component orientations are taken at each electrodes point.&#39;</span>\
                                  <span class="s1">&#39; So , we will rescale stations to dipole center position.&#39;</span>\
                                      <span class="s1">&#39; Distance will stay the same along profile but the number of points will be minus 1.&#39;</span><span class="p">)</span>
                        <span class="k">try</span> <span class="p">:</span>
                            <span class="n">coords_array</span> <span class="o">=</span><span class="n">cfunc</span><span class="o">.</span><span class="n">dipole_center_position</span><span class="p">(</span>
                                <span class="n">dipole_position</span> <span class="o">=</span> <span class="n">data_array</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="n">index</span><span class="p">])</span>
                        <span class="k">except</span> <span class="p">:</span><span class="k">pass</span> 
          
                    <span class="k">if</span> <span class="n">lab</span> <span class="o">==</span> <span class="n">inFO</span><span class="o">.</span><span class="n">suit</span><span class="o">.</span><span class="n">easting</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">lab</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="n">coords_array</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">lab</span> <span class="o">==</span> <span class="n">inFO</span><span class="o">.</span><span class="n">suit</span><span class="o">.</span><span class="n">northing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="ow">or</span> <span class="n">lab</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="n">coords_array</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">lab</span> <span class="o">==</span> <span class="n">inFO</span><span class="o">.</span><span class="n">suit</span><span class="o">.</span><span class="n">elevation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">lab</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;elev&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;elev&#39;</span><span class="p">,</span> <span class="n">coords_array</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">lab</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">coords_array</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">lab</span> <span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">coords_array</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ref</span> <span class="o">==</span><span class="s1">&#39;pyCSAMT&#39;</span><span class="p">:</span> 
                        <span class="k">if</span> <span class="n">lab</span><span class="o">==</span><span class="s1">&#39;len&#39;</span> <span class="ow">or</span> <span class="n">lab</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;len&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;stn_position&#39;</span><span class="p">,</span> <span class="n">coords_array</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lab</span><span class="o">==</span><span class="s1">&#39;azim&#39;</span> <span class="ow">or</span> <span class="n">lab</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;azim&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;azimuth&#39;</span><span class="p">,</span> <span class="n">coords_array</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">ref</span> <span class="o">==</span><span class="s1">&#39;none&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">inFO</span><span class="o">.</span><span class="n">suit</span><span class="o">.</span><span class="n">station</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;stn_position&#39;</span><span class="p">,</span> <span class="n">coords_array</span><span class="p">)</span>

            <span class="c1">#---- compute azimuth , station interval and dipole_length ---------</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">):</span> 
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">compute_azimuth</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> 
                                                    <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  
                <span class="bp">self</span><span class="o">.</span><span class="n">stn_interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_separation</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> 
                                                      <span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span><span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span> <span class="o">=</span> <span class="n">round_dipole_length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_interval</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
  
                
            
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span> 
                
                <span class="c1">#convert lat lon to utm and get the attribute easting and northing </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">convert_location_2_utm</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span>
                                                     <span class="n">latitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">compute_azimuth</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="n">northing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stn_interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_separation</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">easting</span><span class="p">,</span> 
                                                      <span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">northing</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span> <span class="o">=</span> <span class="n">round_dipole_length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_interval</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                
    
        
        <span class="k">elif</span> <span class="n">_pflag</span> <span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">_pflag</span> <span class="o">==</span><span class="mi">3</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="n">_pflag</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span> 
                <span class="k">assert</span> <span class="n">easting</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">northing</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;Easting and Northing must have the same size.&#39;</span>\
                                                                                <span class="s1">&#39; Easting|northing size are currentlysize is &lt;</span><span class="si">{0}</span><span class="s1">|</span><span class="si">{1}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">easting</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">northing</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span><span class="n">easting</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span><span class="n">northing</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">compute_azimuth</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="n">northing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="o">=</span><span class="n">azim</span> 
                
            <span class="k">elif</span> <span class="n">_pflag</span> <span class="o">==</span><span class="mi">3</span> <span class="p">:</span>
                <span class="k">assert</span> <span class="n">lat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">lon</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;Easting and Northing must have the same size.&#39;</span>\
                                                                                <span class="s1">&#39; lat|lon size are currentlysize is &lt;</span><span class="si">{0}</span><span class="s1">|</span><span class="si">{1}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lat</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">lon</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">convert_location_2_utm</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">lat</span> <span class="p">,</span> <span class="n">longitude</span><span class="o">=</span> <span class="n">lon</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">easting</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">easting</span>  
                <span class="bp">self</span><span class="o">.</span><span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">northing</span> 
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">compute_azimuth</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="n">northing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_position</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">compute_dipolelength_from_coords</span><span class="p">(</span><span class="n">easting</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stn_interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_separation</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> 
                                                      <span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">elevation</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elev</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span><span class="p">,),</span> <span class="o">.</span><span class="mi">0</span> <span class="p">)</span> <span class="c1"># set elevation to 0</span>
            <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="n">elevation</span> 

                                                        
            
    <span class="k">def</span> <span class="nf">get_profile_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">easting</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">northing</span> <span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to compute profile angle . </span>
<span class="sd">        params : </span>
<span class="sd">            easting : array_like , (ndarray,1): easting corrdinate of the station point </span>
<span class="sd">            northing :array-like , (ndarray,1): northing coordinate of station point.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">         profile _angle :  float : angle of profile in degrees. </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Computing _ profile angle of geoelectric strike.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">easting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="n">easting</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_location</span><span class="p">(</span><span class="s1">&#39;Easting coordinates must be provided . &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">northing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="o">=</span><span class="n">northing</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_location</span><span class="p">(</span><span class="s1">&#39;Northing coordinate must be provided.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> 
                
              <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">:</span> 
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_float</span><span class="p">(</span><span class="s1">&#39;Could not convert easting/northing to float.&#39;</span><span class="p">)</span>
                   
        <span class="c1"># use the one with the lower standard deviation</span>
        <span class="k">if</span> <span class="n">stats_import</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span> 
            <span class="n">profile1</span> <span class="o">=</span><span class="n">spSTATS</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)</span>
   
            <span class="n">profile2</span> <span class="o">=</span><span class="n">spSTATS</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Could not find scipy.stats, cannot use method linearRegression &#39;</span>
                  <span class="s1">&#39;check installation you can get scipy from scipy.org.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not find scipy.stats, cannot use method lineaRegress &#39;</span>
                    <span class="s1">&#39;check installation you can get scipy from scipy.org.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;Could not find scipy.stats, cannot use method lineaRegress &#39;</span>
                    <span class="s1">&#39;check installation you can get scipy from scipy.org.&#39;</span><span class="p">)</span>
            
        
        <span class="n">profile_line</span> <span class="o">=</span> <span class="n">profile1</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># if the profile is rather E=E(N), the parameters have to converted  into N=N(E) form:</span>
        
        <span class="k">if</span> <span class="n">profile2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">profile1</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
            <span class="n">profile_line</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">profile2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">profile2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">profile2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># if self.profile_angle is None:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">=</span> <span class="p">(</span><span class="mi">90</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">profile_line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">%</span> <span class="mi">180</span>

        <span class="c1"># otherwise: # have 90 degree ambiguity in strike determination# choose strike which offers larger angle with profile</span>
        <span class="c1"># if profile azimuth is in [0,90].</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----&gt; profile angle = </span><span class="si">{}</span><span class="s1"> degrees N.E&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span><span class="p">))</span>

        <span class="c1"># compute pseudo_elect</span>
        <span class="c1"># if self.geoelectric_strike is None :</span>
        <span class="k">if</span>  <span class="mi">0</span><span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">&lt;</span> <span class="mi">90</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">+</span> <span class="mi">90</span> 
        <span class="k">elif</span> <span class="mi">90</span><span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">&lt;</span> <span class="mi">180</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span><span class="mi">90</span>
        <span class="k">elif</span> <span class="mi">180</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">&lt;</span><span class="mi">270</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">+</span><span class="mi">90</span> 
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span> <span class="o">-</span><span class="mi">90</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">%</span> <span class="mi">180</span> 
            

        <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----&gt; Geoelectrike  strike = </span><span class="si">{}</span><span class="s1"> degrees N.E&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geoelectric_strike</span>
    
    <span class="nd">@staticmethod</span>              
    <span class="k">def</span> <span class="nf">reajust_coordinates_values</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stn_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">rewrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">savepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        simple staticmethod to reajut coordinates values and write new station file. Sometimes , for the reason of security , </span>
<span class="sd">        to keep confidential data before any publication , authors must reajust coordinates. This method can help us . </span>
<span class="sd">        by default , the reajustment substract value. to add value to you old coordiantes ,  use negative X and Y </span>
<span class="sd">        method offer possibility of output new file by setting write to True.</span>
<span class="sd">        By convention we use X as EASTING correction and Y for NORTHING correction.</span>
<span class="sd">        </span>
<span class="sd">        params : </span>
<span class="sd">            x : float : value for ajusting X coordinates _EASTING </span>
<span class="sd">            y : float : value for ajustig Y coordinates ._NORTHING</span>

<span class="sd">            stn_file : str : station profile file . it may be a STN file . </span>
<span class="sd">            rewrite : bool : rewrite a new station file after reajust coordinates. </span>
<span class="sd">            savepath : str : outdir pathLike to save your new profile file. </span>
<span class="sd">        </span>
<span class="sd">        returns : </span>
<span class="sd">                stations_pk : arraY_like :(ndarary,1) station profile pka value(m) . Electrode fixed point value.</span>
<span class="sd">                easting : array_like : (ndarray,1) : easting coordinate value (m)</span>
<span class="sd">                northing : array_like : (ndarray,1) : northing coordinate value (m)</span>
<span class="sd">                elevation : array_like :(ndarray,1) : evelation point  at each station (m)</span>
<span class="sd">                </span>
<span class="sd">        e:g:            &gt;&gt;&gt; stn_file =K1.stn</span>
<span class="sd">                        &gt;&gt;&gt; path =  os.path.join(os.environ[&quot;pyCSAMT&quot;],&#39;csamtpy&#39;,&#39;data&#39;, stn_file)</span>
<span class="sd">                        ... profile =Profile.reajust_coordinates_values(x=-300238.702 ,</span>
<span class="sd">                                                                        y=-2369.252 , </span>
<span class="sd">                                                                        stn_fn=path ,rewrite = True, savepath=None )</span>
<span class="sd">                                                                        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">elev</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">dot</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;station_pk&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
        <span class="n">east</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;easting&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">north</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;northing&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span> 
            <span class="k">try</span> <span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;Readjustment not possible with str number.&#39;</span>\
                                                <span class="s1">&#39; Please provide the right values of x and y .&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;In principle, readjustment is not possible with &#39;</span>\
                          <span class="s1">&#39;NoneType number . However , we gonna set X to 0.&#39;</span><span class="p">)</span>
            <span class="n">x</span><span class="o">=</span><span class="mf">0.</span> 
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">0.</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;In principle, readjustment is not possible with&#39;</span>\
                          <span class="s1">&#39; NoneType number . However , we gonna set Y to 0.&#39;</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">stn_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">east</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">north</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span> <span class="p">(</span><span class="s1">&#39;Not possible to reajust coordinates.&#39;</span>\
                               <span class="s1">&#39; Provide at least easting and northing values. &#39;</span><span class="p">)</span>
                
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_station</span><span class="p">(</span><span class="s1">&#39;Could not find station file &#39;</span>\
                                                <span class="s1">&#39;to read. Can not readjust profile coordinates.&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">elev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">elev</span><span class="o">=</span> <span class="mf">0.</span> 
            <span class="k">if</span> <span class="n">dot</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">dot</span> <span class="o">=</span><span class="mf">0.</span> 
        
        <span class="k">if</span> <span class="n">stn_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">inFO</span><span class="o">.</span><span class="n">_sensitive</span><span class="p">()</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">stn_fn</span> <span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span><span class="o">==</span><span class="s1">&#39;stn&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inFO</span><span class="o">.</span><span class="n">_sensitive</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">stn_fn</span> <span class="p">)</span> <span class="o">!=</span><span class="s1">&#39;stn&#39;</span><span class="p">:</span> 
                    <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;File provided &lt;</span><span class="si">{0}</span><span class="s1">&gt;is unacceptable. &#39;</span>\
                                                    <span class="s1">&#39;Please provide your right stn file.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stn_fn</span><span class="p">))</span>
            
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stn_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fn</span> <span class="p">:</span>
                <span class="n">fstn</span><span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="c1">#substract the info line generate by pyCSAMT when create a new STN file </span>
            <span class="k">for</span> <span class="n">ss</span> <span class="p">,</span> <span class="n">infolines</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fstn</span><span class="p">):</span> 
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^&gt;&#39;</span><span class="p">,</span> <span class="n">infolines</span><span class="p">)</span> <span class="ow">is</span>  <span class="kc">None</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^!&#39;</span><span class="p">,</span> <span class="n">infolines</span><span class="p">)</span> <span class="ow">is</span>  <span class="kc">None</span> <span class="p">:</span> 
                    <span class="n">fstn</span> <span class="o">=</span><span class="n">fstn</span><span class="p">[</span><span class="n">ss</span><span class="p">:]</span> <span class="c1"># that mean no info is on the file</span>
                    <span class="k">break</span>
                
            <span class="n">spT</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">stn_check_split_type</span><span class="p">(</span><span class="n">data_lines</span><span class="o">=</span> <span class="n">fstn</span><span class="p">)</span>
            <span class="n">headc</span> <span class="o">=</span> <span class="n">fstn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spT</span><span class="p">)</span>
            
            <span class="n">eastindex</span><span class="p">,</span><span class="n">dotindex</span> <span class="p">,</span><span class="n">northindex</span><span class="p">,</span>  <span class="n">elevindex</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">4</span><span class="p">)]</span>   <span class="c1"># initialise index values</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">headc</span><span class="p">):</span> <span class="c1"># get index . sometimes stn files are littel messy </span>
                
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;e&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;eas&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span> <span class="n">eastindex</span><span class="o">=</span> <span class="n">ii</span>
                <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;dot&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;sta&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span><span class="n">dotindex</span> <span class="o">=</span><span class="n">ii</span> 
                <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;n&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;nor&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span><span class="n">northindex</span> <span class="o">=</span> <span class="n">ii</span> 
                <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;h&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>  <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;elev&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span> <span class="n">elevindex</span> <span class="o">=</span> <span class="n">ii</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Prior to provide the right station profile file. The station file must have as headlines , at least :&#39;</span>\
                                  <span class="s1">&#39; [&quot;dot|sta, &quot;e|easting, &quot;n|northing, &quot;h|elev]. Only this head can be parsed.&#39;</span><span class="p">)</span>
                    
                    <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;Your station file profided is wrong. &#39;</span>\
                                                    <span class="s1">&#39;Only &lt;&quot;dot|sta, &quot;e|easting, &quot;n|northing, &quot;h|elevation&gt; can be parsed. &#39;</span><span class="p">)</span>

                
            <span class="n">dot</span><span class="p">,</span> <span class="n">east</span><span class="p">,</span> <span class="n">north</span> <span class="p">,</span> <span class="n">elev</span> <span class="o">=</span><span class="p">[[]</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fstn</span><span class="p">):</span>
                <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spT</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">item</span><span class="p">):</span> 
                    <span class="k">try</span> <span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">:</span><span class="k">pass</span> 
                    <span class="k">else</span> <span class="p">:</span> 
                        <span class="k">if</span> <span class="n">jj</span> <span class="o">==</span> <span class="n">eastindex</span> <span class="p">:</span> <span class="n">east</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">jj</span> <span class="o">==</span> <span class="n">northindex</span> <span class="p">:</span><span class="n">north</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">jj</span> <span class="o">==</span> <span class="n">elevindex</span> <span class="p">:</span> <span class="n">elev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">jj</span> <span class="o">==</span> <span class="n">dotindex</span> <span class="p">:</span> <span class="n">dot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
        
        <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span> <span class="p">,</span><span class="n">station_pk</span> <span class="p">,</span> <span class="n">elevation</span>  <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">east</span><span class="p">),</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">north</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dot</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elev</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">elevation</span><span class="o">.</span><span class="n">size</span>  <span class="o">&lt;</span><span class="mi">2</span> <span class="p">:</span> <span class="n">elevation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">east</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">station_pk</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span><span class="mi">2</span> <span class="p">:</span> <span class="n">station_pk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        
        <span class="c1"># easting += x</span>
        <span class="c1"># northing +=y</span>
        <span class="n">easting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">xx</span><span class="p">:</span> <span class="n">xx</span> <span class="o">+</span> <span class="n">x</span> <span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">easting</span> <span class="p">)</span>
        <span class="n">northing</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">yy</span><span class="p">:</span> <span class="n">yy</span> <span class="o">+</span> <span class="n">y</span> <span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">northing</span><span class="p">)</span> 
        
        <span class="k">if</span>  <span class="n">rewrite</span> <span class="ow">is</span>  <span class="kc">True</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="n">stn_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="n">spT</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span>
                <span class="n">run_fstn</span> <span class="o">=</span> <span class="n">easting</span><span class="o">.</span><span class="n">size</span>
            <span class="k">else</span> <span class="p">:</span><span class="n">run_fstn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fstn</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                
            <span class="n">stn_write_lines</span> <span class="o">=</span><span class="p">[]</span>
            <span class="n">stn_write_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{0:&lt;10}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;dot&quot;&quot;&quot;&#39;</span><span class="p">,</span><span class="n">spT</span><span class="p">),</span> 
                                            <span class="s1">&#39;</span><span class="si">{0:&gt;10}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;e&quot;&quot;&quot;&#39;</span><span class="p">,</span> <span class="n">spT</span><span class="p">),</span> 
                                            <span class="s1">&#39;</span><span class="si">{0:&gt;10}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;n&quot;&quot;&quot;&#39;</span><span class="p">,</span><span class="n">spT</span><span class="p">),</span> 
                                            <span class="s1">&#39;</span><span class="si">{0:&gt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;h&quot;&quot;&quot;&#39;</span><span class="p">)]))</span>
            <span class="n">stn_write_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">run_fstn</span> <span class="p">):</span>  <span class="c1"># skip the headline.</span>
                <span class="n">stn_write_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{0:&lt;7}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">station_pk</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">spT</span><span class="p">),</span> 
                                                <span class="s1">&#39;</span><span class="si">{:&gt;12.3f}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">easting</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">spT</span><span class="p">),</span> 
                                                 <span class="s1">&#39;</span><span class="si">{:&gt;12.3f}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">northing</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">spT</span><span class="p">),</span> 
                                                 <span class="s1">&#39;</span><span class="si">{:&gt;7}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elevation</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                                                <span class="p">]))</span>
                <span class="n">stn_write_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stn_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">fnew_</span><span class="o">=</span><span class="s1">&#39;STN</span><span class="si">{0}</span><span class="s1">_reaj&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>    
            <span class="k">else</span> <span class="p">:</span> <span class="n">fnew_</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">stn_fn</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_reaj&#39;</span>
            
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fnew_</span><span class="p">,</span> <span class="s1">&#39;.stn&#39;</span><span class="p">]),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span> <span class="p">:</span> 
                <span class="n">fid</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">stn_write_lines</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">savepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span><span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fnew_</span><span class="p">,</span> <span class="s1">&#39;.stn&#39;</span><span class="p">]),</span> <span class="n">savepath</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="n">savepath</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">savepath</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            
            
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">77</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; New &lt;</span><span class="si">{0}</span><span class="s1">&gt; station file has been rewritten.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">fnew_</span><span class="p">,</span> <span class="s1">&#39;.stn&#39;</span><span class="p">])))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; savepath : &lt;</span><span class="si">{0}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span> <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">77</span><span class="p">)</span>
                
            
        <span class="k">return</span> <span class="n">station_pk</span><span class="p">,</span> <span class="n">easting</span> <span class="p">,</span> <span class="n">northing</span> <span class="p">,</span> <span class="n">elevation</span>      
  
        
    <span class="k">def</span> <span class="nf">straighten_profileline</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">straight_type</span> <span class="o">=</span><span class="s1">&#39;classic&#39;</span><span class="p">,</span> <span class="n">reajust</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">output</span> <span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to straighten profile line . User can readjust corrdinate of profile by adding coordinate of </span>
<span class="sd">        readjustation . Method provides 3 type of straighten profile. Default is &quot;classic&quot;, it could be </span>
<span class="sd">        [&#39;natural or distorded&#39;, equidistant] . &quot;natural or distorded Type&quot; is not to straight a profile like a </span>
<span class="sd">        straight line but , it keeps the equidistant point of the station at normal place that the survey must be. </span>
<span class="sd">        sometimes on the field , crew may get around some obstacle and despite the line is not straight , the distance </span>
<span class="sd">        between station is distorded. Using &#39;distord or natural type &#39; , it will show the right place station must be.</span>
<span class="sd">        </span>
<span class="sd">        NB:  for easier approch we use X as easting and Y as northing. It may be change . </span>
<span class="sd">        </span>
<span class="sd">        params : X : array_like (ndarry, array,1): easting coordinates array. </span>
<span class="sd">                Y : array_like (ndarray,1) : northing coordinates array </span>
<span class="sd">                straigth_type : str : type of straighten . it could be &quot;equistant/egal&quot;, </span>
<span class="sd">                                                                        &quot; natural /distord&quot;</span>
<span class="sd">                                    default is &quot;classic&quot; .</span>
<span class="sd">                reajust : tuple : coordinates for reajustment : index 0 : --&gt; x </span>
<span class="sd">                                                               index 1 : --&gt; y</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Profile coordinate X&lt;</span><span class="si">{0}</span><span class="s1">&gt;, y&lt;</span><span class="si">{1}</span><span class="s1">&gt; &#39;</span>\
                            <span class="s1">&#39;are readjusting. Method to reajust is &lt;</span><span class="si">{2}</span><span class="s1">&gt;&#39;</span><span class="o">.</span>\
                                <span class="nb">format</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">straight_type</span><span class="p">))</span>
        

        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="n">X</span> 
        <span class="k">if</span> <span class="n">Y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="n">Y</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;No possible way to straighten up &#39;</span>\
                <span class="s1">&#39;the profile line . Please provide the right coordinates. &#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="o">.</span><span class="n">size</span> <span class="p">:</span> 
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;X and Y must be the same size. &#39;</span>\
                       <span class="s1">&#39;X has a size &lt;</span><span class="si">{0}</span><span class="s1">&gt; while Y has the size &lt;</span><span class="si">{1}</span><span class="s1">&gt;. Line cannot be redressed. &#39;</span>\
                         <span class="s1">&#39;Please provide the same size of both arrays&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">reajust</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reajust</span><span class="p">)</span> <span class="o">!=</span><span class="mi">2</span> <span class="p">:</span> 
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s2">&quot;Could not reajust coordinates beyond three values.&#39;</span><span class="se">\</span>
<span class="s2">                                                 Only x =reajust[0] and y=reajust[1] can be accepted. &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;We are computing dipolelength  to straight  profile. &#39;</span><span class="p">)</span>
                
                <span class="n">dipolLeng</span> <span class="p">,</span> <span class="n">stn_pk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_dipolelength_from_coords</span><span class="p">(</span>
                    <span class="n">easting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">northing</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;We are computing dipole length and we assume the stations coordinates are in the center of each dipole.&#39;</span>\
                              <span class="s1">&#39; Dipole Length is = </span><span class="si">{0}</span><span class="s1"> m and the total length is = </span><span class="si">{1}</span><span class="s1"> m.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dipolLeng</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dipolLeng</span> <span class="p">))</span>
                
            <span class="k">else</span> <span class="p">:</span> 
                <span class="n">stn_pk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Dipole length is = </span><span class="si">{0}</span><span class="s1"> m. Stations are assumed to be in center of each dipole.&#39;</span>\
                              <span class="s1">&#39; Total length is = </span><span class="si">{1}</span><span class="s1"> m&#39;</span><span class="o">.</span>\
                                  <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span><span class="p">,</span>
                                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span> <span class="p">))</span>
        
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">elev</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elev</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> 
            <span class="k">else</span> <span class="p">:</span> <span class="n">elev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span> <span class="n">REW</span> <span class="o">=</span><span class="kc">True</span> 
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">REW</span> <span class="o">=</span><span class="kc">False</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">reajust_coordinates_values</span><span class="p">(</span>
                                            <span class="n">easting</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="n">northing</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="p">,</span> 
                                            <span class="n">x</span><span class="o">=</span><span class="n">reajust</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">reajust</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">station_pk</span><span class="o">=</span><span class="n">stn_pk</span><span class="p">,</span> 
                                            <span class="n">rewrite</span><span class="o">=</span><span class="n">REW</span><span class="p">,</span> <span class="n">elevation</span><span class="o">=</span> <span class="n">elev</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---&gt;Locations coordinates are reajusting to straight profile and we&#39;ll add elevation.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s2">&quot;Locations coordinates are reajusting to straight profile and we&#39;ll top elevation.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^clas+&#39;</span><span class="p">,</span> <span class="n">straight_type</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="c1"># rj_factor = (self.east [-1] -self.east[0]) /(self.east.size -1) </span>
            <span class="c1"># r_east =np.ones_like(self.east)* np.arange(self.east.size)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rr</span><span class="p">:</span> <span class="n">rr</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                            <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">)</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rr</span><span class="p">:</span> <span class="n">rr</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span><span class="mi">1</span> <span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^eq+&#39;</span><span class="p">,</span> <span class="n">straight_type</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^nat+&#39;</span><span class="p">,</span> <span class="n">straight_type</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^dis+&#39;</span><span class="p">,</span> <span class="n">straight_type</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            
            <span class="c1">#a kind of straighthen with equisdistant value between station but not straight , king or natural aspect on the site . </span>
            <span class="n">rf_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">)</span> \
                              <span class="k">if</span> <span class="n">ii</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

            <span class="n">rf_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)</span> \
                              <span class="k">if</span> <span class="n">ii</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            
            <span class="n">temp_ee</span> <span class="p">,</span> <span class="n">temp_nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)</span> 
            <span class="n">temp_ee</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp_nn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span>  <span class="n">jj</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">temp_ee</span><span class="p">):</span> 
                <span class="k">if</span>  <span class="n">jj</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">temp_ee</span> <span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">[</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">rf_X</span>
            <span class="k">for</span>  <span class="n">jj</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">temp_nn</span><span class="p">):</span> 
                <span class="k">if</span>  <span class="n">jj</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">temp_nn</span> <span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">[</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">rf_Y</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="n">temp_ee</span> <span class="p">,</span> <span class="n">temp_nn</span> 
        
    <span class="k">def</span> <span class="nf">rewrite_station_profile</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">easting</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">northing</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">elevation</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> 
                                 <span class="n">area_name</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_azimuth</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For onother purpose , user can rewrite station_profile file by straightening profile throught</span>
<span class="sd">        reajusting location values. The rewritten file can be read by the app. </span>
<span class="sd">        params : easting : array_like : easting coordinates (m)</span>
<span class="sd">                northing :arrauy_like : northing coordinates (m): </span>
<span class="sd">                elevation :array_like :  elevation values (m):</span>
<span class="sd">                username : str :        name _of user </span>
<span class="sd">                add_azimuth : bool :    compute _azimuth using  positive down. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
    
        <span class="n">utm_zone</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;UTM_Zone&#39;</span><span class="p">,</span> <span class="s1">&#39;49N&#39;</span><span class="p">)</span>
        <span class="n">dipole_length</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dipole_length&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">output_name</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;output_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">savepath</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;savepath&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">output_name</span><span class="o">=</span><span class="s1">&#39;new_profile&#39;</span>

        <span class="n">write_profile_lines</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">area_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">area_name</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> 
        <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">username</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">easting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">easting</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">northing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">northing</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">elevation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;It seems you didnt provide any easting values nor northing value.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s2">&quot;You may provide value before rewriten station profile file.!&quot;</span><span class="p">)</span>
        
        <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{0:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&gt;LOCATION&#39;</span><span class="p">),</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="s2">&quot; </span><span class="si">{0:&lt;55}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">area_name</span><span class="p">)</span> <span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{0:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&gt;USERNAME&#39;</span><span class="p">),</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="s2">&quot; </span><span class="si">{0:&lt;55}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{0:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&gt;DATE&#39;</span><span class="p">),</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="s2">&quot; </span><span class="si">{0:&lt;70}</span><span class="s2">&quot;</span><span class="o">.</span>\
                                            <span class="nb">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">()))</span> <span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{0:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&gt;UTM_ZONE&#39;</span><span class="p">),</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="s2">&quot; </span><span class="si">{0:&lt;5}</span><span class="s2">-</span><span class="si">{1:&lt;7}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;WGS84&#39;</span><span class="p">,</span><span class="n">utm_zone</span><span class="p">)</span> <span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>    
        <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{0:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&gt;SOFTWARE&#39;</span><span class="p">),</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="s2">&quot; </span><span class="si">{0:55}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;pyCSAMT&#39;</span><span class="p">)</span> <span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">convert_location_2_latlon</span><span class="p">(</span><span class="n">utm_zone</span><span class="o">=</span><span class="n">utm_zone</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">convert_location_2_utm</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_azimuth</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">azim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Computing azimuth value.&#39;</span><span class="p">)</span>
                <span class="n">azim</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">compute_azimuth</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span>
                                            <span class="n">northing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">azim</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="ow">or</span> <span class="n">azim</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="c1"># recompute azimuth using extrapolation </span>
                    <span class="n">azim</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">compute_azimuth</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span>
                                            <span class="n">northing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    
        <span class="k">if</span> <span class="n">dipole_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Automatic dipole length calculation and stations position  values are set with.&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_dipolelength_from_coords</span><span class="p">(</span><span class="n">easting</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="n">northing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Dipole length is computing automatically and set station position with by default. Dipole length is =</span><span class="si">{0}</span><span class="s2"> m &#39;</span><span class="se">\</span>
<span class="s2">                          and length along the line is =</span><span class="si">{1}</span><span class="s2"> m .&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span><span class="p">))</span>
            
        <span class="k">elif</span> <span class="n">dipole_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span> <span class="o">=</span><span class="n">dipole_length</span> 

            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">infos</span><span class="p">(</span><span class="s1">&#39;We will set compute station position considering your dipole_length value provided. &#39;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;We will compute station position using your default dipole length .&#39;</span>\
                          <span class="s1">&#39;We will the new station step to &lt;</span><span class="si">{0}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span><span class="p">))</span>
            
            <span class="n">stn_position</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dipole_length</span> <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stn_position</span><span class="o">=</span> <span class="n">stn_position</span>
            
                
                
        <span class="n">normalize_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dd</span><span class="p">:</span> <span class="n">dd</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_position</span><span class="p">)</span>
        <span class="n">stnNames</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;S</span><span class="si">{0:02}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
        
        <span class="c1">#set elevation is not provided .set elevation to 0. </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span><span class="p">,),</span><span class="mf">0.</span><span class="p">)</span>
        <span class="c1">#write_data </span>

        <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{0:^5}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;sta&#39;</span><span class="p">),</span> <span class="s2">&quot;</span><span class="si">{0:^9}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;len(m)&#39;</span><span class="p">)]))</span>
        <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="s2">&quot;</span><span class="si">{0:^12}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&quot;&quot;east(m)&#39;</span><span class="p">,</span><span class="s1">&#39;&quot;&quot;north(m)&#39;</span><span class="p">,</span>
                                                                             <span class="s1">&#39;&quot;&quot;lat(Â°)&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&quot;long(Â°)&#39;</span><span class="p">,</span>
                                                                             <span class="s1">&#39;&quot;&quot;elev(m)&#39;</span><span class="p">]]))</span>
        <span class="k">if</span> <span class="n">add_azimuth</span>  <span class="p">:</span> 
            <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:^12}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;azim(Â°)&#39;</span><span class="p">))</span>
            <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">14</span><span class="p">)</span> <span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
        <span class="k">else</span> <span class="p">:</span><span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">14</span><span class="p">),</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
        
        
        <span class="k">for</span> <span class="n">ii</span>  <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="o">.</span><span class="n">size</span><span class="p">):</span> 
            
            <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{:&lt;5}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stnNames</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span> 
                                                   <span class="s1">&#39;</span><span class="si">{:&lt;7}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">normalize_distance</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
                                                   <span class="s1">&#39;</span><span class="si">{:&lt;11.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
                                                   <span class="s1">&#39;</span><span class="si">{:&lt;13.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">north</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span> 
                                                   <span class="s1">&#39;</span><span class="si">{:&lt;15.10f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span> 
                                                   <span class="s1">&#39;</span><span class="si">{:&lt;17.10f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span> 
                                                   <span class="s1">&#39;</span><span class="si">{:&lt;10.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elev</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                                               <span class="p">]))</span>
            <span class="k">if</span> <span class="n">add_azimuth</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span> 
                <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:&lt;7.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">azim</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
            <span class="n">write_profile_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">output_name</span><span class="p">,</span><span class="s1">&#39;.stn&#39;</span><span class="p">]),</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span> 
                <span class="n">fid</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">write_profile_lines</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">savepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">output_name</span><span class="p">,</span><span class="s1">&#39;.stn&#39;</span><span class="p">]),</span> <span class="n">savepath</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">stn_separation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">easting</span>  <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">northing</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span><span class="n">interpolate</span> <span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the station separation : Distance between every two stations . </span>
<span class="sd">        params : easting : array_like (ndarray, 1) : easting coordinates  </span>
<span class="sd">                northing : array_like (ndarray,1) : northing coordinates </span>
<span class="sd">                interpolate : bool : if interpolate is True , will extend to N+1 number</span>
<span class="sd">                                    to much excatly the number of electrode. if false , </span>
<span class="sd">                                    it match the number of dipole N. Defalut is False.</span>
<span class="sd">                                   </span>
<span class="sd">                </span>
<span class="sd">        returns : </span>
<span class="sd">            array of separation : ndarray,1 : separation value </span>
<span class="sd">            separation mean: float : average separation value . </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">easting</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">northing</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span><span class="s1">&#39;float&#39;</span><span class="p">):</span> 
            <span class="k">try</span> <span class="p">:</span>
                <span class="n">easting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">easting</span><span class="p">])</span>
                <span class="n">northing</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">northing</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s2">&quot;NoneType can not be computed.&quot;</span>\
                                                    <span class="s2">&quot;Please provide the right coordinates!.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">easting</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">northing</span><span class="o">.</span><span class="n">size</span> <span class="p">:</span><span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s2">&quot;Both coordinates array must have the same size.&#39;</span><span class="se">\</span>
<span class="s2">                                        The first argument size is &lt;</span><span class="si">{0}</span><span class="s2">&gt;, while the second is &lt;</span><span class="si">{1}</span><span class="s2">&gt;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">easting</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">northing</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        
        <span class="c1"># for kk in range(self.east.size): </span>
        <span class="c1">#     if kk &lt;=self.east.size -2 : </span>
        <span class="c1">#         np.sqrt((self.east[kk+1]-self.east[kk-1])**2 + (self.north[kk+1]-self.north[kk-1])**2)</span>
        <span class="n">stn_sep</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">easting</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">easting</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">northing</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">northing</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> \
                           <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">northing</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">if</span> <span class="n">kk</span> <span class="o">&lt;=</span><span class="n">northing</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">interpolate</span> <span class="ow">is</span> <span class="kc">True</span> <span class="p">:</span> 
            <span class="n">xx</span> <span class="p">,</span> <span class="n">xx_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stn_sep</span><span class="o">.</span><span class="n">size</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stn_sep</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> 
            <span class="n">ff</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">stn_sep</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
            <span class="n">stn_sep</span><span class="o">=</span> <span class="n">ff</span><span class="p">(</span><span class="n">xx_new</span><span class="p">)</span>
  

            
        <span class="k">return</span> <span class="n">stn_sep</span> <span class="p">,</span> <span class="n">stn_sep</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">compute_dipolelength_from_coords</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">northing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fonction to compute dipole length from coordinates easting and northing</span>
<span class="sd">        </span>
<span class="sd">        easting :array_like : array of easting coordinate in meters </span>
<span class="sd">        northing : array_like : array or northing coordinate in meters</span>
<span class="sd">        lat : array_like (ndarray,1) : latitude coordinate  in degree </span>
<span class="sd">        lon : array_like (ndarray,1) : longitude coordinate  in degree </span>
<span class="sd">        </span>
<span class="sd">        reference_ellipsoid : int :     id, Ellipsoid name, Equatorial Radius, square of eccentricity</span>
<span class="sd">                                        default is 23  --&gt;[23, &quot;WGS84&quot;, 6378137, 0.00669438] </span>
<span class="sd">        return : </span>
<span class="sd">            dipolelength : float : length of dipole during survey . approximated </span>
<span class="sd">            stn_pk : array_like(ndarray,1) : position of dipole from reference station : </span>
<span class="sd">                                            first electtrode to 0 and second electrode to dipole length </span>
<span class="sd">                                            ie [0, 50 , ..., nn*50] : nn number of point -1</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">latitude</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="n">longitude</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="n">reference_ellipsoid</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;reference_ellipsoid&#39;</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">easting</span> <span class="ow">is</span> <span class="ow">not</span>  <span class="kc">None</span>  <span class="ow">and</span> <span class="n">northing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">assert</span> <span class="n">easting</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">northing</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span>
                <span class="s1">&#39;Easting and Northing must have the same size.&#39;</span>\
                <span class="s1">&#39; Easting|northing size are currentlysize is &lt;</span><span class="si">{0}</span><span class="s1">|</span><span class="si">{1}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span>\
                    <span class="nb">format</span><span class="p">(</span><span class="n">easting</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">northing</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">assert</span> <span class="n">latitude</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">longitude</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> \
                <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;Latitude and longitude must have the same size.&#39;</span>\
                                           <span class="s1">&#39; Easting|northing size are currentlysize&#39;</span>\
                                               <span class="s1">&#39; is &lt;</span><span class="si">{0}</span><span class="s1">|</span><span class="si">{1}</span><span class="s1">&gt;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">easting</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">northing</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
            
            <span class="c1">#-- convert lat lon to easting northing </span>
            <span class="n">utm_zone</span> <span class="p">,</span> <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span> <span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">ll_to_utm</span><span class="p">(</span><span class="n">reference_ellipsoid</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> 
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;May input at least easting and &#39;</span>\
                                            <span class="s1">&#39;northing coordinates values or&#39;</span>\
                                                <span class="s1">&#39; latitude and longitude values.&#39;</span><span class="p">)</span>
            
            
        <span class="n">distance_east</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">easting</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">easting</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> 
                                  <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">easting</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">distance_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">northing</span><span class="p">[</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">northing</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> 
                                   <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">northing</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
        
        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">distance_east</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">distance_north</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">distance_east</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">])</span>
        <span class="n">dipole_length</span> <span class="o">=</span><span class="n">round_dipole_length</span><span class="p">(</span><span class="n">distance</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> 
        
        <span class="c1">#build stn_pk_position : </span>
            
        <span class="n">stn_pk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">ii</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">easting</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dipole_length</span><span class="p">)[</span><span class="n">ii</span><span class="p">]</span>
                           <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">easting</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dipole_length</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>

        
        
        <span class="k">return</span> <span class="n">dipole_length</span> <span class="p">,</span> <span class="n">stn_pk</span>    </div>

<span class="c1">#=================================================================================</span>
<span class="c1"># LOCATION CLASS </span>
<span class="c1">#=================================================================================</span>
                
<div class="viewcode-block" id="Location"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.cs.Location">[docs]</a><span class="k">class</span> <span class="nc">Location</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Details of sation location . Classe used to convert cordinnates and check </span>
<span class="sd">    values for lat/lon , east/north </span>
<span class="sd">    </span>
<span class="sd">    ================== ========================================================</span>
<span class="sd">    Attributes              Type                Description  </span>
<span class="sd">    ============================== ============================================</span>
<span class="sd">    latitude            float/ndarray,1         sation latitude </span>
<span class="sd">    longitude           float/ndarray,1         station longitude </span>
<span class="sd">    elevation           float/ndarray           station elevantion in m or ft </span>
<span class="sd">    easting             float/ndarray.1         station easting coordinate (m)</span>
<span class="sd">    northing            float/ndarray,1         station northing coordinate (m)</span>
<span class="sd">    azimuth             float/ndarray,1         station azimuth in meter </span>
<span class="sd">    stn_pos              ndarray,1              sation dipole position</span>
<span class="sd">    utm_zone            str                     UTM location zone </span>
<span class="sd">    </span>
<span class="sd">    ===========================================================================</span>
<span class="sd">    </span>
<span class="sd">    Followings method : </span>
<span class="sd">    ===========================================================================</span>
<span class="sd">    Methods                         Description </span>
<span class="sd">    ===========================================================================</span>
<span class="sd">    convert_location_2_utm          convert position location lon/lat in </span>
<span class="sd">                                    utm easting northing </span>
<span class="sd">    convert_location_2_latlon       convert location postion from east/north to</span>
<span class="sd">                                    latitude/longitude </span>
<span class="sd">        </span>
<span class="sd">    ===========================================================================</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span><span class="s1">&#39;WGS84&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latitude</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_longitude</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_easting</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_northing</span> <span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_utm_zone</span> <span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stn_pos</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_azimuth</span> <span class="o">=</span> <span class="kc">None</span> 
        
    
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">utm_zone</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utm_zone</span>
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latitude</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">longitude</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longitude</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">easting</span><span class="p">(</span><span class="bp">self</span> <span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_easting</span> 
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">northing</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_northing</span> 
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">stn_pos</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stn_pos</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">azimuth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">compute_azimuth</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">eas</span><span class="p">)</span> <span class="k">for</span> <span class="n">eas</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">easting</span><span class="p">]),</span>
                                            <span class="n">northing</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">nor</span><span class="p">)</span> <span class="k">for</span> <span class="n">nor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">northing</span><span class="p">]))</span>
        <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_azimuth</span> 
    
    <span class="c1">#-----------setting ---- </span>
    <span class="nd">@utm_zone</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">utm_zone</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">utm_zone</span><span class="p">):</span> 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">utm_zone</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Wrong UTM zone input. Must be a str number.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_location</span><span class="p">(</span><span class="s1">&#39;UTM Zone must be string, not &lt;</span><span class="si">{0}</span><span class="s1">&gt;type.&#39;</span><span class="o">.</span><span class="n">flroat</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">utm_zone</span><span class="p">)))</span>
        <span class="k">else</span> <span class="p">:</span> 
            <span class="k">try</span> <span class="p">:</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">utm_zone</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_location</span><span class="p">(</span><span class="s1">&#39;Error UTM Zone designator. Both first letters provided are not acceotable !&#39;</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">utm_zone</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">inFO</span><span class="o">.</span><span class="n">notion</span><span class="o">.</span><span class="n">utm_zone_dict_designator</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
                    <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_location</span><span class="p">(</span><span class="s1">&#39;Wrong UTM Zone letter designator. Letter must be among &lt;</span><span class="si">{0}</span><span class="s1">&gt;&#39;</span><span class="o">.</span>\
                                                     <span class="nb">format</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">inFO</span><span class="o">.</span><span class="n">notion</span><span class="o">.</span><span class="n">utm_zone_dict_designator</span><span class="o">.</span><span class="n">keys</span><span class="p">()))))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_utm_zone</span> <span class="o">=</span><span class="n">utm_zone</span>
    
    <span class="nd">@latitude</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">latitude</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span><span class="p">):</span> 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">)):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latitude</span><span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">assert_lat_value</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">gis</span><span class="o">.</span><span class="n">assert_lat_value</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">latitude</span> <span class="p">])</span>
        
    <span class="nd">@longitude</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">)</span> <span class="p">:</span> 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">)):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longitude</span><span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">assert_lon_value</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_longitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">gis</span><span class="o">.</span><span class="n">assert_lon_value</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="k">for</span>  <span class="n">lon</span> <span class="ow">in</span> <span class="n">longitude</span> <span class="p">])</span>
        
    <span class="nd">@elevation</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elevation</span><span class="p">)</span> <span class="p">:</span> 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elevation</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">)):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span><span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">assert_elevation_value</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">gis</span><span class="o">.</span><span class="n">assert_elevation_value</span> <span class="p">(</span><span class="n">elev</span><span class="p">)</span> <span class="k">for</span> <span class="n">elev</span> <span class="ow">in</span> <span class="n">elevation</span><span class="p">])</span> 
        
    <span class="nd">@easting</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">easting</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">easting</span><span class="p">):</span> 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">easting</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">)):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_easting</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">easting</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> 
            <span class="k">try</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_easting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="nb">float</span><span class="p">(</span><span class="n">east</span><span class="p">)</span> <span class="k">for</span> <span class="n">east</span> <span class="ow">in</span> <span class="n">easting</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">:</span><span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_float</span><span class="p">(</span><span class="s1">&#39;Easting must be float or an array of float number.&#39;</span><span class="p">)</span>
            
    <span class="nd">@northing</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">northing</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">northing</span><span class="p">):</span> 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">northing</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">)):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_northing</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">northing</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> 
            <span class="k">try</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_northing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">north</span><span class="p">)</span> <span class="k">for</span> <span class="n">north</span> <span class="ow">in</span> <span class="n">northing</span><span class="p">])</span>
        
            <span class="k">except</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_float</span><span class="p">(</span><span class="s1">&#39;northing must be float or an array of float number. &#39;</span><span class="p">)</span>
        
    <span class="nd">@stn_pos</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">stn_pos</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn_pk</span><span class="p">):</span> 
        <span class="k">try</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stn_pos</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">stn</span><span class="p">)</span> <span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">stn_pk</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span><span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_station</span><span class="p">(</span><span class="s1">&#39;Station pka must be float number.! &#39;</span><span class="p">)</span>


    <span class="nd">@azimuth</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">azimuth</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">easting_northing</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">easting_northing</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">easting_northing</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span><span class="mi">2</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_azimuth</span><span class="p">(</span><span class="s1">&#39;Azimuth expected to get two array_like(ndarray,2)&#39;</span><span class="p">)</span>                                                                                                    
        <span class="k">elif</span> <span class="n">easting_northing</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span><span class="mi">2</span> <span class="p">:</span> 
            <span class="n">easting</span> <span class="p">,</span> <span class="n">northing</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">easting_northing</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_azimuth</span> <span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">compute_azimuth</span><span class="p">(</span><span class="n">easting</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">eas</span><span class="p">)</span> <span class="k">for</span> <span class="n">eas</span> <span class="ow">in</span> <span class="n">easting</span><span class="p">]),</span>
                                           <span class="n">northing</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">nor</span><span class="p">)</span> <span class="k">for</span> <span class="n">nor</span> <span class="ow">in</span> <span class="n">northing</span><span class="p">]))</span>

<div class="viewcode-block" id="Location.convert_location_2_utm"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.cs.Location.convert_location_2_utm">[docs]</a>    <span class="k">def</span> <span class="nf">convert_location_2_utm</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span> <span class="o">=</span><span class="kc">None</span>  <span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        project coordinate to utm if coordinate are degrees.  given the reference ellipsoid,</span>
<span class="sd">        constrained to WGS84.</span>
<span class="sd">        params : latitude : float : latitude number </span>
<span class="sd">                longitude : float : longitude number </span>

<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">latitude</span>
        <span class="k">if</span> <span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span><span class="n">longitude</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># </span>
                <span class="k">assert</span>  <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_location</span><span class="p">(</span><span class="s1">&#39;latitude and longitude must be the same size.&#39;</span><span class="p">)</span> 
    
                <span class="bp">self</span><span class="o">.</span><span class="n">easting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">gis</span><span class="o">.</span><span class="n">ll_to_utm</span><span class="p">(</span><span class="n">reference_ellipsoid</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span>
                                              <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                              <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">northing</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="n">gis</span><span class="o">.</span><span class="n">ll_to_utm</span><span class="p">(</span><span class="n">reference_ellipsoid</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span>
                                              <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                              <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>
            
        <span class="k">else</span> <span class="p">:</span> 
            <span class="n">_data_info_utm</span> <span class="o">=</span><span class="n">gis</span><span class="o">.</span><span class="n">ll_to_utm</span><span class="p">(</span><span class="n">reference_ellipsoid</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span>
                                          <span class="n">lat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                                          <span class="n">lon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">utm_zone</span> <span class="o">=</span> <span class="n">_data_info_utm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">easting</span> <span class="o">=</span><span class="n">_data_info_utm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">northing</span><span class="o">=</span><span class="n">_data_info_utm</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span></div>
        
        
<div class="viewcode-block" id="Location.convert_location_2_latlon"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.cs.Location.convert_location_2_latlon">[docs]</a>    <span class="k">def</span> <span class="nf">convert_location_2_latlon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">utm_zone</span> <span class="o">=</span><span class="kc">None</span> <span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        project coodinate on longitude latitude once  data are utm . give referene ellispoid </span>
<span class="sd">        constrained to WGS-84.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utm_zone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utm_zone</span> <span class="o">=</span><span class="n">utm_zone</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utm_zone</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_location</span><span class="p">(</span><span class="s1">&#39;Try to input&#39;</span>\
                                                                     <span class="s1">&#39; the utm_zone : e.g.: 49N&#39;</span><span class="p">)</span>
            

        <span class="n">_data_info_ll</span> <span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">utm_to_ll</span><span class="p">(</span><span class="n">reference_ellipsoid</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span>
                                      <span class="n">northing</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">northing</span><span class="p">,</span> 
                                      <span class="n">easting</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">easting</span><span class="p">,</span> 
                                      <span class="n">zone</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_utm_zone</span> <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="o">=</span> <span class="n">_data_info_ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="n">_data_info_ll</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="Location.get_eastnorth_array_from_latlon"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.cs.Location.get_eastnorth_array_from_latlon">[docs]</a>    <span class="k">def</span> <span class="nf">get_eastnorth_array_from_latlon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arr_lat</span> <span class="p">,</span> <span class="n">arr_lon</span><span class="p">,):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to quicly convert array of latitude and northing into easting northing</span>
<span class="sd">        params : arr_lat : array_like : array of latitude value </span>
<span class="sd">                array_lon : array_like : array of longitude value. </span>
<span class="sd">        returns : </span>
<span class="sd">            easting : array_like : easting array </span>
<span class="sd">            nothing : array_like : northing array</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">array_easting</span> <span class="p">,</span> <span class="n">array_northing</span> <span class="o">=</span><span class="p">[[]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr_lat</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_location_2_utm</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span><span class="n">arr_lat</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                        <span class="n">longitude</span><span class="o">=</span><span class="n">arr_lon</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">array_easting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">easting</span><span class="p">)</span>
            <span class="n">array_northing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">northing</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array_easting</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array_northing</span><span class="p">)</span></div></div>
    
     
<span class="c1">#=================================================================================</span>
<span class="c1"># SITE CLASS </span>
<span class="c1">#=================================================================================</span>
<div class="viewcode-block" id="Site"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.cs.Site">[docs]</a><span class="k">class</span> <span class="nc">Site</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specific site object : Easy pack data :lat, lon, elev, azim, east, north, into dictionnary </span>
<span class="sd">        for easy access .</span>
<span class="sd">        arguments : </span>
<span class="sd">            data_fn :str , </span>
<span class="sd">                    path to site file . the same file as profile </span>

<span class="sd">        e:g:        &gt;&gt;&gt;  site=Site(data_fn=path)</span>
<span class="sd">    </span>
<span class="sd">                    &gt;&gt;&gt;  print(site.east[&#39;S07&#39;])</span>
<span class="sd">                    &gt;&gt;&gt;  print(site.north[&#39;S09&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sitedata</span> <span class="o">=</span><span class="n">data_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">=</span><span class="n">Location</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat</span> <span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_east</span><span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_north</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_azim</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_elev</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_len_stn</span><span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_stn_name</span><span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">utm_zone</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;utm_zone&#39;</span><span class="p">,</span> <span class="s1">&#39;49N&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">keys</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitedata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">set_site_info</span><span class="p">()</span>
            
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">stn_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stn_name</span> 
    <span class="nd">@stn_name</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">stn_name</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names_or_numbOfStations</span> <span class="p">):</span> 
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names_or_numbOfStations</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_stn_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S</span><span class="si">{0:02}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">names_or_numbOfStations</span><span class="p">)]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names_or_numbOfStations</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_stn_name</span> <span class="o">=</span> <span class="n">names_or_numbOfStations</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names_or_numbOfStations</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_stn_name</span> <span class="o">=</span><span class="n">names_or_numbOfStations</span>
            
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">lat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat</span> 
    <span class="nd">@lat</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">lat</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span><span class="n">latitude</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">latitude</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="o">=</span> <span class="n">latitude</span><span class="o">.</span><span class="n">size</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;You are not provided stations_names : We will defined stations names&#39;</span>\
                          <span class="s1">&#39; automatically starting by S-XX [</span><span class="si">{0}</span><span class="s1">,..,</span><span class="si">{1}</span><span class="s1">]so to zip data with latitude. If you dont want this station nomenclature &#39;</span>\
                          <span class="s1">&#39;please provide station names.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">)</span><span class="o">==</span> <span class="n">latitude</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>  <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_site</span><span class="p">(</span><span class="s1">&#39;Stations_names provided &#39;</span>\
                                  <span class="s1">&#39;must have the same size with latitude data. latitude size is &lt;</span><span class="si">{0}</span><span class="s1">&gt;&#39;</span><span class="o">.</span>\
                                      <span class="nb">format</span><span class="p">(</span><span class="n">latitude</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat</span> <span class="o">=</span><span class="p">{</span><span class="n">stn</span><span class="p">:</span><span class="n">lat</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">lat</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)}</span>
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">lon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon</span>
    <span class="nd">@lon</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">lon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">):</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="o">=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span> <span class="n">longitude</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">size</span> <span class="p">:</span><span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_site</span><span class="p">(</span><span class="s1">&#39;Station_names|longitude must&#39;</span>\
                                                                              <span class="s1">&#39; have the same size.Longitude size is &lt;</span><span class="si">{0}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">longitude</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon</span> <span class="o">=</span><span class="p">{</span><span class="n">stn</span><span class="p">:</span><span class="n">lon</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">lon</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">,</span> <span class="n">longitude</span><span class="p">)}</span>
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">elev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elev</span>
    <span class="nd">@elev</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">elev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elevation</span><span class="p">):</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="o">=</span> <span class="n">elevation</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elevation</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span> <span class="n">elevation</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">elevation</span><span class="o">.</span><span class="n">size</span> <span class="p">:</span><span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_site</span><span class="p">(</span><span class="s1">&#39;Station_names|Elevation must&#39;</span>\
                                            <span class="s1">&#39; have the same size.Elevation size is &lt;</span><span class="si">{0}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elevation</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_elev</span> <span class="o">=</span><span class="p">{</span><span class="n">stn</span><span class="p">:</span><span class="n">elev</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">elev</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">,</span> <span class="n">elevation</span><span class="p">)}</span> 
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">azim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_azim</span>
    <span class="nd">@azim</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">azim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">):</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="o">=</span> <span class="n">azimuth</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">azimuth</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span> <span class="n">azimuth</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">azimuth</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">azimuth</span><span class="o">.</span><span class="n">size</span> <span class="p">:</span><span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_site</span><span class="p">(</span><span class="s1">&#39;Station_names|Azimuth must&#39;</span>\
                                            <span class="s1">&#39; have the same size.Azimuth size is &lt;</span><span class="si">{0}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">azimuth</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_azim</span> <span class="o">=</span><span class="p">{</span><span class="n">stn</span><span class="p">:</span><span class="n">azim</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">azim</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">)}</span>   
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">north</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_north</span>
    <span class="nd">@north</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">north</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">northing</span><span class="p">):</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="o">=</span> <span class="n">northing</span><span class="o">.</span><span class="n">size</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;You are not provided stations_names : We will defenied stations names&#39;</span>\
                  <span class="s1">&#39; automatically starting by S-XX [</span><span class="si">{0}</span><span class="s1">,..,</span><span class="si">{1}</span><span class="s1">]so to zip data with latitude. If you dont want this station nomenclature &#39;</span>\
                  <span class="s1">&#39;please provide station names.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">northing</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span> <span class="n">northing</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">northing</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">northing</span><span class="o">.</span><span class="n">size</span> <span class="p">:</span><span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_site</span><span class="p">(</span><span class="s1">&#39;Station_names|Northing must&#39;</span>\
                                            <span class="s1">&#39; have the same size.Northing size is &lt;</span><span class="si">{0}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">northing</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_north</span><span class="o">=</span><span class="p">{</span><span class="n">stn</span><span class="p">:</span><span class="n">north</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">north</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">,</span> <span class="n">northing</span><span class="p">)}</span>  
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">east</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_east</span>
    <span class="nd">@east</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">east</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">easting</span><span class="p">):</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span> <span class="o">=</span> <span class="n">easting</span><span class="o">.</span><span class="n">size</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">easting</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span> <span class="n">easting</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">easting</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">)</span> <span class="o">!=</span> <span class="n">easting</span><span class="o">.</span><span class="n">size</span> <span class="p">:</span><span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_site</span><span class="p">(</span><span class="s1">&#39;Station_names|Easting must&#39;</span>\
                                            <span class="s1">&#39; have the same size.Easting size is &lt;</span><span class="si">{0}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">easting</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_east</span> <span class="o">=</span><span class="p">{</span><span class="n">stn</span><span class="p">:</span><span class="n">east</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">east</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn_name</span><span class="p">,</span> <span class="n">easting</span><span class="p">)}</span> 
        

<div class="viewcode-block" id="Site.set_site_info"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.cs.Site.set_site_info">[docs]</a>    <span class="k">def</span> <span class="nf">set_site_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_fn</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">easting</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">northing</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">utm_zone</span><span class="o">=</span><span class="s1">&#39;49N&#39;</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set-info from site file . Itmay use the profile fine from Zonge STN file. Once call it </span>
<span class="sd">        here , it may call profile in turn to populate attribute for easy access. </span>
<span class="sd">        </span>
<span class="sd">        params : data-fn : str , </span>
<span class="sd">                        path to site data file . may Use Stn or other file of coordinates infos. </span>
<span class="sd">                utm_zone : str </span>
<span class="sd">                        Utm zone WGS84 </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utm_zone</span> <span class="o">=</span> <span class="n">utm_zone</span> 
        <span class="k">if</span> <span class="n">data_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitedata</span> <span class="o">=</span> <span class="n">data_fn</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitedata</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="ow">and</span> <span class="n">easting</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="ow">and</span>  <span class="n">northing</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
            
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;Could not find the file to read. Please provide the right path.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitedata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sitedata</span><span class="p">)</span> <span class="p">:</span> 
                <span class="n">profile_obj</span> <span class="o">=</span><span class="n">Profile</span><span class="p">(</span><span class="n">profile_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sitedata</span><span class="p">)</span>
            
            <span class="k">else</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_profile</span><span class="p">(</span><span class="s1">&#39;Could not read such file. Please provide the right file.&#39;</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">easting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">northing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">profile_obj</span> <span class="o">=</span><span class="n">Profile</span><span class="p">()</span><span class="o">.</span><span class="n">read_stnprofile</span><span class="p">(</span><span class="n">easting</span> <span class="o">=</span><span class="n">easting</span><span class="p">,</span> <span class="n">northing</span> <span class="o">=</span><span class="n">northing</span><span class="p">)</span>
        
        <span class="c1">#call profile object and populate the missing coordinate lat/lon, or east/north </span>
        
        <span class="k">if</span> <span class="n">profile_obj</span><span class="o">.</span><span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">easting</span><span class="o">=</span><span class="n">profile_obj</span><span class="o">.</span><span class="n">east</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">northing</span> <span class="o">=</span><span class="n">profile_obj</span><span class="o">.</span><span class="n">north</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">convert_location_2_latlon</span><span class="p">(</span><span class="n">utm_zone</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">utm_zone</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span> 
        <span class="k">else</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="o">=</span><span class="n">profile_obj</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">profile_obj</span><span class="o">.</span><span class="n">lon</span> 

        <span class="k">if</span> <span class="p">(</span><span class="n">profile_obj</span><span class="o">.</span><span class="n">east</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">profile_obj</span><span class="o">.</span><span class="n">north</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span><span class="n">profile_obj</span><span class="o">.</span><span class="n">lat</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span><span class="n">profile_obj</span><span class="o">.</span><span class="n">lon</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">convert_location_2_utm</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> 
                                                 <span class="n">longitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span> 
    
            <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">easting</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">northing</span> 
            
        <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">north</span> <span class="o">=</span><span class="n">profile_obj</span><span class="o">.</span><span class="n">east</span><span class="p">,</span> <span class="n">profile_obj</span><span class="o">.</span><span class="n">north</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">elev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">azim</span> <span class="o">=</span><span class="n">profile_obj</span><span class="o">.</span><span class="n">elev</span> <span class="p">,</span> <span class="n">profile_obj</span><span class="o">.</span><span class="n">azimuth</span></div></div>
        

        
<span class="c1">#--------------- special functions -----------------</span>

<span class="k">def</span> <span class="nf">_validate_stnprofile</span><span class="p">(</span><span class="n">profile_lines</span><span class="p">,</span> <span class="n">spliting</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    validate station profile . check whether the label of stn file are present.</span>
<span class="sd">    number verification value is set to 2 at minimum matching at least the easting and </span>
<span class="sd">    the northing coodinates . </span>
<span class="sd">    params : profile_lines : list : reading lines </span>
<span class="sd">            spliting : str : type t0 split the stn line . </span>
<span class="sd">    </span>
<span class="sd">    return : </span>
<span class="sd">        ok : int , :  number of info provided </span>
<span class="sd">        head: list : head_stn infos and the index occupied in the file . </span>

<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">stn_label</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;dot&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;easting&#39;</span><span class="p">,</span>
                <span class="s1">&#39;northing&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="s1">&#39;elev&#39;</span><span class="p">,</span> <span class="s1">&#39;station&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;Northing&#39;</span><span class="p">,</span> <span class="s1">&#39;Easting&#39;</span><span class="p">,</span> <span class="s1">&#39;Elevation&#39;</span><span class="p">,</span><span class="s1">&#39;sta&#39;</span> <span class="p">,</span> 
                <span class="s1">&#39;east_Â°&#39;</span><span class="p">,</span> <span class="s1">&#39;north_Â°&#39;</span><span class="p">,</span> <span class="s1">&#39;east_DMS&#39;</span><span class="p">,</span> <span class="s1">&#39;north_DMS&#39;</span><span class="p">,</span>
                <span class="s1">&#39;UTM_zone&#39;</span><span class="p">,</span> <span class="s1">&#39;east_utm&#39;</span><span class="p">,</span> <span class="s1">&#39;north_utm&#39;</span><span class="p">,</span>   <span class="s1">&#39;azim_m&#39;</span><span class="p">,</span>  
                <span class="s1">&#39;elev_m&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;len&#39;</span> <span class="p">]</span>
    <span class="n">ok</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">stn_label</span> <span class="p">:</span> 
        <span class="k">if</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">profile_lines</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">ok</span> <span class="o">+=</span><span class="mi">1</span> 

    <span class="n">head_index</span> <span class="o">=</span><span class="p">[</span> <span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">jj</span><span class="p">)</span> <span class="k">for</span> <span class="n">jj</span> <span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">profile_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">spliting</span><span class="p">))</span> \
                  <span class="k">for</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">stn_label</span> <span class="k">if</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
    <span class="k">return</span>  <span class="n">ok</span><span class="p">,</span> <span class="n">head_index</span>   


<div class="viewcode-block" id="round_dipole_length"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.cs.round_dipole_length">[docs]</a><span class="k">def</span> <span class="nf">round_dipole_length</span><span class="p">(</span><span class="n">value</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    small function to graduate dipole length 5 to 5. Goes to be reality and </span>
<span class="sd">    simple computation .</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">mm</span> <span class="o">=</span> <span class="n">value</span> <span class="o">%</span> <span class="mi">5</span> 
    <span class="k">if</span> <span class="n">mm</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">:</span><span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">mm</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mm</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">mm</span> <span class="o">&lt;</span> <span class="mi">7</span> <span class="p">:</span><span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span><span class="n">mm</span> <span class="o">+</span><span class="mi">5</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span><span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">mm</span> <span class="o">+</span><span class="mf">10.</span><span class="p">)</span></div>
    


<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span> 
    
    <span class="n">file_1</span><span class="o">=</span><span class="s1">&#39;K1.AVG&#39;</span>
    <span class="n">file_2</span><span class="o">=</span><span class="s1">&#39;LCS01.avg&#39;</span>
    <span class="n">file_3</span><span class="o">=</span><span class="s1">&#39;LCS01_2_to_1.avg&#39;</span>
    
    <span class="n">testj</span><span class="o">=</span> <span class="s1">&#39;csi000.dat&#39;</span>
    <span class="n">testedi</span><span class="o">=</span><span class="s1">&#39;testemap3.edi&#39;</span>
    <span class="n">testavg</span> <span class="o">=</span><span class="s1">&#39;K1.AVG&#39;</span>
 
    <span class="n">file_stn</span><span class="o">=</span><span class="s1">&#39;K1.stn&#39;</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csi000.dat&#39;</span><span class="p">,</span> <span class="s1">&#39;testemap3.edi&#39;</span><span class="p">,</span> <span class="s1">&#39;K1.AVG&#39;</span><span class="p">]:</span>
        <span class="n">path</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;pyCSAMT&quot;</span><span class="p">],</span> 
                              <span class="s1">&#39;csamtpy&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">ii</span><span class="p">)</span>
    
        <span class="n">csamt_obj</span> <span class="o">=</span> <span class="n">CSAMT</span><span class="p">(</span><span class="n">data_fn</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">profile_fn</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">file_stn</span><span class="p">))</span>
        <span class="c1"># print(CSAMT.find_path(path =path))</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">csamt_obj</span><span class="o">.</span><span class="n">resistivity</span><span class="p">[</span><span class="s1">&#39;S00&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">csamt_obj</span><span class="o">.</span><span class="n">phase</span><span class="p">[</span><span class="s1">&#39;S00&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">csamt_obj</span><span class="o">.</span><span class="n">phase_err</span><span class="p">[</span><span class="s1">&#39;S00&#39;</span><span class="p">])</span>
        
    
    
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pyCSAMT v1.0.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Kouadio K. Laurent.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.0.
    </div>
  </body>
</html>