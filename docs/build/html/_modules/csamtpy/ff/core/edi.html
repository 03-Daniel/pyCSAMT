
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>csamtpy.ff.core.edi &#8212; pyCSAMT v1.0.01 documentation</title>
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pyCSAMT v1.0.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for csamtpy.ff.core.edi</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===============================================================================</span>
<span class="sd">    Copyright Â© 2021  Kouadio K.Laurent</span>
<span class="sd">    </span>
<span class="sd">    This file is part of pyCSAMT.</span>
<span class="sd">    </span>
<span class="sd">    pyCSAMT is free software: you can redistribute it and/or modify</span>
<span class="sd">    it under the terms of the GNU Lesser General Public License as published by</span>
<span class="sd">    the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">    (at your option) any later version.</span>
<span class="sd">    </span>
<span class="sd">    pyCSAMT is distributed in the hope that it will be useful,</span>
<span class="sd">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">    GNU Lesser General Public License for more details.</span>
<span class="sd">    </span>
<span class="sd">    You should have received a copy of the GNU Lesser General Public License</span>
<span class="sd">    along with pyCSAMT.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>

<span class="sd">===============================================================================</span>

<span class="sd">.. module:: .</span>
<span class="sd">   :synopsis: Deal with EDI files.  The EDI class can read and write an .edi file</span>
<span class="sd">             file, the &#39;standard format&#39; of magnetotellurics.  Each section</span>
<span class="sd">             of the .edi file is given its own class, so the elements of each</span>
<span class="sd">             section are attributes for easy access.</span>
<span class="sd">             Edi file will write following the SEG document instructions ofr EMAP</span>
<span class="sd">             (Electromagnetic Array Profiling)</span>
<span class="sd">             ...</span>
<span class="sd">Created on Mon Jan 11 11:37:51 2021</span>

<span class="sd">@author: KouaoLaurent alias @Daniel03</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">csamtpy.utils.func_utils</span> <span class="k">as</span> <span class="nn">func</span>
<span class="kn">import</span> <span class="nn">csamtpy.ff.core.cs</span>  <span class="k">as</span> <span class="nn">CSobj</span>
<span class="kn">import</span> <span class="nn">csamtpy.ff.core.z</span> <span class="k">as</span> <span class="nn">MTz</span>
<span class="kn">from</span> <span class="nn">csamtpy.etc.</span> <span class="n">infos</span> <span class="kn">import</span> <span class="nn">suit</span> 
<span class="kn">from</span> <span class="nn">csamtpy.etc.infos</span> <span class="kn">import</span> <span class="n">_sensitive</span> <span class="k">as</span> <span class="n">SB</span> 
<span class="kn">from</span> <span class="nn">csamtpy.utils</span> <span class="kn">import</span> <span class="n">gis_tools</span> <span class="k">as</span> <span class="n">gis</span> 
<span class="kn">from</span> <span class="nn">csamtpy.utils</span> <span class="kn">import</span> <span class="n">exceptions</span> <span class="k">as</span> <span class="n">CSex</span>
<span class="kn">from</span> <span class="nn">csamtpy.utils._csamtpylog</span> <span class="kn">import</span> <span class="n">csamtpylog</span>

<span class="n">_logger</span> <span class="o">=</span> <span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="Edi_collection"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Edi_collection">[docs]</a><span class="k">class</span> <span class="nc">Edi_collection</span> <span class="p">:</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Super class to deal with Edifiles . Collect edifiles and set important properties </span>
<span class="sd">    form Controled Source audiofrequency magnetotelluRic ,two(2) components XY and YX will</span>
<span class="sd">    be set and calculated .</span>
<span class="sd">    </span>
<span class="sd">    arguments : list_of_edifiles : list : list of edifiles</span>
<span class="sd">                edipath : str : path to edifiles : </span>
<span class="sd">                                if no listis provided , provided </span>
<span class="sd">                survey_name : location name where the date where collected . if surveyname is None  </span>
<span class="sd">                can chech on edifiles. </span>
<span class="sd">                </span>
<span class="sd">    ================================================================================================</span>
<span class="sd">    Attributes               type                      Description </span>
<span class="sd">    ==================== ================= =========================================================</span>
<span class="sd">    edifiles                list            List of edifiles , defalut is None </span>
<span class="sd">    survey_name             str             location where edidata where collected </span>
<span class="sd">    Edi                     class           Ediclass for ediproperties </span>
<span class="sd">    Location                class           Location class for location properties </span>
<span class="sd">    longitude               ndarray, 1      array of longitude collected from edifiles</span>
<span class="sd">    latitude                ndarray,1       array of latitude collected from edifiles </span>
<span class="sd">    freq_array              nadarry,1       array of frequencies collected from edifiles </span>
<span class="sd">    elevation               ndarray ,1     array of elevation collected from edifiles. </span>
<span class="sd">    station_names          list            list of EDI dataId ; Use station id to work.</span>
<span class="sd">    res_xy|res_yx           dict           dict :{stn: res_xy|res_yx} </span>
<span class="sd">                                            ndarray value of resivities  from 2 comps xy|yx </span>
<span class="sd">    phs_xy|phs_yx           dict           dict :{stn: res_phs|phs_yx} </span>
<span class="sd">                                            ndarray value of phase from 2  comps xy|yx </span>
<span class="sd">    z_xy|res_yx             dict           dict :{stn: z_xy|z_yx}  (in degree)</span>
<span class="sd">                                            ndarray value of impedance from 2 comps xy|yx </span>
<span class="sd">    XX_err_xy| XX_err_yx    dict           dict  of error values :{stn: XX_err_xy|XX_err_yx} </span>
<span class="sd">                                            ndarray value of impedance from 2 comps xy|yx </span>
<span class="sd">                                            XX : res|phs|z  </span>
<span class="sd">                                            stn : name of site eg : stn :S00, S01 , .., Snn</span>
<span class="sd">    ================================================================================================</span>
<span class="sd">                &gt;&gt;&gt; from csamtpy.ff.core.edi import Edi_collection </span>
<span class="sd">                &gt;&gt;&gt; edilist = [os.path.join(path, edi)for edi in os.listdir (path) if edi.endswith(&#39;.edi&#39;)]</span>
<span class="sd">                ... edi_objs = Edi_collection(list_of_edifiles = edilist)</span>
<span class="sd">                ... print(edi_objs.res_xy[&#39;S01&#39;])</span>
<span class="sd">                ... print(edi_objs.phs_err_xy[&#39;S00&#39;])</span>
<span class="sd">                ... print(edi_objs.z_err_xy[&#39;S00&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_edifiles</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edipath</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span>  <span class="n">survey_name</span> <span class="o">=</span><span class="kc">None</span>  <span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">=</span> <span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="o">=</span><span class="n">list_of_edifiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">survey_name</span> <span class="o">=</span><span class="n">survey_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Edi</span> <span class="o">=</span><span class="n">Edi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span> <span class="o">=</span><span class="n">CSobj</span><span class="o">.</span><span class="n">Location</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span> <span class="o">=</span> <span class="kc">None</span> 
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">edipath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Getting edifiles from edipath &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span><span class="o">%</span> <span class="n">edipath</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span> <span class="p">,</span> <span class="n">ediobj</span><span class="p">)</span> <span class="k">for</span> <span class="n">ediobj</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">)</span> <span class="k">if</span> <span class="n">ediobj</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.edi&#39;</span><span class="p">)</span> <span class="p">]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">:</span> 
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;No edifiles found in the path provided &lt;</span><span class="si">%s</span><span class="s1">&gt;.&#39;</span>\
                          <span class="s1">&#39; Iseems the edipath does not match the right edipath.&#39;</span><span class="o">%</span> <span class="n">edipath</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;No edifiles detected. Please provided the right path.&#39;</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Number of edifiles found are &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">edipath</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span> <span class="p">(</span><span class="s1">&#39;May provided a least alist of edifiles or edipath where edifiles are located.&#39;</span>\
                           <span class="s1">&#39; None value cannot be computed.Please get check your path or your edilist. &#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;May provided a least alist of edifiles or edipath where edifiles are located.&#39;</span>\
                           <span class="s1">&#39; None value cannot be computed.Please get check your path or your edilist. &#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;Empty list and wrong edipath can not be read. Please provided either the list of edifiles &#39;</span>\
                                        <span class="s1">&#39;or the right edipath. None value can not be computed.&#39;</span><span class="p">)</span>
                
        <span class="c1">#---&gt; construction of georeference attributes : </span>
        <span class="k">for</span> <span class="n">_key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;_latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;_longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;_azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;_elevation&#39;</span><span class="p">,</span> <span class="s1">&#39;station_names&#39;</span><span class="p">]:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">_key</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>

        <span class="c1"># construction of impedances , resistivities and phasetensor attributes and set all to None value.</span>
        <span class="k">for</span> <span class="n">tensor</span>  <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;_z&#39;</span><span class="p">,</span> <span class="s1">&#39;_z_err&#39;</span><span class="p">,</span> <span class="s1">&#39;_z_det&#39;</span><span class="p">,</span><span class="s1">&#39;_res&#39;</span><span class="p">,</span> <span class="s1">&#39;_res_err&#39;</span><span class="p">,</span> <span class="s1">&#39;_res_det&#39;</span><span class="p">,</span><span class="s1">&#39;_phs&#39;</span><span class="p">,</span> <span class="s1">&#39;_phs_det&#39;</span><span class="p">,</span> <span class="s1">&#39;_phs_det_err&#39;</span>
                         <span class="p">]</span> <span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span> <span class="n">tensor</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
                                 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_collect_edifiles</span><span class="p">()</span>
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span>
    <span class="nd">@latitude</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">latitude</span>
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span>
    <span class="nd">@longitude</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span><span class="o">=</span> <span class="n">longitude</span>
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">elevation</span> 
    <span class="nd">@elevation</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elevation</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span><span class="n">elevation</span>
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">stnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_station_names</span>
    <span class="nd">@stnames</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">stnames</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_stations</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edi_stations</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">)</span> <span class="p">:</span> <span class="n">edi_stations</span> <span class="o">=</span> <span class="n">edi_stations</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edi_stations</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edi_stations</span><span class="p">):</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_station_names</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span>  <span class="c1"># use station id to work </span>
            <span class="k">else</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_station_names</span> <span class="o">=</span><span class="n">edi_stations</span>
            
      
    <span class="k">def</span> <span class="nf">_collect_edifiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edifiles_list</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ediobjs</span> <span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        collect edifiles and set appropriates attributes for eadh stations . </span>
<span class="sd">        params: edifiles_list : list : list of edifiles. </span>
<span class="sd">                ediobjs : obj class : can provided from  class built.</span>
<span class="sd">        eg : </span>
<span class="sd">                    &gt;&gt;&gt; path =r&#39;F:\__main__csamt__\paper2_data_old\data_edifiles - numStations\K1_edi\new_EDI&#39;</span>
<span class="sd">                    &gt;&gt;&gt; edilist = [os.path.join(path, edi)for edi in os.listdir (path) if edi.endswith(&#39;.edi&#39;)]</span>
<span class="sd">                </span>
<span class="sd">                    ... edi_objs = Edi_collection._collect_edifiles(list_of_edifiles = edilist)</span>
<span class="sd">                    ... print(edi_objs.phs_xy[&#39;S01&#39;])</span>
<span class="sd">                    ... print(edi_objs.freq_array)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Collectiong edilfiles from &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span><span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">edifiles_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="o">=</span> <span class="n">edifiles_list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ediobjs</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;No edifiles found to read.Please check your right path &#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Building EDI object from edi files.&#39;</span><span class="p">)</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span><span class="o">=</span><span class="nb">sorted</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edi_obj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">Edi</span><span class="p">(</span><span class="n">edi_filename</span><span class="o">=</span> <span class="n">ediobj</span><span class="p">)</span> <span class="k">for</span>  <span class="n">ediobj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span> <span class="p">]</span>
            
        <span class="k">elif</span> <span class="n">ediobjs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">edi_obj_list</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ediobjs</span><span class="p">)</span>
            
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_obj_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s2">&quot;Can&#39;t read none value. Porvided at least one edifiles!&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Running list of &lt;</span><span class="si">%s</span><span class="s1">&gt; edifiles&#39;</span><span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of edifiles or stations read successfully = &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span><span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span><span class="p">))</span>

        <span class="n">sta</span> <span class="p">,</span> <span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span> <span class="n">elev</span> <span class="p">,</span> <span class="n">freq</span> <span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">zz_err</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">rho_err</span><span class="p">,</span> <span class="n">phs</span> <span class="p">,</span> <span class="n">phs_err</span> <span class="o">=</span><span class="p">[[]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">11</span><span class="p">)]</span>
             
        <span class="c1">#--&gt; set gereference attributes </span>
        
        <span class="k">for</span>  <span class="n">edi_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_obj_list</span> <span class="p">:</span> 
            <span class="n">sta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">dataid</span> <span class="p">)</span> 
            <span class="k">if</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">long</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">long</span><span class="o">=</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">DefineMeasurement</span><span class="o">.</span><span class="n">reflong</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Longitude of Headid &lt;</span><span class="si">{0}</span><span class="s1">&gt; has been set from Edi.DefineMeasurenement&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">dataid</span><span class="p">))</span>
                
            <span class="n">lon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">lat</span><span class="o">=</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">DefineMeasurement</span><span class="o">.</span><span class="n">reflat</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Latitude of Headid &lt;</span><span class="si">{0}</span><span class="s1">&gt; has been set from Edi.DefineMeasurenement&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">dataid</span><span class="p">))</span>
            <span class="n">lat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">elev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="n">edi_obj</span><span class="o">.</span><span class="n">DefineMeasurement</span><span class="o">.</span><span class="n">refelev</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Elevation of Headid &lt;</span><span class="si">{0}</span><span class="s1">&gt; has been set from Edi.DefineMeasurenement&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">dataid</span><span class="p">))</span>
            <span class="n">elev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">elev</span><span class="p">)</span>
            <span class="n">freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span> 
            
        <span class="c1"># ---&gt; get impednaces , phase tensor and resistivities values form ediobject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Setting impedances tensor , phases tensor and  resisvitivities values from ediobjs.&#39;</span><span class="p">)</span>
        
        <span class="n">zz</span><span class="o">=</span> <span class="p">[</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z</span> <span class="k">for</span> <span class="n">edi_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_obj_list</span><span class="p">]</span>
        <span class="n">zz_err</span><span class="o">=</span> <span class="p">[</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z_err</span> <span class="k">for</span> <span class="n">edi_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_obj_list</span><span class="p">]</span>

        <span class="n">rho</span><span class="o">=</span> <span class="p">[</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">resistivity</span> <span class="k">for</span> <span class="n">edi_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_obj_list</span><span class="p">]</span>
        <span class="n">rho_err</span><span class="o">=</span> <span class="p">[</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">resistivity_err</span> <span class="k">for</span> <span class="n">edi_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_obj_list</span><span class="p">]</span>

        <span class="n">phs</span><span class="o">=</span> <span class="p">[</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase</span> <span class="k">for</span> <span class="n">edi_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_obj_list</span><span class="p">]</span>
        <span class="n">phs_err</span><span class="o">=</span> <span class="p">[</span><span class="n">edi_obj</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase_err</span> <span class="k">for</span> <span class="n">edi_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_obj_list</span><span class="p">]</span>

         <span class="c1">#---&gt; set attribute on dictionnary </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S</span><span class="si">{0:02}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifiles</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="n">lon</span> <span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">elev</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_array</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># get frequency array from the first value of edifiles.</span>

        <span class="c1">#---&gt; set ino dictionnary the impdance and phase Tensor </span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Setting impedances, resistivities and phase tensors into dictionnaries.&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_z</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">zz</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span> <span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">zz_err</span><span class="p">)}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_res</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">rho</span><span class="p">)}</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_res_err</span> <span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">rho_err</span><span class="p">)}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_phs</span> <span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">phs</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phs_err</span> <span class="o">=</span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span> <span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">phs_err</span><span class="p">)}</span>
        
        <span class="c1"># self._phs_det ={key:value for key , value in zip (self.id, phs_det)} </span>
        <span class="c1"># self._phs_det_err ={key:value for key , value in zip (self.id, phs_det_err)} </span>
        
    <span class="c1">#---&gt; set a few pertinent atttributes thought components xy and yx </span>
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">res_xy</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">res</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">res_yx</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">res</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">res_err_xy</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">res_err</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">res_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res_err</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">res_err_yx</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">res_err</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">res_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res_err</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">z_xy</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">z</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">z_yx</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">z</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">z_err_xy</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">z_err</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">z_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">z_err_yx</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">z_err</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">z_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_err</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">phs_xy</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">phs</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">phs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">phs_yx</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">phs</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">phs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">phs_err_xy</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">phs_err</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">phs_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs_err</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">phs_err_yx</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="n">stn</span> <span class="p">:</span><span class="n">phs_err</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">stn</span><span class="p">,</span> <span class="n">phs_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs_err</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>
    

<div class="viewcode-block" id="Edi"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Edi">[docs]</a><span class="k">class</span> <span class="nc">Edi</span> <span class="p">:</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ediclass  is for especialy dedicated to .edi files, mainly reading and writing </span>
<span class="sd">    which are meant to follow the archaic EDI format put forward by SEG</span>
<span class="sd">      Can read impedance, Tipper and not spectra.To read spectra format</span>
<span class="sd">     please consult MTpy documentation . Best tool for MT developpement : </span>
<span class="sd">    https://mtpy2.readthedocs.io/en/develop/ or https://github.com/MTgeophysics/mtpy</span>

<span class="sd">    The Edi class contains a class for each major section of the .edi file.</span>

<span class="sd">    Frequency and components are ordered from highest to lowest frequency.</span>
<span class="sd">    arguments : </span>
<span class="sd">        </span>
<span class="sd">        edi_filename :  str : full path to .edi file to be read in.</span>
<span class="sd">                      *default* is None. If an .edi file is not None , that&#39;s </span>
<span class="sd">                      mean Edi is input&#39;, it isautomatically read in and </span>
<span class="sd">                      attributes of Edi are populated </span>


<span class="sd">   </span>
<span class="sd">    ===========================================================================</span>
<span class="sd">    Attributes            Description                                default</span>
<span class="sd">    ===================== ========================================== ==========</span>
<span class="sd">    edifile               Full path to edifile                          None</span>
<span class="sd">    </span>
<span class="sd">    MTEMAP                MT section or EMAP DataSection class, </span>
<span class="sd">                          contains basicinformation on the data </span>
<span class="sd">                          collected . Can read MT and EMAP section</span>

<span class="sd">    DefineMeasurement     DefineMeasurement class, contains</span>
<span class="sd">                          information on how the data was collected.</span>
<span class="sd">                          </span>
<span class="sd">    Head                  Head class, contains metadata on</span>
<span class="sd">                          where, when, and who collected the data</span>
<span class="sd">    Info                  Information class, contains information</span>
<span class="sd">                          on how the data was processed and how the</span>
<span class="sd">                          transfer functions where estimated.</span>
<span class="sd">                          </span>
<span class="sd">    Z                     Z class, contains the impedance data</span>
<span class="sd">                          </span>
<span class="sd">    block_size            number of data in one line.                7</span>
<span class="sd">    data_header_com       header string for each of the data         &#39;&gt;!****{0}****!&#39;</span>
<span class="sd">                           section</span>
<span class="sd">    bloc_num_format       string format of data.                     &#39; 16.6e&#39;</span>
<span class="sd">    _t_comps              components for tipper blocks</span>
<span class="sd">    _z_comps              components for impedance blocks</span>
<span class="sd">    _res_comps            resistivities components </span>
<span class="sd">    _phs_comps            phase components </span>
<span class="sd">    </span>
<span class="sd">    ============================================================================</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    Methods               Description</span>
<span class="sd">    ===================== =====================================================</span>
<span class="sd">    read_edi              Reads in an edi file and populates the associated</span>
<span class="sd">                          classes and attributes.</span>
<span class="sd">    write_edifile         Writes an .edi file following the EDI format given</span>
<span class="sd">                          the apporpriate attributes are filled.  Writes out</span>
<span class="sd">                          in impedance and Tipper format.</span>

<span class="sd">    _fill_data_array      Fill the impedance blocks, Tipper blocks if exists, </span>
<span class="sd">                         if the.edi file is in EMAP section, read_data compute data</span>
<span class="sd">                          to impedance , rho and phase .</span>
<span class="sd">    _write_components_blocks_mt      Write MT or EMAP components blocks for data</span>
<span class="sd">                                      blocks of the .edi file.</span>

<span class="sd">    ===================== =====================================================</span>
<span class="sd">   </span>
<span class="sd">     eg : </span>
<span class="sd">           &gt;&gt;&gt; import csamtpy.ff.core.edi as csedi</span>
<span class="sd">           </span>
<span class="sd">           &gt;&gt;&gt; path =  os.path.join(os.environ[&quot;pyCSAMT&quot;], &#39;csamtpy&#39;,&#39;data&#39;, file_edi_3)</span>
<span class="sd">           </span>
<span class="sd">           &gt;&gt;&gt; edihead= csedi.Head.get_header_list_from_edi(edi_fn=path)</span>
<span class="sd">           &gt;&gt;&gt; info_obj =csedi.Info.get_info_list_from_edi(edi_fn=path)</span>
<span class="sd">           </span>
<span class="sd">           &gt;&gt;&gt; edi_obj =csedi.Edi(edi_filename=path )</span>
<span class="sd">           &gt;&gt;&gt; edi_obj.write_edifile(new_edifilename=None, savepath =pathi)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="o">=</span><span class="n">edi_filename</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Head</span> <span class="o">=</span><span class="n">Head</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="o">=</span><span class="n">Info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DefineMeasurement</span> <span class="o">=</span><span class="n">DefineMeasurement</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MTEMAP</span> <span class="o">=</span><span class="n">MTEMAP</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span><span class="n">MTz</span><span class="o">.</span><span class="n">Z</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span> <span class="o">=</span><span class="n">MTz</span><span class="o">.</span><span class="n">Tipper</span><span class="p">()</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="mi">6</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">data_head_com</span> <span class="o">=</span><span class="s1">&#39;&gt;!****</span><span class="si">{0}</span><span class="s1">****!</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bloc_num_format</span>  <span class="o">=</span><span class="s1">&#39; 15.6e&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span> <span class="n">_z_comps</span> <span class="o">=</span> <span class="p">[</span><span class="n">zz</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="k">for</span> \
                          <span class="n">zz</span> <span class="ow">in</span> <span class="n">SB</span><span class="o">.</span><span class="n">_edi</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^&gt;Z&quot;</span><span class="p">,</span> <span class="n">zz</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">_t_comps</span> <span class="o">=</span> <span class="p">[</span><span class="n">tt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span>\
                         <span class="n">SB</span><span class="o">.</span><span class="n">_edi</span> <span class="k">if</span>  <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^&gt;T&quot;</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span><span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tt</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;EXP&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_res_comps</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span>\
                         <span class="n">SB</span><span class="o">.</span><span class="n">_edi</span> <span class="k">if</span>  <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^&gt;RHO&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_phs_comps</span> <span class="o">=</span> <span class="p">[</span><span class="n">phs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">phs</span> <span class="ow">in</span>\
                         <span class="n">SB</span><span class="o">.</span><span class="n">_edi</span> <span class="k">if</span>  <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^&gt;PHS&quot;</span><span class="p">,</span> <span class="n">phs</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_data_sectionline</span> <span class="o">=</span><span class="kc">None</span> 
       
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">read_edi</span> <span class="p">()</span>
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">lon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">lon</span>
    <span class="nd">@lon</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">lon</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">longitude</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span><span class="n">longitude</span> 
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">lat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">lat</span> 
    <span class="nd">@lat</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">lat</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">lat</span><span class="o">=</span><span class="n">latitude</span> 
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">elev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">elev</span> 
    <span class="nd">@elev</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">elev</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elevation</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span><span class="n">elevation</span>
        

<div class="viewcode-block" id="Edi.read_edi"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Edi.read_edi">[docs]</a>    <span class="k">def</span> <span class="nf">read_edi</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edifile</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read edifile and populate attribute to each data section of edi. </span>
<span class="sd">        params : edifile : str : full path to edifile </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s2">&quot;Reading &lt;</span><span class="si">{0}</span><span class="s2">&gt; edifile.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edifile</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">edifile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="o">=</span> <span class="n">edifile</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;NoneType can not read. Please provide at least an edifile.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifile</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;Can not find edifile to read. Please check your path.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="p">)</span> <span class="o">==</span><span class="s1">&#39;edi&#39;</span><span class="p">:</span> <span class="c1">#---&gt; read each section and populate attribute </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Head</span> <span class="o">=</span> <span class="n">Head</span><span class="o">.</span><span class="n">get_header_list_from_edi</span><span class="p">(</span><span class="n">edi_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Info</span> <span class="o">=</span> <span class="n">Info</span><span class="o">.</span><span class="n">get_info_list_from_edi</span><span class="p">(</span><span class="n">edi_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edifile</span><span class="p">)</span>   
            <span class="bp">self</span><span class="o">.</span><span class="n">DefineMeasurement</span> <span class="o">=</span> <span class="n">DefineMeasurement</span><span class="o">.</span><span class="n">get_DefineMeasurement_info</span><span class="p">(</span><span class="n">edi_fn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edifile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MTEMAP</span> <span class="o">=</span> <span class="n">MTEMAP</span><span class="o">.</span><span class="n">get_mtemap_section_list</span><span class="p">(</span><span class="n">edi_fn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">edi_data_sectionline</span> <span class="o">=</span> <span class="n">MTEMAP</span><span class="o">.</span><span class="n">start_data_lines_num</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_specific_comp</span><span class="p">(</span><span class="n">edifile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifile</span><span class="p">)</span> <span class="c1">#read data section </span></div>
           
   
    <span class="k">def</span> <span class="nf">_get_specific_comp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edifile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_sect_line</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        method to get a specific components present on the data set . put all components into </span>
<span class="sd">        dictionnary  and data : </span>
<span class="sd">            eg : {&#39;zxxr&#39; :&lt;list of data zxxr&gt;, </span>
<span class="sd">                    &#39;zxyr&#39;:&lt;list of data zxyr&gt;, ...., &#39;zyyi&#39;:&lt;list data of zyyi&gt;}</span>
<span class="sd">        param : edifile : str : full path to edifile </span>
<span class="sd">                data_sect_line :int : number of line where data section start . Normally we dont need </span>
<span class="sd">                                it will be find automatically . For consistency , we will use this parameter again</span>
<span class="sd">                                and ask  whether it is not None. User dont need to add anaything provided that He know on </span>
<span class="sd">                                edifile where its data start. </span>
<span class="sd">                                &#39;default is None&#39;: fill automatycally </span>
<span class="sd">        return :comp_dict : dict : dictionnary of all component values get on edifiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Read &lt;get_specific_comp&gt; in edi_data section :edifile :</span><span class="si">{0}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">edifile</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">edifile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="o">=</span> <span class="n">edifile</span> 
        <span class="k">else</span> <span class="p">:</span><span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;Can not find edifile to read. NoneType can not be read. Check, your rigth path.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifile</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;No edifile file .Please check your edipath.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span><span class="s1">&#39;edi&#39;</span><span class="p">:</span> <span class="c1"># we assume that the file will check above , just to get to microsec running</span>
            <span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>  <span class="k">as</span> <span class="n">fedi</span> <span class="p">:</span> 
                <span class="n">edilines</span> <span class="o">=</span><span class="n">fedi</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">edi_data_section</span> <span class="o">=</span><span class="n">edilines</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_data_sectionline</span> <span class="p">:]</span> <span class="c1">#get all data section of edi </span>
            
        <span class="c1"># read data section and and put data on list of dict. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span> <span class="p">,</span> <span class="n">_flag</span><span class="o">=</span><span class="p">{},</span> <span class="mi">0</span> 
        
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">datalines</span> <span class="ow">in</span> <span class="nb">enumerate</span> <span class="p">(</span><span class="n">edi_data_section</span><span class="p">)</span> <span class="p">:</span> 
            <span class="n">keylines</span> <span class="o">=</span><span class="n">datalines</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;&gt;!&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keylines</span> <span class="ow">and</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">keylines</span> <span class="p">:</span>
                <span class="n">edi_lines</span> <span class="o">=</span> <span class="n">keylines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="c1"># out the &#39;&gt;</span>
                <span class="k">if</span> <span class="n">edi_lines</span><span class="o">==</span><span class="p">[]</span> <span class="ow">or</span> <span class="n">edi_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;&#39;</span><span class="ow">or</span> <span class="n">edi_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span><span class="kc">None</span> <span class="p">:</span> <span class="k">continue</span> <span class="c1"># these assement to be sure that we met a none line  </span>
                <span class="n">compkey</span> <span class="o">=</span><span class="n">edi_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">compkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_z_comps</span> <span class="ow">or</span> <span class="n">compkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t_comps</span> <span class="ow">or</span>\
                    <span class="n">compkey</span> <span class="o">==</span><span class="s1">&#39;freq&#39;</span> <span class="ow">or</span> <span class="n">compkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_res_comps</span> <span class="ow">or</span> <span class="n">compkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phs_comps</span><span class="p">:</span> 
                    <span class="n">_flag</span> <span class="o">=</span><span class="mi">1</span>                <span class="c1"># turn on light to find data </span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span> <span class="p">[</span><span class="n">compkey</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>  <span class="c1"># create dict of key and ready to fill value on list</span>
                <span class="k">else</span> <span class="p">:</span> <span class="n">_flag</span> <span class="o">=</span> <span class="mi">0</span>             <span class="c1"># turn off light to find data </span>
            
            <span class="k">elif</span> <span class="n">_flag</span> <span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">keylines</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;!&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>  <span class="ow">or</span> <span class="n">keylines</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> 
                <span class="n">data_lines</span> <span class="o">=</span><span class="n">keylines</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_lines</span><span class="p">):</span> 
                    <span class="k">try</span> <span class="p">:</span> 
                        <span class="n">data_lines</span> <span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> 
                        <span class="k">if</span> <span class="n">data_lines</span> <span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0e32</span> <span class="p">:</span> <span class="n">data_lines</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">=.</span><span class="mi">0</span> <span class="c1"># be sure to set all none value of ** value to 0.0</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">data_lines</span> <span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">compkey</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data_lines</span><span class="p">)</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_data_array</span><span class="p">(</span><span class="n">data_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">)</span>
                
        
    <span class="k">def</span> <span class="nf">_fill_data_array</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span> <span class="o">=</span><span class="kc">None</span>  <span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to fill Impedance Data bloc and Tipper blocks and Resistivities and data blocks if provided </span>
<span class="sd">        User dont need to provided data on dictionnay provided that your are sure that data providing respect </span>
<span class="sd">        SEG instructions. if not fill automatically by reading edifile .</span>
<span class="sd">        </span>
<span class="sd">        param : data_dict : dict : dictionnary of data  &lt; get from reading edifiles &gt; </span>
<span class="sd">                                    default is None : fill automatically </span>
<span class="sd">                                    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flag_freqOrder</span> <span class="o">=</span> <span class="mi">0</span>          <span class="c1">#frequency arranged to highest to lowest . if 1 mean is lower to highest </span>
        
        <span class="k">if</span> <span class="n">data_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span> <span class="o">=</span> <span class="n">data_dict</span>
        <span class="k">elif</span> <span class="n">data_dict</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span><span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;None value found. Can not read data&#39;</span><span class="p">)</span>
        
        <span class="c1"># get frequency array and initialise z_array and Z_error </span>
        <span class="n">freq_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">z_array</span> <span class="p">,</span> <span class="n">z_error_array</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">freq_array</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">,</span> <span class="mi">2</span><span class="p">),</span><span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">),</span>\
                                                <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="n">freq_array</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        
                               
        <span class="k">if</span> <span class="n">freq_array</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="o">&gt;</span> <span class="n">freq_array</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Data originally come to lower to highest frequency.&#39;</span>\
                                <span class="s1">&#39; We gonna set to Highest to lower frequency&#39;</span><span class="p">)</span>
            <span class="n">flag_freqOrder</span>  <span class="o">=</span> <span class="mi">1</span>                 <span class="c1"># set flag to 1 mean value arerange to lowest to hightest                              </span>
                                                
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 

            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;zxxr&#39;</span> <span class="p">:</span>
                <span class="n">z_array</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;i&#39;</span><span class="p">]</span> <span class="p">)</span>  
                <span class="n">z_error_array</span> <span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.var&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;zxyr&#39;</span> <span class="p">:</span>
                <span class="n">z_array</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;i&#39;</span><span class="p">])</span>  
                <span class="n">z_error_array</span> <span class="p">[:</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.var&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;zyxr&#39;</span> <span class="p">:</span>
                <span class="n">z_array</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;i&#39;</span><span class="p">])</span>  
                <span class="n">z_error_array</span> <span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.var&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;zyyr&#39;</span> <span class="p">:</span>
                <span class="n">z_array</span><span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;i&#39;</span><span class="p">])</span>  
                <span class="n">z_error_array</span> <span class="p">[:</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.var&#39;</span><span class="p">]))</span>

                                  
    
        <span class="k">if</span> <span class="n">flag_freqOrder</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> 
            <span class="c1">#--&gt;  return matrice to high to low order </span>
            <span class="n">z_array</span>  <span class="p">,</span> <span class="n">z_error_array</span><span class="p">,</span> <span class="n">freq_array</span>  <span class="o">=</span> <span class="n">z_array</span> <span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">z_error_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">freq_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1">#---&gt; call Zmodule and populate attributes </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">_freq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">_z_err</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">_z</span> <span class="p">,</span><span class="o">=</span><span class="n">freq_array</span> <span class="p">,</span><span class="n">z_error_array</span><span class="p">,</span>  <span class="n">z_array</span> 
        
        
        <span class="k">if</span> <span class="s1">&#39;zrot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span> <span class="p">(</span><span class="n">freq_array</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span> <span class="c1"># fill  zeros value as Zrot </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">compute_resistivity_phase</span><span class="p">()</span> <span class="c1"># compute resistivity and phase </span>
        
        
        <span class="n">_flagTip</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t_comps</span> <span class="p">:</span> 
                <span class="n">_flagTip</span> <span class="o">=</span><span class="kc">True</span> 
                <span class="k">break</span> 
        <span class="k">if</span> <span class="n">_flagTip</span> <span class="o">==</span><span class="kc">True</span> <span class="p">:</span> 
            <span class="n">tip_array</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="n">freq_array</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span> 
            <span class="n">tip_error_array</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="n">freq_array</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="s1">&#39;trot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">rotation_angle</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="s1">&#39;trot&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s1">&#39;zrot&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span> <span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tipper</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span> <span class="p">(</span><span class="n">freq_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">tkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="o">.</span><span class="n">keys</span> <span class="p">():</span>
                <span class="k">if</span> <span class="n">tkey</span> <span class="o">==</span> <span class="s1">&#39;txr.exp&#39;</span><span class="p">:</span> 
                    <span class="n">tip_array</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">tkey</span><span class="p">])</span><span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)])</span><span class="c1"># txi.exp</span>
                    <span class="n">tip_array</span>  <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span><span class="p">[</span><span class="n">tkey</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;txr&#39;</span><span class="p">,</span> <span class="s1">&#39;tyr&#39;</span><span class="p">)])</span>\
                        <span class="o">+</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span> <span class="p">[</span><span class="n">tkey</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;txr&#39;</span><span class="p">,</span> <span class="s1">&#39;tyi&#39;</span><span class="p">)])</span>
                    <span class="n">tip_error_array</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span> <span class="p">[</span><span class="n">tkey</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;txr&#39;</span><span class="p">,</span> <span class="s1">&#39;txvar&#39;</span><span class="p">)]))</span>
                    <span class="n">tip_error_array</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp_dict</span> <span class="p">[</span><span class="n">tkey</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;txr&#39;</span><span class="p">,</span> <span class="s1">&#39;tyvar&#39;</span><span class="p">)]))</span>
                    
            <span class="k">if</span> <span class="n">flag_freqOrder</span> <span class="o">==</span><span class="mi">1</span> <span class="p">:</span> 
                <span class="n">tip_error_array</span><span class="p">,</span> <span class="n">tip_array</span><span class="p">,</span>  <span class="o">=</span> <span class="n">tip_error_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tip_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 

                <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">_freq</span> <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">_tipper</span> <span class="o">=</span> <span class="n">freq_array</span> <span class="p">,</span> <span class="n">tip_array</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">_tipper_err</span>  <span class="o">=</span> <span class="n">tip_error_array</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">compute_amp_phase</span> <span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">compute_mag_direction</span><span class="p">()</span>
        

    
<div class="viewcode-block" id="Edi.write_edifile"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Edi.write_edifile">[docs]</a>    <span class="k">def</span> <span class="nf">write_edifile</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">new_edifilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datatype</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> 
                       <span class="n">savepath</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_filter_array</span> <span class="o">=</span><span class="kc">None</span>  <span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to write edifiles from data setting oin attribute of Edi or from existing file. </span>
<span class="sd">        can write also EMAP data are filled attribute of EDI.</span>
<span class="sd">        param : edifile : str : new edifile name  . If None , will write edi using station_name </span>
<span class="sd">                                plus type of survey (MT of EMAP) plus year of writing as &lt; S00_emap.2021.edi&gt; or </span>
<span class="sd">                                                    &lt;S00_mt.2021.edi&gt;</span>
<span class="sd">                datatype : str : type of file : &quot;mt&quot; or &quot;emap&quot; if None , program will detect which file is provided . </span>
<span class="sd">                                                if set , program will be force to rewrite edi into given format</span>
<span class="sd">                savepath :str : path to save edifile.if None : save to your current work directory</span>
<span class="sd">                </span>
<span class="sd">                add_filter_ array: ndarray(nfreq, 2, 2) , EDI edifile is EMAP section data , if add filter is provied.</span>
<span class="sd">                                                        programm add filtered arrays.</span>
<span class="sd">                          </span>
<span class="sd">        return : new_edifile :str : full path to edifle </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">z_rho_phs_labels</span> <span class="o">=</span><span class="p">[</span>
                            <span class="p">[[</span><span class="s1">&#39;zxxr&#39;</span><span class="p">,</span> <span class="s1">&#39;zxxi&#39;</span><span class="p">,</span> <span class="s1">&#39;zxx.var&#39;</span><span class="p">],</span>
                              <span class="p">[</span><span class="s1">&#39;zxyr&#39;</span><span class="p">,</span> <span class="s1">&#39;zxyi&#39;</span><span class="p">,</span> <span class="s1">&#39;zxy.var&#39;</span><span class="p">],</span>
                              <span class="p">[</span><span class="s1">&#39;zyxr&#39;</span><span class="p">,</span> <span class="s1">&#39;zyxi&#39;</span><span class="p">,</span> <span class="s1">&#39;zyx.var&#39;</span><span class="p">],</span>
                              <span class="p">[</span><span class="s1">&#39;zyyr&#39;</span><span class="p">,</span> <span class="s1">&#39;zyyi&#39;</span><span class="p">,</span> <span class="s1">&#39;zyy.var&#39;</span><span class="p">]],[[</span><span class="s1">&#39;rhoxx&#39;</span><span class="p">,</span> <span class="s1">&#39;rhoxx.var&#39;</span><span class="p">,</span> <span class="s1">&#39;rhoxx.err&#39;</span><span class="p">,</span> <span class="s1">&#39;rhoxx.fit&#39;</span><span class="p">],</span>
                                                            <span class="p">[</span><span class="s1">&#39;rhoxy&#39;</span><span class="p">,</span><span class="s1">&#39;rhoxy.var&#39;</span><span class="p">,</span> <span class="s1">&#39;rhoxy.err&#39;</span><span class="p">,</span> <span class="s1">&#39;rhoxy.fit&#39;</span><span class="p">]],</span>
                                                            
                        <span class="p">[[</span><span class="s1">&#39;phxx&#39;</span><span class="p">,</span><span class="s1">&#39;phsxx.var&#39;</span><span class="p">,</span> <span class="s1">&#39;phsxx.err&#39;</span><span class="p">,</span> <span class="s1">&#39;phsxx.fit&#39;</span><span class="p">],</span>
                          <span class="p">[</span><span class="s1">&#39;phxy&#39;</span><span class="p">,</span><span class="s1">&#39;phsxy.var&#39;</span><span class="p">,</span> <span class="s1">&#39;phsxy.err&#39;</span><span class="p">,</span> <span class="s1">&#39;phsxy.fit&#39;</span><span class="p">]],</span> 
                        
                                                                 <span class="p">[[</span><span class="s1">&#39;frhoxx&#39;</span><span class="p">,</span><span class="s1">&#39;frhoxx.var&#39;</span><span class="p">,</span> <span class="s1">&#39;frhoxx.err&#39;</span><span class="p">,</span> <span class="s1">&#39;frhoxx.fit&#39;</span><span class="p">],</span>
                                                                  <span class="p">[</span><span class="s1">&#39;frhoxy&#39;</span><span class="p">,</span><span class="s1">&#39;frhoxy.var&#39;</span><span class="p">,</span> <span class="s1">&#39;frhoxy.err&#39;</span><span class="p">,</span> <span class="s1">&#39;frhoxy.fit&#39;</span><span class="p">]],</span>
                                                                 
                        <span class="p">[[</span><span class="s1">&#39;fphsxx&#39;</span><span class="p">,</span><span class="s1">&#39;fphsxx.var&#39;</span><span class="p">,</span> <span class="s1">&#39;fphsxx.err&#39;</span><span class="p">,</span> <span class="s1">&#39;fphsxx.fit&#39;</span><span class="p">],</span>
                         <span class="p">[</span><span class="s1">&#39;fphsxy&#39;</span><span class="p">,</span><span class="s1">&#39;fphsxy.var&#39;</span><span class="p">,</span> <span class="s1">&#39;fphsxy.err&#39;</span><span class="p">,</span> <span class="s1">&#39;fphsxy.fit&#39;</span><span class="p">]],</span>
                        <span class="p">]</span>
                                                            
        <span class="n">tip_labels</span> <span class="o">=</span><span class="p">[[</span><span class="s1">&#39;txr.exp&#39;</span><span class="p">,</span> <span class="s1">&#39;txi.exp&#39;</span><span class="p">,</span> <span class="s1">&#39;txvar.exp&#39;</span><span class="p">],[</span><span class="s1">&#39;tyr.exp&#39;</span><span class="p">,</span> <span class="s1">&#39;tyi.exp&#39;</span><span class="p">,</span> <span class="s1">&#39;tyvar.exp&#39;</span><span class="p">]]</span>
                          
        <span class="n">f</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="k">if</span> <span class="n">edi_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="o">=</span><span class="n">edi_fn</span> 
        
        <span class="k">if</span> <span class="n">new_edifilename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edifile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">new_edifilename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;new_&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifile</span><span class="p">))</span> 
            <span class="k">else</span> <span class="p">:</span> 
                <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">new_edifilename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">.</span><span class="si">{2}</span><span class="s1">.edi&#39;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">dataid</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_edi</span><span class="p">()</span>

        <span class="c1"># write info, definemeasurement and mtsection or emapsection </span>
        
        <span class="n">edi_header_infolines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">write_head_info</span><span class="p">()</span>
        <span class="n">edi_info_infolines</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">write_edi_info</span><span class="p">()</span>
        <span class="n">edi_definemeasurement_infolines</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DefineMeasurement</span><span class="o">.</span><span class="n">write_define_measurement</span><span class="p">()</span>
        <span class="n">edi_mtemap_infolines</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MTEMAP</span><span class="o">.</span><span class="n">write_mtemap_section</span><span class="p">(</span><span class="n">nfreq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="n">edi_mtemap_infolines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1">#---&gt; try to force the program to write either emap or mt section format </span>
        
        <span class="k">if</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
        <span class="c1"># if self.typefile is None :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span> <span class="o">=</span> <span class="n">edi_mtemap_infolines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">datatype</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;emapsect&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>  <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">datatype</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;mtsect&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span> <span class="p">(</span><span class="s1">&#39;Currently &lt;pyCSAMT&gt; can write &quot;&gt;=MTSECT&quot; or &quot;&gt;=EMAPSECT&quot;.&#39;</span>\
                               <span class="s1">&#39; The only dataType keys acceptables are either &quot;mt&quot; or &quot;emap&quot;.&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;Datatype provided is not acceptable .Please try &quot;mt&quot; or &quot;emap&quot;.&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span><span class="o">=</span> <span class="n">datatype</span> 
        
        <span class="k">if</span> <span class="n">f</span><span class="o">==</span><span class="mi">1</span> <span class="p">:</span>
            <span class="n">new_edifilename</span> <span class="o">=</span> <span class="n">new_edifilename</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">dataid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span><span class="p">,</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="c1"># set the name of new_filename </span>
                                                     
                                                     
        <span class="c1"># write frequency &gt;!****FREQUENCIES****!</span>
        <span class="n">edi_freq_infolines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_head_com</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;frequencies&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
        <span class="n">edi_freq_infolines</span> <span class="o">=</span><span class="n">edi_freq_infolines</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span>
                                                                       <span class="n">comp_key</span><span class="o">=</span><span class="s1">&#39;freq&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span> <span class="o">==</span> <span class="s1">&#39;mt&#39;</span> <span class="ow">or</span> <span class="s1">&#39;mt&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span> <span class="o">=</span> <span class="s1">&#39;mt&#39;</span>
            <span class="c1"># write impedance rotation angle : &gt;!****IMPEDANCE ROTATION ANGLES****!</span>
            <span class="n">edi_zrot_infolines</span> <span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_head_com</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;impedance rotation angles&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
            <span class="n">edi_zrot_infolines</span> <span class="o">=</span>   <span class="n">edi_zrot_infolines</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">,</span>
                                                                              <span class="n">comp_key</span> <span class="o">=</span> <span class="s1">&#39;zrot&#39;</span><span class="p">)</span>
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span> <span class="o">==</span><span class="s1">&#39;emap&#39;</span> <span class="ow">or</span> <span class="s1">&#39;emap&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span> <span class="o">=</span><span class="s1">&#39;emap&#39;</span>
            
            
        <span class="c1">#--&gt; Write impedance data and tipper </span>
        <span class="c1"># for consistency , may replace if exist nan number by np.nan</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z_err</span>  <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z_err</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">resistivity</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">resistivity</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>

        
        <span class="c1">#---&gt;  &gt;!****IMPEDANCES****!</span>
        <span class="n">edi_z_data_infolines</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_head_com</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;impedances&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">2</span><span class="p">):</span> 
                <span class="c1"># if np.all(self.Z.z[:, ii, jj].real ==0.0) \</span>
                <span class="c1">#     or np.mean (self.Z.z[:, ii, jj].imag)==0.0 or np.mean(self.Z.z_err[:, ii, jj])==0.  :pass  # dont write this none value </span>

                <span class="c1">#else :</span>
                <span class="n">zreal_datalines</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="p">,</span> 
                                                              <span class="n">comp_key</span> <span class="o">=</span><span class="n">z_rho_phs_labels</span> <span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span> <span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">zimag_datalines</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> 
                                                              <span class="n">comp_key</span> <span class="o">=</span><span class="n">z_rho_phs_labels</span> <span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span> <span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">z_error_values</span>  <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">z_err</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">**</span><span class="mi">2</span>
                <span class="n">zvariance_datalines</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span> <span class="o">=</span><span class="n">z_error_values</span><span class="p">,</span> 
                                                              <span class="n">comp_key</span> <span class="o">=</span><span class="n">z_rho_phs_labels</span> <span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span> <span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="n">jj</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">zreal_datalines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">zimag_datalines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">zvariance_datalines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">edi_z_data_infolines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">zreal_datalines</span><span class="p">)</span>
                <span class="n">edi_z_data_infolines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">zimag_datalines</span><span class="p">)</span>
                <span class="n">edi_z_data_infolines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">zvariance_datalines</span><span class="p">)</span>
                
                
                    
                    
        <span class="c1">#===============================================================</span>
        <span class="c1"># write EMAP  :</span>
        <span class="c1">#---------------------------------------------------------------                      </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span> <span class="o">==</span><span class="s1">&#39;emap&#39;</span><span class="p">:</span>
            <span class="c1"># define rho and phase array </span>
            <span class="n">edi_rhophs_infolines</span> <span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_head_com</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Resistivities and phases&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
            <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="n">phs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_filter_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="p">:</span>
                <span class="n">frho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                
                <span class="n">frho</span> <span class="p">[:,</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_filter_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">frho</span> <span class="p">[:,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_filter_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                
            <span class="n">rho</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">rho</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rho</span>  <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">res_xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">res_err_xx</span> <span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">res_err_xx</span>
            <span class="n">rho</span> <span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rho</span>  <span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rho</span> <span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">res_xy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">res_err_xy</span><span class="o">**</span><span class="mi">2</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">res_err_xy</span>  
            
            <span class="n">phs</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">phs</span> <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">phs</span>  <span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase_xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase_err_xx</span> <span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase_err_xx</span>
            <span class="n">phs</span> <span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">phs</span> <span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">phs</span> <span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase_xy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase_err_xy</span><span class="o">**</span><span class="mi">2</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">phase_err_xy</span>    
            
            <span class="c1"># convert np.nan to number </span>
            <span class="n">rho</span> <span class="p">,</span> <span class="n">phs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">phs</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span> 
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">:</span> 
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">rho</span><span class="p">[:,</span> <span class="n">ii</span> <span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span> <span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span> <span class="p">(</span><span class="n">phs</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span> <span class="k">continue</span>
                    <span class="k">else</span> <span class="p">:</span> 
                        <span class="n">res_datalines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span>
                                                                      <span class="n">comp_key</span> <span class="o">=</span> <span class="n">z_rho_phs_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>
                        <span class="n">phs_datalines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span> <span class="o">=</span> <span class="n">phs</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span>
                                                                      <span class="n">comp_key</span> <span class="o">=</span> <span class="n">z_rho_phs_labels</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>
                        <span class="n">res_datalines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">phs_datalines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span> 
                        
                        <span class="n">edi_rhophs_infolines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">res_datalines</span><span class="p">)</span>
                        <span class="n">edi_rhophs_infolines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">phs_datalines</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">add_filter_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                            <span class="n">fres_datalines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span> <span class="o">=</span> <span class="n">frho</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">],</span>
                                                                      <span class="n">comp_key</span> <span class="o">=</span> <span class="n">z_rho_phs_labels</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>
                        
                            <span class="n">edi_rhophs_infolines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fres_datalines</span><span class="p">)</span>
                            
            
            <span class="n">edi_z_data_infolines</span> <span class="o">=</span> <span class="n">edi_z_data_infolines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># delete one more return </span>

            
        <span class="c1">#===============================================================</span>
        <span class="c1"># write EMAP  pass :***TIPPER  *** </span>
        <span class="c1">#---------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">tipper</span> <span class="o">==</span><span class="mi">0</span> <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">tipper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="n">edi_tip_data_infolines</span> <span class="p">,</span> <span class="n">edi_tip_rot_infolines</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span> 
             <span class="c1">#&gt;!****TIPPER ROTATION ANGLES****!</span>
            <span class="k">try</span> <span class="p">:</span>
                <span class="n">edi_tip_rot_infolines</span> <span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_head_com</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;tipper rotation angles&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
                <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">rotation_angle</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">float</span> <span class="p">:</span> 
                    <span class="c1">#fill tip_rot_value </span>
                    <span class="n">tip_rotation_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">rotation_angle</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> 
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">tip_rotation_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">rotation_angle</span><span class="p">)</span>
                    
                    <span class="n">edi_tip_rot_infolines</span> <span class="o">=</span> <span class="n">edi_tip_rot_infolines</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tip_rotation_value</span><span class="p">),</span>
                                                                                 <span class="n">comp_key</span> <span class="o">=</span> <span class="s1">&#39;trot&#39;</span><span class="p">)</span>
                    <span class="c1"># write Tipper data </span>
                    <span class="c1">#  &gt;!****TIPPER PARAMETERS****!</span>
                    <span class="n">edi_tip_data_infolines</span> <span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_head_com</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;tipper parameters&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>
                    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">:</span> 
                        <span class="n">tipreal_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                                                      <span class="n">comp_key</span><span class="o">=</span><span class="n">tip_labels</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">tipimag_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                                                      <span class="n">comp_key</span><span class="o">=</span><span class="n">tip_labels</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">tipvariance_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_components_blocks</span><span class="p">(</span><span class="n">edi_datacomp</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tip</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                                                                      <span class="n">comp_key</span><span class="o">=</span><span class="n">tip_labels</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">edi_tip_data_infolines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">tipreal_lines</span> <span class="p">)</span>
                        <span class="n">edi_tip_data_infolines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">tipimag_lines</span> <span class="p">)</span>
                        <span class="n">edi_tip_data_infolines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">tipvariance_lines</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">:</span> 
                <span class="n">edi_tip_data_infolines</span> <span class="p">,</span> <span class="n">edi_tip_rot_infolines</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
                
        <span class="c1">#WRITE </span>
        <span class="n">write_edilines</span> <span class="o">=</span> <span class="n">edi_header_infolines</span> <span class="o">+</span> <span class="n">edi_info_infolines</span> <span class="o">+</span>\
            <span class="n">edi_definemeasurement_infolines</span> <span class="o">+</span> <span class="n">edi_mtemap_infolines</span>  


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span> <span class="o">==</span><span class="s1">&#39;mt&#39;</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">ilines</span> <span class="ow">in</span> <span class="p">[</span><span class="n">edi_freq_infolines</span> <span class="p">,</span> <span class="n">edi_zrot_infolines</span><span class="p">,</span> <span class="n">edi_z_data_infolines</span><span class="p">,</span>
                           <span class="n">edi_tip_rot_infolines</span><span class="p">,</span> <span class="n">edi_tip_data_infolines</span> <span class="p">]:</span> 
                            
                <span class="k">if</span> <span class="n">ilines</span><span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="k">continue</span> 
                <span class="k">else</span> <span class="p">:</span> <span class="n">write_edilines</span> <span class="o">+=</span> <span class="n">ilines</span> <span class="o">+</span><span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span> 
            
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typefile</span> <span class="o">==</span><span class="s1">&#39;emap&#39;</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">ilines</span> <span class="ow">in</span> <span class="p">[</span><span class="n">edi_freq_infolines</span> <span class="p">,</span> <span class="n">edi_z_data_infolines</span><span class="p">,</span> <span class="n">edi_rhophs_infolines</span><span class="p">]:</span>
                <span class="n">write_edilines</span> <span class="o">+=</span><span class="n">ilines</span> <span class="o">+</span><span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span> 
        
        <span class="n">write_edilines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&gt;END&#39;</span><span class="p">)</span>
                        
        <span class="c1"># writenow file : </span>
        <span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="n">new_edifilename</span> <span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fw</span> <span class="p">:</span> 
            <span class="n">fw</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">write_edilines</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">savepath</span>  <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1"># create a folder in your current work directory</span>
            <span class="k">try</span> <span class="p">:</span>
                
                <span class="n">savepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;_outputEDI_&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Create newpath &lt;</span><span class="si">%s</span><span class="s1">&gt; to save edifile&#39;</span><span class="o">%</span> <span class="n">savepath</span><span class="p">)</span>    
            <span class="k">except</span> <span class="p">:</span> 

                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;It seems the path already exists !&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">savepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">try</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span> <span class="p">:</span> 
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_edifilename</span><span class="p">,</span> <span class="n">savepath</span> <span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span> 
                    <span class="k">try</span> <span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span> <span class="p">(</span><span class="s1">&#39;File &lt;</span><span class="si">{0}</span><span class="s1">&gt; already exists ,&#39;</span>\
                                       <span class="s1">&#39; New file will be set on new folder </span><span class="si">{1}</span><span class="s1">:&#39;</span> \
                               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">new_edifilename</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;new_edi.</span><span class="si">{0}</span><span class="s1">.</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span>\
                                                          <span class="nb">format</span><span class="p">(</span><span class="s1">&#39;pyCS&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">))))</span>
                        <span class="n">new_path</span> <span class="o">=</span> <span class="s1">&#39;new_edi.</span><span class="si">{0}</span><span class="s1">.</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;pyCS&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">new_path</span><span class="p">))</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Create newpath &lt;</span><span class="si">%s</span><span class="s1">&gt; to save edifile&#39;</span><span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">new_path</span><span class="p">))</span>
                    <span class="k">except</span> <span class="p">:</span><span class="k">pass</span> 
                    <span class="k">else</span> <span class="p">:</span> <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_edifilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">new_path</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">:</span> <span class="k">pass</span> 

        <span class="n">write_edilines</span><span class="o">=</span><span class="p">[]</span>
        
       
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">77</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&gt; Edifile &lt;</span><span class="si">{0}</span><span class="s1">&gt; has be successfully written to your savepath.</span><span class="se">\n</span><span class="s1">---&gt; savepath : &lt;</span><span class="si">{1}</span><span class="s1">&gt;&#39;</span><span class="o">.</span>\
              <span class="nb">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">new_edifilename</span><span class="p">),</span> <span class="n">savepath</span> <span class="p">))</span>
        <span class="c1"># print(&#39;-&#39;*77)  </span>
        
        <span class="k">return</span> <span class="n">new_edifilename</span></div>
            
      
            
        
    <span class="k">def</span> <span class="nf">_write_components_blocks</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_datacomp</span> <span class="p">,</span> <span class="n">comp_key</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        methods to write blocks  with data components keys . </span>
<span class="sd">        edi_datacomp  :( ndarray, n) : array of data components . </span>
<span class="sd">                        :::(nfreq, 2, 2)</span>
<span class="sd">        comp_key : component to write in edifile .</span>
<span class="sd">        datatype  : str : mt or eamap : default is &quot;mt&quot;</span>
<span class="sd">        </span>
<span class="sd">        return : data_list : list of line to write in edifile</span>
<span class="sd">    </span>
<span class="sd">        Note : we assume that comp_key provided is found on the edifile </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Ready to write edi data component blocks info list !&#39;</span><span class="p">)</span>
        
        <span class="n">block_rot</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;ROT=ZROT&#39;</span><span class="p">,</span> <span class="s1">&#39;ROT=TROT&#39;</span><span class="p">,</span> <span class="s1">&#39;ROT=NONE&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">datatype</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">typefile</span>
        
        <span class="k">if</span> <span class="n">comp_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span>  <span class="n">comp_block_line</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&gt;FREQ  //</span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edi_datacomp</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">datatype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mt&quot;</span><span class="p">,</span> <span class="s1">&#39;&gt;=mtsect&#39;</span><span class="p">,</span> <span class="s1">&#39;mtsect&#39;</span><span class="p">]</span> <span class="p">:</span>
 
            <span class="k">if</span> <span class="n">comp_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span><span class="s1">&#39;zrot&#39;</span> <span class="ow">or</span> <span class="n">comp_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;trot&#39;</span><span class="p">:</span>
                <span class="n">comp_block_line</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&gt;</span><span class="si">{0}</span><span class="s1">  //</span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp_key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> 
                                                        <span class="n">edi_datacomp</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="n">comp_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">comp_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">,</span> <span class="s1">&#39;trot&#39;</span><span class="p">]:</span>
                <span class="n">comp_block_line</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">  //</span><span class="si">{2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp_key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                              <span class="n">block_rot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                              <span class="n">edi_datacomp</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="n">comp_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">comp_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">,</span> <span class="s1">&#39;trot&#39;</span><span class="p">]:</span>
                <span class="n">comp_block_line</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">  //</span><span class="si">{2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp_key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                              <span class="n">block_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                              <span class="n">edi_datacomp</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">comp_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;Could not write the component key &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span><span class="o">%</span> <span class="n">comp_key</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">datatype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;emap&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=emapsect&#39;</span><span class="p">,</span><span class="s1">&#39;emapsect&#39;</span><span class="p">]:</span> 
            <span class="k">if</span> <span class="n">comp_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> 
                <span class="n">comp_block_line</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&gt;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">  //</span><span class="si">{2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp_key</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                              <span class="n">block_rot</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                              <span class="n">edi_datacomp</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
            <span class="c1"># else : raise CSex.pyCSAMTError_EDI(&#39;Could not write the component key &lt;%s&gt;&#39;% comp_key)</span>
            
        <span class="k">else</span> <span class="p">:</span><span class="c1">#datatype.lower() not in [&#39;mt&#39; , &#39;&gt;=mtsect&#39;] and datatype.lower() not in [&#39;emap&#39;, &#39;&gt;=emapsect&#39;]: </span>
            
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span> <span class="p">(</span><span class="s1">&#39;Two Types of data can be read either  MTsection or EMAPsection.&#39;</span>\
                           <span class="s1">&#39;The dataType provided &lt;</span><span class="si">{0}</span><span class="s1">&gt; does not match any of them. We suggest to&#39;</span>\
                            <span class="s1">&#39; use &quot;mt&quot; or &quot;emap&quot;.as datatype key ,&#39;</span>\
                                <span class="s1">&#39; if not please refer to SEG-Edile write principles.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datatype</span><span class="p">))</span> 
                          
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;DataType &lt;</span><span class="si">{0}</span><span class="s1">&gt; provided is wrong!&#39;</span>\
                                        <span class="s1">&#39; please use &quot;MT&quot;or &quot;EMAP&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datatype</span><span class="p">))</span>
        
        <span class="c1">#-- &gt; read value form component edi_data_comp </span>
        <span class="k">for</span> <span class="n">index_data</span> <span class="p">,</span> <span class="n">datacomp</span> <span class="ow">in</span> <span class="nb">enumerate</span> <span class="p">(</span><span class="n">edi_datacomp</span> <span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> 
 
            <span class="k">if</span> <span class="n">datacomp</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">comp_key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zrot&#39;</span><span class="p">,</span> <span class="s1">&#39;trot&#39;</span><span class="p">]:</span> 
                <span class="n">datacomp</span> <span class="o">=</span> <span class="mf">1.0E32</span>          
                <span class="c1"># if datacomp.mean() == self.Head.empty :continue # dont write this data when all are empty</span>
                <span class="c1"># else : </span>
            <span class="n">format_value</span> <span class="o">=</span><span class="s2">&quot;{0:</span><span class="si">{1}</span><span class="s2">}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datacomp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bloc_num_format</span><span class="p">)</span> <span class="c1">#</span>
            <span class="n">format_value</span> <span class="o">=</span><span class="n">format_value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>          <span class="c1">#   1.000000E+32</span>
            <span class="k">if</span> <span class="n">index_data</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                <span class="n">format_value</span> <span class="o">=</span><span class="n">format_value</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="c1"># ---&gt; when block is at the end </span>
            <span class="k">if</span> <span class="n">index_data</span> <span class="o">==</span> <span class="n">edi_datacomp</span><span class="o">.</span><span class="n">size</span> <span class="p">:</span> <span class="n">format_value</span> <span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> 
                
            <span class="n">comp_block_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_value</span><span class="p">)</span>  <span class="c1">#join block value to its corresponding  </span>
            
        <span class="k">return</span> <span class="n">comp_block_line</span>
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">station</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">dataid</span> 

    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">processingsoftware</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">ProcessingSoftware</span><span class="o">.</span><span class="n">name</span> 
    
    
    <span class="nd">@station</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">station</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_station_name</span><span class="p">):</span> 
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">set_station_name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">set_station_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">set_station_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">dataid</span> <span class="o">=</span> <span class="n">set_station_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MTEMAP</span><span class="o">.</span><span class="n">sectid</span> <span class="o">=</span> <span class="n">set_station_name</span>
    
    <span class="nd">@processingsoftware</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">processingsoftware</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sofware_name</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Info</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">ProcessingSoftware</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">sofware_name</span></div>
    


        
<div class="viewcode-block" id="Head"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Head">[docs]</a><span class="k">class</span> <span class="nc">Head</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The edi head block contains a series of options which (1) identity the data  </span>
<span class="sd">    set, (2) describe whn , where and by whoom was acquired , and (3) describe   </span>
<span class="sd">    when , how  and by whom it was written.</span>
<span class="sd">    </span>
<span class="sd">    arguments : </span>
<span class="sd">        edi_fn :str : Full path to edi path </span>
<span class="sd">        </span>
<span class="sd">    eg: </span>
<span class="sd">         &gt;HEAD</span>
<span class="sd">             DATAID=&quot;kap012&quot;</span>
<span class="sd">             ACQBY=&quot;Phoenix&quot;</span>
<span class="sd">             FILEBY=&quot;EMTF FCU&quot;</span>
<span class="sd">             FILEDATE=01/02/18</span>
<span class="sd">             LAT=-30:52:05.62</span>
<span class="sd">             LONG=21:44:35.00</span>
<span class="sd">             ELEV=1166</span>
<span class="sd">             STDVERS=SEG 1.0</span>
<span class="sd">             PROGVERS=&quot;4.0&quot;</span>
<span class="sd">             PROGDATE=06/20/11</span>
<span class="sd">             MAXSECT=999</span>
<span class="sd">             EMPTY=1.0e+32</span>
<span class="sd">                </span>
<span class="sd">    ============================================================================</span>
<span class="sd">    Attribute       Description                 resctriction           Default </span>
<span class="sd">    ============================================================================</span>
<span class="sd">    dataid          Identifier for data set         str             Required </span>
<span class="sd">    acqby           Name of contractor or other </span>
<span class="sd">                            party                   str             Required </span>
<span class="sd">    fileby          Name of contractor of other </span>
<span class="sd">                            party                   str             Required </span>
<span class="sd">    acqdate         Date of (start of) data</span>
<span class="sd">                        acquisition                 date            Required </span>
<span class="sd">    enddate         Date of end of data acq         date            &quot;&quot;</span>
<span class="sd">    filedate        Date EDI was written            Date            Required </span>
<span class="sd">    country         Name of country of acq.         str             &quot;&quot;</span>
<span class="sd">    state           state(s) of province(s) of </span>
<span class="sd">                        acquisition                 str             &quot;&quot;</span>
<span class="sd">    county          Name of country of acq.         str             &quot;&quot;</span>
<span class="sd">    prospect        Name of associated prospect     str             &quot;&quot;</span>
<span class="sd">    loc             Description of location         str             &quot;&quot;</span>
<span class="sd">    lat             avg.(approx) latitude of acq.   str             &quot;&quot;</span>
<span class="sd">    long            avg.(approx)longitude of avq.   str             &quot;&quot;</span>
<span class="sd">    elev            avg.(approx)elevation of acq.   str             &quot;&quot;</span>
<span class="sd">    units           Units for elevation             &quot;m&quot;|&quot;ft&quot;        &quot;m&quot;</span>
<span class="sd">    stdvers         Version of EDI format for </span>
<span class="sd">                        this file                   str             Required </span>
<span class="sd">    progvers       Version ID for prog. written    str             Required </span>
<span class="sd">    progdate        Last revision of prog writing</span>
<span class="sd">                        file                        str             Required </span>
<span class="sd">    coordsys        coordinate system [geographic|</span>
<span class="sd">                                       geomagnetic] str             Geography North</span>
<span class="sd">    declination     geomagnetic declination         float           &quot;10.&quot;     </span>
<span class="sd">    maxsect         Maximum data section in EDI </span>
<span class="sd">                            file                    int&gt;=1          &quot;16&quot;</span>
<span class="sd">    bindata         if not &quot;&quot;, tag for binary data</span>
<span class="sd">                            file                    str of &quot;&quot;       &quot;&quot;</span>
<span class="sd">    empty           Value which represents &quot;nodata&quot; float           &quot;1.0E32&quot;</span>
<span class="sd">    </span>
<span class="sd">    ============================================================================</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">head_keys</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;dataid&#39;</span><span class="p">,</span> <span class="s1">&#39;acqby&#39;</span><span class="p">,</span>
                <span class="s1">&#39;fileby&#39;</span><span class="p">,</span><span class="s1">&#39;acqdate&#39;</span><span class="p">,</span>
                <span class="s1">&#39;enddate&#39;</span><span class="p">,</span> <span class="s1">&#39;filedate&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;county&#39;</span><span class="p">,</span><span class="s1">&#39;prospect&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="s1">&#39;elev&#39;</span><span class="p">,</span><span class="s1">&#39;declination&#39;</span><span class="p">,</span><span class="s1">&#39;datum&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;stdvers&#39;</span><span class="p">,</span> <span class="s1">&#39;coordsys&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;progvers&#39;</span><span class="p">,</span> <span class="s1">&#39;progdate&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;maxsect&#39;</span><span class="p">,</span> <span class="s1">&#39;bindata&#39;</span><span class="p">,</span><span class="s1">&#39;project&#39;</span><span class="p">,</span>  
                                        <span class="s1">&#39;survey&#39;</span><span class="p">,</span><span class="s1">&#39;empty&#39;</span><span class="p">]</span>
    
    
    
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_header_list</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span> <span class="o">=</span><span class="n">CSobj</span><span class="o">.</span><span class="n">Location</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataid</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">acqby</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">fileby</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">acqdate</span> <span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enddate</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">filedate</span> <span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                        <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">county</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">prospect</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span><span class="s1">&#39;m&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdvers</span><span class="o">=</span><span class="s1">&#39;SEG 1.0&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progvers</span><span class="o">=</span><span class="s1">&#39;pyCSAMT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progdate</span> <span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordsys</span> <span class="o">=</span><span class="s1">&#39;Geomagnetic North&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declination</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">datum</span> <span class="o">=</span><span class="s1">&#39;WGS84&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxsect</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">bindata</span> <span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">survey</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">empty</span> <span class="o">=</span><span class="mf">1.0E32</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span> <span class="o">=</span> <span class="n">edi_header_list</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_head</span><span class="p">()</span>
            
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">lat</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span> 
    <span class="nd">@lat</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">lat</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat</span><span class="p">):</span>
        <span class="k">try</span> <span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span><span class="n">gis</span><span class="o">.</span><span class="n">convert_position_str2float</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Converted string &quot;dms&quot; input latitude  to decimal degree.&#39;</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">latitude</span> <span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>


    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">long</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span> 
    <span class="nd">@long</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">long</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">long</span><span class="p">):</span>
        <span class="k">try</span> <span class="p">:</span><span class="nb">float</span> <span class="p">(</span><span class="n">long</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span><span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">convert_position_str2float</span><span class="p">(</span><span class="n">long</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Converted string &quot;dms&quot; input longitude  to decimal degree.&#39;</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">longitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">long</span><span class="p">)</span>

    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">elev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">elevation</span> 
    
    <span class="nd">@elev</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">elev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elev</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span><span class="n">elev</span>

        
<div class="viewcode-block" id="Head.get_header_list_from_edi"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Head.get_header_list_from_edi">[docs]</a>    <span class="nd">@classmethod</span> 
    <span class="k">def</span> <span class="nf">get_header_list_from_edi</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">edi_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        class method to return edi_head_list . </span>
<span class="sd">        param : edi_fn :str : full path to edifile </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Geting &lt;</span><span class="si">%s</span><span class="s1">&gt; Head info&#39;</span><span class="o">%</span> <span class="n">edi_fn</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;Edile file not found ! Please check your right path.&#39;</span><span class="p">)</span>
        <span class="n">markhead</span> <span class="p">,</span> <span class="n">ediheadlist</span><span class="o">=</span><span class="mi">0</span><span class="p">,[]</span>
        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span> <span class="n">edi_fn</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span> <span class="o">==</span><span class="s1">&#39;edi&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span> <span class="n">edi_fn</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">!=</span><span class="s1">&#39;edi&#39;</span><span class="p">:</span> 
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_Header</span><span class="p">(</span><span class="s1">&#39;Edifile &lt;</span><span class="si">{0}</span><span class="s1">&gt; - Header is not correct.Please check your edifile&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">apth</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">edi_fn</span><span class="p">)))</span>
            
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">edi_fn</span> <span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span> <span class="p">:</span> 
                <span class="n">head_lines</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">hh</span><span class="p">,</span> <span class="n">headitems</span> <span class="ow">in</span> <span class="nb">enumerate</span> <span class="p">(</span><span class="n">head_lines</span><span class="p">):</span> 
                    
                    <span class="k">if</span> <span class="s1">&#39;&gt;HEAD&#39;</span> <span class="ow">in</span> <span class="n">headitems</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&gt;HEAD&#39;</span><span class="p">,</span> <span class="n">headitems</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">markhead</span> <span class="o">=</span> <span class="n">hh</span>
   
                    <span class="k">if</span> <span class="s1">&#39;&gt;INFO&#39;</span> <span class="ow">in</span> <span class="n">headitems</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&gt;INFO&#39;</span><span class="p">,</span> <span class="n">headitems</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
                        
                        <span class="n">ediheadlist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">head_lines</span><span class="p">[</span><span class="n">markhead</span><span class="p">:</span><span class="n">hh</span><span class="p">])</span>

                        <span class="k">break</span> 
 
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">edi_header_list</span> <span class="o">=</span> <span class="n">ediheadlist</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Head.read_head"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Head.read_head">[docs]</a>    <span class="k">def</span> <span class="nf">read_head</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_header_list</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read_header_list and set attributes values</span>
<span class="sd">        param : edi_header_list : list of edifile header infos .</span>
<span class="sd">         eg:: </span>
<span class="sd">             </span>
<span class="sd">                    &gt;&gt;&gt;&gt; file_edi= &#39;S00_ss.edi&#39;</span>
<span class="sd">                    &gt;&gt;&gt;&gt; path =  os.path.join(os.environ[&quot;pyCSAMT&quot;], </span>
<span class="sd">                                          &#39;csamtpy&#39;,&#39;data&#39;, file_edi)</span>
<span class="sd">                    ... edihead= Head.get_header_list_from_edi(edi_fn=path)</span>
<span class="sd">                    ... print(edihead.lat)</span>
<span class="sd">                    ... print(edihead.long)</span>
<span class="sd">                    ... print(edihead.elev)</span>
<span class="sd">                    ... print(edihead.acqby)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Reading info list.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">edi_header_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span> <span class="o">=</span> <span class="n">edi_header_list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_Header</span><span class="p">(</span><span class="s1">&#39;None items found to read.&#39;</span><span class="p">)</span>
        <span class="n">new_header</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">item</span><span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># replace any blank line </span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_keys</span> <span class="p">:</span>

                    <span class="k">if</span> <span class="n">key</span><span class="o">==</span><span class="s1">&#39;long&#39;</span> <span class="p">:</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span>   <span class="c1"># some Edifile use LON instead of LONG , must take into accountfor parsing</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>         <span class="c1"># set attribute that exist in  headkeys  </span>
                        <span class="c1">#for more consistency , try to clean possible space before setting attribute </span>
                        
                        <span class="n">keyi</span> <span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># function return a list of clean value</span>
                        <span class="k">if</span> <span class="n">keyi</span><span class="o">==</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">keyi</span><span class="o">=</span> <span class="s1">&#39;long&#39;</span>
                        <span class="k">if</span> <span class="n">keyi</span> <span class="o">==</span><span class="s1">&#39;coordsys&#39;</span> <span class="p">:</span><span class="n">keyi</span> <span class="o">==</span><span class="s1">&#39;coordinate_system&#39;</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">keyi</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>
                        <span class="n">new_header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">keyi</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span> <span class="o">=</span> <span class="n">new_header</span></div>

    
<div class="viewcode-block" id="Head.write_head_info"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Head.write_head_info">[docs]</a>    <span class="k">def</span> <span class="nf">write_head_info</span> <span class="p">(</span><span class="bp">self</span> <span class="p">,</span> <span class="n">head_list_infos</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write list info . Can read edi and rewrite list or  to provide </span>
<span class="sd">            input as [&#39;key_01=value_01&#39;, &#39;key_02=value_02&#39;, ...,&#39;key_nn=value_nn&#39; ]</span>
<span class="sd">            Note : If value is absent i.e None ,  don&#39;t write the key . </span>
<span class="sd">            </span>
<span class="sd">        param: head_list_infos : list : list of head info </span>
<span class="sd">        return write_info : list : list ready to write to let EDI file more visible .</span>
<span class="sd">        e:g:</span>
<span class="sd">            &gt;&gt;&gt; path =  os.path.join(os.environ[&quot;pyCSAMT&quot;], &#39;csamtpy&#39;,&#39;data&#39;, S00_ss.edi)</span>
<span class="sd">            ... edihead= Head.get_header_list_from_edi(edi_fn=path)</span>
<span class="sd">            ... print(edihead.write_head_info(head_list_infos = edihead.edi_header))</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Writing Edifile info .&#39;</span><span class="p">)</span>

        <span class="n">write_header</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;&gt;HEAD</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">head_list_infos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span> <span class="o">=</span> <span class="n">head_list_infos</span> 
        
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_keys</span> <span class="p">:</span> 
                <span class="n">keyvalue</span> <span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">keyvalue</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>  <span class="k">continue</span><span class="c1">#keyvalue=&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">keyvalue</span> <span class="o">!=</span><span class="kc">None</span> <span class="p">:</span> 
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span><span class="s1">&#39;long&#39;</span> <span class="ow">or</span> <span class="n">key</span><span class="o">==</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">keyvalue</span> <span class="o">=</span><span class="n">gis</span><span class="o">.</span><span class="n">convert_position_float2str</span><span class="p">(</span><span class="n">keyvalue</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span><span class="s1">&#39;dataid&#39;</span> <span class="p">:</span> <span class="n">keyvalue</span> <span class="o">=</span><span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyvalue</span><span class="p">)</span> <span class="c1"># put &quot;&quot;</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span><span class="s1">&#39;stdvers&#39;</span> <span class="p">:</span> <span class="n">keyvalue</span> <span class="o">=</span><span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyvalue</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span><span class="s1">&#39;progvers&#39;</span><span class="p">:</span>
                        <span class="n">keyvalue</span> <span class="o">=</span><span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyvalue</span><span class="p">)</span>
                        <span class="n">write_header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">keyvalue</span><span class="p">),</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                    <span class="k">else</span> <span class="p">:</span> <span class="n">write_header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">keyvalue</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                    
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1">#for consistency rewrite .</span>
            <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edi_header</span> <span class="p">:</span> 
                <span class="n">item</span><span class="p">,</span> <span class="n">itemvalue</span><span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">head_keys</span> <span class="p">:</span>
                    <span class="k">if</span>  <span class="n">itemvalue</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;None&#39;</span> <span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">]:</span><span class="k">pass</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># be sure to let item with no space.</span>

                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span><span class="s1">&#39;dataid&#39;</span> <span class="p">:</span> <span class="n">itemvalue</span> <span class="o">=</span><span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">itemvalue</span><span class="p">)</span> <span class="c1"># put &quot;&quot;</span>
                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span><span class="s1">&#39;stdvers&#39;</span> <span class="p">:</span> <span class="n">itemvalue</span> <span class="o">=</span><span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">itemvalue</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span><span class="s1">&#39;progvers&#39;</span><span class="p">:</span>

                            <span class="n">itemvalue</span> <span class="o">=</span><span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Software</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;pyCSAMT&#39;</span><span class="p">}),</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
                            <span class="n">write_header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">itemvalue</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                        
                        <span class="k">else</span> <span class="p">:</span> <span class="n">write_header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">itemvalue</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
        
        <span class="n">write_header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">write_header</span></div></div>
    
 
<div class="viewcode-block" id="Info"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Info">[docs]</a><span class="k">class</span> <span class="nc">Info</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     class EDI info class : collect information of the survey : </span>
<span class="sd">    for instance : </span>
<span class="sd">             &gt;INFO</span>
<span class="sd">                 MAXINFO=999</span>
<span class="sd">                  PROJECT=SAMTEX</span>
<span class="sd">                  SURVEY=Kaapvaal 2003</span>
<span class="sd">                  YEAR=2003</span>
<span class="sd">                  PROCESSEDBY=SAMTEX team</span>
<span class="sd">                  PROCESSINGSOFTWARE=JONES 2.3</span>
<span class="sd">                  PROCESSINGTAG=</span>
<span class="sd">                  SITENAME=South Africa</span>
<span class="sd">                  RUNLIST=</span>
<span class="sd">                  REMOTEREF=</span>
<span class="sd">                  REMOTESITE=</span>
<span class="sd">                  SIGNCONVENTION=exp(+ i\omega t)</span>
<span class="sd">     Holds the following information:</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    Attributes         Type        Explanation</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    maxrun              int&gt;=1          maximum number of text lines in info text </span>
<span class="sd">                                        (maybe less)</span>
<span class="sd">    Source              class obj       Porvenace of data to rewrite </span>
<span class="sd">    Processing          Processing obj  How data where processed   </span>
<span class="sd">    Notes               Note class      info additions </span>
<span class="sd">    </span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">infokeys</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;maxinfo&#39;</span><span class="p">,</span> <span class="s1">&#39;project&#39;</span><span class="p">,</span> <span class="s1">&#39;survey&#39;</span><span class="p">,</span> <span class="s1">&#39;creationdate&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;processedby&#39;</span><span class="p">,</span><span class="s1">&#39;processingsoftware&#39;</span><span class="p">,</span> <span class="s1">&#39;processingtag&#39;</span><span class="p">,</span>
               <span class="s1">&#39;sitename&#39;</span><span class="p">,</span> <span class="s1">&#39;runlist&#39;</span><span class="p">,</span> <span class="s1">&#39;remoteref&#39;</span><span class="p">,</span> <span class="s1">&#39;remotesite&#39;</span><span class="p">,</span> <span class="s1">&#39;signconvention&#39;</span><span class="p">]</span>
    
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">edi_info_list</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ediinfo</span> <span class="o">=</span><span class="n">edi_info_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span><span class="kc">None</span> <span class="c1">#use for EMEAP section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxinfo</span> <span class="o">=</span><span class="mi">999</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Source</span><span class="o">=</span><span class="n">Source</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Processing</span><span class="o">=</span><span class="n">Processing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Copyright</span> <span class="o">=</span><span class="n">Copyright</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Head</span><span class="o">=</span><span class="n">Head</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setattar__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ediinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_info</span><span class="p">()</span>
                          
            
<div class="viewcode-block" id="Info.get_info_list_from_edi"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Info.get_info_list_from_edi">[docs]</a>    <span class="nd">@classmethod</span> 
    <span class="k">def</span> <span class="nf">get_info_list_from_edi</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">edi_fn</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        class to get edinfo from edifiles :</span>
<span class="sd">            retunn edi_info_list </span>
<span class="sd">        params : edi_fn : full path to edifile</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;subclass :Reading &lt;</span><span class="si">%s</span><span class="s1">&gt; Ediinfo and return  class.&#39;</span><span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="n">info_mark</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;None infos to read! Please provide the right path .&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span><span class="n">edi_fn</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;edi&#39;</span><span class="p">:</span>  <span class="c1"># we do this simultaneous assement to get a ms of computation .</span>
            <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span> <span class="n">edi_fn</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span><span class="kc">True</span> <span class="p">)</span><span class="o">==</span><span class="s1">&#39;edi&#39;</span><span class="p">:</span> 
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">edi_fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi</span><span class="p">:</span>
                    <span class="n">edi_lines</span> <span class="o">=</span><span class="n">fi</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    
                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edi_lines</span><span class="p">):</span> 
                    <span class="k">if</span> <span class="s1">&#39;&gt;info&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="ow">in</span> <span class="n">info</span> <span class="ow">or</span> <span class="n">info</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;INF&#39;</span><span class="p">)</span><span class="o">&gt;=</span> <span class="mi">0</span>  <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&gt;INFO&#39;</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
         
                        <span class="n">info_mark</span><span class="o">=</span><span class="n">ii</span> 
                    <span class="k">elif</span> <span class="n">info</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span> <span class="p">:</span><span class="k">continue</span> 
                    <span class="k">elif</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="ow">in</span> <span class="n">info</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&gt;=DEFINEMEAS&#39;</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="ow">or</span> <span class="n">info</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;=DEFINEMEAS&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span> 
                        <span class="n">list_info</span> <span class="o">=</span> <span class="n">edi_lines</span><span class="p">[</span><span class="n">info_mark</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ii</span><span class="p">]</span> <span class="c1">#get the info plus one </span>
                        <span class="k">break</span> 

            <span class="k">return</span> <span class="bp">cls</span> <span class="p">(</span><span class="n">edi_info_list</span><span class="o">=</span><span class="n">list_info</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Info.read_info"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Info.read_info">[docs]</a>    <span class="k">def</span> <span class="nf">read_info</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_info_list</span> <span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        readinformation and populate attaribute info </span>
<span class="sd">        can setother attributes once read and not present on the file. </span>
<span class="sd">        </span>
<span class="sd">        params : edi_info_list :list </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listinfo</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">edi_info_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ediinfo</span> <span class="o">=</span><span class="n">edi_info_list</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ediinfo</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;None list found. can not read.&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">ii</span> <span class="p">,</span> <span class="n">iteminfo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ediinfo</span> <span class="p">):</span>
            <span class="n">iteminfo</span><span class="o">=</span><span class="n">iteminfo</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iteminfo</span> <span class="o">==</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span><span class="k">continue</span> <span class="c1">#continue </span>
            <span class="k">elif</span> <span class="n">iteminfo</span> <span class="o">!=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="k">try</span> <span class="p">:</span> 
                    <span class="n">item</span> <span class="p">,</span> <span class="n">infovalue</span> <span class="o">=</span> <span class="n">iteminfo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">:</span> <span class="c1">#Try to set attribute for consistency  wheter no value is provide as info value .[&#39;&#39;] </span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iteminfo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">))</span><span class="o">==</span><span class="mi">1</span> <span class="p">:</span> 
                        <span class="n">item</span> <span class="p">,</span> <span class="n">infovalue</span><span class="o">=</span> <span class="n">iteminfo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span>
                        <span class="k">pass</span> 
            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span><span class="s1">&#39;&#39;</span>  <span class="ow">or</span> <span class="n">infovalue</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">item</span> <span class="o">==</span><span class="p">[]</span> <span class="ow">or</span> <span class="n">infovalue</span> <span class="o">==</span><span class="kc">None</span> <span class="p">:</span><span class="k">continue</span> 
            <span class="k">else</span> <span class="p">:</span> 

                <span class="n">item</span> <span class="p">,</span> <span class="n">infovalue</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span> <span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="n">infovalue</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;project&#39;</span>  <span class="ow">in</span> <span class="n">item</span>  <span class="ow">or</span>  <span class="s1">&#39;survey&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">or</span> <span class="s1">&#39;date&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">or</span>  <span class="s1">&#39;sitename&#39;</span><span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">infovalue</span><span class="p">)</span>
                <span class="n">listinfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">infovalue</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="s1">&#39;process&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">or</span> <span class="s1">&#39;run&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">or</span> <span class="s1">&#39;remo&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">or</span> <span class="s1">&#39;signconv&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">item</span> <span class="o">==</span><span class="s1">&#39;processingsoftware&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">ProcessingSoftware</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">infovalue</span><span class="p">)</span>
                    <span class="n">listinfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">infovalue</span><span class="p">]))</span>
                <span class="k">else</span> <span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">infovalue</span><span class="p">)</span>
                    <span class="n">listinfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">infovalue</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="s1">&#39;creating_application&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">ProcessingSoftware</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                     <span class="bp">self</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">ProcessingSoftware</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">infovalue</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">infovalue</span><span class="p">)</span>
                <span class="n">listinfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">infovalue</span><span class="p">]))</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">ediinfo</span> <span class="o">=</span> <span class="n">listinfo</span></div>

            
<div class="viewcode-block" id="Info.write_edi_info"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Info.write_edi_info">[docs]</a>    <span class="k">def</span> <span class="nf">write_edi_info</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edi_info_list</span> <span class="o">=</span><span class="kc">None</span> <span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write edi information info . Can read edi and rewrite list or  to provide </span>
<span class="sd">            input as [&#39;key_01=value_01&#39;, &#39;key_02=value_02&#39;, ...,&#39;key_nn=value_nn&#39; ]</span>
<span class="sd">            Note : If value is absent i.e None ,  don&#39;t write the key . Info write method add some</span>
<span class="sd">            field notes informations from other softwares if exists.  </span>
<span class="sd">            </span>
<span class="sd">        params : edi_info_list : list </span>
<span class="sd">        return list </span>
<span class="sd">                e:g :     </span>
<span class="sd">                    &gt;&gt;&gt; file_edi_2=&#39;SAMTEX.edi_2.edi&#39;</span>
<span class="sd">                    &gt;&gt;&gt; file_edi= &#39;S00_ss.edi&#39;</span>
<span class="sd">                    &gt;&gt;&gt; path =  os.path.join(os.environ[&quot;pyCSAMT&quot;],  &#39;csamtpy&#39;,&#39;data&#39;, file_edi_2)</span>
<span class="sd">                    ... info_obj =Info.get_info_list_from_edi(edi_fn=path)</span>
<span class="sd">                    ... print(info_obj.write_edi_info())</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;writing ediinfo from &lt;</span><span class="si">%s</span><span class="s1">&gt; class.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="n">write_info</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;&gt;INFO</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">edi_info_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ediinfo</span> <span class="o">=</span> <span class="n">edi_info_list</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ediinfo</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">infokeys</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;project&#39;</span> <span class="p">,</span> <span class="s1">&#39;survey&#39;</span> <span class="p">,</span><span class="s1">&#39;creationdate&#39;</span><span class="p">,</span>  <span class="s1">&#39;sitename&#39;</span> <span class="p">]:</span> 
                    <span class="n">valueinfo</span> <span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Source</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s1">&#39;process&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;run&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;rem&#39;</span><span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;signconv&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="p">:</span> 
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;processingsoftware&#39;</span><span class="p">:</span> 
                        <span class="n">valueinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">ProcessingSoftware</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span><span class="s1">&#39;processedby&#39;</span><span class="p">:</span> 
                        <span class="n">valueinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Processing</span><span class="p">,</span> <span class="s1">&#39;processedby&#39;</span><span class="p">)</span>
                        
                    <span class="k">else</span> <span class="p">:</span>  <span class="n">valueinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Processing</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span> <span class="n">valueinfo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;processedby&#39;</span><span class="p">:</span> <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">valueinfo</span><span class="p">)),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                <span class="k">else</span> <span class="p">:</span> <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span>
                                                  <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">valueinfo</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
            <span class="c1">#add softwares info </span>
            <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;CREATINGSOFTWARE&#39;</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span>
                                       <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Source</span><span class="p">,</span> <span class="s1">&#39;creatingsoftware&#39;</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
            <span class="c1"># write_info.append(&#39;&#39;.join([&#39;  {0}&#39;.format(&#39;CREATIONDATE&#39;), &#39;=&#39;,</span>
            <span class="c1">#                            getattr(self.Source, &#39;creationdate&#39;), &#39;\n&#39;]))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;FILTER&#39;</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span>
                                           <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                                       
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ediinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1">#rewrite for consistency</span>
            
            <span class="k">for</span> <span class="n">infok</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">infokeys</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">infok</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;project&#39;</span> <span class="p">,</span> <span class="s1">&#39;survey&#39;</span> <span class="p">,</span> <span class="s1">&#39;creationdate&#39;</span> <span class="p">,</span>  <span class="s1">&#39;sitename&#39;</span> <span class="p">]:</span> 
                    <span class="n">valueinf</span> <span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Source</span><span class="p">,</span> <span class="n">infok</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">infok</span> <span class="o">==</span> <span class="s1">&#39;creationdate&#39;</span> <span class="p">:</span> <span class="n">valueinf</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Source</span><span class="p">,</span> <span class="n">infok</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s1">&#39;process&#39;</span> <span class="ow">in</span> <span class="n">infok</span> <span class="ow">or</span> <span class="s1">&#39;run&#39;</span> <span class="ow">in</span> <span class="n">infok</span> <span class="ow">or</span> <span class="s1">&#39;rem&#39;</span><span class="ow">in</span> <span class="n">infok</span> <span class="ow">or</span> <span class="s1">&#39;signconv&#39;</span> <span class="ow">in</span> <span class="n">infok</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">infok</span> <span class="o">==</span> <span class="s1">&#39;processedby&#39;</span> <span class="p">:</span><span class="n">valueinf</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Source</span><span class="o">.</span><span class="n">creatingsoftware</span><span class="p">)</span>    
                    <span class="k">elif</span> <span class="n">infok</span> <span class="o">==</span> <span class="s1">&#39;processingsoftware&#39;</span> <span class="p">:</span> <span class="n">valueinf</span> <span class="o">=</span><span class="s1">&#39;&quot;</span><span class="si">{0}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> 
                            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Processing</span><span class="o">.</span><span class="n">ProcessingSoftware</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">))</span>
                    <span class="k">else</span> <span class="p">:</span> <span class="n">valueinf</span> <span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Processing</span><span class="p">,</span> <span class="n">infok</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
                    <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;FILTER&#39;</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                <span class="k">else</span> <span class="p">:</span> <span class="n">valueinf</span> <span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infok</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">valueinf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span><span class="k">continue</span>   
                <span class="k">else</span> <span class="p">:</span> <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">infok</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">valueinf</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                
            
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ediinfo</span><span class="p">:</span> <span class="c1">#add others info from procesing files.</span>
                <span class="n">keyi</span><span class="p">,</span> <span class="n">valueinf</span>  <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">keyi</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span> <span class="o">=</span><span class="n">keyi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">valueinf</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span> <span class="o">=</span><span class="n">valueinf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">keyi</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">suit</span><span class="o">.</span><span class="n">latitude</span> <span class="p">:</span>
                    <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyi</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">valueinf</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="n">keyi</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">suit</span><span class="o">.</span><span class="n">azimuth</span> <span class="p">:</span>
                    <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyi</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">valueinf</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span> 
                <span class="k">elif</span> <span class="n">keyi</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">suit</span><span class="o">.</span><span class="n">longitude</span> <span class="p">:</span>
                    <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyi</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">valueinf</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="n">keyi</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">suit</span><span class="o">.</span><span class="n">elevation</span> <span class="p">:</span>
                    <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyi</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">valueinf</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="s1">&#39;notes&#39;</span> <span class="ow">in</span> <span class="n">keyi</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="p">:</span> <span class="c1">#add some other fieldnotes : </span>
                    <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyi</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">valueinf</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
        
        <span class="n">write_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>     
        <span class="k">return</span> <span class="n">write_info</span></div></div>
            
<div class="viewcode-block" id="DefineMeasurement"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.DefineMeasurement">[docs]</a><span class="k">class</span> <span class="nc">DefineMeasurement</span><span class="p">:</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Begins Measurement definition data section . Defines Location of sensors </span>
<span class="sd">    and parameters pertainning to runs for each measurments . </span>
<span class="sd">    </span>
<span class="sd">    for instance :</span>
<span class="sd">         &gt;=DEFINEMEAS</span>
<span class="sd">             MAXCHAN=7</span>
<span class="sd">             MAXRUN=999</span>
<span class="sd">             MAXMEAS=9999</span>
<span class="sd">             UNITS=M</span>
<span class="sd">             REFTYPE=CART</span>
<span class="sd">             REFLAT=-30:52:05.62</span>
<span class="sd">             REFLONG=21:44:35.00</span>
<span class="sd">             REFELEV=1166</span>
<span class="sd">              </span>
<span class="sd">             &gt;!****CHANNELS USING ORIGINAL SITE LAYOUT. FOR ROTATIONS SEE ZROT****!</span>
<span class="sd">            &gt;HMEAS ID=1001.001 CHTYPE=HX X=      0.0 Y=      0.0 Z=   0.0 AZM=   0.0</span>
<span class="sd">            &gt;HMEAS ID=1002.001 CHTYPE=HY X=      0.0 Y=      0.0 Z=   0.0 AZM=  90.0</span>
<span class="sd">            &gt;HMEAS ID=1003.001 CHTYPE=HZ X=      0.0 Y=      0.0 Z=   0.0 AZM=   0.0</span>
<span class="sd">            &gt;EMEAS ID=1004.001 CHTYPE=EX X=    -50.0 Y=      0.0 Z=   0.0 X2=     50.0 Y2=      0.0 AZM=   0.0</span>
<span class="sd">            &gt;EMEAS ID=1005.001 CHTYPE=EY X=      0.0 Y=    -50.0 Z=   0.0 X2=      0.0 Y2=     50.0 AZM=  90.0</span>
<span class="sd">    </span>
<span class="sd">        :param : defineMeas_list : list : </span>
<span class="sd">            to get the list for define measurement ,</span>
<span class="sd">            it&#39;s better to call the classmethod &lt;get_define_measurement_info&gt; to </span>
<span class="sd">            full path to .edi file to read in.</span>
<span class="sd">            </span>

<span class="sd">        ================= ==================================== ======== ===========</span>
<span class="sd">        Attributes        Description                          Default  Restriction </span>
<span class="sd">        ================= ==================================== ======== ===========</span>
<span class="sd">        defineMeas_list   list of definemeasurment             None     no</span>
<span class="sd">        maxchan           Maximum number of channels measured  None     yes</span>
<span class="sd">        maxmeas           Maximum number of measurements       9999     yes</span>
<span class="sd">        maxrun            Maximum number of measurement runs   999      yes</span>
<span class="sd">        meas_####         Hmeasurement or EmEasurment object   None     yes</span>
<span class="sd">                          defining the measurement made  </span>
<span class="sd">        refelev           Reference elevation (m)              None     yes</span>
<span class="sd">        reflat            Reference latitude                   None     yes</span>
<span class="sd">        refloc            Reference location                   None     yes</span>
<span class="sd">        reflon            Reference longituted                 None     yes</span>
<span class="sd">        reftype           Reference coordinate system          &#39;cart&#39;   yes</span>
<span class="sd">        units             Units of length                      m        yes</span>
<span class="sd"> </span>
<span class="sd">        ================= ==================================== ======== ===========</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">definemeasurementkeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;maxchan&#39;</span><span class="p">,</span> <span class="s1">&#39;maxrun&#39;</span><span class="p">,</span> <span class="s1">&#39;maxmeas&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;reftype&#39;</span><span class="p">,</span> <span class="s1">&#39;reflat&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;reflong&#39;</span><span class="p">,</span> <span class="s1">&#39;refelev&#39;</span><span class="p">]</span>
    <span class="n">definemeasurement_comment</span> <span class="o">=</span> <span class="s1">&#39;&gt;!***channels using original site layout. For rotations see zrot***!&#39;</span>

    <span class="n">nchan</span> <span class="o">=</span><span class="mi">0</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defineMeas_list</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">:</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span><span class="o">=</span><span class="n">defineMeas_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxchan</span> <span class="o">=</span><span class="kc">None</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">maxrun</span> <span class="o">=</span><span class="mi">999</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxmeas</span> <span class="o">=</span><span class="mi">9999</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span><span class="s1">&#39;m&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reflat</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_reflong</span><span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_refelev</span> <span class="o">=</span><span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">reftype</span> <span class="o">=</span><span class="s1">&#39;CART&#39;</span>

   
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">read_define_measurement</span><span class="p">()</span>
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">reflat</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reflat</span> 
    <span class="nd">@reflat</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">reflat</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reflat</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_reflat</span> <span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">assert_lat_value</span><span class="p">(</span><span class="n">reflat</span><span class="p">)</span>

    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">reflong</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reflong</span>
    <span class="nd">@reflong</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">reflong</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reflong</span><span class="p">):</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">_reflong</span> <span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">assert_lon_value</span><span class="p">(</span><span class="n">reflong</span><span class="p">)</span>
        
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">refelev</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refelev</span>
    <span class="nd">@refelev</span><span class="o">.</span><span class="n">setter</span> 
    <span class="k">def</span> <span class="nf">refelev</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elevation</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_refelev</span> <span class="o">=</span> <span class="n">gis</span><span class="o">.</span><span class="n">assert_elevation_value</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span>

            
<div class="viewcode-block" id="DefineMeasurement.get_DefineMeasurement_info"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.DefineMeasurement.get_DefineMeasurement_info">[docs]</a>    <span class="nd">@classmethod</span> 
    <span class="k">def</span> <span class="nf">get_DefineMeasurement_info</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">edi_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        class method to get definemeasurment list  </span>
<span class="sd">        params : edi_fn : full path to edifiles. </span>
<span class="sd">        return class </span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Reading &lt; </span><span class="si">%s</span><span class="s1">&gt; file from &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">edi_fn</span><span class="p">),</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        
        <span class="n">_flagmeas</span> <span class="o">=</span><span class="mi">0</span>
        <span class="n">dfmeasurementlist</span> <span class="o">=</span> <span class="p">[]</span> 
        <span class="k">if</span> <span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;Can not read edifile .None value is found.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">edi_fn</span><span class="p">)</span> <span class="o">==</span><span class="s1">&#39;edi&#39;</span><span class="p">:</span> 
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">edi_fn</span> <span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span> <span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fdefm</span> <span class="p">:</span> 
                <span class="n">edilines</span> <span class="o">=</span><span class="n">fdefm</span><span class="o">.</span><span class="n">readlines</span> <span class="p">()</span>
            <span class="k">for</span> <span class="n">dd</span> <span class="p">,</span> <span class="n">dmvalue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edilines</span><span class="p">)</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="s1">&#39;&gt;=definemeas&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">dmvalue</span> <span class="ow">or</span> <span class="n">dmvalue</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;=DEFINEMEAS&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&gt;=DEFINEMEAS&#39;</span><span class="p">,</span><span class="n">dmvalue</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                    <span class="n">_flagmeas</span><span class="o">=</span> <span class="n">dd</span>
                
                <span class="k">if</span> <span class="n">_flagmeas</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span> 
                    <span class="k">if</span> <span class="n">dmvalue</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;=mtsect&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span><span class="o">&gt;=</span><span class="mi">0</span>  <span class="ow">or</span> <span class="n">dmvalue</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;=emapsect&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;&gt;=MTSECT&#39;</span> <span class="ow">in</span> <span class="n">dmvalue</span> <span class="ow">or</span> <span class="s1">&#39;&gt;=EMAPSECT&#39;</span> <span class="ow">in</span> <span class="n">dmvalue</span><span class="p">:</span>
 
                            <span class="n">dfmeasurementlist</span><span class="o">=</span> <span class="n">edilines</span><span class="p">[</span><span class="n">_flagmeas</span><span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">dd</span><span class="p">]</span>
                            <span class="k">break</span> 
   
        <span class="k">return</span> <span class="bp">cls</span> <span class="p">(</span><span class="n">defineMeas_list</span><span class="o">=</span><span class="n">dfmeasurementlist</span><span class="p">)</span> </div>
    
    
<div class="viewcode-block" id="DefineMeasurement.read_define_measurement"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.DefineMeasurement.read_define_measurement">[docs]</a>    <span class="k">def</span> <span class="nf">read_define_measurement</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">define_measurement_list</span>  <span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        readmeasurement inedilist and populate attributes . </span>
<span class="sd">        param : define_measurement_list : list : lif of measurement data </span>
<span class="sd">            can be : [key_01=value_01 , ..., key_xx = value_xx]</span>
<span class="sd">            Emeas and Hmeas will be set on dictionnary and call the class to populate attribute</span>
<span class="sd">            default is None </span>
<span class="sd">            eg :</span>
<span class="sd">                    &gt;&gt;&gt; file_edi= &#39;S00_ss.edi&#39;</span>
<span class="sd">                    &gt;&gt;&gt; path =  os.path.join(os.environ[&quot;pyCSAMT&quot;], &#39;csamtpy&#39;,&#39;data&#39;, file_edi_2)</span>
<span class="sd">                                          </span>
<span class="sd">                    &gt;&gt;&gt; definemeas =DefineMeasurement.get_measurement_info(edi_fn=path)</span>
<span class="sd">                    ... print(definemeas.define_measurement)</span>
<span class="sd">                    .. print(definemeas.meas_ex)</span>
<span class="sd">            to get measurement_hx or measurement_ex : </span>
<span class="sd">                for instance get attribute &lt;id&gt; of Emeasurement :</span>
<span class="sd">                    ... print(definemeas.meas_ex.id) --&gt; output =1004.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Reading DefineMeasurement info &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">xmeas_list</span> <span class="o">=</span><span class="p">[]</span>

        <span class="k">if</span> <span class="n">define_measurement_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span><span class="o">=</span> <span class="n">define_measurement_list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span><span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;Can not find DefineMeasurment list to read.&#39;</span>\
                                                                        <span class="s1">&#39;Please provide the list of definemeasurment.&#39;</span>\
                                                                        <span class="s1">&#39; e:g:[key_01=value_01 , ..., key_xx = value_xx] &#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;r^</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;hmeas&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">keys</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;r^</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;emeas&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span><span class="n">keys</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>   
                <span class="k">try</span> <span class="p">:</span> 
                    <span class="n">dfmkey</span><span class="p">,</span> <span class="n">dfmvalue</span> <span class="o">=</span><span class="n">keys</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">:</span> <span class="k">pass</span> 
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;maxchan&#39;</span> <span class="ow">in</span> <span class="n">dfmkey</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmvalue</span><span class="p">)</span> <span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">dfmvalue</span> <span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="p">:</span> <span class="n">dfmvalue</span> <span class="o">=</span> <span class="s1">&#39;7&#39;</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfmvalue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">dfmvalue</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span>  

                    <span class="n">dfmkey</span> <span class="p">,</span> <span class="n">dfmvalue</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="n">dfmkey</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">dfmvalue</span><span class="p">))</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                
                    <span class="k">if</span> <span class="n">dfmkey</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">definemeasurementkeys</span> <span class="p">:</span> 
                        <span class="c1">#set attribute and convert to degree decimal lon and lat</span>
                        <span class="k">if</span> <span class="s2">&quot;reflat&quot;</span>  <span class="ow">in</span> <span class="n">dfmkey</span><span class="p">:</span> 
                            <span class="bp">self</span><span class="o">.</span><span class="n">reflat</span><span class="o">=</span> <span class="n">dfmvalue</span>
                            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">dfmkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflat</span><span class="p">)</span>
                            <span class="n">xmeas_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dfmkey</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">gis</span><span class="o">.</span><span class="n">convert_position_float2str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflat</span><span class="p">)),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">]))</span>
                        <span class="k">elif</span>  <span class="n">dfmkey</span> <span class="o">==</span> <span class="s1">&#39;reflon&#39;</span> <span class="ow">or</span> <span class="n">dfmkey</span> <span class="o">==</span><span class="s1">&#39;reflong&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dfmkey</span> <span class="o">==</span><span class="s1">&#39;reflon&#39;</span><span class="p">:</span><span class="n">dfmkey</span> <span class="o">+=</span><span class="s1">&#39;g&#39;</span>          <span class="c1">#add &quot;g&quot; to get reflong defalut attribut</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">reflong</span> <span class="o">=</span> <span class="n">dfmvalue</span> 
                            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">dfmkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflong</span><span class="p">)</span>
                            <span class="n">xmeas_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dfmkey</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">gis</span><span class="o">.</span><span class="n">convert_position_float2str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflong</span><span class="p">)),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">]))</span>
                        <span class="k">elif</span> <span class="s1">&#39;refelev&#39;</span> <span class="ow">in</span> <span class="n">dfmkey</span> <span class="p">:</span> 
                            <span class="bp">self</span><span class="o">.</span><span class="n">refelev</span><span class="o">=</span> <span class="n">dfmvalue</span>
                            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">dfmkey</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">refelev</span><span class="p">)</span>
                            <span class="n">xmeas_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dfmkey</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refelev</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">]))</span>
                        <span class="k">else</span> <span class="p">:</span> 
                            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">dfmkey</span><span class="p">,</span> <span class="n">dfmvalue</span><span class="p">)</span>
                            <span class="n">xmeas_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dfmkey</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">dfmvalue</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">]))</span>
      
            <span class="c1">#elif re.match(&#39;r^{0}&#39;.format(&#39;hmeas&#39;.upper()), keys) is not None or re.match(&#39;r^{0}&#39;.format(&#39;emeas&#39;.upper()),keys) is not  None :            </span>
            <span class="k">if</span> <span class="s1">&#39;hmeas&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">keys</span> <span class="p">:</span>  <span class="c1"># set the meas into dictionar of Emas and Hmeas </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nchan</span> <span class="o">+=</span><span class="mi">1</span> 
                <span class="n">keyH</span><span class="o">=</span><span class="n">keys</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">keyH</span><span class="o">=</span> <span class="n">gather_measurement_key_value_with_str_parser</span> <span class="p">(</span><span class="n">old_measurement_list</span><span class="o">=</span><span class="n">keyH</span><span class="p">)</span>
                <span class="n">hdict</span><span class="o">=</span><span class="p">{}</span>
                <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">keyH</span> <span class="p">:</span> 
                    <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">ss</span> <span class="p">:</span> 
                        <span class="n">hmeask</span><span class="p">,</span> <span class="n">hmeasv</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                        <span class="n">hdict</span> <span class="p">[</span><span class="n">hmeask</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">=</span> <span class="n">hmeasv</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                
                <span class="n">xmeas_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdict</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;emeas&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">keys</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nchan</span> <span class="o">+=</span><span class="mi">1</span>        <span class="c1">#get number of channels</span>
                <span class="n">keyE</span> <span class="o">=</span><span class="n">keys</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">keyE</span><span class="o">=</span> <span class="n">gather_measurement_key_value_with_str_parser</span> <span class="p">(</span><span class="n">old_measurement_list</span><span class="o">=</span><span class="n">keyE</span><span class="p">)</span>
                <span class="n">edict</span> <span class="o">=</span><span class="p">{}</span>
                <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">keyE</span> <span class="p">:</span> 
                    <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">ss</span> <span class="p">:</span> 
                        <span class="n">emeask</span><span class="p">,</span> <span class="n">emeasv</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>   
                        <span class="n">edict</span><span class="p">[</span><span class="n">emeask</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span><span class="n">emeasv</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">xmeas_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edict</span><span class="p">)</span>
                

        <span class="k">for</span> <span class="n">dict_meas_eh</span> <span class="ow">in</span> <span class="n">xmeas_list</span> <span class="p">:</span> <span class="c1">#create attribute Emeas and Hmeas fonction to chtype value </span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_meas_eh</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> 
                <span class="n">newkey</span> <span class="o">=</span><span class="s2">&quot;meas_</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_meas_eh</span><span class="p">[</span><span class="s1">&#39;chtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">if</span> <span class="s1">&#39;h&#39;</span> <span class="ow">in</span> <span class="n">newkey</span> <span class="p">:</span>
                    <span class="n">measvalue</span> <span class="o">=</span> <span class="n">Hmeasurement</span><span class="p">(</span><span class="o">**</span><span class="n">dict_meas_eh</span><span class="p">)</span><span class="c1"># self.meas_hx etc..</span>
                <span class="k">if</span> <span class="s1">&#39;e&#39;</span> <span class="ow">in</span> <span class="n">newkey</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="p">:</span>
                    <span class="n">measvalue</span> <span class="o">=</span> <span class="n">Emeasurement</span><span class="p">(</span><span class="o">**</span><span class="n">dict_meas_eh</span><span class="p">)</span> <span class="c1"># self.meas_ex etc..</span>
                <span class="k">try</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">newkey</span><span class="p">,</span> <span class="n">measvalue</span><span class="p">)</span> 
                <span class="k">except</span> <span class="p">:</span>
                    <span class="ne">AttributeError</span> 
                    <span class="k">pass</span> 
         
                
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Number of channels &quot;emeas&quot; and &quot;hmeas&quot; found is &lt;</span><span class="si">%s</span><span class="s1">&gt;.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nchan</span><span class="p">)</span>
        
   
        <span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span> <span class="o">=</span> <span class="n">xmeas_list</span></div>

<div class="viewcode-block" id="DefineMeasurement.write_define_measurement"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.DefineMeasurement.write_define_measurement">[docs]</a>    <span class="k">def</span> <span class="nf">write_define_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">define_measurement_list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        write definemeasurement method ,intend to write and rewrite measurements infos into list. </span>
<span class="sd">        informations must be on list as possible if not may set attribute manually :</span>
<span class="sd">            [key01=value02 , ..., keynn=valuenn + dictXX ]</span>
<span class="sd">            dictXX ={meas_e}, {meas_hx}, {meas_ey}{meas_hx}, {meas_hy} {meas_hz}</span>
<span class="sd">            </span>
<span class="sd">        param: define_measurement_list :list </span>
<span class="sd">        return : </span>
<span class="sd">        define_measurement :list </span>
<span class="sd">        </span>
<span class="sd">        eg ::    if no edifiles is provided , can write definemeasurement  by creating dict of Eand H measurment. For instance :</span>
<span class="sd">                    ex_dict ={&#39;id&#39;:1002, &#39;chtype&#39;:&#39;Ex&#39;, &#39;x&#39;:0, &#39;y&#39;:0, &#39;z&#39;:0, &#39;x2&#39;:-50,&#39;y2&#39;:0, &#39;z2&#39;:0, </span>
<span class="sd">                                       &#39;acqchan&#39;:0,&#39;filter&#39;:&#39;hanning&#39;, &#39;sensor&#39;:&#39;ex&#39;, &#39;gain&#39;:None}</span>
<span class="sd">                    ey_dict ={&#39;id&#39;:1003.1, &#39;chtype&#39;:&#39;Ey&#39;, &#39;x&#39;:0, &#39;y&#39;:50, &#39;z&#39;:0, &#39;x2&#39;:0,&#39;y2&#39;:0, &#39;z2&#39;:0, </span>
<span class="sd">                                   &#39;acqchan&#39;:0}</span>
<span class="sd">                    hy_dict ={&#39;id&#39;:1003, &#39;chtype&#39;:&#39;Hy&#39;, &#39;x&#39;:0, &#39;y&#39;:50, &#39;z&#39;:90, &#39;azm&#39;:0.0,&#39;dip&#39;:35,</span>
<span class="sd">                                       &#39;acqchan&#39;:&#39;hy&#39;,&#39;filter&#39;:&#39;Hanning&#39;, &#39;sensor&#39;:None, &#39;gain&#39;:0, &#39;measdate&#39;:&#39;&#39;}</span>
<span class="sd">                    </span>
<span class="sd">                    &gt;&gt;&gt; definemeas =DefineMeasurement()</span>
<span class="sd">                    &gt;&gt;&gt; ex =Emeasurement(**ex_dict)</span>
<span class="sd">                    &gt;&gt;&gt; ey =Emeasurement(**ey_dict)</span>
<span class="sd">                    &gt;&gt;&gt; hy=Hmeasurement(**hy_dict)</span>
<span class="sd">                    ... definemeas.__setattr__(&#39;meas_ex&#39;, ex)</span>
<span class="sd">                    ... definemeas.__setattr__(&#39;meas_ey&#39;, ey)</span>
<span class="sd">                    ... definemeas.__setattr__(&#39;meas_hy&#39;, hy)</span>
<span class="sd">                    ... print(definemeas.write_define_measurement())</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">write_dfmeasurements</span><span class="p">,</span> <span class="n">dictlist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&gt;=DEFINEMEAS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">],[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;write defineMeasurement infos &lt;</span><span class="si">%s</span><span class="s1">&gt;.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">define_measurement_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span> <span class="o">=</span><span class="n">define_measurement_list</span> 

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">minimum_parser_to_write_edi</span><span class="p">(</span><span class="n">edilines</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;.edi_parser provided is wrong.Definemeasurement list provided cannot be write.&#39;</span>\
                             <span class="s1">&#39; Please provide key values as :[key01=value02 , ..., keynn=valuenn + dictXX ]&#39;</span>\
                                 <span class="s1">&#39;with dictXX =</span><span class="si">{meas_e}</span><span class="s1">, </span><span class="si">{meas_hx}</span><span class="s1">, </span><span class="si">{meas_ey}{meas_hx}</span><span class="s1">, </span><span class="si">{meas_hy}</span><span class="s1"> </span><span class="si">{meas_hz}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Please check your definemeasurement list provided. Can not be write.&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s2">&quot;Can not write the items on the definemeasurement list provided. &quot;</span>\
                                            <span class="s2">&quot;It seems no right parser if found.&quot;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">itemkey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">itemkey</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="p">:</span>
                   <span class="n">keydfmeas</span> <span class="p">,</span> <span class="n">valuedfmeas</span> <span class="o">=</span> <span class="n">itemkey</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                   <span class="n">keydfmeas</span> <span class="p">,</span> <span class="n">valuedfmeas</span> <span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="n">keydfmeas</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="n">valuedfmeas</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> 
                   <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keydfmeas</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">valuedfmeas</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">itemkey</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span><span class="n">dictlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">itemkey</span><span class="p">)</span>
                
            <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">definemeasurement_comment</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">itemkey</span> <span class="ow">in</span> <span class="n">dictlist</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;h&#39;</span> <span class="ow">in</span> <span class="n">itemkey</span><span class="p">[</span><span class="s1">&#39;chtype&#39;</span><span class="p">]</span> <span class="p">:</span>
                    <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&gt;hmeas&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                    <span class="c1"># valuemeas= getattr(self, &#39;meas_{}&#39;.format(itemkey[&#39;chtype&#39;]))</span>
                <span class="k">elif</span> <span class="s1">&#39;e&#39;</span> <span class="ow">in</span> <span class="n">itemkey</span><span class="p">[</span><span class="s1">&#39;chtype&#39;</span><span class="p">]</span> <span class="p">:</span><span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&gt;emeas&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

                <span class="k">for</span> <span class="n">keym</span><span class="p">,</span> <span class="n">valm</span> <span class="ow">in</span> <span class="n">itemkey</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">valm</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="p">,</span> <span class="s1">&#39;None&#39;</span> <span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="p">:</span> <span class="n">valm</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:&gt;7.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">.</span><span class="mi">0</span><span class="p">))</span>
                    <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keym</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{0:&gt;7}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">valm</span><span class="o">.</span><span class="n">upper</span><span class="p">())]))</span>
                <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_measurement</span> <span class="ow">is</span>  <span class="kc">None</span> <span class="p">:</span> <span class="c1"># for consistency , all options to right file are welcome .</span>
        
            <span class="n">chtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;ey&#39;</span><span class="p">,</span> <span class="s1">&#39;hx&#39;</span><span class="p">,</span> <span class="s1">&#39;hy&#39;</span><span class="p">,</span> <span class="s1">&#39;hz&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">keydefm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">definemeasurementkeys</span><span class="p">:</span>
                <span class="n">measvalues</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keydefm</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">keydefm</span> <span class="o">==</span><span class="s1">&#39;reflong&#39;</span><span class="p">:</span> <span class="n">measvalues</span> <span class="o">=</span><span class="n">gis</span><span class="o">.</span><span class="n">convert_position_float2str</span><span class="p">(</span><span class="n">measvalues</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">keydefm</span> <span class="o">==</span><span class="s1">&#39;reflat&#39;</span><span class="p">:</span> <span class="n">measvalues</span> <span class="o">=</span><span class="n">gis</span><span class="o">.</span><span class="n">convert_position_float2str</span><span class="p">(</span><span class="n">measvalues</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">measvalues</span>  <span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="n">measvalues</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">measvalues</span><span class="o">=</span><span class="s1">&#39;&#39;</span> 
                <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keydefm</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">measvalues</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
            <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">definemeasurement_comment</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># then write Hmeasurement and Emeasurements throught their attributes.</span>
            <span class="k">for</span> <span class="n">meastype</span> <span class="ow">in</span> <span class="n">chtype</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;meas_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meastype</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="s1">&#39;e&#39;</span> <span class="ow">in</span> <span class="n">meastype</span> <span class="p">:</span>
                        <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&gt;emeas&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                        <span class="k">for</span> <span class="n">eattr</span> <span class="ow">in</span> <span class="n">Emeasurement</span><span class="o">.</span><span class="n">emeasurementkey</span> <span class="p">:</span>
                            <span class="k">try</span> <span class="p">:</span><span class="n">tempattr</span> <span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;meas_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meastype</span><span class="p">))</span>
                            <span class="k">except</span> <span class="p">:</span>
                                <span class="ne">AttributeError</span> 
                                <span class="k">pass</span> 
                            <span class="k">else</span> <span class="p">:</span> 
                                
                                <span class="n">valuemeasxx</span> <span class="o">=</span> <span class="n">tempattr</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eattr</span><span class="p">)]</span>

                                <span class="k">if</span> <span class="n">valuemeasxx</span> <span class="o">==</span><span class="kc">None</span> <span class="p">:</span> <span class="n">valuemeasxx</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
                                <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eattr</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{0:&gt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">valuemeasxx</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())]))</span>
                        <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s1">&#39;h&#39;</span> <span class="ow">in</span> <span class="n">meastype</span> <span class="p">:</span>
                        <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&gt;hmeas&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                        <span class="k">for</span> <span class="n">hattr</span> <span class="ow">in</span> <span class="n">Hmeasurement</span><span class="o">.</span><span class="n">hmeasurementkey</span> <span class="p">:</span> 
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">tempattr</span> <span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;meas_</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meastype</span><span class="p">))</span>
                            <span class="k">except</span> <span class="p">:</span>
                                <span class="ne">AttributeError</span> 
                                <span class="k">pass</span> 
                            <span class="k">else</span> <span class="p">:</span> 
                                <span class="n">valuemeasyy</span> <span class="o">=</span> <span class="n">tempattr</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hattr</span><span class="p">)]</span>
                                <span class="k">if</span> <span class="n">valuemeasyy</span> <span class="o">==</span><span class="kc">None</span> <span class="p">:</span> <span class="n">valuemeasyy</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
                                <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hattr</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{0:&gt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">valuemeasyy</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())]))</span>
                        <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">write_dfmeasurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">write_dfmeasurements</span></div></div>
                             
<div class="viewcode-block" id="Hmeasurement"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Hmeasurement">[docs]</a><span class="k">class</span> <span class="nc">Hmeasurement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the sensor location and orientation , and run parameters for</span>
<span class="sd">        a magnetic field measurement.HMeasurement contains metadata for a magnetic </span>
<span class="sd">        field measurement.</span>
<span class="sd">    </span>
<span class="sd">        ====================== ====================================================</span>
<span class="sd">        Attributes             Description</span>
<span class="sd">        ====================== ====================================================</span>
<span class="sd">        id                     Measurement ID , channel number </span>
<span class="sd">        chtype                 Type of Hmeasurment[ HX | HY | HZ | RHX | RHY ]</span>
<span class="sd">        x                      x (m) north offset from reference sensor </span>
<span class="sd">        y                      y (m) offest from ref sensor </span>
<span class="sd">        azm                    angle of sensor relative to north = 0</span>
<span class="sd">        acqchan                name of the channel acquired usually same as chtype</span>
<span class="sd">        dip                    dip angle for sensor (&quot;&quot;)</span>
<span class="sd">        filter                 description of sensor to run (&quot;&quot;)</span>
<span class="sd">        gain                   gain used for run (&quot;&quot;)</span>
<span class="sd">        measdate               date of run (&quot;&quot;)</span>
<span class="sd">        ====================== ====================================================</span>
<span class="sd">    </span>
<span class="sd">        :Fill Metadata: ::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; import csamtpy.ff.core.edi as csedi</span>
<span class="sd">            &gt;&gt;&gt; hmeas_dict = {&#39;id&#39;: &#39;1000.3&#39;, &#39;chtype&#39;:&#39;hx&#39;, &#39;x&#39;:0, &#39;y&#39;:0, &#39;azm&#39;:0, &#39;sensor&#39;:&#39;None&#39;}</span>
<span class="sd">            &gt;&gt;&gt; hmeas = csedi.Hmeasurement(**hmeas_dict )</span>
<span class="sd">            ... print(hmeas.chtype)</span>
<span class="sd">            ... print(hmeas.azm)</span>
<span class="sd">            ... print(hmeas.measdate)</span>
<span class="sd">            ... print(hmeas.sensor)</span>
<span class="sd"> </span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">hmeasurementkey</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;chtype&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;azm&#39;</span><span class="p">,</span><span class="s1">&#39;dip&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;acqchan&#39;</span><span class="p">,</span><span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;sensor&#39;</span><span class="p">,</span> <span class="s1">&#39;gain&#39;</span><span class="p">,</span> <span class="s1">&#39;measdate&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span> <span class="p">:</span> 
        
       <span class="k">for</span>  <span class="n">hmeaskey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hmeasurementkey</span><span class="p">:</span> <span class="c1">#initialise attribute</span>
            <span class="k">if</span> <span class="n">hmeaskey</span> <span class="o">==</span><span class="s1">&#39;measdate&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">hmeaskey</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">  %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">()))</span>
            <span class="k">elif</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">hmeaskey</span> <span class="ow">or</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">hmeaskey</span> <span class="ow">or</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="n">hmeaskey</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">hmeaskey</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:&lt;7.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">.</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">hmeaskey</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

       <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="nb">list</span> <span class="p">(</span><span class="n">kws</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="c1">#set attribute coming from dict</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hmeasurementkey</span><span class="p">:</span> 
                <span class="k">try</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;10.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="n">keys</span><span class="p">])))</span>
                <span class="k">except</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">kws</span><span class="p">[</span><span class="n">keys</span><span class="p">])</span>  </div>
                
<div class="viewcode-block" id="Emeasurement"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Emeasurement">[docs]</a><span class="k">class</span> <span class="nc">Emeasurement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the electrode location , and run parameters for</span>
<span class="sd">        an electric field measurement.EMeasurement contains metadata for an </span>
<span class="sd">        electric field measurement</span>
<span class="sd">    </span>
<span class="sd">        ====================== ====================================================</span>
<span class="sd">        Attributes             Description (Restriction)</span>
<span class="sd">        ====================== ====================================================</span>
<span class="sd">        id                     Measurement ID , channel number  (&#39;required &#39;)</span>
<span class="sd">        chtype                 Type of Hmeasurement[ Ex | Ey ](required)</span>
<span class="sd">        x                      x (m) north offset from first electrode (reauired)</span>
<span class="sd">        y                      y (m) offest from ref for first electrode(reauired)</span>
<span class="sd">        z                      z offset from the ref for first electrode(reauired) </span>
<span class="sd">        x2                      x offset from the 2nd electrode (&#39;required&#39;)</span>
<span class="sd">        y2                      y offset from the 2nd electrode (required)</span>
<span class="sd">        z2                      z offset from the 2nd electrode (&quot;&quot;)</span>
<span class="sd">        acqchan                name of the channel acquired usually same as chtype</span>
<span class="sd">        filter                 description of sensor to run (&quot;&quot;)</span>
<span class="sd">        gain                   gain used for run (&quot;&quot;)</span>
<span class="sd">        measdate               date of run (&quot;&quot;)</span>
<span class="sd">        ====================== ====================================================</span>
<span class="sd">    </span>
<span class="sd">        :Fill Metadata: ::</span>
<span class="sd">    </span>
<span class="sd">            &gt;&gt;&gt; import csamtpy.ff.core.edi as csedi</span>
<span class="sd">            &gt;&gt;&gt; emeas_dict = {&#39;id&#39;: &#39;1000.4&#39;, &#39;chtype&#39;:&#39;ex&#39;, &#39;x&#39;:0, &#39;y&#39;:0, &#39;azm&#39;:0, &#39;acqchan&#39;:&#39;ex&#39;, }</span>
<span class="sd">            &gt;&gt;&gt; emeas = csedi.Hmeasurement(**emeas_dict)</span>
<span class="sd">            ... print(emeas.chtype)</span>
<span class="sd">            ... print(emeas.azm)</span>
<span class="sd">            ... print(emeas.measdate)</span>
<span class="sd"> </span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">emeasurementkey</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;chtype&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="s1">&#39;y2&#39;</span><span class="p">,</span> <span class="s1">&#39;z2&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;acqchan&#39;</span><span class="p">,</span><span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;sensor&#39;</span><span class="p">,</span> <span class="s1">&#39;gain&#39;</span><span class="p">,</span> <span class="s1">&#39;measdate&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span> <span class="p">:</span> 
        
       <span class="k">for</span>  <span class="n">emeaskey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emeasurementkey</span><span class="p">:</span> <span class="c1">#initialise attribute</span>
           <span class="k">if</span> <span class="n">emeaskey</span> <span class="o">==</span><span class="s1">&#39;measdate&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">emeaskey</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">  %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">()))</span>
           <span class="k">elif</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">emeaskey</span> <span class="ow">or</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">emeaskey</span> <span class="ow">or</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="n">emeaskey</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">emeaskey</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;7.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">.</span><span class="mi">0</span><span class="p">))</span>
           <span class="k">else</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">emeaskey</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

       <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="nb">list</span> <span class="p">(</span><span class="n">kws</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">keys</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emeasurementkey</span><span class="p">:</span> 
                <span class="k">try</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:&lt;10.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="n">keys</span><span class="p">])))</span>
                <span class="k">except</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">kws</span><span class="p">[</span><span class="n">keys</span><span class="p">])</span>            </div>

<div class="viewcode-block" id="TSeries"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.TSeries">[docs]</a><span class="k">class</span> <span class="nc">TSeries</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *** Future plan *** :</span>
<span class="sd">        Begin a times series data section. Defines the set of measurments for which times series </span>
<span class="sd">        data are presented. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span> </div>
<div class="viewcode-block" id="Spectra"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Spectra">[docs]</a><span class="k">class</span> <span class="nc">Spectra</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    *** Future plan *** :</span>
<span class="sd">        Begin a spectra  data section. Defines the set of measurments for which spectra </span>
<span class="sd">        data are presented. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span> </div>

<div class="viewcode-block" id="MTEMAP"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.MTEMAP">[docs]</a><span class="k">class</span> <span class="nc">MTEMAP</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Begins an MT and EMAP data section .Defines the default measurment for MT sounding and </span>
<span class="sd">    Defines the measurments which makeup an EMAP lines. </span>
<span class="sd">    for instance :</span>
<span class="sd">      &gt;=MTSECT                          &gt;=EMAPSECT</span>
<span class="sd">             SECTID=&quot;&quot;                      SECTID=S00</span>
<span class="sd">                NFREQ=**                    NCHAN=4</span>
<span class="sd">                HX= 1001.001                MAXBLKS=999</span>
<span class="sd">                HY= 1002.001                NDIPOLE =47 </span>
<span class="sd">                HZ= 1003.001                NFREQ=17</span>
<span class="sd">                EX= 1004.001                HX= 0.</span>
<span class="sd">                EY= 1005.001                HY= .0</span>
<span class="sd">                                            HZ= NONE</span>
<span class="sd">                                            CHKSUM =None</span>
<span class="sd">        argument : </span>
<span class="sd">            mt_or_emap_section_list : list : mt and emap section </span>
<span class="sd">            can read ediflies by calling class method &lt;&#39;get_mtemap_section_list&#39;&gt;</span>
<span class="sd">            </span>
<span class="sd">     Holds the following information:</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    Attributes        Description               Default          restriction </span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    sectid            Name of this section          None        str or&quot;&quot;</span>
<span class="sd">    nfreq             Number of frequencies      required       int &gt;=1</span>
<span class="sd">    maxblks             maximum number of blocks </span>
<span class="sd">                        of this section             None         int&gt;=1</span>
<span class="sd">    ndipole         Number of dipoles in </span>
<span class="sd">                        the EMAP line              required  </span>
<span class="sd">    type            Descrip. of spatial filter</span>
<span class="sd">                        type used                  None         str or &quot;&quot;</span>
<span class="sd">    hx              Meas ID for Hx measurement     None         Def Meas Id or &quot;      </span>
<span class="sd">    hy              Meas ID for Hy measurement     None         Def Meas Id or &quot;</span>
<span class="sd">    hz              Meas ID for Hz measurement     None         Def Meas Id or &quot;</span>
<span class="sd">    ex              Meas ID for Ex measurement     None         Def Meas Id or &quot;</span>
<span class="sd">    ey              Meas ID for Ey measurement     None         Def Meas Id or &quot;</span>
<span class="sd">    rx              Meas ID for Rx measurement     None         Def Meas Id or &quot;</span>
<span class="sd">    ry              Meas ID for Ry measurement     None         Def Meas Id or &quot;</span>
<span class="sd">    chksum          checksum total for datavalues  None         Num of &quot;&quot;</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    **Note : MTEMAP can recognize functionto value provided with type of data acquired eithe MT or EMAP.</span>
<span class="sd">    </span>
<span class="sd">    More attributes can be added by inputing a key word dictionary</span>

<span class="sd">    &gt;&gt;&gt;MTEMAP(**{&#39;ex&#39;:&#39;0011.001&#39;, &#39;hx&#39;:&#39;0013.001&#39;,&#39;sectid&#39;:&#39;Niable&#39;,&#39;nfreq&#39;:47, </span>
<span class="sd">                 &#39;ey&#39;:&#39;0012.001&#39;, &#39;hy&#39;:0014.001 , &#39;hz&#39;: 0015.001 })</span>
<span class="sd">    &gt;&gt;&gt; MTEMAP (**{&#39;sectid&#39;:&#39;yobkro&#39;,&#39;nfreq&#39;:18 , &#39;maxblks&#39;:100, &#39;hx&#39;:&quot;1003.1&quot;, </span>
<span class="sd">              &#39;ex&#39;:&#39;1005.4&#39;,&#39;hz&#39;:&#39;1006.3&#39;, &#39;ey&#39;:1002.3 , &#39;hy&#39;:&#39;1000.2&#39;,&#39;chksum&#39;:47,</span>
<span class="sd">              &#39;ndipole&#39;:47, &#39;type&#39;:&#39;hann&#39;})</span>
<span class="sd">   </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mtemapsectkey</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;sectid&#39;</span><span class="p">,</span> <span class="s1">&#39;nfreq&#39;</span><span class="p">,</span> <span class="s1">&#39;maxblks&#39;</span><span class="p">,</span> <span class="s1">&#39;hx&#39;</span><span class="p">,</span> <span class="s1">&#39;hy&#39;</span><span class="p">,</span> <span class="s1">&#39;hz&#39;</span><span class="p">,</span> <span class="s1">&#39;ex&#39;</span><span class="p">,</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ry&#39;</span><span class="p">,</span> <span class="s1">&#39;ndipole&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;chksum&#39;</span><span class="p">]</span>
    
    <span class="n">start_data_lines_num</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="n">temp_sectid</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mt_or_emap_section_list</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span> <span class="o">=</span><span class="n">csamtpylog</span><span class="o">.</span><span class="n">get_csamtpy_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectinfo</span> <span class="o">=</span> <span class="n">mt_or_emap_section_list</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectkey</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
            
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span><span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">keys</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_mtemap_section</span><span class="p">()</span>
            
        
<div class="viewcode-block" id="MTEMAP.get_mtemap_section_list"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.MTEMAP.get_mtemap_section_list">[docs]</a>    <span class="nd">@classmethod</span> 
    <span class="k">def</span> <span class="nf">get_mtemap_section_list</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">edi_fn</span> <span class="o">=</span><span class="kc">None</span> <span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MT or EMAP section_classmethod to get special MT info or EMAP info in edifile</span>
<span class="sd">        param :edi_fn :str : full path to edifile </span>
<span class="sd">        return :newclass</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s2">&quot;Read MT Section on edifile &lt;</span><span class="si">%s</span><span class="s2">&gt;: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">edi_fn</span><span class="p">),</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">edi_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span><span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;NoneType can not be read. Please provide your right edipath.&#39;</span><span class="p">)</span>
        <span class="n">mtflag</span><span class="p">,</span>  <span class="n">mtsection</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]</span>
        <span class="n">gmtsectmeasurement</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">SB</span><span class="o">.</span><span class="n">which_file</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span><span class="n">edi_fn</span><span class="p">)</span> <span class="o">==</span><span class="s1">&#39;edi&#39;</span><span class="p">:</span> <span class="c1">#check whether it is edifile.</span>
            <span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="n">edi_fn</span> <span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">encoding</span> <span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fmt</span> <span class="p">:</span> 
                <span class="n">edilines</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">mtitems</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edilines</span><span class="p">)</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="s1">&#39;dataid&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="ow">in</span> <span class="n">mtitems</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;DATAID&#39;</span><span class="p">,</span><span class="n">mtitems</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
                    <span class="n">mitems</span> <span class="o">=</span> <span class="n">mtitems</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">try</span> <span class="p">:</span>
                        <span class="n">forsectid</span> <span class="o">=</span> <span class="n">mitems</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">:</span> <span class="k">pass</span> 
                    <span class="k">else</span> <span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">temp_sectid</span> <span class="o">=</span> <span class="n">forsectid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 

                <span class="k">if</span> <span class="s1">&#39;&gt;=mtsect&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">mtitems</span> <span class="ow">or</span><span class="s1">&#39;&gt;=emapsect&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">mtitems</span>  <span class="ow">or</span> <span class="n">mtitems</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&gt;=mtsect&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">:</span>
                    <span class="n">mtflag</span> <span class="o">=</span><span class="n">ii</span>
                
                <span class="k">if</span>  <span class="p">(</span><span class="n">mtflag</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;&gt;!&#39;</span> <span class="ow">in</span> <span class="n">mtitems</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&gt;!&#39;</span><span class="p">,</span> <span class="n">mtitems</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;&gt;FREQ&#39;</span> <span class="ow">in</span> <span class="n">mtitems</span><span class="p">)</span> <span class="p">:</span> 
                    <span class="n">mtsection</span> <span class="o">=</span> <span class="n">edilines</span><span class="p">[</span><span class="n">mtflag</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ii</span><span class="p">]</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">start_data_lines_num</span> <span class="o">=</span><span class="n">ii</span> <span class="c1"># get the number where start data section .</span>
                    <span class="k">break</span> 
        <span class="c1"># rebuild the list for consistent to be sure to take all params whatever it&#39;s messy</span>

            <span class="n">ss</span> <span class="o">=</span> <span class="n">gather_measurement_key_value_with_str_parser</span><span class="p">(</span><span class="n">old_measurement_list</span><span class="o">=</span><span class="n">mtsection</span><span class="p">)</span>
            <span class="n">gmtsectmeasurement</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
 
        <span class="k">return</span> <span class="bp">cls</span> <span class="p">(</span><span class="n">mt_or_emap_section_list</span> <span class="o">=</span><span class="n">gmtsectmeasurement</span><span class="p">)</span></div>


<div class="viewcode-block" id="MTEMAP.read_mtemap_section"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.MTEMAP.read_mtemap_section">[docs]</a>    <span class="k">def</span> <span class="nf">read_mtemap_section</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mt_or_emap_section_list</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read mtsection and set attribute . values can be set as key :[key01=value01, ..., keynn=valuenn]</span>
<span class="sd">        param : mt_or_emap_section_list: list : mt or emap  section list </span>
<span class="sd">        </span>
<span class="sd">        e:g: </span>
<span class="sd">            &gt;&gt;&gt; import csamtpy.ff.core.edi as csedi </span>
<span class="sd">            ... mtsection_obj= csedi.MTEMAP.get_mtemap_section_list(edi_fn =path)</span>
<span class="sd">            ... info = mtsection_obj.read_mtemap_section()</span>
<span class="sd">            ... print(mtsection_obj.sectid) </span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mtemapsectionlist</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span><span class="p">[],</span><span class="s2">&quot;</span><span class="si">{:&gt;12}</span><span class="s2">&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Reading MTEMAP section and populate attributes&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">mt_or_emap_section_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">mtsectinfo</span> <span class="o">=</span><span class="n">mt_or_emap_section_list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectinfo</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Nonelist can not be read.Please provide the right MT section list info.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">CSex</span><span class="o">.</span><span class="n">pyCSAMTError_EDI</span><span class="p">(</span><span class="s1">&#39;Nonelist found. cannot read MTsection info. Please provide the riht path.&#39;</span><span class="p">)</span>
        

        <span class="k">for</span> <span class="n">ii</span> <span class="p">,</span> <span class="n">mtinfo</span> <span class="ow">in</span> <span class="nb">enumerate</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectinfo</span><span class="p">):</span>
            
            <span class="k">try</span> <span class="p">:</span> 
                <span class="n">mtinfo</span> <span class="o">=</span><span class="n">mtinfo</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">mtkey</span><span class="p">,</span> <span class="n">mtvalue</span> <span class="o">=</span> <span class="n">mtinfo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mtvalue</span> <span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">mtvalue</span> <span class="o">==</span><span class="s1">&#39;**&#39;</span> <span class="p">:</span> <span class="n">mtvalue</span> <span class="o">=</span><span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="p">:</span><span class="k">pass</span> 
            <span class="k">else</span> <span class="p">:</span> 
                <span class="n">mtkey</span><span class="p">,</span> <span class="n">mtvalue</span> <span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="n">mtkey</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">func</span><span class="o">.</span><span class="n">_strip_item</span><span class="p">(</span><span class="n">item_to_clean</span><span class="o">=</span><span class="n">mtvalue</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">mtkey</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">mtvalue</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mtkey</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;sectid&#39;</span> <span class="ow">or</span> <span class="n">mtkey</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;nfreq&#39;</span> <span class="p">:</span><span class="n">fmt</span> <span class="o">=</span><span class="s1">&#39;</span><span class="si">{:&gt;7}</span><span class="s1">&#39;</span>
                <span class="n">mtemapsectionlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtkey</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mtvalue</span><span class="p">))]))</span>
        
        <span class="c1">#check the mtsection and fill it is None or 0.00</span>
        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span> <span class="n">olditem</span>  <span class="ow">in</span> <span class="nb">enumerate</span> <span class="p">(</span><span class="n">mtemapsectionlist</span><span class="p">):</span> 
            <span class="k">if</span> <span class="s1">&#39;sectid&#39;</span> <span class="ow">in</span> <span class="n">olditem</span> <span class="p">:</span>
                <span class="n">newitem</span> <span class="o">=</span> <span class="n">olditem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">try</span> <span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">newitem</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="p">:</span> <span class="k">pass</span> 
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">mtemapsectionlist</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;sectid&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_sectid</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>   <span class="c1"># for consistency try to leave return if exists</span>
                    
        <span class="c1">#--&gt; rewrite the list for consistency </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;FileType with DataType supposed to be written is on &lt;</span><span class="si">%s</span><span class="s1">&gt;_sect format &#39;</span> <span class="o">%</span> <span class="n">mtemapsectionlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectinfo</span> <span class="o">=</span><span class="n">mtemapsectionlist</span></div>
        
<div class="viewcode-block" id="MTEMAP.write_mtemap_section"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.MTEMAP.write_mtemap_section">[docs]</a>    <span class="k">def</span> <span class="nf">write_mtemap_section</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mt_or_emap_section_list</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">nfreq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to write MT or EMAP section into list : provide list as [&#39;key01= value01&#39;, ..., keyxx=valuexx ]</span>
<span class="sd">        Method can recognize whether edifile provided is MT or EMAP , Then can read file according to. </span>
<span class="sd">        param :mt_or_emap_section_list :list :list of mt or eamp sectiionvalidate by egal (&#39;=&#39;)</span>
<span class="sd">        eg ::    </span>
<span class="sd">                &gt;&gt;&gt; mtemapinfo ={&#39;sectid&#39;:&#39;yobkro&#39;,&#39;nfreq&#39;:18 , &#39;maxblks&#39;:100, &#39;hx&#39;:&quot;1003.1&quot;,</span>
<span class="sd">                         &#39;ex&#39;:&#39;1005.4&#39;,&#39;hz&#39;:&#39;1006.3&#39;, &#39;ey&#39;:1002.3 , &#39;hy&#39;:&#39;1000.2&#39;}#&#39;chksum&#39;:18, &#39;ndipole&#39;:47, &#39;type&#39;:&#39;hann&#39;</span>
<span class="sd">                &gt;&gt;&gt; mtemapsection_obj = MTEMAP(**mtinfo)</span>
<span class="sd">                ... writeinfomtemapsect = mtemapsection_obj.write_mtemap_section()</span>
<span class="sd">                ... print(writeinfomtemapsect)</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;Writing MT or EMAP section&#39;</span><span class="p">)</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:&gt;7}</span><span class="s1">&#39;</span>
        <span class="n">write_lines</span><span class="p">,</span> <span class="n">mtemapList</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;&gt;=MTSECT</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">],[]</span>
        <span class="n">infoType</span> <span class="o">=</span><span class="kc">None</span>          <span class="c1">#flag to check whether edifile is MT or EMAP</span>
        <span class="k">if</span> <span class="n">mt_or_emap_section_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectinfo</span> <span class="o">=</span> <span class="n">mt_or_emap_section_list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectinfo</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="k">for</span> <span class="n">keyitem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectinfo</span><span class="p">:</span> 
                <span class="n">key</span><span class="p">,</span> <span class="n">itemval</span> <span class="o">=</span> <span class="n">keyitem</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectkey</span> <span class="p">:</span> 
                    <span class="k">if</span>  <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;ndipole&#39;</span><span class="p">,</span> <span class="s1">&#39;chksum&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">itemval</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="p">:</span>
                            <span class="n">infoType</span> <span class="o">=</span><span class="s1">&#39;&gt;=EMAPSECT</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="n">write_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0:&lt;7}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">itemval</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">]))</span>  
                        <span class="k">else</span> <span class="p">:</span><span class="k">continue</span>
                    <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;ey&#39;</span><span class="p">,</span> <span class="s1">&#39;hx&#39;</span><span class="p">,</span> <span class="s1">&#39;hy&#39;</span><span class="p">,</span> <span class="s1">&#39;hz&#39;</span><span class="p">]:</span>
                        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:&gt;12}</span><span class="s1">&#39;</span>
                        <span class="n">write_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">itemval</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
                    
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;nfreq&#39;</span><span class="p">:</span> 
                            <span class="k">if</span> <span class="n">nfreq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">itemval</span><span class="o">=</span> <span class="n">nfreq</span>
                        <span class="n">write_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0:&lt;7}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">itemval</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">]))</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectinfo</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="c1"># the case to convert file , set attribute </span>

            <span class="k">for</span> <span class="n">keyi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtemapsectkey</span> <span class="p">:</span> 
                <span class="n">mtvalue</span> <span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyi</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">keyi</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;ndipole&#39;</span><span class="p">,</span> <span class="s1">&#39;chksum&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">mtvalue</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="p">:</span> <span class="n">infoType</span> <span class="o">=</span> <span class="s1">&#39;&gt;=EMAPSECT</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="k">else</span> <span class="p">:</span><span class="k">continue</span>
                <span class="k">if</span> <span class="n">mtvalue</span> <span class="o">==</span><span class="kc">None</span> <span class="p">:</span> <span class="n">mtvalue</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> 
                <span class="k">if</span> <span class="n">keyi</span> <span class="o">==</span><span class="s1">&#39;nfreq&#39;</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="n">nfreq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">mtvalue</span> <span class="o">=</span> <span class="n">nfreq</span>
                <span class="k">if</span> <span class="n">keyi</span>  <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;ey&#39;</span><span class="p">,</span> <span class="s1">&#39;hx&#39;</span><span class="p">,</span> <span class="s1">&#39;hy&#39;</span><span class="p">,</span> <span class="s1">&#39;hz&#39;</span><span class="p">]:</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:&gt;12}</span><span class="s1">&#39;</span>
                    <span class="n">write_lines</span> <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyi</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mtvalue</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">]))</span>
                <span class="k">else</span> <span class="p">:</span> <span class="n">write_lines</span> <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;  </span><span class="si">{0:&lt;}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyi</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mtvalue</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">]))</span>
        
        <span class="k">if</span> <span class="n">infoType</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span><span class="k">return</span>  <span class="n">write_lines</span>
        <span class="k">if</span> <span class="n">infoType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
            <span class="n">write_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">infoType</span>
            <span class="k">for</span> <span class="n">newitem</span> <span class="ow">in</span> <span class="n">write_lines</span> <span class="p">:</span><span class="c1"># reduce unuseless components for EMAP</span>
                <span class="k">if</span> <span class="n">newitem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;EX&#39;</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">newitem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">newitem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;HZ&#39;</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span>  <span class="p">:</span><span class="k">pass</span>
                <span class="k">else</span> <span class="p">:</span> <span class="n">mtemapList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newitem</span><span class="p">)</span>
                
            <span class="k">return</span> <span class="n">mtemapList</span></div></div>


<div class="viewcode-block" id="References"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.References">[docs]</a><span class="k">class</span> <span class="nc">References</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rfeerences information for a citation.</span>

<span class="sd">    Holds the following information:</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    Attributes         Type        Explanation</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    author            string      Author names</span>
<span class="sd">    title             string      Title of article, or publication</span>
<span class="sd">    journal           string      Name of journal</span>
<span class="sd">    doi               string      DOI number </span>
<span class="sd">    year              int         year published</span>
<span class="sd">    ================= =========== =============================================</span>

<span class="sd">    More attributes can be added by inputing a key word dictionary</span>
<span class="sd">    e:g :</span>
<span class="sd">        &gt;&gt;&gt; refobj = References(**{&#39;volume&#39;:18, &#39;pages&#39;:&#39;234--214&#39;, </span>
<span class="sd">                                   &#39;title&#39;:&#39;pyCSAMT :python toolbox for CSAMT&#39; ,</span>
<span class="sd">                          &#39;journal&#39;:&#39;Computers and Geosciences&#39;, </span>
<span class="sd">                          &#39;year&#39;:&#39;2021&#39;, &#39;author&#39;:&#39;DMaryE&#39;})</span>
<span class="sd">        ... print(refobj.journal)</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;journal&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;doi&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]:</span> 
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>



<div class="viewcode-block" id="Copyright"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Copyright">[docs]</a><span class="k">class</span> <span class="nc">Copyright</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Information of copyright, mainly about how someone else can use these</span>
<span class="sd">    data. Be sure to read over the conditions_of_use.</span>

<span class="sd">    Holds the following information:</span>

<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    Attributes         Type        Explanation</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    references         References  citation of published work using these data</span>
<span class="sd">    conditions_of_use string      conditions of use of data used for testing program</span>
<span class="sd">    release_status    string      release status [ open | public | proprietary]</span>
<span class="sd">    ================= =========== =============================================</span>

<span class="sd">    More attributes can be added by inputing a key word dictionary</span>

<span class="sd">    &gt;&gt;&gt; Copyright(**{&#39;owner&#39;:&#39;University of CSAMT&#39;, &#39;contact&#39;:&#39;Cagniard&#39;})</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">References</span> <span class="o">=</span> <span class="n">References</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditions_of_use</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;All data sets located in the &quot;data&quot; directory &lt;csamtpy/data&gt; may be used&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;to test the performance of the software &quot;pyCSAMT&quot;&#39;</span><span class="p">,</span> 
                                          <span class="s1">&#39;but cannot be used for commercial and distributive purposes&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;. They can only be used for understanding the program and cannot&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39; be distributed to a third party. However, user can go to IRIS &#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;website: http://ds.iris.edu/ds/tags/magnetotelluric-data/ to download &#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;metadata from other useful tests. All data and metadata from  this site are&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;available free of charge and may be copied freely, duplicated and further distributed&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;provided this data set is cited as the reference.&#39;</span><span class="p">])</span>
                                          
        <span class="bp">self</span><span class="o">.</span><span class="n">release_status</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>


<div class="viewcode-block" id="Source"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Source">[docs]</a><span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Information of the file history, how it was made</span>

<span class="sd">    Holds the following information:</span>

<span class="sd">    ====================== =========== ========================================</span>
<span class="sd">    Attributes             Type        Explanation</span>
<span class="sd">    ====================== =========== ========================================</span>
<span class="sd">    project                string      where the project have been done </span>
<span class="sd">    sitename               string      where the survey have been taken place</span>
<span class="sd">    creationdate           string      creation time of file YYYY-MM-DD,hh:mm:ss</span>
<span class="sd">    creatingsoftware       string      name of program creating the file</span>
<span class="sd">    author                 Person      person whom created the file</span>
<span class="sd">    submitter              Person      person whom is submitting file for</span>
<span class="sd">                                       archiving</span>
<span class="sd">    ====================== =========== ========================================</span>

<span class="sd">    More attributes can be added by inputing a key word dictionary</span>

<span class="sd">    &gt;&gt;&gt;Source(**{&#39;archive&#39;:&#39;IRIS&#39;, &#39;reprocessed_by&#39;:&#39;grad_student&#39;})</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">,</span> <span class="s1">&#39;survey&#39;</span><span class="p">,</span> <span class="s1">&#39;sitename&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creationdate</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%M-%D - %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creatingsoftware</span> <span class="o">=</span> <span class="s1">&#39;pyCSAMT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Author</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Recipient</span> <span class="o">=</span><span class="n">Person</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>



<div class="viewcode-block" id="Person"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Person">[docs]</a><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Information for a person</span>

<span class="sd">    Holds the following information:</span>

<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    Attributes         Type        Explanation</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    email             string      email of person</span>
<span class="sd">    name              string      name of person</span>
<span class="sd">    organization      string      name of person&#39;s organization</span>
<span class="sd">    organization_url  string      organizations web address</span>
<span class="sd">    ================= =========== =============================================</span>

<span class="sd">    More attributes can be added by inputing a key word dictionary</span>

<span class="sd">    &gt;&gt;&gt; person =Person(**{&#39;name&#39;:&#39;ABA&#39;, &#39;email&#39;:&#39;aba@cagniard.res.org&#39;,</span>
<span class="sd">                          &#39;phone&#39;:&#39;00225-0769980706&#39;, </span>
<span class="sd">                  &#39;organization&#39;:&#39;CagniadRES&#39;})</span>
<span class="sd">    ... person.name , person.organisation --&gt;output: ABA , CagniardRES</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;organization&#39;</span><span class="p">,</span> <span class="s1">&#39;organization_url&#39;</span><span class="p">]:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>



<div class="viewcode-block" id="Processing"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Processing">[docs]</a><span class="k">class</span> <span class="nc">Processing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Information for a Edi processing</span>

<span class="sd">    Holds the following information:</span>

<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    Attributes         Type        Explanation</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    ProcessingSoftware class      Software obj : Input software info.</span>
<span class="sd">    processedby        str        name handler of dataprocessing</span>
<span class="sd">    processingtag      str        specifictag</span>
<span class="sd">    runlist            list         ---</span>
<span class="sd">    remoteref                     reference point for remoting </span>
<span class="sd">    remotesite          str       reference site name </span>
<span class="sd">    signconvention     str        convention sign provide default</span>
<span class="sd">    ================= =========== =============================================</span>

<span class="sd">    More attributes can be added by inputing a key word dictionary</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;processedby&#39;</span><span class="p">,</span> <span class="s1">&#39;processingtag&#39;</span><span class="p">,</span> <span class="s1">&#39;runlist&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;remoteref&#39;</span><span class="p">,</span> <span class="s1">&#39;remotesite&#39;</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ProcessingSoftware</span> <span class="o">=</span> <span class="n">Software</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signconvention</span> <span class="o">=</span> <span class="s1">&#39;exp(+i \omega t)&#39;</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>


<div class="viewcode-block" id="Software"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.Software">[docs]</a><span class="k">class</span> <span class="nc">Software</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    software info </span>
<span class="sd">    </span>
<span class="sd">    Holds the following information:</span>

<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    Attributes         Type        Explanation</span>
<span class="sd">    ================= =========== =============================================</span>
<span class="sd">    name                string      name of software </span>
<span class="sd">    version             string      version of sotware </span>
<span class="sd">    Author              string      Author of software</span>
<span class="sd">    release             string      latest version release</span>
<span class="sd">    ================= =========== =============================================</span>

<span class="sd">    More attributes can be added by inputing a key word dictionary</span>

<span class="sd">    &gt;&gt;&gt; Software(**{&#39;release&#39;:&#39;0.11.23&#39;})</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;realease&#39;</span><span class="p">]</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Author</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>  </div>
            
<div class="viewcode-block" id="minimum_parser_to_write_edi"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.minimum_parser_to_write_edi">[docs]</a><span class="k">def</span> <span class="nf">minimum_parser_to_write_edi</span> <span class="p">(</span><span class="n">edilines</span><span class="p">,</span> <span class="n">parser</span> <span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This fonction validate edifile for writing , string with egal. We assume that </span>
<span class="sd">    dictionnary in list will be for definemeasurment E and H fieds. </span>
<span class="sd">    param : edilines : list : list of item to parse </span>
<span class="sd">            parser  : str : the egal is use  to parser edifile . it can be change </span>
<span class="sd">            default is egal (=)</span>
<span class="sd">    eg:         </span>
<span class="sd">                &gt;&gt;&gt; file_edi= &#39;S00_ss.edi&#39;</span>
<span class="sd">                &gt;&gt;&gt; path =  os.path.join(os.environ[&quot;pyCSAMT&quot;], &#39;csamtpy&#39;,&#39;data&#39;, file_edi_2)</span>
<span class="sd">                &gt;&gt;&gt; definemeas =DefineMeasurement.get_measurement_info(edi_fn=path)</span>
<span class="sd">                ... minimparser = minimum_parser_to_write_edi(edilines =definemeas.define_measurement)</span>
<span class="sd">                ... print(minimparser)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span><span class="n">parser</span> <span class="o">=</span><span class="s1">&#39;=&#39;</span>
    <span class="k">elif</span> <span class="n">parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Parser must a string value like &lt;&quot;=&quot;, ...&gt;&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edilines</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edilines</span> <span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="p">:</span> <span class="n">edilines</span> <span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">edilines</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span><span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;&lt;edilines&gt; argument  must be on list of string with egal&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">lines</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edilines</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span><span class="k">continue</span> 
        <span class="k">elif</span> <span class="n">lines</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">0</span> <span class="p">:</span> 
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span> <span class="p">(</span><span class="s1">&#39;None &lt;&quot;=&quot;&gt; found on this item&lt;</span><span class="si">{0}</span><span class="s1">&gt; of  the edilines list. list can not&#39;</span>\
            <span class="s1">&#39; be parsed.Please put egal between key and value &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
            <span class="k">return</span> <span class="kc">None</span> 
        
    <span class="k">return</span> <span class="n">edilines</span> </div>

<div class="viewcode-block" id="gather_measurement_key_value_with_str_parser"><a class="viewcode-back" href="../../../../csamt.html#csamtpy.ff.core.edi.gather_measurement_key_value_with_str_parser">[docs]</a><span class="k">def</span> <span class="nf">gather_measurement_key_value_with_str_parser</span> <span class="p">(</span><span class="n">old_measurement_list</span><span class="p">,</span> <span class="n">parser</span> <span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fonction to rebuild xmeasurement list , to solder list with egal. In the case no value is found at </span>
<span class="sd">    the last item, we will add None . </span>
<span class="sd">    param : old_measurement_list :list : measurement list to solder : </span>
<span class="sd">        parser : str : can be egal or all you want . Default is None mean parser &#39;=&#39;. </span>
<span class="sd">    </span>
<span class="sd">    return new_list :list : listsolded with egal like : &lt;key=value&gt; </span>
<span class="sd">    eg : </span>
<span class="sd">           &gt;&gt;&gt; measm = [ [&#39;&gt;HMEAS&#39;, &#39;ID=1001.001&#39;, &#39;CHTYPE=HX&#39;, &#39;X=&#39;, &#39;0.0&#39;, &#39;Y=&#39;, &#39;0.0&#39;, &#39;Z=&#39;, &#39;0.0&#39;, &#39;AZM=&#39;, &#39;0.0&#39;, &#39;TS=&#39;],</span>
<span class="sd">                            [&#39;&gt;HMEAS&#39;, &#39;ID=1002.001&#39;, &#39;CHTYPE=HY&#39;, &#39;X=&#39;, &#39;0.0&#39;, &#39;Y=&#39;, &#39;0.0&#39;, &#39;Z=&#39;, &#39;0.0&#39;, &#39;AZM=&#39;, &#39;90.0&#39;],</span>
<span class="sd">                            [&#39;&gt;HMEAS&#39;, &#39;ID=1003.001&#39;, &#39;CHTYPE=HZ&#39;, &#39;X=&#39;, &#39;0.0&#39;, &#39;Y=&#39;, &#39;0.0&#39;, &#39;Z=&#39;, &#39;0.0&#39;, &#39;AZM=&#39;, &#39;0.0&#39;, &#39;TS=&#39;, &#39;&#39;]] </span>
<span class="sd">           &gt;&gt;&gt; for item in measm: </span>
<span class="sd">               print(gather_measurement_key_value_with_str_parser(old_measurement_list=item) )</span>
<span class="sd">                   .... [&#39;ID=1001.001&#39;, &#39;CHTYPE=HX&#39;, &#39;X=0.0&#39;, &#39;Y=0.0&#39;, &#39;Z=0.0&#39;, &#39;AZM=0.0&#39;, &#39;TS=None&#39;]</span>
<span class="sd">                   ... [&#39;ID=1002.001&#39;, &#39;CHTYPE=HY&#39;, &#39;X=0.0&#39;, &#39;Y=0.0&#39;, &#39;Z=0.0&#39;, &#39;AZM=90.0&#39;]</span>
<span class="sd">                   ... [&#39;ID=1003.001&#39;, &#39;CHTYPE=HZ&#39;, &#39;X=0.0&#39;, &#39;Y=0.0&#39;, &#39;Z=0.0&#39;, &#39;AZM=0.0&#39;, &#39;TS=None&#39;]</span>
<span class="sd">                       </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># print(old_measurement_list)</span>
    
    <span class="n">new_list</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="p">[[]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span><span class="n">parser</span> <span class="o">=</span><span class="s1">&#39;=&#39;</span> 
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">old_measurement_list</span><span class="p">):</span> 
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span>          <span class="c1"># where there is many egal =</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>       <span class="c1">#split assume that there is space</span>
            <span class="n">old_measurement_list</span><span class="o">=</span><span class="n">old_measurement_list</span><span class="p">[:</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">old_measurement_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="k">break</span> 

    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span> <span class="p">(</span><span class="n">old_measurement_list</span><span class="p">):</span>  <span class="c1"># chech whether there is eg: [X=,&#39;&#39;]</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span> <span class="o">==</span><span class="mi">1</span> <span class="p">:</span> 
            <span class="n">itemf</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">itemf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span><span class="s1">&#39;&#39;</span>  <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span> 
                <span class="k">try</span> <span class="p">:</span> <span class="n">addvalue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">old_measurement_list</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="p">:</span>
                    <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">]))</span>
                    <span class="k">pass</span>
                <span class="k">else</span> <span class="p">:</span> <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">addvalue</span><span class="p">)]))</span>

    <span class="k">return</span> <span class="n">new_list</span></div>
                        

                 

<span class="c1"># if __name__== &#39;__main__&#39;: </span>
<span class="c1">#     file_14 =&#39;csi000.dat&#39;</span>
<span class="c1">#     file_edi_2=&#39;SAMTEX.edi_2.edi&#39;</span>
<span class="c1">#     file_edi_3 =&#39;csa000j.edi&#39;</span>
    
<span class="c1">#     file_edi_1= &#39;S00_ssmtpy.edi&#39;</span>
<span class="c1">#     file_edi_4 =&#39;testemap2.edi&#39;</span>

<span class="c1">#     path =  os.path.join(os.environ[&quot;pyCSAMT&quot;], </span>
<span class="c1">#                           &#39;csamtpy&#39;,&#39;data&#39;, file_edi_2)</span>
  
<span class="c1">#     # Info.</span>
<span class="c1">#     edi_obj =Edi(edi_filename=path)</span>
<span class="c1">#     edi_obj.write_edifile(new_edifilename= &#39;TEST.edi&#39;, savepath =pathi, )</span>
  
<span class="c1">#     # d=edi_obj.DefineMeasurement.define_measurement</span>
<span class="c1">#     # e= edi_obj.MTEMAP.mtemapsectinfo</span>
  
    
  
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pyCSAMT v1.0.01 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Kouadio K. Laurent.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.0.
    </div>
  </body>
</html>